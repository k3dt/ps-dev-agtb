var UITools={index:0,getIndex:function(){return this.index+=1}},getRelativePosition=function(a,b){var c=$(a).offset(),d=$(b).get(0)instanceof Document?{top:0,left:0}:$(b).offset();return{top:c.top-d.top,left:c.left-d.left}};function isHTMLElement(a){try{return a instanceof HTMLElement}catch(b){return"object"===typeof a&&1===a.nodeType&&"object"===typeof a.style&&"object"===typeof a.ownerDocument}}function isInDOM(a){return jQuery(a).parents("body:last").get(0)===document.body}
function cloneObject(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}var Style=function(a){this.belongsTo=this.cssClasses=this.cssProperties=null;Style.prototype.initObject.call(this,a)};Style.prototype.type="Style";Style.MAX_ZINDEX=100;Style.prototype.initObject=function(a){var b={cssClasses:[],cssProperties:{},belongsTo:null};$.extend(!0,b,a);this.cssClasses=b.cssClasses;this.cssProperties=b.cssProperties;this.belongsTo=b.belongsTo};
Style.prototype.applyStyle=function(){if(!this.belongsTo.html)throw Error("applyStyle(): can't apply style to an object with no html");var a,b;$(this.belongsTo.html).css(this.cssProperties);for(a=0;a<this.cssClasses.length;a+=1)b=this.cssClasses[a],$(this.belongsTo.html).hasClass(b)||$(this.belongsTo.html).addClass(b);return this};Style.prototype.addProperties=function(a){$.extend(!0,this.cssProperties,a);$(this.belongsTo.html).css(a);return this};
Style.prototype.getProperty=function(a){return this.cssProperties[a]||$(this.belongsTo.html).css(a)||window.getComputedStyle(this.belongsTo.html,null).getPropertyValue(a)};Style.prototype.removeProperties=function(a){var b,c;for(c=0;c<a.length;c+=1)b=a[c],this.cssProperties.hasOwnProperty(b)&&($(this.belongsTo.html).css(b,""),delete this.cssProperties[b]);return this};
Style.prototype.addClasses=function(a){var b,c;if(a&&a instanceof Array)for(b=0;b<a.length;b+=1)if(c=a[b],"string"===typeof c)-1===this.cssClasses.indexOf(c)&&(this.cssClasses.push(c),$(this.belongsTo.html).addClass(c));else throw Error("addClasses(): array element is not of type string");else throw Error("addClasses(): parameter must be of type Array");return this};
Style.prototype.removeClasses=function(a){var b,c;if(a&&a instanceof Array)for(b=0;b<a.length;b+=1)if(c=a[b],"string"===typeof c)c=this.cssClasses.indexOf(c),-1!==c&&($(this.belongsTo.html).removeClass(this.cssClasses[c]),this.cssClasses.splice(c,1));else throw Error("removeClasses(): array element is not of type string");else throw Error("removeClasses(): parameter must be of type Array");return this};
Style.prototype.removeAllClasses=function(){this.cssClasses=[];$(this.belongsTo.html).removeClass();return this};Style.prototype.containsClass=function(a){return-1!==this.cssClasses.indexOf(a)};Style.prototype.getClasses=function(){return this.cssClasses};Style.prototype.stringify=function(){return{cssClasses:this.cssClasses}};
var ArrayList=function(){var a=[],b=0,c,d;return{id:Math.random(),get:function(b){return a[b]},insert:function(c){a[b]=c;b+=1;return this},insertAt:function(c,d){a.splice(d,0,c);b=a.length;return this},remove:function(d){c=this.indexOf(d);if(-1===c)return!1;b-=1;a.splice(c,1);return!0},getSize:function(){return b},isEmpty:function(){return 0===b},indexOf:function(c){for(d=0;d<b;d+=1)if(c.id===a[d].id)return d;return-1},find:function(b,c){var d,h;for(d=0;d<a.length;d+=1)if(h=a[d],h[b]===c)return h},
contains:function(a){return-1!==this.indexOf(a)?!0:!1},sort:function(b){var c=!1;b&&(a.sort(b),c=!0);return c},asArray:function(){return a},getFirst:function(){return a[0]},getLast:function(){return a[b-1]},popLast:function(){var c;b-=1;c=a[b];a.splice(b,1);return c},getDimensionLimit:function(){var c=[1E5,-1,-1,1E5];for(d=0;d<b;d+=1)c[0]>a[d].y&&(c[0]=a[d].y),c[1]<a[d].x+a[d].width&&(c[1]=a[d].x+a[d].width),c[2]<a[d].y+a[d].height&&(c[2]=a[d].y+a[d].height),c[3]>a[d].x&&(c[3]=a[d].x);return c},clear:function(){0!==
b&&(a=[],b=0);return this},getCanvas:function(){return 0<this.getSize()?this.get(0).getCanvas():void 0}}};"undefined"!==typeof exports&&(module.exports=ArrayList);var Base=function(a){var b={id:a&&a.id||"base-ui-"+UITools.getIndex()};$.extend(!0,b,a);this.id=b.id};Base.prototype.setId=function(a){this.id=a;return this};Base.prototype.type="Core";Base.prototype.family="Core";Base.prototype.getType=function(){return this.type};Base.prototype.getFamily=function(){return this.family};
Base.prototype.dispose=function(){for(var a in this)this[a]=null};"undefined"!==typeof exports&&(module.exports=Base);var Proxy=function(a){Base.call(this,a);this.callback=this.url=null;Proxy.prototype.initObject.call(this,a)};Proxy.prototype=new Base;Proxy.prototype.type="Proxy";Proxy.prototype.family="Proxy";Proxy.prototype.initObject=function(a){var b={url:null,callback:null};$.extend(!0,b,a);this.setUrl(b.url).setCallback(b.callback)};Proxy.prototype.setUrl=function(a){this.url=a;return this};
Proxy.prototype.setCallback=function(a){this.callback=a;return this};Proxy.prototype.getData=function(){};Proxy.prototype.sendData=function(a,b){};var Element=function(a){Base.call(this,a);this.zOrder=this.visible=this.style=this.html=this.height=this.width=this.y=this.x=null;Element.prototype.initObject.call(this,a)};Element.prototype=new Base;Element.prototype.type="Base";Element.prototype.family="Base";
Element.prototype.initObject=function(a){var b={style:{cssProperties:{},cssClasses:[]},width:0,height:0,x:0,y:0,zOrder:1,visible:!0};$.extend(!0,b,a);this.setStyle(new Style({belongsTo:this,cssProperties:b.style.cssProperties,cssClasses:b.style.cssClasses})).setDimension(b.width,b.height).setPosition(b.x,b.y).setZOrder(b.zOrder).setVisible(b.visible)};Element.prototype.setId=function(a){this.id=a;this.html&&(this.html.id=this.id);return this};
Element.prototype.setX=function(a){if("number"===typeof a)this.x=a,this.html&&this.style.addProperties({left:this.x});else throw Error("setX: x param is not a number");return this};Element.prototype.setY=function(a){if("number"===typeof a)this.y=a,this.html&&this.style.addProperties({top:this.y});else throw Error("setY: y param is not a number");return this};
Element.prototype.setWidth=function(a){if("number"===typeof a)this.width=a,this.html&&this.style.addProperties({width:this.width});else throw Error("setWidth: w is not a number");return this};Element.prototype.setHeight=function(a){if("number"===typeof a)this.height=a,this.html&&this.style.addProperties({height:this.height});else throw Error("setHeight: h is not a number");return this};Element.prototype.setPosition=function(a,b){this.setX(a);this.setY(b);return this};
Element.prototype.setDimension=function(a,b){this.setWidth(a);this.setHeight(b);return this};Element.prototype.setZOrder=function(a){"number"===typeof a&&0<a&&(this.zOrder=a,this.html&&this.style.addProperties({zIndex:this.zOrder}));return this};Element.prototype.setVisible=function(a){_.isBoolean(a)&&(this.visible=a,this.html&&(a?this.style.addProperties({display:"inline"}):this.style.addProperties({display:"none"})));return this};
Element.prototype.setStyle=function(a){a instanceof Style&&(this.style=a);return this};Element.prototype.createHTMLElement=function(a){return document.createElement(a)};Element.prototype.createHTML=function(){this.html||(this.html=this.createHTMLElement("div"),this.html.id=this.id,this.style.applyStyle(),this.style.addProperties({position:"absolute",left:this.x,top:this.y,width:this.width,height:this.height,zIndex:this.zOrder}));return this.html};Element.prototype.paint=function(){};
Element.prototype.getHTML=function(){this.html||this.createHTML();return this.html};Element.prototype.calculateWidth=function(a,b){var c=b||"12px arial",d=$(this.createHTMLElement("div"));d.text(a).css({position:"absolute","float":"left","white-space":"nowrap",visibility:"hidden",font:c}).appendTo($("body"));c=d.width();d.remove();return c};var SugarProxy=function(a){Proxy.call(this,a);this.sendMethod=this.getMethod=this.uid=null;SugarProxy.prototype.initObject.call(this,a)};
SugarProxy.prototype=new Proxy;SugarProxy.prototype.type="SugarProxy";SugarProxy.prototype.initObject=function(a){var b={sendMethod:"PUT",getMethod:"GET",createMethod:"POST",uid:null};$.extend(!0,b,a);this.setUid(b.uid).setSendMethod(b.sendMethod).setGetMethod(b.getMethod).setCreateMethod(b.createMethod)};SugarProxy.prototype.setUid=function(a){this.uid=a;return this};SugarProxy.prototype.setSendMethod=function(a){this.sendMethod=a;return this};
SugarProxy.prototype.setGetMethod=function(a){this.getMethod=a;return this};SugarProxy.prototype.setCreateMethod=function(a){this.createMethod=a;return this};SugarProxy.prototype.getData=function(a,b){var c,d=this,e;c=this.getOperation(this.getMethod);e="read"===c&&a?App.api.buildURL(this.url,null,null,a):App.api.buildURL(this.url,null,null);App.api.call(c,e,{},{success:function(a){b&&b.success&&b.success.call(d,a)},error:function(a){b&&"function"===typeof b.error&&b.error.call(d,a)}})};
SugarProxy.prototype.sendData=function(a,b){var c,d=this,e;c=this.getOperation(this.sendMethod);e=App.api.buildURL(this.url,null,null);attributes={data:a};App.api.call(c,e,attributes,{success:function(a){b&&b.success&&b.success.call(d,a)}})};SugarProxy.prototype.createData=function(a,b){var c,d=this,e;c=this.getOperation(this.createMethod);e=App.api.buildURL(this.url,null,null);attributes={data:a};App.api.call(c,e,attributes,{success:function(a){b&&b.success&&b.success.call(d,a)}})};
SugarProxy.prototype.removeData=function(a,b){var c=this,d;d=a?App.api.buildURL(this.url,null,null,a):App.api.buildURL(this.url,null,null);App.api.call("delete",d,{},{success:function(a){b&&b.success&&b.success.call(c,a)}})};SugarProxy.prototype.getOperation=function(a){var b;switch(a){case "GET":b="read";break;case "POST":b="create";break;case "PUT":b="update";break;case "DELETE":b="delete"}return b};
var ExpressionContainer=function(a,b){Element.call(this,a);this.onChange=this.parent=this.value=this.expression=this.tooltipHandler=null;ExpressionContainer.prototype.init.call(this,a,b)};ExpressionContainer.prototype=new Element;ExpressionContainer.prototype.type="ExpressionContainer";ExpressionContainer.prototype.family="ExpressionContainer";ExpressionContainer.prototype.init=function(a,b){var c={expression:[],onChange:null};$.extend(!0,c,a);this.setExpressionValue(c.expression).setParent(b).setOnChangeHandler(c.onChange)};
ExpressionContainer.prototype.setOnChangeHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnChangeHandler(): The parameter must be a function or null.");this.onChange=a;return this};ExpressionContainer.prototype.setExpressionValue=function(a){this.expression=a;this.updateExpressionView();return this};ExpressionContainer.prototype.setParent=function(a){this.parent=a;return this};ExpressionContainer.prototype.clear=function(){return this};
ExpressionContainer.prototype.remove=function(){$(this.html).remove();delete this.tooltipHandler;delete this.expression;delete this.value;delete this.parent};ExpressionContainer.prototype.getObject=function(){return this.expression};ExpressionContainer.prototype.isValid=function(){return!0};
ExpressionContainer.prototype.createHTML=function(){var a,b;if(this.html)return this.html;b=this.createHTMLElement("span");a=this.createHTMLElement("div");a.className="expression-container-cell";$(a).attr("data-placement","bottom");a.setAttributeNode(document.createAttribute("title"));b.appendChild(a);this.html=b;this.dvContainer=a;this.updateExpressionView();this.attachListeners();return this.html};
ExpressionContainer.prototype.updateExpressionView=function(){var a=this.parseValue(this.expression),b;b=$(this.dvContainer);b.text(a);b.attr("data-original-title",a);return this};ExpressionContainer.prototype.parseValue=function(a){var b="";if(a)for(i=0;i<a.length;i+=1)""!==b&&(b+=" "),b+=a[i].expLabel;return b};
ExpressionContainer.prototype.attachListeners=function(){var a=this;if(!this.html)return this;$(this.dvContainer).on("mouseenter",function(){this.offsetWidth<this.scrollWidth&&(this.tooltipHandler=$(this).tooltip({trigger:"manual"}),this.tooltipHandler.tooltip("show"))}).on("mouseleave",function(){this.tooltipHandler&&(this.tooltipHandler.tooltip("destroy"),this.tooltipHandler=null)});$(this.html).on("click",function(){a.handleClick(this)});return this};
ExpressionContainer.prototype.handleClick=function(a){var b,c;b=this.parent.parentElement.parent;c=this.parent.parentElement;c.fieldType||c.isReturnType?"DropDown"===c.fieldType||"Checkbox"===c.fieldType?this.handleDropDownBuilder(b,c,a):this.handleCriteriaBuilder(b,c,a):App.alert.show("expression-variable-click",{level:"warning",messages:"Please define first the column type.",autoClose:!0})};
ExpressionContainer.prototype.handleCriteriaBuilder=function(a,b,c){var d=this,e,f={operators:!1,evaluations:!1,variables:!1,constants:!1},g={};if(a.globalCBControl.isOpen())a.globalCBControl.close();else{a.globalCBControl.setOwner(c);a.globalCBControl.setOnChangeHandler(function(a,b,c){e=JSON.parse(b);d.setExpressionValue(e);if("function"===typeof d.onChange)d.onChange(b,c)});if(b.isReturnType)g={constants:!0,variables:{dataRoot:null,data:b.fields,dataFormat:"tabular",textField:"label",moduleTextField:"moduleText",
moduleValueField:"moduleValue"}};else switch(b.fieldType){case "Date":g={operators:{arithmetic:["+","-"]},constants:{date:!0,timespan:!0},variables:{dataRoot:null,data:b.fields,dataFormat:"tabular",textField:"label",typeFilter:b.fieldType,moduleTextField:"moduleText",moduleValueField:"moduleValue"}};break;case "TextArea":case "TextField":case "email":case "Phone":case "URL":$.extend(!0,g,{constants:{basic:{string:!0}},variables:{dataRoot:null,data:b.fields,dataFormat:"tabular",textField:"label",typeFilter:b.fieldType,
moduleTextField:"moduleText",moduleValueField:"moduleValue"}});break;case "Integer":$.extend(!0,g,{operators:{arithmetic:!0,group:!0},constants:{basic:{number:!0}},variables:{dataRoot:null,data:b.fields,dataFormat:"tabular",textField:"label",typeFilter:b.fieldType,moduleTextField:"moduleText",moduleValueField:"moduleValue"}});break;default:b.isReturnType&&$.extend(!0,g,{constants:{basic:!0,date:!0}})}$.extend(!0,f,g);a.globalCBControl.setOperators(f.operators).setEvaluations(f.evaluations).setVariablePanel(f.variables).setConstantPanel(f.constants);
a.globalCBControl.setValue(this.expression);a.globalCBControl.open()}};
ExpressionContainer.prototype.handleDropDownBuilder=function(a,b,c){var d=this,e;a.globalDDSelector.isOpen()?a.globalDDSelector.close():(a.globalDDSelector.setOwner(c),a.globalDDSelector.setOnItemValueActionHandler(function(b,c,h){b=JSON.stringify(d.expression);e=0===Object.keys(h).length?[]:[{expType:"CONSTANT",expSubType:"string",expLabel:h.text,expValue:h.value}];d.setExpressionValue(e);a.globalDDSelector.close();if("function"===typeof d.onChange)d.onChange(JSON.stringify(d.expression),b)}),a.globalDDSelector.setValues(b.combos[b.module+
a.moduleFieldSeparator+b.field]),a.globalDDSelector.setValue(this.expression),a.globalDDSelector.open())};
var DecisionTable=function(a){Element.call(this,{id:a.id});this.isDirty=this.showDirtyIndicator=this.onDirty=this.onChange=this.onRemoveRow=this.onAddRow=this.onRemoveColumn=this.onAddColumn=this.width=this.rows=this.decisionRows=this.conclusions=this.conditions=this.proxy=this.name=this.dom=this.hitType=this.base_module=null;this.fields=[];this.combos={};this.language={};this.correctlyBuilt=!1;this.globalDDSelector=this.globalCBControl=null;this.moduleFieldSeparator="|||";DecisionTable.prototype.initObject.call(this,
a||{})};DecisionTable.prototype=new Element;DecisionTable.prototype.type="DecisionTable";
DecisionTable.prototype.initObject=function(a){var b={name:"",proxy:new SugarProxy,restClient:null,base_module:"",type:"multiple",width:"auto",rows:0,container:null,columns:{conditions:[],conclusions:[]},ruleset:[],onAddColumn:null,onRemoveColumn:null,onChange:null,showDirtyIndicator:!0,language:{SINGLE_HIT:"Single Hit",MULTIPLE_HIT:"Multiple Hit",CONDITIONS:"Conditions",CONCLUSIONS:"Conclusions",ADD_ROW:"Add row",REMOVE_ROW:"Remove row",CLICK_TO_EDIT:"Click to edit",ERROR_CONCLUSION_VAR_DUPLICATED:"conclusion variable is duplicated",
ERROR_EMPTY_RETURN_VALUE:'The "Return" conclusion is empty',ERROR_EMPTY_ROW:"No conditions were specified in row with conclusions, It's allowed only one row with no conditions (default ruleset)",ERROR_NOT_EXISTING_FIELDS:"This Business Rules Table can't be created, some required fields are missing: %s.",ERROR_INCORRECT_BUILD:"This Business Rules Table can't is incorrectly built",MSG_DELETE_ROW:"Do you really want to delete this rule set?",MIN_ROWS:"The decision table must have at least 1 row",MIN_CONDITIONS_COLS:"The decision table must have at least 1 condition column",
MIN_CONCLUSIONS_COLS:"The decision table must have at least 1 conclusion column",LBL_RETURN:"Return",ERROR_NO_VARIABLE_SELECTED:"No variable was selected",ERROR_INVALID_EXPRESSION:"Invalid expression",LBL_VARIABLES:"Variables",LBL_CONSTANTS:"Constants",LBL_ADD_CONDITION:"Add condition",LBL_ADD_CONCLUSION:"Add conclusion",ERROR_MISSING_EXPRESSION_OR_OPERATOR:"missing expression or operator"}};$.extend(!0,b,a);this.dom={};this.conclusions=[];this.conditions=[];this.decisionRows=0;this.onAddColumn=b.onAddColumn;
this.onRemoveColumn=b.onRemoveColumn;this.onChange=b.onChange;this.rows=parseInt(b.rows,10);this.language=b.language;this.setName(b.name).setProxy(b.proxy).setBaseModule(b.base_module).setHitType(b.type).setWidth(b.width).setShowDirtyIndicator(b.showDirtyIndicator);b.container&&($(b.container).append(this.getHTML()),this.isDOMNodeInsertedSupported||this.updateDimensions());this.auxConclutions=b.columns.conclusions;this.auxConditions=b.columns.conditions;this.rules=b.ruleset;this.globalCBControl=new ExpressionControl({matchOwnerWidth:!1,
width:250,allowInput:!1,itemContainerHeight:70,appendTo:jQuery("#businessrulecontainer").get(0)});this.globalDDSelector=new DropdownSelector({matchOwnerWidth:!0});this.getFields()};DecisionTable.prototype.setShowDirtyIndicator=function(a){this.showDirtyIndicator=!!a;return this};DecisionTable.prototype.getIsDirty=function(){return this.isDirty};DecisionTable.prototype.setIsDirty=function(a,b){this.isDirty=a;b||"function"===typeof this.onDirty&&this.onDirty.call(this,a);return this};
DecisionTable.prototype.onChangeVariableHandler=function(){var a=this;return function(b,c){var d;d=this.getHTML();d=$(d.parentElement).find(d.tagName.toLowerCase()).index(d);d="condition"===this.variableMode?a.validateColumn(d,0):a.validateColumn(d,1);a.setIsDirty(!0);"function"===typeof a.onChange&&a.onChange.call(a,{object:this,newVal:b,oldVal:c},d)}};
DecisionTable.prototype.onChangeValueHandler=function(){var a=this;return function(b,c,d){var e,f,g;f=(g=b instanceof DecisionTableValueEvaluation)?b.getHTML()[0]:b.getHTML();e=f.parentElement;f=$(f.parentElement).find("td").index(f)/(g?2:1);e=$(e.parentElement).find("tr").index(e);g=a.validateColumn(f,g?0:1);g.valid&&(g=a.validateRow(e));a.setIsDirty(!0);"function"===typeof a.onChange&&a.onChange.call(a,{object:b,newVal:c,oldVal:d},g)}};
DecisionTable.prototype.removeAllConclusions=function(){for(;this.conclusions.length;)this.conclusions[0].remove();return this};DecisionTable.prototype.removeAllConditions=function(){for(;this.conditions.length;)this.conditions[0].remove();return this};DecisionTable.prototype.setConditions=function(a){var b;this.removeAllConditions();for(b=0;b<a.length;b+=1)this.addCondition(a[b]);return this};
DecisionTable.prototype.setConclusions=function(a){var b;this.removeAllConclusions();for(b=0;b<a.length;b+=1)this.addConclusion(!a[b],this.base_module+this.moduleFieldSeparator+a[b]);return this};
DecisionTable.prototype.setRuleset=function(a){var b,c,d={},e={},f,g,h="",k={},l;for(b=0;b<this.conditions.length;b+=1)d[this.conditions[b].select.value]?d[this.conditions[b].select.value].push(b):d[this.conditions[b].select.value]=[b];e.result=0;for(b=1;b<this.conclusions.length;b+=1)e[this.conclusions[b].select.value]=b;for(b=0;b<a.length;b+=1){g=a[b].conditions;f={};for(c=0;c<g.length;c+=1)l=g[c].variable_module+this.moduleFieldSeparator+g[c].variable_name,"undefined"===typeof f[l]&&(f[l]=-1),
f[l]+=1,"undefined"!==typeof d[l]?this.conditions[d[l][f[l]]].addValue(g[c].value,g[c].condition):(k[g[c].variable_module]||(k[g[c].variable_module]={}),k[g[c].variable_module][g[c].variable_name]=0);f=a[b].conclusions;for(c=0;c<f.length;c+=1)l="return"===f[c].conclusion_type?"result":this.base_module+this.moduleFieldSeparator+f[c].conclusion_value,"undefined"!==typeof e[l]?this.conclusions[e[l]].addValue(f[c].value):(k[this.base_module]||(k[this.base_module]={}),k[this.base_module][l]=0);this.addDecisionRow()}for(b in k)if(k.hasOwnProperty(b))for(c in k[b])h+=
", "+b+"::"+c;(h=h.slice(2))?(f=this.html.parentElement,$(this.html).remove(),k=this.createHTMLElement("p"),k.textContent=this.language.ERROR_NOT_EXISTING_FIELDS.replace(/\%s/,h),this.html=this.createHTMLElement("div"),this.html.appendChild(k),f.appendChild(this.html),App.alert.show(null,{level:"error",messages:this.html.textContent})):this.correctlyBuilt=!0;this.updateDimensions();return this};
DecisionTable.prototype.isDOMNodeInsertedSupported=function(){var a=this.createHTMLElement("div"),b=!1;a.addEventListener("DOMNodeInserted",function(){b=!0});a.appendChild(a.cloneNode());return b};DecisionTable.prototype.setRows=function(a){this.rows=parseInt(a,10);return this.updateDimensions()};DecisionTable.prototype.setWidth=function(a){this.width=a;return this.updateDimensions()};
DecisionTable.prototype.updateDimensions=function(){if(!this.html)return this;var a,b,c;"auto"!==this.width?(c=$(this.dom.indexTableContainer).outerWidth()+4,a=$(this.dom.conditionsTable).css("width","").outerWidth(),b=$(this.dom.conclusionsTable).css("width","").outerWidth(),a=Math.floor(a/(a+b)*(this.width-c)),b=this.width-c-a):($(this.dom.conditionsHeader.parentElement).css("width","").find("th").css("width",""),$(this.dom.conclusionsTable).css("width",""),$(this.dom.conclusionsHeader.parentElement).css("width",
"").find("th").css("width",""));this.dom.conditionsTableContainer.style.width=this.dom.conditionsHeaderContainer.style.width="auto"!==this.width?a+"px":"auto";this.dom.conclusionsTableContainer.style.width=this.dom.conclusionsHeaderContainer.style.width="auto"!==this.width?b+"px":"auto";this.decisionRows&&this.rows?(a=$(this.dom.conditionsTable).find("tr").outerHeight(),this.dom.indexTableContainer.style.height=this.dom.conditionsTableContainer.style.height=this.dom.conclusionsTableContainer.style.height=
a*this.rows+10+this.rows+"px"):this.dom.indexTableContainer.style.height=this.dom.conditionsTableContainer.style.height=this.dom.conclusionsTableContainer.style.height="auto";a=$(this.dom.conditionsTable).outerWidth();a<$(this.dom.conditionsTableContainer).width()&&"auto"!==this.width&&(this.dom.conditionsTable.style.width="100%",a=$(this.dom.conditionsTable).outerWidth(),a=2*Math.ceil(a/2));$(this.dom.conditionsHeader.parentElement).css("width",a+"px");a=Math.floor(a/this.conditions.length);$(this.dom.conditionsHeader).find("th").css("width",
a+"px");a=$(this.dom.conclusionsTable).outerWidth();a<$(this.dom.conclusionsTableContainer).width()&&"auto"!==this.width&&(this.dom.conclusionsTable.style.width="100%",a=$(this.dom.conclusionsTable).outerWidth(),a=2*Math.ceil(a/2));$(this.dom.conclusionsHeader.parentElement).css("width",a+"px");a=Math.floor(a/this.conclusions.length);$(this.dom.conclusionsHeader).find("th").css("width",a+"px");return this};
DecisionTable.prototype.createRemoveButton=function(){var a=this.createHTMLElement("span");a.className="icon-minus decision-table-remove";return a};
DecisionTable.prototype.addDecisionRow=function(){var a=this.createHTMLElement("tr"),b,c;if(!this.conditions.length||!this.conclusions.length)return this;for(b=0;b<this.conditions.length;b+=1)this.conditions[b].values[this.decisionRows]||this.conditions[b].addValue(),c=this.conditions[b].getValueHTML(this.conditions[b].values.length-1),a.appendChild(c[0]),a.appendChild(c[1]);this.dom.conditionsTable.appendChild(a);a=a.cloneNode(!1);for(b=0;b<this.conclusions.length;b+=1)this.conclusions[b].values[this.decisionRows]||
this.conclusions[b].addValue(),a.appendChild(this.conclusions[b].getValueHTML(this.conclusions[b].values.length-1));this.dom.conclusionsTable.appendChild(a);a=a.cloneNode(!1);c=this.createRemoveButton();this.decisionRows+=1;b=this.createHTMLElement("td");b.appendChild(c);a.appendChild(b);this.dom.indexTable.appendChild(a);1===this.decisionRows&&this.updateDimensions();"function"===typeof this.onAddRow&&this.onAddRow.call(this);return this};
DecisionTable.prototype.removeRowWithoutConfirmation=function(a){for(i=0;i<this.conclusions.length;i+=1)this.conclusions[i].removeValue(a);for(i=0;i<this.conditions.length;i+=1)this.conditions[i].removeValue(a);$(this.dom.indexTable).find("tr:eq("+a+")").remove();$(this.dom.conditionsTable).find("tr:eq("+a+")").remove();$(this.dom.conclusionsTable).find("tr:eq("+a+")").remove();this.decisionRows--;this.setIsDirty(!0);valid=this.validateColumn();"function"===typeof this.onChange&&this.onChange.call(this,
{},valid);"function"===typeof this.onRemoveRow&&this.onRemoveRow.call(this);return this};
DecisionTable.prototype.removeDecisionRow=function(a){var b,c=!1,d=this;if(1===this.decisionRows)return App.alert.show("mininal-error",{level:"warning",messages:this.language.MIN_ROWS,autoClose:!0}),this;for(b=0;b<this.conditions.length;b+=1)if(this.conditions[b].values[a].filledValue()){c=!0;break}if(!c)for(b=0;b<this.conclusions.length;b+=1)if(this.conclusions[b].values[a].filledValue()){c=!0;break}if(c)App.alert.show("message-config-delete-row",{level:"confirmation",messages:this.language.MSG_DELETE_ROW,
onConfirm:function(){return d.removeRowWithoutConfirmation(a)},onCancel:function(){return this}});else return this.removeRowWithoutConfirmation(a)};
DecisionTable.prototype.getFields=function(a){var b=this;if(this.fields.length)return this.fields;App.alert.show("upload",{level:"process",title:"LBL_LOADING",autoclose:!1});this.proxy.setUrl("pmse_Project/CrmData/oneToOneRelated/"+this.base_module);this.proxy.getData(null,{success:function(c){var d,e,f,g,h;if(c&&c.success){f=[];g={};for(d=0;d<c.result.length;d+=1){h=c.result[d];for(e=0;e<h.fields.length;e+=1)f.push({label:h.fields[e].text,value:h.fields[e].value,type:h.fields[e].type,moduleText:h.text,
moduleValue:h.value}),"none"!==h.fields[e].optionItem?g[h.value+b.moduleFieldSeparator+h.fields[e].value]=h.fields[e].optionItem:"Checkbox"===h.fields[e].type&&(g[h.value+b.moduleFieldSeparator+h.fields[e].value]={checked:translate("LBL_DROPDOW_CHECKED"),unchecked:translate("LBL_DROPDOWN_UNCHECKED")})}b.fields=f;b.combos=g;b.setConditions(b.auxConditions);b.setConclusions(b.auxConclutions);b.setRuleset(b.rules);b.conditions.length||b.addCondition(a);b.conclusions.length||b.addConclusion(!0);b.decisionRows||
b.addDecisionRow();App.alert.dismiss("upload");b.setIsDirty(!1)}}});return this};DecisionTable.prototype.setName=function(a){this.name=a;return this};DecisionTable.prototype.setProxy=function(a){this.proxy=a;return this};DecisionTable.prototype.setBaseModule=function(a){this.base_module=a;return this};DecisionTable.prototype.setHitType=function(a){this.hitType=a;return this};
DecisionTable.prototype.onRemoveVariableHandler=function(a){var b=this,c;return function(){for(var d,e=0;e<a.length;e+=1)a[e]===this&&(d=a[e],a.splice(e,1));b.updateDimensions();c=b.validateRow();"function"===typeof b.onRemoveColumn&&b.onRemoveColumn.call(this,d);b.setIsDirty(!0);"function"===typeof b.onChange&&b.onChange.call(b,{},c)}};
DecisionTable.prototype.addCondition=function(a){a=new DecisionTableVariable({parent:this,field:a||null,fields:this.fields,combos:this.combos,language:this.language});var b,c;a.onRemove=this.onRemoveVariableHandler(this.conditions);a.onChangeValue=this.onChangeValueHandler();a.onChange=this.onChangeVariableHandler();this.conditions.push(a);this.html&&this.dom.conditionsHeader.appendChild(a.getHTML());this.proxy.uid=this.base_module||"";for(b=0;b<this.decisionRows;b+=1)a.addValue(),c=a.getValueHTML(b),
$(this.dom.conditionsTable).find("tr:eq("+b+")").append(c[0]).append(c[1]);this.updateDimensions();this.setIsDirty(!0);"function"===typeof this.onAddColumn&&this.onAddColumn.call(this,a);return this};
DecisionTable.prototype.addConclusion=function(a,b){var c=new DecisionTableVariable({isReturnType:a,variableMode:"conclusion",fields:this.fields,combos:this.combos,field:b,parent:this,language:this.language}),d;c.onRemove=this.onRemoveVariableHandler(this.conclusions);c.onChangeValue=this.onChangeValueHandler();c.onChange=this.onChangeVariableHandler();this.conclusions.push(c);this.html&&this.dom.conclusionsHeader.appendChild(c.getHTML());for(d=0;d<this.decisionRows;d+=1)c.addValue(),this.dom.conclusionsTable.childNodes[d].appendChild(c.getValueHTML(d));
this.updateDimensions();this.setIsDirty(!0);"function"===typeof this.onAddColumn&&this.onAddColumn.call(this,c);return this};
DecisionTable.prototype.canBeRemoved=function(a){var b=!1;a.parent===this&&("condition"===a.variableMode?(b=1<this.conditions.length)||App.alert.show("mininal-column-error",{level:"warning",messages:this.language.MIN_CONDITIONS_COLS,autoClose:!0}):"conclusion"===a.variableMode&&((b=1<this.conclusions.length)||App.alert.show("mininal-column-error",{level:"warning",messages:this.language.MIN_CONCLUSIONS_COLS,autoClose:!0})));return b};
DecisionTable.prototype.createHTML=function(){if(this.html)return this.html;var a,b,c,d,e,f;c=this.createHTMLElement("thead");plusNode=this.createHTMLElement("span");plusNode.className="icon-plus";plusNode2=this.createHTMLElement("span");plusNode2.className="icon-plus";a=this.createHTMLElement("tr");b=this.createHTMLElement("th");a.appendChild(b);b=this.createHTMLElement("th");d=this.createHTMLElement("button");d.appendChild(plusNode);d.className="decision-table-add-button";d.title=this.language.LBL_ADD_CONDITION;
this.dom.addConditionButton=d;e=this.createHTMLElement("span");e.appendChild(document.createTextNode(this.language.CONDITIONS));e.appendChild(d);b.appendChild(e);b.className="decision-table-separator-border";a.appendChild(b);b=b.cloneNode(!1);d=d.cloneNode(!0);d.title=this.language.LBL_ADD_CONCLUSION;this.dom.addConclusionButton=d;e=e.cloneNode(!1);e.appendChild(document.createTextNode(this.language.CONCLUSIONS));e.appendChild(d);b.appendChild(e);a.appendChild(b);c.appendChild(a);a=this.createHTMLElement("tr");
b=this.createHTMLElement("th");e=this.createHTMLElement("button");e.appendChild(plusNode2);e.title=this.language.ADD_ROW;e.className="decision-table-add-row";b.appendChild(e);a.appendChild(b);b=this.createHTMLElement("th");e=this.createHTMLElement("div");e.className="decision-table-conditions-header";this.dom.conditionsHeaderContainer=e;f=this.createHTMLElement("table");f.appendChild(a.cloneNode(!1));e.appendChild(f);this.dom.conditionsHeader=f.childNodes[0];b.className="decision-table-separator-border";
b.appendChild(e);a.appendChild(b);b=b.cloneNode(!0);this.dom.conclusionsHeaderContainer=b.childNodes[0];this.dom.conclusionsHeaderContainer.className="decision-table-conclusions-header";this.dom.conclusionsHeader=this.dom.conclusionsHeaderContainer.childNodes[0].childNodes[0];a.appendChild(b);d=this.createHTMLElement("tbody");d.appendChild(a);a=this.createHTMLElement("tr");b=this.createHTMLElement("td");e=e.cloneNode(!1);e.className="decision-table-container";this.dom.indexTableContainer=e;f=f.cloneNode(!1);
f.className="decision-table-index";this.dom.indexTable=f;e.appendChild(f);b.appendChild(e);a.appendChild(b);b=b.cloneNode(!0);this.dom.conditionsTable=(this.dom.conditionsTableContainer=b.childNodes[0]).childNodes[0];this.dom.conditionsTable.className="decision-table-conditions";b.className="decision-table-separator-border";a.appendChild(b);b=b.cloneNode(!0);b.className="";this.dom.conclusionsTable=(this.dom.conclusionsTableContainer=b.childNodes[0]).childNodes[0];this.dom.conclusionsTable.className=
"decision-table-conclusions";a.appendChild(b);d.appendChild(a);a=this.createHTMLElement("table");a.className="decision-table";a.appendChild(c);a.appendChild(d);this.html=a;for(c=0;c<this.conditions.length;c+=1)this.dom.conditionsHeader.appendChild(this.conditions[c].getHTML());for(c=0;c<this.conclusions.length;c+=1)this.dom.conclusionsHeader.appendChild(this.conclusions[c].getHTML());this.setShowDirtyIndicator(this.showDirtyIndicator);this.attachListeners();return this.html};
DecisionTable.prototype.attachListeners=function(){var a=this;$(this.dom.conditionsTableContainer).on("scroll",function(){a.globalCBControl.close();a.globalDDSelector.close();a.dom.conditionsHeaderContainer.scrollLeft=this.scrollLeft;a.dom.conclusionsTableContainer.scrollTop=this.scrollTop});$(this.dom.conditionsHeaderContainer).on("scroll",function(){a.dom.conditionsTableContainer.scrollLeft=this.scrollLeft});$(this.dom.conclusionsTableContainer).add(this.dom.conclusionsHeaderContainer).on("scroll",
function(){a.globalCBControl.close();a.globalDDSelector.close();a.dom.conclusionsHeaderContainer.scrollLeft=a.dom.conclusionsTableContainer.scrollLeft=this.scrollLeft;a.dom.indexTableContainer.scrollTop=a.dom.conditionsTableContainer.scrollTop=this.scrollTop});$(this.dom.indexTableContainer).on("scroll",function(){a.dom.conditionsTableContainer.scrollTop=a.dom.conclusionsTableContainer.scrollTop=this.scrollTop});$(this.dom.addConclusionButton).on("click",function(){a.addConclusion()});$(this.dom.addConditionButton).on("click",
function(){a.addCondition()});$(this.dom.indexTable).on("click","span.decision-table-remove",function(){a.removeDecisionRow($(a.dom.indexTable).find("span.decision-table-remove").index(this))});$(this.dom.conditionsTable).on("keydown","td",function(b){var c,d=this.parentElement;9===b.keyCode&&(c=$(d.parentElement).find("tr").index(d),$(d).find("td:last").get(0)===this&&!b.shiftKey?(b.preventDefault(),$(a.conclusions[0].getValueHTML(c)).find("span").focus()):$(d).find("td:first").get(0)===this&&b.shiftKey&&
(b.preventDefault(),$(a.dom.indexTable).find("span").eq(c).focus()))});$(this.dom.indexTable).on("keydown","td",function(b){var c;c=this.parentElement;9===b.keyCode&&(c=$(c.parentElement).find("tr").index(c),b.shiftKey?0<c&&(b.preventDefault(),$(a.conclusions[a.conclusions.length-1].getValueHTML(c-1)).find("span").focus()):(b.preventDefault(),$(a.conditions[0].getValueHTML(c)[0]).find("span").focus()))});$(this.dom.conclusionsTable).on("keydown","td",function(b){var c,d=this.parentElement;9===b.keyCode&&
(c=$(d.parentElement).find("tr").index(d),$(d).find("td:last").get(0)===this&&!b.shiftKey&&c<a.decisionRows-1?(b.preventDefault(),$(a.dom.indexTable).find("span").eq(c+1).focus()):$(d).find("td:first").get(0)===this&&b.shiftKey&&(b.preventDefault(),$(a.conditions[a.conditions.length-1].getValueHTML(c)[1]).find("span").focus()))});$(this.dom.conditionsTable).on("keydown","td",function(b){var c,d=this.parentElement;9===b.keyCode&&(c=$(d.parentElement).find("tr").index(d),$(d).find("td:last").get(0)===
this&&!b.shiftKey?(b.preventDefault(),$(a.conclusions[0].getValueHTML(c)).find("span").focus()):$(d).find("td:first").get(0)===this&&b.shiftKey&&(b.preventDefault(),$(a.dom.indexTable).find("button").eq(c).focus()))});$(this.dom.indexTable).on("keydown","td",function(b){var c,d=this.parentElement;9===b.keyCode&&(c=$(d.parentElement).find("tr").index(d),$(d).find("td:last").get(0)===this&&!b.shiftKey?(b.preventDefault(),$(a.conditions[0].getValueHTML(c)[0]).find("span").focus()):$(d).find("td:first").get(0)===
this&&(b.shiftKey&&0<c)&&(b.preventDefault(),$(a.conclusions[a.conclusions.length-1].getValueHTML(c-1)).find("span").focus()))});$(this.dom.conclusionsTable).on("keydown","td",function(b){var c,d=this.parentElement;9===b.keyCode&&(c=$(d.parentElement).find("tr").index(d),$(d).find("td:last").get(0)===this&&!b.shiftKey&&c<a.decisionRows-1?(b.preventDefault(),$(a.dom.indexTable).find("button").eq(c+1).focus()):$(d).find("td:first").get(0)===this&&b.shiftKey&&(b.preventDefault(),$(a.conditions[a.conditions.length-
1].getValueHTML(c)[1]).find("span").focus()))});$(this.html).find(".decision-table-add-row").on("click",function(){a.addDecisionRow()});$(this.dom.conditionsTable).add(this.dom.conclusionsTable).add(this.dom.indexTable).on("focus","td",function(){var b=this.parentElement;$(a.html).find("tr.cell-edit").removeClass("cell-edit");b=$(b.parentElement).find("tr").index(b);$(a.dom.indexTable.childNodes[b]).add(a.dom.conditionsTable.childNodes[b]).add(a.dom.conclusionsTable.childNodes[b]).addClass("cell-edit")}).on("blur",
"select, input",function(){});$(document).bind("DOMNodeInserted",function(b){b.target===a.html&&a.updateDimensions()});return this};
DecisionTable.prototype.validateConclusions=function(){var a,b={};for(a=0;a<this.conclusions.length;a+=1){if(!this.conclusions[a].isReturnType&&this.conclusions[a].field&&this.conclusions[a].getFilledValuesNum()){if(b[this.conclusions[a].field])return $(this.conclusions[a].getHTML()).addClass("error"),{valid:!1,location:"Conclusion # "+(a+1),message:this.language.ERROR_CONCLUSION_VAR_DUPLICATED};b[this.conclusions[a].field]=!0}$(this.conclusions[a].getHTML()).removeClass("error")}return{valid:!0}};
DecisionTable.prototype.validateRow=function(a){var b=0,c=this.decisionRows,d,e,f=0;"number"===typeof a&&(b=a,c=a+1);for(d=b;d<c;d+=1){a=b=!1;for(e=0;e<this.conditions.length;e+=1)if(this.conditions[e].values[d].filledValue()){b=!0;break}if(b)if(this.conclusions[0].values[d].filledValue())a=!0;else return $(this.conclusions[0].values[d].getHTML()).addClass("error"),{valid:!1,message:this.language.ERROR_EMPTY_RETURN_VALUE,location:"row # "+(d+1)};$(this.conclusions[0].values[d].getHTML()).removeClass("error");
if(!a)for(e=0;e<this.conclusions.length;e+=1)if(this.conclusions[e].values[d].filledValue()){a=!0;break}if(a&&!b&&(f+=1,1<f))return $(this.dom.conditionsTable).find("tr").eq(d).addClass("error"),{valid:!1,message:this.language.ERROR_EMPTY_ROW,location:"row # "+(d+1)};$(this.dom.conditionsTable).find("tr").eq(d).removeClass("error")}return{valid:!0}};
DecisionTable.prototype.validateColumn=function(a,b){var c,d,e,f=[{type:"condition",collection:this.conditions},{type:"conclusion",collection:this.conclusions}];$(this.dom.conditionsTable).find("tr").removeClass("error");if("number"===typeof a&&"number"===typeof b){if(c=f[b].collection[a].isValid(),!c.valid)return{valid:!1,message:c.message,location:f[b].type+" # "+(a+1)+(!isNaN(c.index)?" - row "+(c.index+1):"")}}else for(e=0;e<f.length;e+=1)for(d=0;d<f[e].collection.length;d+=1)if(c=f[e].collection[d].isValid(),
!c.valid)return{valid:!1,message:c.message,location:f[e].type+" # "+(d+1)+(!isNaN(c.index)?" - row "+(c.index+1):"")};return{valid:!0}};DecisionTable.prototype.isValid=function(){var a;if(!this.correctlyBuilt)return{valid:!1,message:this.language.ERROR_INCORRECT_BUILD};a=this.validateColumn();if(!a.valid)return a;a=this.validateRow();return!a.valid?a:this.validateConclusions()};
DecisionTable.prototype.getJSON=function(){var a={id:this.id,base_module:this.base_module,type:this.hitType,name:this.name,columns:{conditions:[],conclusions:[]},ruleset:[]},b,c,d,e,f,g,h=0;if(!this.isValid().valid)return null;g={};for(f=0;f<this.decisionRows;f+=1){for(e=0;e<this.conditions.length;e+=1)this.conditions[e].field&&this.conditions[e].values[f].getValue().length&&(b=this.conditions[e].module+this.moduleFieldSeparator+this.conditions[e].field,g[b]||(g[b]={max:0,current:0}),g[b].current+=
1,g[b].current>g[b].max&&(g[b].max=g[b].current));for(e in g)g[e].current=0}for(e=0;e<this.conditions.length;e+=1)if(b=this.conditions[e].module+this.moduleFieldSeparator+this.conditions[e].field,g[b]){for(f=0;f<g[b].max;f+=1)a.columns.conditions.push({module:this.conditions[e].module,field:this.conditions[e].field});delete g[b]}for(e=0;e<this.conclusions.length;e+=1)if(this.conclusions[e].isReturnType||this.conclusions[e].field&&this.conclusions[e].getFilledValuesNum())a.columns.conclusions.push(this.conclusions[e].select?
this.conclusions[e].field:"");for(e=0;e<this.decisionRows;e+=1){b={id:e+1};c=[];d=[];for(f=0;f<this.conditions.length;f+=1)(g=this.conditions[f].getJSON(e))&&c.push(g);for(f=0;f<this.conclusions.length;f+=1)g=this.conclusions[f].getJSON(e),g.value.length&&d.push(g);b.conditions=c;b.conclusions=d;c.length||(h+=1);(c.length||1>=h)&&a.ruleset.push(b)}return a};
var DecisionTableVariable=function(a){Element.call(this);this.module=this.fieldType=this.field=this.fieldName=this.parent=null;this.values=[];this.fields=null;this.combos={};this.onChangeValue=this.onChange=this.onRemove=this.select=this.closeButton=this.isReturnType=this.variableMode=null;this.language={};DecisionTableVariable.prototype.initObject.call(this,a)};DecisionTableVariable.prototype=new Element;
DecisionTableVariable.prototype.initObject=function(a){var b={parent:null,field:null,fields:[],combos:{},variableMode:"condition",isReturnType:!1,onRemove:null,onChange:null,onChangeValue:null,language:{}};$.extend(!0,b,a);this.language=b.language;this.parent=b.parent;this.variableMode=b.variableMode;this.isReturnType=b.isReturnType;this.setFields(b.fields).setCombos(b.combos).setField(b.field);b.values&&this.setValues(b.values);this.onRemove=b.onRemove;this.onChange=b.onChange;this.onChangeValue=
b.onChangeValue};
DecisionTableVariable.prototype.setField=function(a){var b,c,d,e;if(this.isReturnType)return this;if(a){"string"===typeof a?(e=a,c=a.split(this.parent.moduleFieldSeparator),d=c[0],c=c[1]):(d=a.module,c=a.field,e=d+this.parent.moduleFieldSeparator+c);for(a=0;a<this.fields.length;a+=1)if(b=this.fields[a],b.value===c&&b.moduleValue===d)return this.field=c,this.fieldName=b.label,this.fieldType=b.type,this.module=d,this.select.value=e,this}else this.module=this.fieldType=this.fieldName=this.field=null;
this.select&&(this.select.selectedIndex=-1);return this};DecisionTableVariable.prototype.setFields=function(a){a.push&&a.pop&&(this.fields=a,this.isReturnType||this.populateSelectElement());return this};DecisionTableVariable.prototype.setCombos=function(a){this.combos=a;return this};
DecisionTableVariable.prototype.populateSelectElement=function(){var a,b,c,d,e;this.select&&$(this.select).empty();d=this.createHTMLElement("select");if(this.fields.length){c=this.createHTMLElement("option");d.appendChild(c);b={};for(a=0;a<this.fields.length;a+=1){if(this.fields[a].moduleText!==b.label){if("conclusion"===this.variableMode&&this.fields[a].moduleValue!==this.parent.base_module)break;b=document.createElement("optgroup");b.label=this.fields[a].moduleText;d.appendChild(b)}c=this.createHTMLElement("option");
e=SUGAR.App.lang.get(this.fields[a].label,this.base_module);c.label=e;c.value=this.fields[a].moduleValue+this.parent.moduleFieldSeparator+this.fields[a].value;c.appendChild(document.createTextNode(e));this.field===c.value&&(c.selected=!0);b.appendChild(c)}}this.select=d;return this};
DecisionTableVariable.prototype.setValues=function(a){var b;if("object"!==typeof a||!a.push)return this;if("conclusion"===this.variableMode)for(b=0;b<a.length;b+=1)("string"===typeof a[b]||"number"===typeof a[b])&&this.values.push(new DecisionTableSingleValue({value:a[b],parent:this,fields:this.fields}));else for(b=0;b<a.length;b+=1)this.values.push(new DecisionTableValueEvaluation({value:a[b].value,operator:a[b].operator,parent:this,fields:this.fields,language:this.language}));return this};
DecisionTableVariable.prototype.getValueHTML=function(a){return this.values[a]?this.values[a].getHTML():null};
DecisionTableVariable.prototype.createHTML=function(){var a=this.createHTMLElement("th"),b;if(this.html)return this.html;this.isReturnType?(b=this.createHTMLElement("span"),b.className="decision-table-return",b.appendChild(document.createTextNode(this.isReturnType?this.language.LBL_RETURN:this.fieldName||""))):b=this.select;a.appendChild(b);this.isReturnType||(b=this.createHTMLElement("button"),b.appendChild(document.createTextNode(" ")),b.className="decision-table-close-button",b.title=this.language.LBL_TITLE_CLOSE_BUTTON,
this.closeButton=b,a.appendChild(this.closeButton));this.html=a;this.attachListeners();return this.html};DecisionTableVariable.prototype.removeWithoutConfirmation=function(){for(;this.values.length;)this.values[0].remove();this.values=null;$(this.html).remove();"function"===typeof this.onRemove&&this.onRemove.call(this)};
DecisionTableVariable.prototype.remove=function(){var a=this;this.parent.canBeRemoved(this)&&(this.getFilledValuesNum()?App.alert.show("variable-check",{level:"confirmation",messages:"Do you really want to remove this variable?",onCancel:function(){},onConfirm:function(){a.removeWithoutConfirmation()}}):this.removeWithoutConfirmation())};
DecisionTableVariable.prototype.attachListeners=function(){var a=this,b,c;if(!this.html)return this;$(this.select).on("change",function(){b=a.module+a.parent.moduleFieldSeparator+a.field;c=this.value;a.hasValues()?App.alert.show("select-change-confirm",{level:"confirmation",messages:"Values associated to this variable will be removed. Do you want to continue?",autoClose:!1,onConfirm:function(){a.setField(c||null);a.clearAllValues();"function"===typeof a.onChange&&a.onChange.call(a,a.field,b)},onCancel:function(){a.select.value=
b}}):(a.setField(this.value||null),"function"===typeof a.onChange&&a.onChange.call(a,a.field,b))});$(this.closeButton).on("click",function(){a.remove()});return this};DecisionTableVariable.prototype.clearAllValues=function(){var a;for(a=0;a<this.values.length;a+=1)this.values[a].clear();return this};DecisionTableVariable.prototype.hasValues=function(){return 0!==this.getFilledValuesNum()};
DecisionTableVariable.prototype.getFilledValuesNum=function(){var a,b=0;for(a=0;a<this.values.length;a+=1)this.values[a].filledValue()&&(b+=1);return b};DecisionTableVariable.prototype.onRemoveValueHandler=function(){var a=this;return function(){var b;for(b=0;b<a.values.length;b+=1)if(a.values[b]===this){a.values.splice(b,1);break}}};DecisionTableVariable.prototype.onChangeValueHandler=function(){var a=this;return function(b,c){"function"===typeof a.onChangeValue&&a.onChangeValue.call(a,this,b,c)}};
DecisionTableVariable.prototype.addValue=function(a,b){a="conclusion"===this.variableMode?new DecisionTableSingleValue({value:a,parent:this,fields:this.fields,language:this.language}):new DecisionTableValueEvaluation({value:a,operator:b,parent:this,fields:this.fields,language:this.language});a.onRemove=this.onRemoveValueHandler();a.onChange=this.onChangeValueHandler();this.values.push(a);return this};
DecisionTableVariable.prototype.getJSON=function(a){var b={};if("number"===typeof a){if(this.values[a]){b.value=this.values[a].getValue();if("conclusion"===this.variableMode)b.conclusion_value=this.isReturnType?"result":this.field,b.conclusion_type=this.isReturnType?"return":"variable";else if(b.variable_name=this.field,b.condition=this.values[a].operator,b.value&&!b.condition||!b.value&&!b.condition)return!1;this.isReturnType||(b.variable_module=this.module);return b}}else return!1};
DecisionTableVariable.prototype.removeValue=function(a){this.values[a]&&($(this.values[a].getHTML()).remove(),this.values.splice(a,1));return this};
DecisionTableVariable.prototype.isValid=function(){var a={valid:!0},b,c=0,d;$(this.select).parent().removeClass("error");if("conclusion"===this.variableMode)for(b=0;b<this.values.length;b+=1){d=this.values[b].isValid();if(!d.valid)return d;this.values[b].value.length&&(c+=1)}else for(b=0;b<this.values.length;b+=1)if(d=this.values[b].isValid(),this.values[b].operator&&(c+=1),!d.valid)return a.valid=!1,a.message=d.message,a.index=b,a;c&&(this.select&&!this.select.value)&&($(this.select.parentElement).addClass("error"),
a={valid:!1,message:this.language.ERROR_NO_VARIABLE_SELECTED});return a};var DecisionTableValue=function(a){Element.call(this,a);this.parent=this.onChange=this.onRemove=this.expression=this.value=null;this.language={};DecisionTableValue.prototype.initObject.call(this,a)};DecisionTableValue.prototype=new Element;
DecisionTableValue.prototype.initObject=function(a){var b={value:[],onRemove:null,onChange:null,parent:null,fields:[],language:{}};$.extend(!0,b,a||{});this.language=b.language;this.parentElement=b.parent;this.expression=new ExpressionContainer({variables:b.fields,onChange:this.onChangeExpressionHandler(),language:this.language},this);this.setValue(b.value);this.onRemove=b.onRemove;this.onChange=b.onChange};
DecisionTableValue.prototype.onChangeExpressionHandler=function(){var a=this;return function(b,c){a.value=this.getObject();"function"===typeof a.onChange&&a.onChange.call(a,b,c)}};DecisionTableValue.prototype.updateHTML=function(){};DecisionTableValue.prototype.clear=function(){this.setValue([]);return this};DecisionTableValue.prototype.setValue=function(a){this.expression.setExpressionValue(a);this.value=a;return this};DecisionTableValue.prototype.createHTML=function(){};
DecisionTableValue.prototype.onEnterCellHandler=function(a){return function(){if("function"===typeof a){var b=a();$(this.parentElement).empty().append(b);$(b).select().focus()}}};
DecisionTableValue.prototype.onLeaveCellHandler=function(a){var b=this;return function(){var c=document.createElement("span"),d=this.parentElement,e=b[a],f=!1;c.tabIndex=0;f=e!==this.value;b[a]=this.value;b[a]?c.appendChild(document.createTextNode(b[a])):c.innerHTML="&nbsp;";try{$(d).empty().append(c)}catch(g){}b.isValid();f&&"function"===typeof b.onChange&&b.onChange.call(b,b[a],e)}};
DecisionTableValue.prototype.isValid=function(){if(this.expression.isValid())return $(this.html).removeClass("error"),{valid:!0};$(this.html).addClass("error");return{valid:!1,message:this.language.ERROR_INVALID_EXPRESSION}};DecisionTableValue.prototype.attachListeners=function(){};DecisionTableValue.prototype.remove=function(){$(this.html).remove();this.expression.remove();"function"===typeof this.onRemove&&this.onRemove.call(this)};DecisionTableValue.prototype.getValue=function(){return this.expression.getObject()};
DecisionTableValue.prototype.filledValue=function(){return!!this.value.length};var DecisionTableSingleValue=function(a){DecisionTableValue.call(this,a)};DecisionTableSingleValue.prototype=new DecisionTableValue;DecisionTableSingleValue.prototype.createValueControl=function(){var a=this;return function(){var b=document.createElement("input");b.type="text";b.value=a.value||"";return b}};
DecisionTableSingleValue.prototype.updateHTML=function(){this.html&&(this.value?$(this.html).find("span").text(this.value):$(this.html).find("span").html("&nbsp;"),$(this.html).find("input").val(this.value));return this};DecisionTableSingleValue.prototype.createHTML=function(){if(this.html)return this.html;var a;a=this.createHTMLElement("td");a.appendChild(this.expression.getHTML());return this.html=a};
var DecisionTableValueEvaluation=function(a){DecisionTableValue.call(this,a);this.operator=null;DecisionTableValueEvaluation.prototype.initObject.call(this,a)};DecisionTableValueEvaluation.prototype=new DecisionTableValue;DecisionTableValueEvaluation.prototype.OPERATORS="== >= <= > < !=".split(" ");DecisionTableValueEvaluation.prototype.initObject=function(a){this.setOperator(a.operator||"")};
DecisionTableValueEvaluation.prototype.clear=function(){DecisionTableValue.prototype.clear.call(this);this.setOperator("");return this};DecisionTableValueEvaluation.prototype.setOperator=function(a){this.operator=a;this.html&&this.html[0]&&jQuery(this.html[0]).find("span").empty().append(a);return this};
DecisionTableValueEvaluation.prototype.createHTML=function(){if(this.html)return this.html;var a,b,c;a=DecisionTableSingleValue.prototype.createHTML.call(this);b=this.createHTMLElement("td");b.className="decision-table-operator";c=this.createHTMLElement("span");c.tabIndex=0;this.operator?c.appendChild(document.createTextNode(this.operator)):c.innerHTML="&nbsp";b.appendChild(c);this.html=[b,a];this.attachListeners();return this.html};
DecisionTableValueEvaluation.prototype.fillOperators=function(a){var b,c,d;switch(this.parentElement.fieldType.toLowerCase()){case "date":case "datetime":case "decimal":case "currency":case "float":case "integer":d=this.OPERATORS;break;default:d=[this.OPERATORS[0],this.OPERATORS[5]]}$(a).append("<option></option>");for(b=0;b<d.length;b+=1)c=this.createHTMLElement("option"),c.label=c.value=d[b],c.appendChild(document.createTextNode(d[b])),c.selected=d[b]===this.operator,a.appendChild(c);return a};
DecisionTableValueEvaluation.prototype.createValueControl=function(){var a=this;return function(){var b=document.createElement("input");b.type="text";b.value=a.value||"";return b}};DecisionTableValueEvaluation.prototype.createOperatorControl=function(){var a=this;return function(){var b=document.createElement("select");a.fillOperators(b);b.value=a.operator;return b}};
DecisionTableValueEvaluation.prototype.attachListeners=function(){if(!this.html||!this.html.push)return this;$(this.html[0]).on("focus","span",this.onEnterCellHandler(this.createOperatorControl())).on("blur","select",this.onLeaveCellHandler("operator"));return this};DecisionTableValueEvaluation.prototype.filledValue=function(){return!!this.operator&&DecisionTableValue.prototype.filledValue.call(this)};
DecisionTableValueEvaluation.prototype.isValid=function(){var a=DecisionTableValue.prototype.isValid.call(this);a.valid?(a={valid:!!this.value.length===!!this.operator},a.valid?$(this.html).removeClass("error"):($(this.html).addClass("error"),a.message=this.language.ERROR_MISSING_EXPRESSION_OR_OPERATOR)):$(this.html[0]).removeClass("error");return a};DecisionTableValueEvaluation.prototype.getOperator=function(){return this.operator};
var DataItem=function(a){Element.call(this,a);this._parent=null;this._data={};this._text=null;this._eventListenersAttached=!1;this.onClick=this._htmlItemContent=null;this._disabled=!1;DataItem.prototype.init.call(this,a)};DataItem.prototype=new Element;DataItem.prototype.constructor=DataItem;DataItem.prototype.type="DataItem";
DataItem.prototype.init=function(a){var b={data:{},onClick:null,text:"[item]",parent:null,disabled:!1};jQuery.extend(!0,b,a);this.setFullData(b.data).setOnClickHandler(b.onClick).setText(b.text).setParent(b.parent);b.disabled?this.disable():this.enable()};DataItem.prototype.disable=function(){this.html&&this.style.addClasses(["adam-disabled"]);this._disabled=!0;return this};DataItem.prototype.enable=function(){this.html&&this.style.removeClasses(["adam-disabled"]);this._disabled=!1;return this};
DataItem.prototype.setParent=function(a){if(!(null===a||a instanceof ItemContainer))throw Error("setParent(): The parameter must be an instace of ItemContainer or null.");this._parent=a;return this};DataItem.prototype.getParent=function(){return this._parent};
DataItem.prototype._getFinalText=function(){var a,b,c;b=this._text;if("string"===typeof b)if(a=b.match(/^\{\{([a-zA-z0-9\.\-]+)\}\}$/)){a=a[1].split(".");b=this._data;for(c=0;c<a.length&&!(b=b[a[c]],!b);c++);a=b&&"object"!==typeof b?b:""}else a=b;else a=this._text(this,this.getData())||"";return a};
DataItem.prototype.setText=function(a){if(!("string"===typeof a||"function"===typeof a))throw Error("setText(): The parameter must be a string or function.");this._text=a;this._htmlTextContainer&&(this._htmlTextContainer.textContent=this._getFinalText());return this};DataItem.prototype.getText=function(){return this._htmlTextContainer?this._htmlTextContainer.textContent:this._getFinalText()};
DataItem.prototype.setOnRemoveHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnRemoveHandler(): The parameter must be a function or null.");this.onRemove=a;return this};DataItem.prototype.setOnClickHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnClickHandler(): The parameter must be a function or null.");this.onClick=a;return this};DataItem.prototype.clearData=function(a){void 0===a?this._data={}:delete this._data[a];return this};
DataItem.prototype.setData=function(a,b){this._data[a]=b;return this};DataItem.prototype.setFullData=function(a){var b;this.clearData();for(b in a)a.hasOwnProperty(b)&&this.setData(b,a[b]);this._htmlTextContainer&&this.setText(this._text);return this};DataItem.prototype._onClick=function(){var a=this;return function(b){b.preventDefault();b.stopPropagation();if("function"===typeof a.onClick&&!a._disabled)a.onClick(a)}};
DataItem.prototype.getData=function(){var a={},b;for(b in this._data)a[b]=this._data[b];return a};DataItem.prototype._attachListeners=function(){this.html&&!this._eventListenersAttached&&(jQuery(this._htmlItemContent).on("click",this._onClick()),this._eventListenersAttached=!0);return this};DataItem.prototype.createHTML=function(){throw Error("createHTML(): Calling an abstract method in DataItem.");};
var SingleItem=function(a){DataItem.call(this,a);this._htmlItemContent=this._htmlRemoveButton=this._htmlIconContainer=this._htmlTextContainer=this.onRemove=null;SingleItem.prototype.init.call(this,a)};SingleItem.prototype=new DataItem;SingleItem.prototype.constructor=SingleItem;SingleItem.prototype.init=function(a){var b={onRemove:null,removable:!0};jQuery.extend(!0,b,a);this.setOnRemoveHandler(b.onRemove)};
SingleItem.prototype.disable=function(){this.html&&(this._htmlRemoveButton.style.display="none");return DataItem.prototype.disable.call(this)};SingleItem.prototype.enable=function(){this.html&&(this._htmlRemoveButton.style.display="");return DataItem.prototype.enable.call(this)};SingleItem.prototype.setOnRemoveHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnRemoveHandler(): The parameter must be a function or null.");this.onRemove=a;return this};
SingleItem.prototype._onRemoveButtonClick=function(){var a=this;return function(b){b.preventDefault();b.stopPropagation();if("function"===typeof a.onRemove)a.onRemove(a)}};SingleItem.prototype._attachListeners=function(){this.html&&!this._eventListenersAttached&&(DataItem.prototype._attachListeners.call(this),jQuery(this._htmlRemoveButton).on("click",this._onRemoveButtonClick()),jQuery(this.html).on("focus focusin focusout blur",function(a){a.stopPropagation()}),this._eventListenersAttached=!0);return this};
SingleItem.prototype.createHTML=function(){var a,b,c,d;if(this.html)return this.html;this.html=this.createHTMLElement("li");this.html.id=this.id;this.html.className="adam single-item";a=this.createHTMLElement("span");a.className="adam single-item-text";b=this.createHTMLElement("span");b.className="adam single-item-icon";d=this.createHTMLElement("a");d.className="adam single-item-content";d.href="#";c=this.createHTMLElement("a");c.href="#";c.className="adam single-item-remove icon-remove-sign";d.appendChild(b);
d.appendChild(a);this.html.appendChild(d);this.html.appendChild(c);this._htmlTextContainer=a;this._htmlIconContainer=b;this._htmlRemoveButton=c;this._htmlItemContent=d;this.setText(this._text);this._disabled?this.disable():this.enable();return this._attachListeners().html};var ListItem=function(a){DataItem.call(this,a);ListItem.prototype.init.call(this,a)};ListItem.prototype=new DataItem;ListItem.prototype.constructor=ListItem;ListItem.prototype.type="ListItem";
ListItem.prototype.init=function(a){var b={text:"[listitem]"};jQuery.extend(!0,b,a);this.setText(b.text)};ListItem.prototype.setVisible=function(a){_.isBoolean(a)&&(this.visible=a,this.html&&(a?this.style.addProperties({display:""}):this.style.addProperties({display:"none"})));return this};
ListItem.prototype.setText=function(a){if(!("string"===typeof a||"function"===typeof a))throw Error("setText(): The parameter must be a string or function.");this._text=a;this._htmlItemContent&&(a=this._getFinalText(),isHTMLElement(a)?this._htmlItemContent.appendChild(a):this._htmlItemContent.textContent=a);return this};
ListItem.prototype.createHTML=function(){this.html||(this.html=this.createHTMLElement("li"),this.html.className="adam list-item",this._htmlItemContent=this.html,this.setText(this._text),this._attachListeners(),this.setVisible(this.visible));return this.html};var CloseListItem=function(a){ListItem.call(this,a);CloseListItem.prototype.init.call(this,a)};CloseListItem.prototype=new ListItem;
CloseListItem.prototype.init=function(a){this.setText(function(){var a=document.createElement("div"),c=document.createElement("span");a.className="close-list-item";c.className="icon-remove";a.appendChild(c);return a})};CloseListItem.prototype.createHTML=function(){ListItem.prototype.createHTML.call(this);$(this.html).css("background-color","#A0A0A0");return this.html};
var ItemContainer=function(a){Element.call(this,a);this._items=new ArrayList;this._massiveAction=!1;this._textInputMode=this.onInputChar=this.onSelect=this.onRemoveItem=this.onAddItem=null;this._textInputs=new ArrayList;this._blurTimer=this.onFocus=this.onBlur=this._className=this.onBeforeAddItemByInput=this._selectedIndex=this._inputValidationFunction=null;this._blurSemaphore=this._blurred=!0;this._disabled=!1;ItemContainer.prototype.init.call(this,a)};ItemContainer.prototype=new Element;
ItemContainer.prototype.constructor=ItemContainer;ItemContainer.prototype.textInputMode={NONE:0,END:1,ALL:2};
ItemContainer.prototype.init=function(a){var b={items:[],onAddItem:null,onRemoveItem:null,width:200,height:80,textInputMode:this.textInputMode.ALL,inputValidationFunction:null,onBeforeAddItemByInput:null,onSelect:null,onInputChar:null,onBlur:null,onFocus:null,className:"",disbaled:!1};jQuery.extend(!0,b,a);if("number"!==typeof b.textInputMode)throw Error("init(): The textInputMode config option must be a number");this._textInputMode=b.textInputMode;this.setWidth(b.width).setHeight(b.height).setItems(b.items).setOnAddItemHandler(b.onAddItem).setInputValidationFunction(b.inputValidationFunction).setOnBeforeAddItemByInput(b.onBeforeAddItemByInput).setOnRemoveItemHandler(b.onRemoveItem).setOnSelectHandler(b.onSelect).setOnInputCharHandler(b.onInputChar).setOnBlurHandler(b.onBlur).setOnFocusHandler(b.onFocus).setClassName(b.className);
b.disabled?this.disable():this.enable()};ItemContainer.prototype.getText=function(){var a,b=this._items.asArray(),c="";for(a=0;a<b.length;a+=1)c+=" "+b[a].getText();return c.substr(1)};ItemContainer.prototype.setWidth=function(a){if(!("number"===typeof a||"string"===typeof a&&("auto"===a||/^\d+(\.\d+)?(em|px|pt|%)?$/.test(a))))throw Error("setWidth(): invalid parameter.");this.width=a;this.html&&this.style.addProperties({width:this.width});return this};
ItemContainer.prototype.disable=function(){var a,b;if(!this._disabled){b=this._items.asArray();for(a=0;a<b.length;a+=1)b[a].disable();jQuery(this.html).find("input").attr("disabled",!0);this._disabled=!0}return!0};ItemContainer.prototype.enable=function(){if(this._disabled){items=this._items.asArray();for(i=0;i<items.length;i+=1)items[i].enable();jQuery(this.html).find("input").attr("disabled",!1);this._disabled=!1}return this};
ItemContainer.prototype.setClassName=function(a){if("string"!==typeof a)throw Error("setClassName(): The parameter must be a string.");this.style.addClasses([a]);return this};ItemContainer.prototype.setOnFocusHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnFocusHandler(): The parameter must be a function or null.");this.onFocus=a;return this};
ItemContainer.prototype.setOnBlurHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnBlurHandler(): The parameter must be a function or null.");this.onBlur=a;return this};ItemContainer.prototype.setOnInputCharHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnInputCharHandler(): The parameter must be a function or null.");this.onInputChar=a;return this};
ItemContainer.prototype.setOnSelectHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnSelectHandler(): The parameter must be a function or null.");this.onSelect=a;return this};ItemContainer.prototype.setOnBeforeAddItemByInput=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnBeforeAddItemByInput(): The parameter must be a function or null.");this.onBeforeAddItemByInput=a;return this};
ItemContainer.prototype.setInputValidationFunction=function(a){if(!(null===a||"function"===typeof a))throw Error("setInputValidationFunction(): The parameter must be a function or null.");this._inputValidationFunction=a;return this};ItemContainer.prototype.setOnAddItemHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnAddItemHandler(): The parameter must be a function or null.");this.onAddItem=a;return this};
ItemContainer.prototype.setOnRemoveItemHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnRemoveItemHandler(): The parameter must be a function or null.");this.onRemoveItem=a;return this};
ItemContainer.prototype._addInputText=function(a){var b=this.createHTMLElement("input");b.className="adam item-container-input";b.disabled=this._disabled;this._textInputs.insert(b);this.html&&("number"===typeof a&&(a=this._items.get(a)),a&&a instanceof SingleItem?this.html.insertBefore(b,a.getHTML()):this.html.appendChild(b));return this};
ItemContainer.prototype.clearItems=function(){jQuery(this.html).empty();this._items.clear();this._textInputs.clear();this._textInputMode!==this.textInputMode.NONE&&this._addInputText();return this};ItemContainer.prototype.isParentOf=function(a){return this===a.getParent()};
ItemContainer.prototype._paintItem=function(a,b){this.html&&this.isParentOf(a)&&("number"===typeof b?0===b?jQuery(this.html).prepend(a.getHTML()):b<this._items.getSize()-1?jQuery(this.html).find(".item-container-input").eq(b).before(a.getHTML()):jQuery(this.html).find(".item-container-input").last().before(a.getHTML()):this._textInputMode===this.textInputMode.NONE?this.html.appendChild(a.getHTML()):jQuery(this.html).find(".item-container-input").last().before(a.getHTML()),this._textInputMode===this.textInputMode.ALL&&
this._addInputText(b||a));return this};ItemContainer.prototype._paintItems=function(){var a,b=this._items.asArray();if(this.html){this._textInputMode===this.textInputMode.ALL&&this._addInputText();for(a=0;a<b.length;a++)this._paintItem(b[a]);this._textInputMode===this.textInputMode.END&&this._addInputText()}return this};ItemContainer.prototype._onRemoveItemHandler=function(){var a=this;return function(b){a.removeItem(b);if("function"===typeof a.onRemoveItem)a.onRemoveItem(a,b)}};
ItemContainer.prototype.addItem=function(a,b,c){if(!(a instanceof SingleItem||"object"===typeof a))throw Error("The paremeter must be an object literal or null.");a instanceof SingleItem||(a=new SingleItem(a));a.setParent(this);a.setOnRemoveHandler(this._onRemoveItemHandler());"number"===typeof b&&0<=b?this._items.insertAt(a,b):this._items.insert(a);this._massiveAction||(this._paintItem(a,b),!c&&jQuery(a.getHTML()).next().get(0)!==jQuery(":focus").get(0)?jQuery(a.getHTML()).next().focus():(this._selectedIndex+=
1,this.html&&(this.html.scrollTop+=this.html.scrollHeight)));"function"===typeof this.onAddItem&&(a="number"===typeof b&&0<=b?this._items.get(b):this._items.get(this._items.getSize()-1),this.onAddItem(this,a,b));return this};ItemContainer.prototype.removeItem=function(a){this.isParentOf(a)&&(this._items.remove(a),jQuery(a.getHTML()).prev(".item-container-input").remove().end().next().focus().end().remove());return this};
ItemContainer.prototype.setVisible=function(a){_.isBoolean(a)&&(this.visible=a,this.html&&(a?this.style.addProperties({display:""}):this.style.addProperties({display:"none"})));return this};ItemContainer.prototype.setItems=function(a){var b;if(!jQuery.isArray(a))throw Error("setItems(): The parameter must be an array.");this._massiveAction=!0;this.clearItems();for(b=0;b<a.length;b++)this.addItem(a[b]);this._paintItems();this._massiveAction=!1;return this};ItemContainer.prototype.getItems=function(){return this._items.asArray()};
ItemContainer.prototype._getTextWidth=function(a,b){var c,d;c=this.createHTMLElement("span");d=window.getComputedStyle(b);c.style.padding=0;c.style.fontFamily=d.getPropertyValue("font-family");c.style.fontSize=d.getPropertyValue("font-size");c.style.fontWeight=d.getPropertyValue("font-weight");c.style.whiteSpace="nowrap";c.style.display="none";c.textContent=a.replace(/\s/g,"_");b.parentNode.appendChild(c);d=jQuery(c);c=d.outerWidth();d.remove();return c};
ItemContainer.prototype._isValidInput=function(a){var b=!0;"function"===typeof this._inputValidationFunction&&(b=this._inputValidationFunction(this,a));return b};ItemContainer.prototype.select=function(a){if(this.html&&!this._disabled&&("number"===typeof a?jQuery(this.html).find(".adam.item-container-input").eq(a).focus():jQuery(this.html).find(".adam.item-container-input").last().focus(),"function"===typeof this.onSelect))this.onSelect(this);return this};
ItemContainer.prototype.getData=function(){var a=[],b=this._items.asArray();for(i=0;i<b.length;i+=1)a.push(b[i].getData());return a};ItemContainer.prototype.getSelectedIndex=function(){return this._selectedIndex};ItemContainer.prototype._onBlur=function(){var a=this;return function(){clearInterval(a._blurTimer);"function"===typeof a.onBlur&&(a._blurred=!0,a.onBlur(a))}};
ItemContainer.prototype._attachListeners=function(){var a,b="";this.html&&(a=this,jQuery(this.html).on("mousedown",function(){a._blurred||(a._blurSemaphore=!1)}).on("click",function(){a._blurSemaphore=!0;a.select()}).on("focusin",function(b){clearInterval(a._blurTimer);a._blurred&&("function"===typeof a.onFocus&&a._blurSemaphore)&&(a._blurred=!1,a.onFocus(a))}).on("focusout",function(b){a._blurred||(a._blurTimer=setInterval(a._onBlur(),20))}).on("focus",".adam.item-container-input",function(){a._selectedIndex=
$(this.parentNode).find("input").index(this)}).on("click",".adam.item-container-input",function(a){a.stopPropagation()}).on("focusout",".adam.item-container-input",function(b){a._blurSemaphore||(b.stopPropagation(),a._blurSemaphore=!0)}).on("keydown",".adam.item-container-input",function(b){var d,e;switch(b.keyCode){case 37:case 39:b.shiftKey&&(d=jQuery(a.html).find(".adam.item-container-input").index(this),b=jQuery(a.html).find(".adam.item-container-input").eq(d+(37===b.keyCode?-1:1)),b.length&&
(this.value="",this.style.width="1px",b.get(0).focus()));break;case 27:this.value="";break;case 13:b.preventDefault();a._isValidInput(this.value)&&(b=new SingleItem({text:this.value}),d=jQuery(a.html).find(".adam.item-container-input").index(this),"function"===typeof a.onBeforeAddItemByInput&&(e=a.onBeforeAddItemByInput(a,b,this.value,d),!1===e?b=null:e instanceof SingleItem&&(b=e)),b instanceof SingleItem&&a.addItem(b,d),this.value="",this.style.width="1px");this.select();break;default:try{d=(d=
b.originalEvent.keyIdentifier)?eval('"\\u'+d.replace(/(U\+)/,"")+'"'):"string"===typeof b.char?b.char:String.fromCharCode(b.which)}catch(f){d=""}d=this.selectionStart!==this.selectionEnd?String.fromCharCode(b.keyCode):this.value+d;d=a._getTextWidth(d,this)||1;this.style.width=d+"px"}}).on("keyup",".adam.item-container-input",function(c){var d;try{d=(d=c.originalEvent.keyIdentifier)?eval('"\\u'+d.replace(/(U\+)/,"")+'"'):"string"===typeof c.char?c.char:String.fromCharCode(c.which)}catch(e){}if((d||
b!==this.value)&&"function"===typeof a.onInputChar)a.onInputChar(a,d,this.value,c.keyCode);b=this.value}).on("blur",".adam.item-container-input",function(){""!==this.value&&(this.value="",this.style.width="1px")}));return this};
ItemContainer.prototype.createHTML=function(){this.html||(this.html=this.createHTMLElement("ul"),this.html.className="adam item-container",this.style.applyStyle(),this.style.addProperties({left:this.x,top:this.y,width:this.width,height:this.height,zIndex:this.zOrder}),this._paintItems(),this._attachListeners(),this.setVisible(this.visible));return this.html};var FieldPanelItem=function(a){Element.call(this,a);this.onValueAction=this._parent=null;FieldPanelItem.prototype.init.call(this,a)};
FieldPanelItem.prototype=new Element;FieldPanelItem.prototype.constructor=FieldPanelItem;FieldPanelItem.prototype.family="FieldPanelItem";FieldPanelItem.prototype.type="FieldPanelItem";FieldPanelItem.prototype.init=function(a){var b={parent:null,onValueAction:null};jQuery.extend(!0,b,a);this.setParent(b.parent).setOnValueActionHandler(b.onValueAction)};
FieldPanelItem.prototype.setParent=function(a){if(!(null===a||a instanceof FieldPanel))throw Error("setParent(): The parameter must be an instance of FieldPanel or null.");this._parent=a;return this};FieldPanelItem.prototype.getParent=function(){return this._parent};FieldPanelItem.prototype.setVisible=function(a){this.visible=!!a;this.html&&(a?this.style.addProperties({display:""}):this.style.addProperties({display:"none"}));return this};
FieldPanelItem.prototype.setOnValueActionHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnValueActionHandler(): The parameter must be a function or null.");this.onValueAction=a;return this};FieldPanelItem.prototype._onValueAction=function(a){if("function"===typeof this.onValueAction)this.onValueAction(this,this.getValueObject(a));return this};FieldPanelItem.prototype.getValueObject=function(){throw Error("getValueObject(): Trying to call an abstract method.");};
var FieldPanelButton=function(a){FieldPanelItem.call(this,a);this._value=this._text=null;FieldPanelButton.prototype.init.call(this,a)};FieldPanelButton.prototype=new FieldPanelItem;FieldPanelButton.prototype.constructor=FieldPanelButton;FieldPanelButton.prototype.type="FieldPanelButton";FieldPanelButton.prototype.init=function(a){var b={text:"[button]",value:""};jQuery.extend(!0,b,a);this.setText(b.text).setValue(b.value)};
FieldPanelButton.prototype.setValue=function(a){if("string"!==typeof a)throw Error("setValue(): The parameter must be a string.");this._value=a;return this};FieldPanelButton.prototype.setText=function(a){if("string"!==typeof a)throw Error("setText(): The parameter must be a string.");this.html&&(this.html.textContent=a);this._text=a;return this};FieldPanelButton.prototype._onClickHandler=function(){var a=this;return function(b){b.preventDefault();a._onValueAction()}};
FieldPanelButton.prototype._attachListeners=function(){if(this.html)jQuery(this.html).on("click",this._onClickHandler());return this};FieldPanelButton.prototype.createHTML=function(){this.html||(this.html=this.createHTMLElement("a"),this.html.href="#",this.html.className="adam field-panel-button btn btn-mini btn-block",this.setText(this._text).setVisible(this.visible),this._attachListeners());return this.html};FieldPanelButton.prototype.getValueObject=function(){return{text:this._text,value:this._value}};
var FieldPanelButtonGroup=function(a){FieldPanelItem.call(this,a);this._items=new ArrayList;this._htmlItemsContainer=this._htmlLabel=this._label=null;this._massiveAction=!1;FieldPanelButtonGroup.prototype.init.call(this,a)};FieldPanelButtonGroup.prototype=new FieldPanelItem;FieldPanelButtonGroup.prototype.constructor=FieldPanelButtonGroup;FieldPanelButtonGroup.prototype.type="FieldPanelButtonGroup";FieldPanelButtonGroup.prototype.init=function(a){var b={items:[],label:""};jQuery.extend(!0,b,a);this.setItems(b.items).setLabel(b.label)};
FieldPanelButtonGroup.prototype.setLabel=function(a){if("string"!==typeof a)throw Error("setLabel(): The parameter must be a string.");this._label=a;this._htmlLabel&&(this._label?(jQuery(this.html).prepend(this._htmlLabel),this._htmlLabel.textContent=a):jQuery(this._htmlLabel).remove());return this};FieldPanelButtonGroup.prototype.clearItems=function(){this._items.clear();this._htmlItemsContainer&&jQuery(this._htmlItemsContainer).empty();return this};
FieldPanelButtonGroup.prototype._paintItem=function(a){var b=this;a.html||(a.html=this.createHTMLElement("button"),a.html.className="adam field-panel-button-group-button btn btn-mini",a.html.appendChild(document.createTextNode(a.text)),jQuery(a.html).on("click",function(){b._onValueAction(a)}));this._htmlItemsContainer.appendChild(a.html);return this};
FieldPanelButtonGroup.prototype.addItem=function(a){a={text:a.text||a.value||"[button]",value:a.value||a.text||null,html:null};this._items.insert(a);!this._massiveAction&&this._htmlItemsContainer&&this._paintItem(a);return this};FieldPanelButtonGroup.prototype._paintItems=function(){var a,b;if(this.html){b=this._items.asArray();for(a=0;a<b.length;a+=1)this._paintItem(b[a])}return this};
FieldPanelButtonGroup.prototype.setItems=function(a){var b;if(!jQuery.isArray(a))throw Error("setItems(): The parameter must be an array.");this._massiveAction=!0;this.clearItems();for(b=0;b<a.length;b+=1)this.addItem(a[b]);this._paintItems();this._massiveAction=!1;return this};FieldPanelButtonGroup.prototype.getItems=function(){return this._items.asArray()};FieldPanelButtonGroup.prototype.getValueObject=function(a){return{text:a.text,value:a.value}};
FieldPanelButtonGroup.prototype.createHTML=function(){this.html||(this.html=this.createHTMLElement("div"),this.html.className="adam field-panel-button-group",this._htmlLabel=this.createHTMLElement("span"),this._htmlLabel.className="adam field-panel-button-group-label",this._htmlItemsContainer=this.createHTMLElement("div"),this._htmlItemsContainer.className="adam field-panel-button-container btn-group",this.html.appendChild(this._htmlLabel),this.html.appendChild(this._htmlItemsContainer),this.setLabel(this._label)._paintItems().setVisible(this.visible));
return this.html};
var CollapsiblePanel=function(a){FieldPanelItem.call(this,a);this._items=new ArrayList;this._title="";this._massiveAction=!1;this._attachedListeners=this.onExpand=this.onCollapse=this._collapsed=this._htmlTitleContainer=this._htmlCollapsibleIcon=this._bodyHeight=this._htmlBody=this._htmlTitle=this._htmlHeader=null;this._initialized=!1;this._enabledAnimations=null;this._disabled=!1;this._onEnablementStatusChange=null;this._headerVisible=!1;CollapsiblePanel.prototype.init.call(this,a)};
CollapsiblePanel.prototype=new FieldPanelItem;CollapsiblePanel.prototype.constructor=CollapsiblePanel;CollapsiblePanel.prototype.type="CollapsiblePanel";
CollapsiblePanel.prototype.init=function(a){var b={title:"[panel]",items:[],bodyHeight:"auto",collapsed:!0,width:"100%",onCollapse:null,onExpand:null,enabledAnimations:!0,disabled:!1,onEnablementStatusChange:null,headerVisible:!0};jQuery.extend(!0,b,a);b.enabledAnimations?this.enableAnimations():this.disableAnimations();b.disabled?this.disable():this.enable();this.setWidth(b.width).setTitle(b.title).setItems(b.items).setBodyHeight(b.bodyHeight).setOnCollapseHandler(b.onCollapse).setOnExpandHandler(b.onExpand).setOnEnablementStatusChangeHandler(b.onEnablementStatusChange);
b.collapsed?this.collapse():this.expand();b.headerVisible?this.showHeader():this.hideHeader();this._initialized=!0};CollapsiblePanel.prototype.showHeader=function(){this._headerVisible=!0;this._htmlHeader&&(this._htmlHeader.style.display="");return this};CollapsiblePanel.prototype.hideHeader=function(){this._headerVisible=!1;this._htmlHeader&&(this._htmlHeader.style.display="none");return this};
CollapsiblePanel.prototype.setOnEnablementStatusChangeHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnEnablementStatusChangeHandler(): The parameter must be a function or null.");this.onEnablementStatusChange=a;return this};CollapsiblePanel.prototype.isDisabled=function(){return this._disabled};
CollapsiblePanel.prototype.disable=function(){if(!this._disabled&&(this.collapse(),this.style.addClasses(["collapsible-panel-disabled"]),this._disabled=!0,"function"===typeof this.onEnablementStatusChange))this.onEnablementStatusChange(this,!1);return this};CollapsiblePanel.prototype.enable=function(){if(this._disabled&&(this.style.removeClasses(["collapsible-panel-disabled"]),this._disabled=!1,"function"===typeof this.onEnablementStatusChange))this.onEnablementStatusChange(this,!0);return this};
CollapsiblePanel.prototype.setParent=function(a){if(!(null===a||a instanceof FieldPanel||a instanceof MultipleCollapsiblePanel))throw Error("setParent(): The parameter must be an instance of FieldPanel, MultipleCollapsiblePanel or null.");this._parent=a;return this};CollapsiblePanel.prototype.enableAnimations=function(){this._enabledAnimations=!0;return this};CollapsiblePanel.prototype.disableAnimations=function(){this._enabledAnimations=!1;return this};
CollapsiblePanel.prototype.setOnExpandHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnExpandHandler(): The paremeter must be a function or null.");this.onExpand=a;return this};CollapsiblePanel.prototype.setOnCollapseHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnCollapseHandler(): The paremeter must be a function or null.");this.onCollapse=a;return this};
CollapsiblePanel.prototype.setWidth=function(a){if("number"===typeof a)Element.prototype.setWidth(a);else if(/^\d+(.\d+)?(px|%)?$/.test(a))this.width=a,this.html&&this.style.addProperties({width:a});else throw Error("setWidth(): The parameter must be a number or a valid number/unit formatted string.");return this};CollapsiblePanel.prototype.isCollapsed=function(){return this._collapsed};
CollapsiblePanel.prototype.collapse=function(a){this._collapsed=!0;if(this._htmlBody&&(jQuery(this._htmlCollapsibleIcon).removeClass("icon-double-angle-down").addClass("icon-double-angle-right"),isInDOM(this.html)?!this._enabledAnimations||a?jQuery(this._htmlBody).stop(!0,!0).hide():jQuery(this._htmlBody).stop(!0,!0).slideUp():this._htmlBody.style.display="none",this._initialized&&"function"===typeof this.onCollapse))this.onCollapse(this);return this};
CollapsiblePanel.prototype.expand=function(a){this._collapsed=!1;if(this._htmlBody&&(jQuery(this._htmlCollapsibleIcon).removeClass("icon-double-angle-right").addClass("icon-double-angle-down"),!this._enabledAnimations||a?jQuery(this._htmlBody).stop(!0,!0).show():jQuery(this._htmlBody).stop(!0,!0).slideDown(),this._initialized&&"function"===typeof this.onExpand))this.onExpand(this);return this};CollapsiblePanel.prototype.toggleCollapse=function(){this._collapsed?this.expand():this.collapse();return this};
CollapsiblePanel.prototype.setBodyHeight=function(a){this._bodyHeight=a;this._htmlBody&&(this._htmlBody.style.maxHeight=isNaN(a)?a:a+"px");return this};CollapsiblePanel.prototype.setTitle=function(a){if("string"!==typeof a)throw Error("setTitle(): The parameter must be a string.");this._title=a;this._htmlTitle&&(this._htmlTitle.textContent=a);return this};CollapsiblePanel.prototype.getTitle=function(){return this._title};
CollapsiblePanel.prototype._unpaintItem=function(a){a.html&&(a.html.remove?a.html.remove():a.html.removeNode(!0));return this};CollapsiblePanel.prototype._unpaintItems=function(){var a,b=this._items.asArray();if(this.html)for(a=0;a<b.length;a+=1)this._unpaintItem(b[a]);return this};CollapsiblePanel.prototype.removeItem=function(a){if(a=this.getItem(a))this._items.remove(a),this._unpaintItem(a)};
CollapsiblePanel.prototype.clearItems=function(){this._items.asArray();this._unpaintItems();this._massiveAction&&this._items.clear();return this};CollapsiblePanel.prototype._paintItem=function(a,b){var c;this.html&&(b&&(c=this._items.get(b)),c?this._htmlBody.insertBefore(a.getHTML(),c.getHTML()):this._htmlBody.appendChild(a.getHTML()));return this};CollapsiblePanel.prototype._paintItems=function(){var a,b;if(this.html){b=this._items.asArray();this._unpaintItems();for(a=0;a<b.length;a+=1)this._paintItem(b[a])}return this};
CollapsiblePanel.prototype.addItem=function(a,b){if("number"===typeof b)this._items.insertAt(a,b);else if(null===b||void 0===b)this._items.insert(a);else throw Error("addItem(): The second parameter is optional, in case of use it must be a number.");this._massiveAction||this._paintItem(a,b);return this};
CollapsiblePanel.prototype.getItem=function(a){return"string"===typeof a?this._items.find("id",a):"number"===typeof a?this._items.get(a):typeof a instanceof FormPanelItem&&0<=this._items.indexOf(a)?a:null};CollapsiblePanel.prototype.setItems=function(a){var b;if(!jQuery.isArray(a))throw Error("setItems(): The parameter must be an array.");this._massiveAction=!0;this.clearItems();for(b=0;b<a.length;b++)this.addItem(a[b]);this._paintItems();this._massiveAction=!1;return this};
CollapsiblePanel.prototype.getItems=function(){return this._items.asArray()};CollapsiblePanel.prototype._createBody=function(){throw Error("_createBody(): This function must be overwritten in subclases, since it's been called from an abstract one.");};CollapsiblePanel.prototype._attachListeners=function(){var a;this.html&&!this._attachedListeners&&(a=this,jQuery(this._htmlTitleContainer).on("click",function(){a._disabled||a.toggleCollapse()}));return this};
CollapsiblePanel.prototype.createHTML=function(){var a,b,c,d,e;this.html||(this.html=this.createHTMLElement("div"),this.html.id=this.id,this.html.className="adam collapsible-panel",a=this.createHTMLElement("div"),a.className="adam collapsible-panel-header",d=this.createHTMLElement("h4"),d.className="adam collapsible-panel-title",b=this.createHTMLElement("span"),e=this.createHTMLElement("i"),e.className="adam collapsible-panel-icon icon-double-angle-right",d.appendChild(e),d.appendChild(b),a.appendChild(d),
this.html.appendChild(a),c=this._createBody(),c.className+=" adam collapsible-panel-body",this._htmlBody=c,this.html.appendChild(c),this._htmlCollapsibleIcon=e,this._htmlTitleContainer=d,this._htmlHeader=a,this._htmlTitle=b,this._htmlBody=c,this.setBodyHeight(this._bodyHeight),this.setTitle(this._title),this._paintItems(),this._collapsed?this.collapse():this.expand(),this._attachListeners(),this.setVisible(this.visible),this._headerVisible?this.showHeader():this.hideHeader(),this.style.applyStyle(),
this.style.addProperties({width:this.width,height:"auto"}));return this.html};var FormPanel=function(a){CollapsiblePanel.call(this,a);this.onSubmit=this._submitVisible=this._dependencyMap=this._htmlFooter=this._submitCaption=this._htmlSubmit=null;FormPanel.prototype.init.call(this,a)};FormPanel.prototype=new CollapsiblePanel;FormPanel.prototype.constructor=FormPanel;FormPanel.prototype.type="FormPanel";
FormPanel.prototype.init=function(a){var b={submitCaption:translate("LBL_PMSE_FORMPANEL_SUBMIT"),items:[],submitVisible:!0,onSubmit:null};jQuery.extend(!0,b,a);this._dependencyMap={};this._submitVisible=!!b.submitVisible;this.setItems(b.items).setSubmitCaption(b.submitCaption).setOnSubmitHandler(b.onSubmit)};FormPanel.prototype.setOnSubmitHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnSubmitHandler(): The parameter must be a function or null.");this.onSubmit=a;return this};
FormPanel.prototype.setItems=function(a){this._dependencyMap&&CollapsiblePanel.prototype.setItems.call(this,a);return this};
FormPanel.prototype._createField=function(a){var b={type:"text"};jQuery.extend(!0,b,a);switch(b.type){case "text":a=new FormPanelText(b);break;case "integer":b.precision=0;b.groupingSeparator="";a=new FormPanelNumber(b);break;case "number":b.precision=-1;b.groupingSeparator="";a=new FormPanelNumber(b);break;case "currency":b.precision=2;a=new FormPanelNumber(b);break;case "dropdown":a=new FormPanelDropdown(b);break;case "date":a=new FormPanelDate(b);break;case "datetime":a=new FormPanelDatetime(b);
break;case "radio":a=new FormPanelRadio(b);break;case "hidden":a=new FormPanelHidden(b);break;case "checkbox":a=new FormPanelCheckbox(b);break;case "button":a=new FormPanelButton(b);break;default:throw Error("_createField(): Invalid field type.");}return a};FormPanel.prototype.setSubmitCaption=function(a){if("string"!==typeof a)throw Error("setSubmitCaption(): The parameter must be a string.");this._submitCaption=a;this._htmlSubmit&&(this._htmlSubmit.textContent=a);return this};
FormPanel.prototype.getItem=function(a){return"string"===typeof a?this._items.find("_name",a):"number"===typeof a?this._items.get(a):a instanceof FormPanelItem&&0<=this._items.indexOf(a)?a:null};FormPanel.prototype._paintItem=function(a,b){var c;this.html&&("number"===typeof b&&(c=this._items.get(b+1)),c?this._htmlBody.insertBefore(a.getHTML(),c.getHTML()):this._htmlBody.insertBefore(a.getHTML(),this._htmlFooter));return this};
FormPanel.prototype.addItem=function(a,b){var c,d,e,f;if(a instanceof FormPanelField)c=a;else if("object"===typeof a)c=this._createField(a);else throw Error("addItem(): the parameter must be an object or an instance of FormPanelField.");c.setForm(this);CollapsiblePanel.prototype.addItem.call(this,c,b);if(c instanceof FormPanelField){if(d=this._dependencyMap[c.getName()])for(e=0;e<d.length;e+=1)(f=this.getItem(d[e]))&&f.fireDependentFields();c.fireDependentFields()}return this};
FormPanel.prototype.replaceItem=function(a,b){var c;b=this.getItem(b);c=this._items.indexOf(b);0<=c&&(this.removeItem(b),this.addItem(a,c));return this};FormPanel.prototype.isValid=function(){var a=this._items.asArray(),b,c=!0;for(b=0;b<a.length&&!(a[b]instanceof FormPanelField&&(c=c&&a[b].isValid(),!c));b+=1);return c};FormPanel.prototype._createBody=function(){var a=this.createHTMLElement("form");a.className="form-panel-body";return a};
FormPanel.prototype.getValueObject=function(){var a,b=this._items.asArray(),c={};for(a=0;a<b.length;a+=1)b[a]instanceof FormPanelField&&(c[b[a].getName()]=b[a].getValue());return c};
FormPanel.prototype.registerSingleDependency=function(a,b){if(!(a instanceof FormPanelField&&"string"===typeof b||jQuery.isArray(b)))throw Error("registerSingleDependency(): Incorrect parameters.");this._dependencyMap[b]||(this._dependencyMap[b]=[]);-1===this._dependencyMap[b].indexOf(b)&&this._dependencyMap[b].push(a.getName());return this};
FormPanel.prototype.registerDependency=function(a,b){var c;if(!(a instanceof FormPanelField&&jQuery.isArray(b)))throw Error("registerDependency(): Incorrect parameters.");for(c=0;c<b.length;c+=1)this.registerSingleDependency(a,b[c]);return this};FormPanel.prototype.showSubmit=function(){this._htmlFooter.style.display="";this._submitVisible=!0;return this};FormPanel.prototype.hideSubmit=function(){this._htmlFooter.style.display="none";this._submitVisible=!1;return this};
FormPanel.prototype.reset=function(){var a=this._items.asArray(),b;for(b=0;b<a.length;b+=1)a[b]instanceof FormPanelField&&a[b].reset();return this};FormPanel.prototype.submit=function(){this.isValid()&&$(this._htmlBody).trigger("submit");return this};
FormPanel.prototype._attachListeners=function(){var a;this.html&&!this._attachedListeners&&(a=this,CollapsiblePanel.prototype._attachListeners.call(this),jQuery(a._htmlBody).on("submit",function(b){var c=!0;b.preventDefault();a.isValid()&&("function"===typeof a.onSubmit&&(c=!1!==a.onSubmit(a)),c&&a._onValueAction())}),this._attachedListeners=!0);return this};
FormPanel.prototype.createHTML=function(){var a,b;this.html||(CollapsiblePanel.prototype.createHTML.call(this),b=this.createHTMLElement("div"),b.className="adam form-panel-footer",a=this.createHTMLElement("button"),a.className="adam form-panel-submit btn btn-mini",b.appendChild(a),this._htmlBody.appendChild(b),this._htmlSubmit=a,this._htmlFooter=b,this.setSubmitCaption(this._submitCaption),this._attachListeners(),this._submitVisible?this.showSubmit():this.hideSubmit());return this.html};
var FormPanelItem=function(a){Element.call(this,a);this._form=this._disabled=this._label=this._name=null;FormPanelItem.prototype.init.call(this,a)};FormPanelItem.prototype=new Element;FormPanelItem.prototype.constructor=FormPanelItem;FormPanelItem.prototype.type="FormPanelItem";
FormPanelItem.prototype.init=function(a){var b={name:this.id,form:null,label:"[form-item]",disabled:!1,height:"auto"};jQuery.extend(!0,b,a);this.setName(b.name).setForm(b.form).setLabel(b.label).setHeight(b.height);b.disabled?this.disable():this.enable()};
FormPanelItem.prototype.setHeight=function(a){if(!("number"===typeof a||"string"===typeof a&&("auto"===a||/^\d+(\.\d+)?(em|px|pt|%)?$/.test(a))))throw Error("setHeight(): invalid parameter.");this.height=a;this.html&&this.style.addProperties({height:this.height});return this};FormPanelItem.prototype.setName=function(a){if("string"!==typeof a)throw Error("setName(): The parameter must be a string.");this._name=a;return this};FormPanelItem.prototype.getName=function(){return this._name};
FormPanelItem.prototype.setWidth=function(a){return FormPanel.prototype.setWidth.call(this,a)};FormPanelItem.prototype.setForm=function(a){if(!(null===a||a instanceof FormPanel))throw Error("setForm(): The parameter must be an instance of FormPanel or null.");this._form=a;return this};FormPanelItem.prototype.getForm=function(){return this._form};FormPanelItem.prototype.setLabel=function(a){if("string"!==typeof a)throw Error("setLabel(): The parameter must be a string.");this._label=a;return this};
FormPanelItem.prototype.getLabel=function(){return this._label};FormPanelItem.prototype.enable=function(){this._disabled=!1;return this};FormPanelItem.prototype.disable=function(){this._disabled=!0;return this};FormPanelItem.prototype.isDisabled=function(){return this._disabled};FormPanelItem.prototype._attachListeners=function(){};
FormPanelItem.prototype.setVisible=function(a){_.isBoolean(a)&&(this.visible=a,this.html&&(a?this.style.removeProperties(["display"]):this.style.addProperties({display:"none"})));return this};FormPanelItem.prototype._postCreateHTML=function(){this._attachListeners();this.style.applyStyle();this.style.addProperties({width:this.width,height:this.height});this._disabled?this.disable():this.enable();this.setVisible(this.visible);return this};
FormPanelItem.prototype.createHTML=function(){var a;this.html||(a=this.createHTMLElement("div"),a.id=this.id,a.className="adam form-panel-item",this.html=a,this._postCreateHTML());return this.html};var FormPanelButton=function(a){FormPanelItem.call(this,a);this._htmlButton=this.onClick=null;FormPanelButton.prototype.init.call(this,a)};FormPanelButton.prototype=new FormPanelItem;FormPanelButton.prototype.constructor=FormPanelButton;FormPanelButton.prototype.type="FormPanelButton";
FormPanelButton.prototype.init=function(a){var b={onClick:null,width:"100%"};jQuery.extend(!0,b,a);this.setOnClickHandler(b.onClick).setWidth(b.width)};FormPanelButton.prototype.setOnClickHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnClickHandler(): The parameter must be a function or null.");this.onClick=a;return this};FormPanelButton.prototype.enable=function(){this._htmlButton&&(this._htmlButton.disabled=!1);return FormPanelItem.prototype.enable.call(this)};
FormPanelButton.prototype.disable=function(){this._htmlButton&&(this._htmlButton.disabled=!0);return FormPanelItem.prototype.disable.call(this)};FormPanelButton.prototype._attachListeners=function(){var a=this;if(this.html)jQuery(this._htmlButton).on("click",function(){if("function"===typeof a.onClick)a.onClick(a)});return this};FormPanelButton.prototype._postCreateHTML=function(){this._htmlButton&&FormPanelItem.prototype._postCreateHTML.call(this);return this};
FormPanelButton.prototype.createHTML=function(){var a,b;this.html||(a=FormPanelItem.prototype.createHTML.call(this),a.className+=" form-panel-button",b=this.createHTMLElement("input"),b.type="button",b.value=this._label,b.className="btn btn-mini",a.appendChild(b),this._htmlButton=b,this._postCreateHTML());return this.html};
var FormPanelField=function(a){FormPanelItem.call(this,a);this.onChange=this._value=null;this._htmlControl=[];this._htmlLabelContainer=this._htmlControlContainer=null;this._dependantFields=[];this._initialValue=this._form=this._disabled=this.required=this._dependencyHandler=null;FormPanelField.prototype.init.call(this,a)};FormPanelField.prototype=new FormPanelItem;FormPanelField.prototype.constructor=FormPanelField;FormPanelField.prototype.type="FormPanelField";
FormPanelField.prototype.init=function(a){var b={label:"[field]",onChange:null,dependantFields:[],dependencyHandler:null,value:"",required:!1};jQuery.extend(!0,b,a);this.setLabel(b.label).setValue(b.value).setRequired(b.required).setOnChangeHandler(b.onChange).setDependantFields(b.dependantFields).setDependencyHandler(b.dependencyHandler);this._initialValue=this._value};FormPanelField.prototype.reset=function(){this.setValue(this._initialValue);return this};
FormPanelField.prototype.setForm=function(a){FormPanelItem.prototype.setForm.call(this,a);a&&a.registerDependency(this,this._dependantFields);return this};FormPanelField.prototype.setRequired=function(a){this.required=!!a;return this};FormPanelField.prototype._evalRequired=function(){return this.required&&!this._disabled?!!this._value:!0};FormPanelField.prototype._validateField=function(){return this};
FormPanelField.prototype.isValid=function(){var a=this._evalRequired();a&&(a=this._validateField());!a&&this.html?jQuery(this.html).addClass("error"):jQuery(this.html).removeClass("error");return a};FormPanelField.prototype.setDependencyHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setDependencyHandler(): The parameter must be a function or null.");this._dependencyHandler=a;return this};
FormPanelField.prototype._fireDependencyHandler=function(a,b){"function"===typeof this._dependencyHandler&&this._dependencyHandler(this,a,b);return this};FormPanelField.prototype.addDependantField=function(a){if("string"===typeof a)this._dependantFields.push(a),this._form&&this._form.registerSingleDependency(this,a);else throw Error("addDependantField(): The parameter must be a string (The name of the dependant field).");return this};
FormPanelField.prototype.setDependantFields=function(a){var b;if(!jQuery.isArray(a))throw Error("setDependantFields(): the parameter must be an array.");this._dependantFields=[];for(b=0;b<a.length;b+=1)this.addDependantField(a[b]);return this};FormPanelField.prototype.setLabel=function(a){FormPanelItem.prototype.setLabel.call(this,a);this._htmlLabelContainer&&(this._htmlLabelContainer.textContent=a);return this};
FormPanelField.prototype.setOnChangeHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnChangeHandler(): The parameter must be a function or null.");this.onChange=a;return this};FormPanelField.prototype._setValueToControl=function(a){this._htmlControl[0]&&(this._htmlControl[0].value=a);return this};
FormPanelField.prototype.setValue=function(a){var b=this._value;if("string"!==typeof a)throw Error("setValue(): The parameter must be a string.");this._setValueToControl(a);this._value=a;a!==b&&this.fireDependentFields();return this};FormPanelField.prototype.enable=function(){var a;if(this._htmlControl&&this._htmlControl.length)for(a=0;a<this._htmlControl.length;a+=1)this._htmlControl[a].disabled=!1;return FormPanelItem.prototype.enable.call(this)};
FormPanelField.prototype.disable=function(){var a;if(this._htmlControl&&this._htmlControl.length)for(a=0;a<this._htmlControl.length;a+=1)this._htmlControl[0].disabled=!0;return FormPanelItem.prototype.disable.call(this)};FormPanelField.prototype.getValue=function(){return this._value};FormPanelField.prototype._getValueFromControl=function(){var a="",b;for(b=0;b<this._htmlControl.length;b+=1)a+=this._htmlControl[b].value;return a};
FormPanelField.prototype.fireDependentFields=function(){var a,b=this._value;if(this._form)for(i=0;i<this._dependantFields.length;i++)(a=this._form.getItem(this._dependantFields[i]))&&a._fireDependencyHandler(this,b);return this};FormPanelField.prototype._onChangeHandler=function(){var a=this;return function(){var b=a._value,c=a._getValueFromControl();if(b!==c){a._value=c;if("function"===typeof a.onChange)a.onChange(a,c,b);a.fireDependentFields()}}};
FormPanelField.prototype._attachListeners=function(){var a;if(this.html)for(a=0;a<this._htmlControl.length;a+=1)jQuery(this._htmlControl[a]).on("change",this._onChangeHandler());return this};
FormPanelField.prototype._createControl=function(){var a,b;if(!this._htmlControl.length)throw Error("_createControl(): This method shouldn't be called until the field control is created.");this._setValueToControl(this._value);for(b=0;b<this._htmlControl.length;b+=1)a=this._htmlControl[b],a.className+=" inherit-width adam form-panel-field-control",this._htmlControlContainer.appendChild(a);this.setValue(this._value);return this};
FormPanelField.prototype._postCreateHTML=function(){this._htmlControlContainer&&FormPanelItem.prototype._postCreateHTML.call(this);return this};
FormPanelField.prototype.createHTML=function(){var a,b,c,d;this.html||(a=FormPanelItem.prototype.createHTML.call(this),a.className+=" adam form-panel-field record-cell",a.className+="\tadam-"+this.type.toLowerCase(),b=this.createHTMLElement("div"),b.className="adam form-panel-label record-label",c=this.createHTMLElement("span"),c.className="normal index",d=this.createHTMLElement("span"),d.className="edit",c.appendChild(d),a.appendChild(b),a.appendChild(c),this._htmlLabelContainer=b,this._htmlControlContainer=
d,this.html=a,this._createControl().setLabel(this._label),this._postCreateHTML());return this.html};var FormPanelHidden=function(a){FormPanelField.call(this,a)};FormPanelHidden.prototype=new FormPanelField;FormPanelHidden.prototype.constructor=FormPanelHidden;FormPanelHidden.prototype.type="FormPanelHidden";
FormPanelHidden.prototype._createControl=function(){this._htmlControl.length||(this._htmlControl[0]=this.createHTMLElement("input"),this._htmlControl[0].name=this._name,this._htmlControl[0].type="hidden",FormPanelField.prototype._createControl.call(this));return this};FormPanelHidden.prototype.createHTML=function(){FormPanelField.prototype.createHTML.call(this);this.html.style.display="none";return this};
var FormPanelText=function(a){FormPanelField.call(this,a);this._maxLength=this.onKeyUp=this._placeholder=null;FormPanelText.prototype.init.call(this,a)};FormPanelText.prototype=new FormPanelField;FormPanelText.prototype.constructor=FormPanelText;FormPanelText.prototype.type="FormPanelText";FormPanelText.prototype.init=function(a){var b={placeholder:"",onKeyUp:null,maxLength:0};jQuery.extend(!0,b,a);this.setPlaceholder(b.placeholder).setOnKeyUpHandler(b.onKeyUp).setMaxLength(b.maxLength)};
FormPanelText.prototype.setMaxLength=function(a){if(!("number"===typeof a&&0<=a))throw Error("setMaxLength(): The parameter must be a number major than 0.");this._maxLength=a;this._htmlControl[0]&&(a?this._htmlControl[0].maxLength=a:this._htmlControl[0].removeAttribute("maxlength"));return this};FormPanelText.prototype.setOnKeyUpHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnKeyUpHandler(): The parameter must be a function or null");this.onKeyUp=a;return this};
FormPanelText.prototype.setPlaceholder=function(a){if("string"!==typeof a)throw Error("setPlaceholder(): The parameter must be a string.");this._placeholder=a;this._htmlControl[0]&&(this._htmlControl[0].placeholder=a);return this};FormPanelText.prototype._onKeyUp=function(){var a=this;return function(b){if("function"===typeof a.onKeyUp)a.onKeyUp(a,a._htmlControl[0].value,b.keyCode)}};
FormPanelText.prototype._attachListeners=function(){this.html&&(FormPanelField.prototype._attachListeners.call(this),jQuery(this._htmlControl[0]).on("keyup",this._onKeyUp()));return this};FormPanelText.prototype._createControl=function(){this._htmlControl.length||(this._htmlControl[0]=this.createHTMLElement("input"),this._htmlControl[0].name=this._name,this._htmlControl[0].type="text",this.setMaxLength(this._maxLength),FormPanelField.prototype._createControl.call(this));return this};
FormPanelText.prototype.createHTML=function(){this.html||(FormPanelField.prototype.createHTML.call(this),this.setPlaceholder(this._placeholder));return this.html};var FormPanelNumber=function(a){FormPanelField.call(this,a);this._precision=this._groupingSeparator=this._decimalSeparator=null;this._initialized=!1;FormPanelNumber.prototype.init.call(this,a)};FormPanelNumber.prototype=new FormPanelField;FormPanelNumber.prototype.constructor=FormPanelNumber;FormPanelNumber.prototype.type="FormPanelNumber";
FormPanelNumber.prototype.init=function(a){var b={decimalSeparator:".",groupingSeparator:",",precision:-1,value:null};jQuery.extend(!0,b,a);this.setDecimalSeparator(b.decimalSeparator).setGroupingSeparator(b.groupingSeparator).setPrecision(b.precision).setValue(b.value);this._initialized=!0};FormPanelNumber.prototype._setValueToControl=function(a){this._htmlControl[0]&&(this._htmlControl[0].value=this._parseToUserString(a));return this};
FormPanelNumber.prototype._getValueFromControl=function(){var a,b=this._htmlControl[0].value;this._groupingSeparator&&(a=RegExp((this._isRegExpSpecialChar(this._groupingSeparator)?"\\":"")+this._groupingSeparator,"g"),b=b.replace(a,""));if(2<(a=b.split(this._decimalSeparator)).length)return null;a[1]=a[1]||"0";if(!/^\-?\d+$/.test(a[0])||!/^\d+$/.test(a[1]))return null;b=parseInt(a[0],10);b+=parseInt(a[1],10)/Math.pow(10,a[1].length);this._htmlControl[0].value=this._parseToUserString(b);return b};
FormPanelNumber.prototype.setValue=function(a){var b=this._value;if(!this._decimalSeparator)return this;if(!(null===a||"number"===typeof a))throw Error("setValue(): The parameter must be a number.");this._setValueToControl(a);this._value=a;a!==b&&this.fireDependentFields();return this};
FormPanelNumber.prototype.setDecimalSeparator=function(a){if(!("string"===typeof a&&1===a.length))throw Error("setDecimalSeparator(): The parameter must be a single character.");if(!isNaN(a)||0<=["+","-","/","*"].indexOf(a))throw Error("setDecimalSeparator(): Invalid parameter.");if(a===this._groupingSeparator)throw Error("setDecimalSeparator(): The decimal separator must be different than the grouping separator.");this._decimalSeparator=a;this._initialized&&this.setValue(this._value);return this};
FormPanelNumber.prototype.setGroupingSeparator=function(a){if(!("string"===typeof a&&1>=a.length))throw Error("setGroupingSeparator(): The parameter must be a single character or empty string.");if(!(isNaN(a)||0>["+","-","/","*"].indexOf(a)))throw Error("setGroupingSeparator(): Invalid parameter.");if(a===this._decimalSeparator)throw Error("setGroupingSeparator(): The grouping separator must be different than the decimal separator.");this._groupingSeparator=a;this._initialized&&this.setValue(this._value);
return this};FormPanelNumber.prototype.setPrecision=function(a){if(!("number"===typeof a&&0===a%1))throw Error("setPrecision(): The parameter must be an integer.");this._precision=a;this._initialized&&this.setValue(this._value);return this};FormPanelNumber.prototype._createControl=function(){this._htmlControl.length||(this._htmlControl[0]=this.createHTMLElement("input"),this._htmlControl[0].type="text",FormPanelField.prototype._createControl.call(this));return this};
FormPanelNumber.prototype._isRegExpSpecialChar=function(a){switch(a){case "\\":case "^":case "$":case "*":case "+":case "?":case ".":case "(":case ")":case "|":case "{":case "}":return!0}return!1};FormPanelNumber.prototype.isValid=function(){var a=FormPanelField.prototype.isValid.call(this);this._htmlControl[0].value&&null===this._value&&(a=!1);!a&&this.html?jQuery(this.html).addClass("error"):jQuery(this.html).removeClass("error");return a};
FormPanelNumber.prototype._parseToUserString=function(a){var b="",c,d,e;if(null===a)b="";else{0<=this._precision&&(c=Math.pow(10,this._precision),a=Math.round(a*c)/c);e=0===this._precision?"":this._decimalSeparator;c=Math.floor(a).toString();if(0!==this._precision){a=a.toString().split(".")[1]||(0>this._precision?"0":"");for(d=a.length;d<this._precision;d+=1)a+="0"}else a="";if(this._groupingSeparator)for(;3<c.length;)b=this._groupingSeparator+c.substr(-3)+b,c=c.slice(0,-3);b=c+b+e+a}return b};
FormPanelNumber.prototype._onKeyDown=function(){var a=this;return function(b){0===a._precision&&((48>b.keyCode||57<b.keyCode&&96>b.keyCode||105<b.keyCode)&&37!==b.keyCode&&39!==b.keyCode&&8!==b.keyCode&&46!==b.keyCode)&&b.preventDefault()}};FormPanelNumber.prototype._attachListeners=function(){this.html&&(jQuery(this._htmlControl[0]).on("keydown",this._onKeyDown()),FormPanelField.prototype._attachListeners.call(this));return this};
var FormPanelDate=function(a){FormPanelField.call(this,a);this._dom={};this._dateFormat=this._dateObject=null;FormPanelDate.prototype.init.call(this,a)};FormPanelDate.prototype=new FormPanelField;FormPanelDate.prototype.constructor=FormPanelDate;FormPanelDate.prototype.type="FormPanelDate";FormPanelDate.prototype.init=function(a){var b={dateFormat:"yyyy-mm-dd"};jQuery.extend(!0,b,a);this.setDateFormat(b.dateFormat)};
FormPanelDate.prototype.open=function(){jQuery(this._htmlControl[0]).datepicker("show");return this};FormPanelDate.prototype.close=function(){jQuery(this._htmlControl[0]).datepicker("hide");return this};FormPanelDate.prototype._validateField=function(){return null!==this._value||""===this._htmlControl[0].value};FormPanelDate.prototype._setValueToControl=function(a){return FormPanelField.prototype._setValueToControl.call(this,this._format(a))};FormPanelDate.prototype._getValueFromControl=function(){return this._unformat(this._htmlControl[0].value)};
FormPanelDate.prototype._unformat=function(a){a=App.date(a,this._dateFormat.toUpperCase(),!0);return a.isValid()?a.format():null};FormPanelDate.prototype._format=function(a){if(!a)return a;a=App.date(a);return a.isValid()?a.format(this._dateFormat.toUpperCase()):null};FormPanelDate.prototype.getFormattedDate=function(){return this._format(this._value)};
FormPanelDate.prototype._attachListeners=function(){if(this.html)jQuery(this._htmlControl[0]).on("changeDate change",this._onChangeHandler()).on("show",function(){$(".datepicker").filter(":visible").css("z-index",1300)});return this};FormPanelDate.prototype.setDateFormat=function(a){if("string"!==typeof a)throw Error("setFormat(): The parameter must be a string.");this._dateFormat=a;this._htmlControl[0]&&$(this._htmlControl[0]).datepicker({format:this._dateFormat});return this};
FormPanelDate.prototype._createControl=function(){this._htmlControl[0]||(this._htmlControl[0]=this.createHTMLElement("input"),this._htmlControl[0].name=this._name,this._htmlControl[0].type="text",this.setDateFormat(this._dateFormat),FormPanelField.prototype._createControl.call(this));return this};var FormPanelDatetime=function(a){FormPanelDate.call(this,a);this._timeFormat=null;FormPanelDatetime.prototype.init.call(this,a)};FormPanelDatetime.prototype=new FormPanelDate;
FormPanelDatetime.prototype.constructor=FormPanelDatetime;FormPanelDatetime.prototype.type="FormPanelDatetime";FormPanelDatetime.prototype.init=function(a){var b={timeFormat:"H:i"};jQuery.extend(!0,b,a);this.setTimeFormat(b.timeFormat)};FormPanelDatetime.prototype.openTime=function(){jQuery(this._htmlControl[1]).timepicker("show");return this};FormPanelDatetime.prototype.closeTime=function(){jQuery(this._htmlControl[1]).timepicker("hide");return this};FormPanelDatetime.prototype.closeAll=function(){return this.close().closeTime()};
FormPanelDatetime.prototype._setValueToControl=function(a){var b;if(!this._htmlControl.length)return this;a?(a=a.split("T"),b=a[1],a=a[0],this._htmlControl[1]&&(FormPanelDate.prototype._setValueToControl.call(this,a),b=b.split(/[\+\-]/),b=b[0],jQuery(this._htmlControl[1]).timepicker("setTime",b))):this._htmlControl[0].value=this._htmlControl[1].value="";return this};
FormPanelDatetime.prototype._getValueFromControl=function(){var a="",b,c,d=!1;this._htmlControl.length&&(b=this._htmlControl[0].value,c=this._htmlControl[1].value,b&&c&&(a=SUGAR.App.date(b+" "+c,this._dateFormat.toUpperCase()+" "+SUGAR.App.date.convertFormat(this._timeFormat),!0),d=a.isValid()),d?a=a.format():(b&&!FormPanelDate.prototype._unformat.call(this,b)&&(this._htmlControl[0].value=""),c&&jQuery(this._htmlControl[1]).timepicker("setTime",c),a=null));return a};
FormPanelDatetime.prototype.setValue=function(a){var b=this._value;if(!(null===a||"string"===typeof a))throw Error("setValue(): The parameter must be a string.");if(!("string"===typeof a&&(""===a||App.date(a).isValid())))throw Error("setValue(): Invalid value.");this._setValueToControl(a);this._value=a;a!==b&&this.fireDependentFields();return this};
FormPanelDatetime.prototype.setTimeFormat=function(a){var b="",c,d;switch(a){case "H:i":case "h:ia":case "h:iA":case "h:i a":case "h:i A":case "H.i":case "h.ia":case "h.iA":case "h.i a":case "h.i A":this._timeFormat=a;break;default:throw Error("setTimeFormat(): invalid format.");}this._htmlControl[1]&&(this._dateObject&&(c=a.split(""),d=this._dateObject.getHours(),d="h"===c[0]&&12<d?d-12:d,b+=(10>d?"0"+d:d)+c[1],d=this._dateObject.getMinutes(),b+=10>d?"0"+d:d,3<c.length&&(d=12>this._dateObject.getHours()?
"am":"pm",b="a"===c[3]?b+d:"A"===c[3]?b+d.toUpperCase():b+(" "+("A"===c[4]?d.toUpperCase():"a"===c[4]?d:"")))),this._htmlControl[1].value=b,jQuery(this._htmlControl[1]).timepicker({timeFormat:a,appendTo:function(a){return a.parent().parent().parent().parent().parent().parent().parent()}}));return this};FormPanelDatetime.prototype._attachListeners=function(){this.html&&(FormPanelDate.prototype._attachListeners.call(this),jQuery(this._htmlControl[1]).on("change",this._onChangeHandler()));return this};
FormPanelDatetime.prototype._createControl=function(){this._htmlControl.length||(this._htmlControl[1]=this.createHTMLElement("input"),this._htmlControl[1].type="text",this.setTimeFormat(this._timeFormat),FormPanelDate.prototype._createControl.call(this));return this};var FormPanelDropdown=function(a){FormPanelField.call(this,a);this._dataRoot=this._dataURL=this._proxy=this._options=null;this._massiveAction=!1;this._valueField=this._labelField=null;FormPanelDropdown.prototype.init.call(this,a)};
FormPanelDropdown.prototype=new FormPanelField;FormPanelDropdown.prototype.constructor=FormPanelDropdown;FormPanelDropdown.prototype.type="FormPanelDropdown";
FormPanelDropdown.prototype.init=function(a){var b={options:[],value:"",dataURL:null,dataRoot:null,labelField:"label",valueField:"value"};jQuery.extend(!0,b,a);this._proxy=new SugarProxy;FormPanelField.prototype.setValue.call(this,b.value);this._options=new ArrayList;this.setDataURL(b.dataURL).setDataRoot(b.dataRoot).setLabelField(b.labelField).setValueField(b.valueField);"string"===typeof b._dataURL?this.load():this.setOptions(b.options)};
FormPanelDropdown.prototype.setLabelField=function(a){if("string"!==typeof a)throw Error("setLabelField(): The parameter must be a string.");this._labelField=a;return this};FormPanelDropdown.prototype.getLabelField=function(a){return this._labelField};FormPanelDropdown.prototype.setValueField=function(a){if(!("string"===typeof a||"function"===typeof a))throw Error("setValueField(): The parameter must be a string.");this._valueField=a;return this};FormPanelDropdown.prototype.getValueField=function(){return this._valueField};
FormPanelDropdown.prototype._showLoadingMessage=function(){var a;this._htmlControl.length&&(a=this.createHTMLElement("option"),a.value="",a.label=a.textContent="loading...",a.className="adam form-apnel-dropdown-loading",a.selected=!0,this.disable(),this._htmlControl[0].appendChild(a));return this};FormPanelDropdown.prototype._removeLoadingMessage=function(){jQuery(this._htmlControl[0]).find("adam form-apnel-dropdown-loading").remove();this.enable();return this};
FormPanelDropdown.prototype._onLoadDataSuccess=function(){var a=this;return function(b){b=a._dataRoot?b[a._dataRoot]:b;a._removeLoadingMessage();a.setOptions(b)}};FormPanelDropdown.prototype.load=function(){if("string"!==typeof this._dataURL)throw Error("load(): The dataURL wasn't set properly.");this._proxy.url=this._dataURL;this.clearOptions();this._showLoadingMessage();this._proxy.getData(null,{success:this._onLoadDataSuccess()});return this};
FormPanelDropdown.prototype.setDataRoot=function(a){if(!(null===a||"string"===typeof a))throw Error("setDataRoot(): The parameter must be a string or null.");this._dataRoot=a;return this};FormPanelDropdown.prototype.setDataURL=function(a){if(!(null===a||"string"===typeof a))throw Error("setDataURL(): The parameter must be a string or null.");this._dataURL=a;return this};
FormPanelDropdown.prototype.existsValueInOptions=function(a){var b,c=this._options.asArray();if("string"===typeof this._valueField)return!!this._options.find(this._valueField,a);for(b=0;b<c[b];b+=1)if(a===this._valueField(c[b]))return!0;return!1};FormPanelDropdown.prototype._getFirstAvailableOption=function(){var a;return this._options?(a=this._options.asArray(),a[0]||null):null};FormPanelDropdown.prototype.getSelectedText=function(){return jQuery(this.html).find("option:selected").text()};
FormPanelDropdown.prototype.getSelectedData=function(){return jQuery(this.html).find("option:selected").data("data")};FormPanelDropdown.prototype.setValue=function(a){this._options&&(this.existsValueInOptions(a)?FormPanelField.prototype.setValue.call(this,a):(a=(a=this._getFirstAvailableOption())?"function"===typeof this._valueField?this._valueField(this,a):a[this._valueField]:"",FormPanelField.prototype.setValue.call(this,a||"")));return this};
FormPanelDropdown.prototype.clearOptions=function(){jQuery(this._htmlControl[0]).empty();this._options.clear();this._value="";return this};FormPanelDropdown.prototype._paintOption=function(a){var b=this.createHTMLElement("option");b.label=b.textContent=a[this._labelField];b.value="function"===typeof this._valueField?this._valueField(this,a):a[this._valueField];jQuery(b).data("data",a);this._htmlControl[0].appendChild(b);return this};
FormPanelDropdown.prototype.addOption=function(a){"object"===typeof a&&(a=cloneObject(a),this._options.insert(a),this.html&&!this._massiveAction&&this._paintOption(a));return this};FormPanelDropdown.prototype._paintOptions=function(){var a,b=this._options.asArray();if(this.html){jQuery(this._htmlControl[0]).empty();for(a=0;a<b.length;a+=1)this._paintOption(b[a])}return this};
FormPanelDropdown.prototype.setOptions=function(a){var b,c;if(!jQuery.isArray(a))throw Error("setOptions(): The parameter must be an array.");c=this._value;this._massiveAction=!0;this.clearOptions();for(b=0;b<a.length;b+=1)this.addOption(a[b]);this._paintOptions();this._massiveAction=!1;this.setValue(c);return this.html};FormPanelDropdown.prototype.reset=function(){};
FormPanelDropdown.prototype._createControl=function(){this._htmlControl[0]||(this._htmlControl[0]=this.createHTMLElement("select"),this._htmlControl[0].name=this._name,FormPanelField.prototype._createControl.call(this));return this};FormPanelDropdown.prototype.createHTML=function(){this.html||(FormPanelField.prototype.createHTML.call(this),this._paintOptions(),this._setValueToControl(this._value),this._value=this._getValueFromControl());return this};
var FormPanelRadio=function(a){FormPanelField.call(this,a);this._options=[];FormPanelRadio.prototype.init.call(this,a)};FormPanelRadio.prototype=new FormPanelField;FormPanelRadio.prototype.constructor=FormPanelRadio;FormPanelRadio.prototype.type="FormPanelRadio";FormPanelRadio.prototype.init=function(a){var b={options:[]};jQuery.extend(!0,b,a);this.setOptions(b.options).setValue(void 0!==b.value?b.value:this._value)};
FormPanelRadio.prototype._setValueToControl=function(a){var b,c;for(b=0;b<this._htmlControl.length;b+=1)c=jQuery(this._htmlControl[b]).find("input").get(0),c.checked=c.value===a?!0:!1;return this};FormPanelRadio.prototype.setValue=function(a){FormPanelField.prototype.setValue.call(this,a);this._htmlControl.length&&(this._value=this._getValueFromControl());return this};
FormPanelRadio.prototype.setOptions=function(a){var b;if(!jQuery.isArray(a))throw Error("setOptions(): The parameter must be an array.");for(b=0;b<a.length;b+=1)!0===a[b].selected&&(this._value=a[b].value);this._options=a;return this};FormPanelRadio.prototype._getValueFromControl=function(){var a,b,c="";if(this._htmlControl.length){a=jQuery(this._htmlControl[0]);for(b=1;b<this._htmlControl.length;b+=1)a.add(this._htmlControl[b]);a=a.find(":checked");a.length&&(c=a.val())}return c};
FormPanelRadio.prototype._createControl=function(){var a,b,c;if(!this._htmlControl.length){for(a=0;a<this._options.length;a+=1)c=this.createHTMLElement("label"),b=this.createHTMLElement("input"),b.type="radio",b.name=this._name,b.value=this._options[a].value,b.className="adam formpanel-radio",b.checked=!!this._options[a].selected,c.appendChild(b),c.appendChild(document.createTextNode(this._options[a].label)),this._htmlControl.push(c);FormPanelField.prototype._createControl.call(this)}return this};
var FormPanelCheckbox=function(a){FormPanelField.call(this,a)};FormPanelCheckbox.prototype=new FormPanelField;FormPanelCheckbox.prototype.constructor=FormPanelCheckbox;FormPanelCheckbox.prototype.type="FormPanelCheckbox";FormPanelCheckbox.prototype._setValueToControl=function(a){this._htmlControl[0]&&(this._htmlControl[0].checked=!!a);return this};FormPanelCheckbox.prototype._getValueFromControl=function(){return this._htmlControl[0].checked};
FormPanelCheckbox.prototype.setValue=function(a){var b=this._value;this._setValueToControl(!!a);this._value=!!a;a!==b&&this.fireDependentFields();return this};FormPanelCheckbox.prototype._createControl=function(){this._htmlControl.length||(this._htmlControl[0]=this.createHTMLElement("input"),this._htmlControl[0].type="checkbox",this._htmlControl[0].name=this._name,FormPanelField.prototype._createControl.call(this));return this};
var ListPanel=function(a){CollapsiblePanel.call(this,a);this._showingLoadingMessage=this._htmlMessage=this._dataRoot=this._autoload=this._dataURL=this._proxy=this._data=this._itemsContent=null;this._filter=[];this.onLoad=this.onItemClick=this._filterMode=null;ListPanel.prototype.init.call(this,a)};ListPanel.prototype=new CollapsiblePanel;ListPanel.prototype.constructor=ListPanel;ListPanel.prototype.type="ListPanel";
ListPanel.prototype.init=function(a){var b={items:[],itemsContent:"[list item]",data:null,onItemClick:null,dataURL:null,autoload:!1,dataRoot:null,onLoad:null,filter:[],filterMode:"inclusive",fieldToFilter:null};jQuery.extend(!0,b,a);this._proxy=new SugarProxy;this._autoload=b.autoload;this.setFilterMode(b.filterMode).setItemsContent(b.itemsContent).setOnItemClickHandler(b.onItemClick).setDataURL(b.dataURL).setDataRoot(b.dataRoot).setOnLoadHandler(b.onLoad);"string"===typeof this._dataURL&&this._autoload?
this.load():jQuery.isArray(b.data)?this.setDataItems(b.data,b.fieldToFilter,b.filter):this.setItems(b.items)};ListPanel.prototype.setFilterMode=function(a){if("inclusive"!==a&&"exclusive"!==a)throw Error('setFilterMode(): The value for the parameter should be "inclusive" or "exclusive"');this._filterMode=a;return this};ListPanel.prototype.getFilterMode=function(a){return this._filterMode};
ListPanel.prototype.setOnLoadHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("onLoadHandler(): The parameter must be a function or null.");this.onLoad=a;return this};ListPanel.prototype._checkItemsNum=function(){0===this._items.getSize()?this.showMessage("[0 items]"):this.removeMessage();return this};ListPanel.prototype.setDataRoot=function(a){if(!(null===a||"string"===typeof a))throw Error("setDataRoot(): The parameter must be a string or null.");this._dataRoot=a;return this};
ListPanel.prototype._createMessageBox=function(){var a;this._htmlMessage?a=this._htmlMessage:(a=this.createHTMLElement("div"),a.className="adam list-panel-message",this._htmlMessage=a);return a};ListPanel.prototype.showMessage=function(a){var b=this._createMessageBox();this._showingLoadingMessage=!1;jQuery(b).empty();isHTMLElement(a)?b.appendChild(a):"string"===typeof a&&(b.textContent=a);$(this._htmlBody).prepend(this._htmlMessage);return this};
ListPanel.prototype.removeMessage=function(){jQuery(this._htmlMessage).remove();this._showingLoadingMessage=!1;return this};ListPanel.prototype._onLoadDataError=function(){var a=this;return function(b){b=a.createHTMLElement("strong");b.appendChild(document.createTextNode("An error occurred, please try again."));a.showMessage(b)}};
ListPanel.prototype._onLoadDataSuccess=function(){var a=this;return function(b){var c=a._dataRoot?b[a._dataRoot]:b;a.removeMessage().setDataItems(c)._checkItemsNum();if("function"===typeof a.onLoad)a.onLoad(a,b)}};
ListPanel.prototype._showLoadingMessage=function(){var a,b;if(this._showingLoadingMessage)return this;a=this.createHTMLElement("span");b=this.createHTMLElement("i");b.className="adam list-panel-spinner icon-spinner icon-spin";a.appendChild(b);a.appendChild(document.createTextNode("loading..."));this.showMessage(a);this._showingLoadingMessage=!0;return this};
ListPanel.prototype.load=function(){if("string"!==typeof this._dataURL)throw Error("load(): The url wasn't set properly.");this._proxy.url=this._dataURL;this.clearItems();this._showLoadingMessage();this._proxy.getData(null,{success:this._onLoadDataSuccess(),error:this._onLoadDataError()});return this};ListPanel.prototype.setDataURL=function(a){if(!(null===a||"string"===typeof a))throw Error("setDataURL(): The parameter must be a string or null.");this._dataURL=a;return this};
ListPanel.prototype.setOnItemClickHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnItemClickHandler(): The parameter must be a function or null.");this.onItemClick=a;return this};ListPanel.prototype._onItemClickHandler=function(){var a=this;return function(b){if("function"===typeof a.onItemClick)a.onItemClick(a,b);a._onValueAction(b)}};
ListPanel.prototype.addDataItem=function(a){if("object"!==typeof a)throw Error("addDataItem(): The parameter must be an object.");this.addItem({data:a});return this};
ListPanel.prototype._filterData=function(a,b,c){var d=[],e,f=!1,g=this;jQuery.isArray(c)&&c.length?f=function(a){return"inclusive"===g._filterMode?0<=c.indexOf(a[b]):-1===c.indexOf(a[b])}:"string"===typeof c?f=function(a){return c.toLowerCase()===a[b].toLowerCase()}:"function"===typeof c&&(f=c);if("string"===typeof b&&f){for(e=0;e<a.length;e+=1)f(a[e])&&d.push(a[e]);return d}return a};ListPanel.prototype.getFilter=function(){return this._filter.slice(0)};
ListPanel.prototype.setDataItems=function(a,b,c){if(jQuery.isArray(a)){this._massiveAction=!0;a=this._filterData(a,b,c);this.clearItems();for(b=0;b<a.length;b+=1)this.addDataItem(a[b]);this._filter=c||[];this._paintItems();this._massiveAction=!1}return this};ListPanel.prototype.setItemsContent=function(a){if(!("string"===typeof a||"function"===typeof a))throw Error("setItemsContent(): The parameter must be a string or a function.");this._itemsContent=a;return this};
ListPanel.prototype.setItems=function(a){this._itemsContent&&CollapsiblePanel.prototype.setItems.call(this,a);return this};ListPanel.prototype.addItem=function(a){a instanceof ListItem||(a.text||(a.text=this._itemsContent),a=new ListItem(a));a.setOnClickHandler(this._onItemClickHandler());CollapsiblePanel.prototype.addItem.call(this,a);return this};ListPanel.prototype._createBody=function(){var a=this.createHTMLElement("ul");a.className="list-panel";return a};ListPanel.prototype.getValueObject=function(a){return a.getData()};
var MultipleCollapsiblePanel=function(a){CollapsiblePanel.call(this,jQuery.extend(!0,{bodyHeight:100},a));this._selectedPanel=this._lastSelectedPanel=this._htmlContentTitle=this._htmlContentHeader=this._htmlContent=this._panelList=this._selectedPanel=null;this._fastAccessObject={};MultipleCollapsiblePanel.prototype.init.call(this,a)};MultipleCollapsiblePanel.prototype=new CollapsiblePanel;MultipleCollapsiblePanel.prototype.constructor=MultipleCollapsiblePanel;
MultipleCollapsiblePanel.prototype.type="MultipleCollapsiblePanel";MultipleCollapsiblePanel.prototype.init=function(){this._panelList=new ListPanel({itemsContent:this._panelListItemContent(),onItemClick:this._onPanelListItemClick(),collapsed:!1})};MultipleCollapsiblePanel.prototype.getItem=function(a){var b=null;"string"===typeof a?b=this._items.find("id",a):"number"===typeof a?b=this._items.get(a):a instanceof CollapsiblePanel&&this.isParentOf(a)&&(b=a);return b};
MultipleCollapsiblePanel.prototype.disableItem=function(a){(a=this.getItem(a))&&a.disable();return this};MultipleCollapsiblePanel.prototype.enableItem=function(a){(a=this.getItem(a))&&a.enable();return this};MultipleCollapsiblePanel.prototype._onItemEnablementStatusChange=function(){var a=this;return function(b,c){var d=a._fastAccessObject[b.id];d.listItem.setVisible(c);c?d.panel.expand():!a.isCollapsed()&&a._selectedPanel===b&&a.displayMenu(!0)}};
MultipleCollapsiblePanel.prototype._panelListItemContent=function(){return function(a,b){var c=this.createHTMLElement("a"),d=this.createHTMLElement("span"),e=this.createHTMLElement("i");c.className="adam list-item-content";e.className="adam list-item-arrow icon-circle-arrow-right";d.textContent=b.text;c.appendChild(d);c.appendChild(e);return c}};MultipleCollapsiblePanel.prototype._onPanelListItemClick=function(){var a=this;return function(b,c){a.displayPanel(c.getData().id)}};
MultipleCollapsiblePanel.prototype._clearContent=function(){var a;if(this._htmlContent)for(a=this._htmlContent.childNodes;1<a.length;)a[0].remove?this._htmlContent.lastChild.remove():this._htmlContent.lastChild.removeNode(!0);return!0};MultipleCollapsiblePanel.prototype.expand=function(a){this.displayMenu(!0);CollapsiblePanel.prototype.expand.call(this,a);return this};
MultipleCollapsiblePanel.prototype.displayPanel=function(a){a=this._items.find("id",a);var b;this._selectedPanel!==a&&(this._selectedPanel=a,this.html&&(this._lastSelectedPanel!==a&&(this._selectedPanel.getHTML(),this._clearContent(),this._htmlContentTitle.textContent=this._selectedPanel.getTitle(),this._htmlContent.appendChild(this._selectedPanel._htmlBody),a=jQuery(this._htmlBody).innerHeight(),b=jQuery(this._htmlContentHeader).outerHeight(),this._selectedPanel._htmlBody.style.height=a-b+"px"),
a=$(this._htmlBody).innerWidth(),this._htmlContent.style.left=a+"px",jQuery(this._panelList._htmlBody).animate({left:"-="+a+"px"}),jQuery(this._htmlContent).animate({left:0})))};
MultipleCollapsiblePanel.prototype.displayMenu=function(a){var b,c;if(this._selectedPanel&&(this._lastSelectedPanel=c=this._selectedPanel,this._selectedPanel=null,this._panelList._htmlBody.scrollTop=0,b=-1*parseInt(this._panelList._htmlBody.style.left,10),a?(this._panelList._htmlBody.style.left="0px",this._htmlContent.style.left=b+"px"):jQuery(this._panelList._htmlBody).add(this._htmlContent).animate({left:"+="+b+"px"}),"function"===typeof c.onCollapse))c.onCollapse(c);return this};
MultipleCollapsiblePanel.prototype.setBodyHeight=function(a){if(isNaN(a))throw Error("setBodyHeight(): The parameter must be a number.");this._bodyHeight=a;this._htmlBody&&(this._htmlBody.style.maxHeight=this._htmlBody.style.height=a+"px");return this};MultipleCollapsiblePanel.prototype.clearItems=function(){this.displayMenu();this._panelList&&this._panelList.clearItems();this._items.clear();return this};
MultipleCollapsiblePanel.prototype._paintItems=function(){var a,b;if(this._panelList){b=this._items.asArray();this._panelList.clearItems();for(a=0;a<b.length;a+=1)this._paintItem(b[a])}return this};MultipleCollapsiblePanel.prototype._paintItem=function(a){var b;this._panelList&&(this._panelList.addItem({data:{id:a.id,text:a.getTitle()},visible:!a.isDisabled()}),b=this._panelList.getItems(),this._fastAccessObject[a.id]={listItem:b[b.length-1],panel:a});return this};
MultipleCollapsiblePanel.prototype._createItem=function(a){switch(a.type){case "form":a=new FormPanel(a);break;case "list":a=new ListPanel(a);break;default:throw Error('_createItem(): The parameter has an invalid "type" property.');}return a};MultipleCollapsiblePanel.prototype.getValueObject=function(a){return a.value};MultipleCollapsiblePanel.prototype._onValueAction=function(a){if("function"===typeof this.onValueAction)this.onValueAction(a.panel,this.getValueObject(a));return this};
MultipleCollapsiblePanel.prototype._onSubpanelItemAction=function(){var a=this;return function(b,c){a._onValueAction({panel:b,value:c})}};
MultipleCollapsiblePanel.prototype.addItem=function(a){var b;if(a instanceof CollapsiblePanel)b=a;else if("object"===typeof a)b=this._createItem(a);else throw Error("addItem(): The parameter must be an instance of CollapsiblePanel or an object.");b.setParent(this).setOnValueActionHandler(this._onSubpanelItemAction()).setOnEnablementStatusChangeHandler(this._onItemEnablementStatusChange()).disableAnimations();this._items.insert(b.expand());this._massiveAction||this._paintItem(a);return this};
MultipleCollapsiblePanel.prototype.removeItem=function(a){if(a=this.getItem(a))this._items.remove(a),delete this._fastAccessObject[a.id],this.html&&(a.html.remove?a.html.remove():a.html.removeNode(!0));return this};MultipleCollapsiblePanel.prototype._attachListeners=function(){var a;this.html&&!this._attachedListeners&&(a=this,CollapsiblePanel.prototype._attachListeners.call(this),jQuery(this._htmlContentBackButton).on("click",function(){a.displayMenu()}));return this};
MultipleCollapsiblePanel.prototype._createBody=function(){var a,b,c,d,e;this._htmlBody||(a=this.createHTMLElement("div"),b=this.createHTMLElement("div"),b.className="adam multiple-panel-content",c=this.createHTMLElement("header"),c.className="adam multiple-panel-contentheader",d=this.createHTMLElement("span"),d.className="adam multiple-panel-title",e=this.createHTMLElement("i"),e.className="adam multiple-panel-back icon-circle-arrow-left",this._panelList.getHTML(),this._panelList._htmlBody.className+=
" adam-main-list",c.appendChild(d),c.appendChild(e),b.appendChild(c),a.appendChild(this._panelList._htmlBody),a.appendChild(b),this._htmlContent=b,this._htmlContentHeader=c,this._htmlContentTitle=d,this._htmlContentBackButton=e,this._htmlBody=a);return this._htmlBody};MultipleCollapsiblePanel.prototype.createHTML=function(){this.html||(CollapsiblePanel.prototype.createHTML.call(this),this.html.className+=" multiple-panel");return this.html};
var FieldPanelItemFactory=function(){var a={button:FieldPanelButton,buttongroup:FieldPanelButtonGroup,list:ListPanel,form:FormPanel,multiple:MultipleCollapsiblePanel,item_container:ItemContainer};return{hasProduct:function(b){return!!a[b]},canProduce:function(b){for(var c in a)if(a.hasOwnProperty(c)&&a[c]===b)return!0;return!1},isProduct:function(b){for(var c in a)if(a.hasOwnProperty(c)&&b instanceof a[c])return!0;return!1},make:function(b){var c=b.type;if(!this.hasProduct(c))throw Error('make(): The product "'+
c+"\" can't be produced by this factory.");return new a[c](b)}}}(),FieldPanel=function(a){Element.call(this,a);this._open=null;this._massiveAction=!1;this._onItemValueAction=null;this._items=new ArrayList;this._open=!1;this._owner=null;this._matchOwnerWidth=!0;this._appendTo=null;this._attachedListeners=!1;this.onClose=this.onOpen=this._className=null;FieldPanel.prototype.init.call(this,a)};FieldPanel.prototype=new Element;FieldPanel.prototype.constructor=FieldPanel;
FieldPanel.prototype.init=function(a){var b={items:[],onItemValueAction:null,open:!1,owner:null,matchOwnerWidth:!0,appendTo:document.body,className:"",onOpen:null,onClose:null};jQuery.extend(!0,b,a);this.setOwner(b.owner).setAppendTo(b.appendTo).setMatchOwnerWidth(b.matchOwnerWidth).setItems(b.items).setOnItemValueActionHandler(b.onItemValueAction).setClassName(b.className);b.open?this.open():this.close();this.setOnOpenHandler(b.onOpen).setOnCloseHandler(b.onClose)};
FieldPanel.prototype.setClassName=function(a){if("string"!==typeof a)throw Error("setClassName(): The parameter must be a string.");this._className=a;this.html&&jQuery(this.html).addClass(a);return this};FieldPanel.prototype.setOnOpenHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("The parameter must be a function or null.");this.onOpen=a;return this};
FieldPanel.prototype.setOnCloseHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("The parameter must be a function or null.");this.onClose=a;return this};FieldPanel.prototype.setMatchOwnerWidth=function(a){this._matchOwnerWidth=!!a;this._open&&this._append();return this};
FieldPanel.prototype.setAppendTo=function(a){if(!isHTMLElement(a)&&!("function"===typeof a||a instanceof Base))throw Error("setAppendTo(): The parameter must be an HTML element or an instance of Base.");this._appendTo=a;this.isOpen()&&this._append();return this};FieldPanel.prototype.setWidth=function(a){Element.prototype.setWidth.call(this,a);this.html&&"number"===typeof a&&this.style.addProperties({"min-width":this.width});return this};
FieldPanel.prototype.open=function(){if(!this._open&&(this.getHTML(),this._append(),jQuery(this.getHTML()).slideDown(),this._open=!0,"function"===typeof this.onOpen))this.onOpen(this);return this};FieldPanel.prototype.close=function(){if(this._open&&(this.html&&(this.html.style.display="none"),this._open=!1,"function"===typeof this.onClose))this.onClose(this);return this};FieldPanel.prototype.isOpen=function(){return this._open};FieldPanel.prototype.getOwner=function(){return this._owner};
FieldPanel.prototype.setOnItemValueActionHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnItemValueActionHandler(): the parameter must be a function or null.");this.onItemValueAction=a;return this};
FieldPanel.prototype._append=function(){var a;a=this._appendTo;var b=this._owner,c=1,d=0,e,f;b&&(isHTMLElement(b)||(b=b.html),c=b.offsetHeight);"function"===typeof a&&(a=a.call(this));isHTMLElement(a)||(a=a.html);e=a.children;for(i=0;i<e.length;i+=1)f=jQuery(e[i]).zIndex(),f>d&&(d=f);this.setZOrder(d+1);(!b||isInDOM(b))&&a.appendChild(this.html);b?(this.setWidth(this._matchOwnerWidth?b.offsetWidth:this.width),a=getRelativePosition(b,a)):(this.setWidth(this.width),a={left:0,top:0});this.setPosition(a.left,
a.top+c-1);return this};FieldPanel.prototype.setOwner=function(a){if(!(null===a||a instanceof Element||isHTMLElement(a)))throw Error("setOwner(): The parameter must be an instance of Element or null.");this._owner=a;this.isOpen()&&this._append();return this};FieldPanel.prototype._onItemValueActionHandler=function(){var a=this;return function(b,c){if("function"===typeof a.onItemValueAction)a.onItemValueAction(a,b,c)}};
FieldPanel.prototype.addItem=function(a){FieldPanelItemFactory.isProduct(a)||(a=FieldPanelItemFactory.make(a));if(FieldPanelItemFactory.isProduct(a))a.onValueAction=this._onItemValueActionHandler(),this._items.insert(a);else throw Error("addItem(): The parameter must be acceptable by this parent.");!this._massiveAction&&this.html&&this._paintItem(a);return this};FieldPanel.prototype.clearItems=function(){this._items.clear();jQuery(this.html).empty();return this};
FieldPanel.prototype._paintItem=function(a){this.html.appendChild(a.getHTML());return this};FieldPanel.prototype._paintItems=function(){var a,b;if(this.html){b=this._items.asArray();for(a=0;a<b.length;a++)this._paintItem(b[a])}return this};FieldPanel.prototype.setItems=function(a){var b;this._massiveAction=!0;this.clearItems();for(b=0;b<a.length;b++)this.addItem(a[b]);this._paintItems();this._massiveAction=!1;return this};FieldPanel.prototype.getItems=function(){return this._items.asArray()};
FieldPanel.prototype.hideItem=function(a){(a=this._items.get(a))&&a.hide();return this};FieldPanel.prototype.showItem=function(a){(a=this._items.get(a))&&a.show();return this};FieldPanel.prototype.attachListeners=function(){var a=this;this.html&&!this._attachedListeners&&(jQuery(document).on("click",function(b){var c=$(a.html);a._owner&&(c=isHTMLElement(a._owner)?c.add(a._owner):c.add(a._owner.html));jQuery(b.target).closest(c).length||a.close()}),this._attachedListeners=!0);return this};
FieldPanel.prototype.createHTML=function(){this.html||(Element.prototype.createHTML.call(this),this.html.className="adam field-panel",this._paintItems(),this.style.addProperties({position:"absolute","min-width":this.width,height:"auto",zIndex:this.zOrder}),this.html.style.display=this._open?"":"none",this.setClassName(this._className),this.attachListeners());return this.html};
var DropdownSelector=function(a){a.open=!1;FieldPanel.call(this,a);this._matchOwnerWidth=this._appendTo=this._open=this.value=this.values=this.onChange=this._owner=null;DropdownSelector.prototype.init.call(this,a)};DropdownSelector.prototype=new FieldPanel;DropdownSelector.prototype.type="DropboxSelector";DropdownSelector.prototype.init=function(a){var b={width:250,height:"auto",owner:null,onChange:null,values:null,value:null,open:!1,appendTo:document.body,matchOwnerWidth:!0};$.extend(!0,b,a);this.setMatchOwnerWidth(b.matchOwnerWidth).setWidth(b.width).setHeight(b.height).setOwner(b.owner).setOnChangeHandler(b.onChange).setValues(b.values).setValue(b.value).setIsOpen(b.open).setAppendTo(b.appendTo)};
DropdownSelector.prototype.setOwner=function(a){this._owner=a;return this};DropdownSelector.prototype.setIsOpen=function(a){this._open=a;return this};DropdownSelector.prototype.isPanelOpen=function(){return this._open};DropdownSelector.prototype.setAppendTo=function(a){this._appendTo=a;return this};
DropdownSelector.prototype.setWidth=function(a){if(!("number"===typeof a||"string"===typeof a&&("auto"===a||/^\d+(\.\d+)?(em|px|pt|%)?$/.test(a))))throw Error("setWidth(): invalid parameter.");this.width=a;this.html&&this.style.addProperties({width:this.width});return this};
DropdownSelector.prototype.setHeight=function(a){if(!("number"===typeof a||"string"===typeof a&&("auto"===a||/^\d+(\.\d+)?(em|px|pt|%)?$/.test(a))))throw Error("setHeight(): invalid parameter.");this.height=a;this.html&&this.style.addProperties({height:this.height});return this};DropdownSelector.prototype.setMatchOwnerWidth=function(a){this._matchOwnerWidth=a;return this};
DropdownSelector.prototype.open=function(){this.getHTML();this.isPanelOpen()||(this._appendPanel(),$(this.html).slideDown(),this.setIsOpen(!0));return this};DropdownSelector.prototype.close=function(){this.html&&(this.html.style.display="none");this.setIsOpen(!1)};DropdownSelector.prototype.setOnChangeHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnChangeHandler(): the parameter must be a function or null.");this.onChange=a;return this};
DropdownSelector.prototype.setValues=function(a){this.values=a;this.html&&this.createElements();return this};DropdownSelector.prototype.setValue=function(a){this.value=a;this.html&&console.log("Update Value visually");return this};
DropdownSelector.prototype.createHTML=function(){var a;FieldPanel.prototype.createHTML.call(this);this.style.applyStyle();a=new ListPanel({bodyHeight:100,maxBodyHeight:200,collapsed:!1,headerVisible:!1,itemsContent:"{{text}}"});this.addItem(a);this.listHtml=a;this.style.addProperties({position:"absolute",height:"auto","min-width":0,zIndex:this.zOrder});this.createElements();this.attachListeners();return this.html};
DropdownSelector.prototype.createElements=function(){var a;this.listHtml.clearItems();this.listHtml.addItem(new CloseListItem({data:{}}));if(jQuery.isArray(this.values))for(a=0;a<this.values.length;a+=1)this.listHtml.addDataItem({value:this.values[a].value,text:this.values[a].text});else for(a in this.values)this.listHtml.addDataItem({value:a,text:this.values[a]});return this};
DropdownSelector.prototype.attachListeners=function(){var a=this;if(this.html)$(document).on("click",function(b){var c="#"+a.id;b.target!==a.html&&(!$(b.target).parents(c).length&&b.target.parentNode!==a._owner)&&a.close()});return this};
DropdownSelector.prototype._appendPanel=function(){var a;a=this._appendTo;var b=this._owner,c=1,d=0,e,f;b&&(isHTMLElement(b)||(b=b.html),c=b.offsetHeight);"function"===typeof a&&(a=a.call(this));isHTMLElement(a)||(a=a.html);e=a.children;for(i=0;i<e.length;i+=1)f=jQuery(e[i]).zIndex(),f>d&&(d=f);this.setZOrder(d+1);(!b||isInDOM(b))&&a.appendChild(this.html);b?(this.setWidth(this._matchOwnerWidth?b.offsetWidth:this.width),a=getRelativePosition(b,a)):(this.setWidth(this.width),a={left:0,top:0});this.setPosition(a.left,
a.top+c-1);return this};
var ExpressionControl=function(a){Element.call(this,a);this._panel=null;this._operatorSettings={};this._operatorPanel=null;this._evaluationSettings={};this._evaluationPanel=null;this._evaluationPanels={};this._constantPanel=this._constantSettings=this._variablePanel=this._variableSettings=null;this._constantPanels={};this._attachedListeners=!1;this._value=this.onChange=null;this._panelSemaphore=!0;this._itemContainer=null;this._externalItemContainer=!1;this._numberGroupingSeparator=this._decimalSeparator=
this._dateFormat=this._expressionVisualizer=this._proxy=null;this._auxSeparator="|||";this.onClose=this.onOpen=null;ExpressionControl.prototype.init.call(this,a)};ExpressionControl.prototype=new Element;ExpressionControl.prototype.constructor=ExpressionControl;ExpressionControl.prototype.type="ExpressionControl";
ExpressionControl.prototype._regex={string:/("(?:[^"\\]|\\.)*")|('(?:[^'\\]|\\.)*')/,datetime:/^\d{4}-((0[1-9])|(1[0-2]))-((0[1-9])|([12][0-9])|(3[01]))(\s((0[0-9])|(1[0-2])|(2[0-3])):[0-5][0-9]:[0-5][0-9])?$/,unittime:/^\d+[wdhm]$/};
ExpressionControl.prototype._typeToControl={address:"text",checkbox:"checkbox",currency:"currency",date:"date",datetime:"datetime",decimal:"number",encrypt:"text",dropdown:"dropdown","float":"number",email:"text",name:"text",integer:"integer",multiselect:"text",phone:"text",radio:"radio",textarea:"text",url:"text",textfield:"text"};
ExpressionControl.prototype.OPERATORS={arithmetic:[{text:"+",value:"addition"},{text:"-",value:"substraction"},{text:"x",value:"multiplication"},{text:"/",value:"division"}],logic:[{text:"AND",value:"AND"},{text:"OR",value:"OR"},{text:"NOT",value:"NOT"}],comparison:[{text:"<",value:"minor_than"},{text:"<=",value:"minor_equals_than"},{text:"==",value:"equals"},{text:">=",value:"major_equals_than"},{text:">",value:"major_than"},{text:"!=",value:"not_equals"}],group:[{text:"(",value:"("},{text:")",value:")"}]};
ExpressionControl.prototype.init=function(a){var b={width:200,itemContainerHeight:80,height:"auto",operators:!0,evaluation:!1,variable:!1,constant:!0,onChange:null,owner:null,itemContainer:null,appendTo:document.body,matchOwnerWidth:!0,expressionVisualizer:!0,dateFormat:"yyyy-mm-dd",decimalSeparator:"."===a.numberGroupingSeparator?",":".",numberGroupingSeparator:","===a.decimalSeparator?".":",",allowInput:!0,onOpen:null,onClose:null,className:""};jQuery.extend(!0,b,a);this._proxy=new SugarProxy;b.itemContainer instanceof
ItemContainer?(this._itemContainer=b.itemContainer,this._externalItemContainer=!0):this._itemContainer=new ItemContainer({textInputMode:b.allowInput?ItemContainer.prototype.textInputMode.ALL:ItemContainer.prototype.textInputMode.NONE,width:"100%",height:b.itemContainerHeight});this._panel=new FieldPanel({id:b.id,open:!1,onItemValueAction:this._onPanelValueGeneration(),width:this.width,className:b.className||""});this._itemContainer.setOnAddItemHandler(this._onChange()).setOnRemoveItemHandler(this._onChange()).setInputValidationFunction(this._inputValidationFunction()).setOnBeforeAddItemByInput(this._onBeforeAddItemByInput());
this.setWidth(b.width).setHeight(b.height).setDateFormat(b.dateFormat).setDecimalSeparator(b.decimalSeparator).setNumberGroupingSeparator(b.numberGroupingSeparator).setOwner(b.owner).setAppendTo(b.appendTo).setOperators(b.operators).setEvaluations(b.evaluation).setVariablePanel(b.variable).setConstantPanel(b.constant).setOnChangeHandler(b.onChange).setMatchOwnerWidth(b.matchOwnerWidth).setOnOpenHandler(b.onOpen).setOnCloseHandler(b.onClose);b.expressionVisualizer?this.showExpressionVisualizer():this.hideExpressionVisualizer()};
ExpressionControl.prototype.setOnOpenHandler=function(a){this._panel.setOnOpenHandler(a);return this};ExpressionControl.prototype.setOnCloseHandler=function(a){this._panel.setOnCloseHandler(a);return this};ExpressionControl.prototype.getText=function(){return this._itemContainer.getText()};
ExpressionControl.prototype.setDecimalSeparator=function(a){if(!("string"===typeof a&&a&&1===a.length&&!/\d/.test(a)&&!/[\+\-\*\/]/.test(a)))throw Error("setDecimalSeparator(): The parameter must be a single character different than a digit and arithmetic operator.");if(a===this._numberGroupingSeparator)throw Error("setDecimalSeparator(): The decimal separator must be different from the number grouping separator.");this._decimalSeparator=a;return this};
ExpressionControl.prototype.setNumberGroupingSeparator=function(a){if(!(null===a||"string"===typeof a&&1>=a.length))throw Error("setNumberGroupingSeparator(): The parameter is optional should be a single character or null.");if(a===this._decimalSeparator)throw Error("setNumberGroupingSeparator(): The decimal separatpr must be different from the number grouping separator.");this._numberGroupingSeparator=a;return this};
ExpressionControl.prototype.setDateFormat=function(a){this._dateFormat=a;this._constantPanels.date&&this._constantPanels.date.getItem("date").setFormat(a);return this};ExpressionControl.prototype._onBeforeAddItemByInput=function(){var a=this;return function(b,c,d,e){if(b=a._parseInputToItem(d))c.setFullData(b);else return!1}};ExpressionControl.prototype.isLeapYear=function(a){return 0===a%400||0===a%4?!0:!1};
ExpressionControl.prototype.isValidDateTime=function(a){if("string"===typeof a){if(!this._regex.datetime.test(a))return!1;a=a.split("-");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10);a[2]=parseInt(a[2],10);if(0>=a[1]||(0>=a[2]||12<a[1]||31<a[2])||(4===a[1]||6===a[1]||9===a[1])&&30<a[0]||!this.isLeapYear(a[0])&&28<a[2]||29<a[2])return!1}else return!1;return!0};
ExpressionControl.prototype._inputValidationFunction=function(){var a=this;return function(b,c){var d=jQuery.trim(c);switch(d){case "+":case "-":case "NOW":return!0;default:return a._regex.unittime.test(d)||a.isValidDateTime(d)}}};ExpressionControl.prototype.showExpressionVisualizer=function(){this._externalItemContainer||this._itemContainer.setVisible(!0);return this};ExpressionControl.prototype.hideExpressionVisualizer=function(){this._externalItemContainer||this._itemContainer.setVisible(!1);return this};
ExpressionControl.prototype.setMatchOwnerWidth=function(a){this._panel.setMatchOwnerWidth(!!a);return this};ExpressionControl.prototype.setAppendTo=function(a){this._panel.setAppendTo(a);return this};ExpressionControl.prototype.isOpen=function(){return this._panel&&this._panel.isOpen()||!1};ExpressionControl.prototype.getValueObject=function(){return this._itemContainer.getData()};
ExpressionControl.prototype._onChange=function(){var a=this;return function(b,c,d){c=a._value;a._value=JSON.stringify(b.getData());if("function"===typeof a.onChange)a.onChange(a,a._value,c)}};ExpressionControl.prototype.setOwner=function(a){this._panel.setOwner(a);return this};ExpressionControl.prototype.getOwner=function(){return this._panel.getOwner()};ExpressionControl.prototype.getValue=function(){return this._value};
ExpressionControl.prototype.setValue=function(a){var b;if("string"===typeof a)a=JSON.parse(a);else if(!jQuery.isArray(a))throw Error("The parameter must be a array formatted string or an object.");this._itemContainer.clearItems();for(b=0;b<a.length;b+=1)this._itemContainer.addItem(this._createItem(a[b]));return this};
ExpressionControl.prototype.setOnChangeHandler=function(a){if(!(null===a||"function"===typeof a))throw Error("setOnChangeHandler(): the parameter must be a function or null.");this.onChange=a;return this};ExpressionControl.prototype.setWidth=function(a){if(!("number"===typeof a||"string"===typeof a&&("auto"===a||/^\d+(\.\d+)?(em|px|pt|%)?$/.test(a))))throw Error("setWidth(): invalid parameter.");this.width=a;this.html&&this.style.addProperties({width:this.width});return this};
ExpressionControl.prototype.setHeight=function(a){if(!("number"===typeof a||"string"===typeof a&&("auto"===a||/^\d+(\.\d+)?(em|px|pt|%)?$/.test(a))))throw Error("setHeight(): invalid parameter.");this.height=a;this.html&&this.style.addProperties({height:this.height});return this};ExpressionControl.prototype._getProperty=function(a,b){var c,d;if(a){c=b.split(".");for(d=0;d<c.length;d+=1)a=a[c[d]]}return a};
ExpressionControl.prototype.setConstantPanel=function(a){this._constantSettings=a=!1===a?!1:!0===a?{basic:!0,date:!0,timespan:!0}:jQuery.extend(!0,!0,a);this._constantPanel&&this._createBasicConstantPanel()._createDateConstantPanel()._createTimespanPanel();return this};
ExpressionControl.prototype.setVariablePanel=function(a){var b={dataURL:null,dataRoot:null,data:[],dataFormat:"tabular",dataChildRoot:null,textField:"text",valueField:"value",typeField:"type",typeFilter:null,filterMode:"inclusive",moduleTextField:null,moduleValueField:null};if(!1===a)b=!1;else{jQuery.extend(!0,b,a);if(b.dataURL){if("string"!==typeof b.dataURL)throw Error('setVariablePanel(): The "dataURL" property must be a string.');if(!(null===b.dataRoot||"string"===typeof b.dataRoot))throw Error('setVariablePanel(): The "dataRoot" property must be a string or null.');
b.data=[]}else if(!jQuery.isArray(b.data))throw Error('setVariablePanel(): The "data" property must be an array.');if("tabular"!==b.dataFormat&&"hierarchical"!==b.dataFormat)throw Error('setVariablePanel(): The "dataFormat" property only can have the "hierarchical" or "tabular" values.');if("string"!==typeof b.dataChildRoot&&"hierarchical"===b.dataFormat)throw Error('setVariablePanel(): You set the "dataFormat" property to "hierarchical" so the "dataChildRoot" property must be specified.');if("string"!==
typeof b.textField)throw Error('setVariablePanel(): The "textField" property must be a string.');if("string"!==typeof b.valueField)throw Error('setVariablePanel(): The "valueField" property must be a string.');if("string"!==typeof b.typeField)throw Error('setVariablePanel(): The "typeField" property must be a string.');if(!(null===b.typeFilter||"string"===typeof b.typeFilter||jQuery.isArray(b.typeFilter)))throw Error('setVariablePanel(): The "typeFilter" property must be a string, array or null.');
if("string"!==typeof b.moduleTextField)throw Error('setVariablePanel(): The "moduleTextField" property must be a string.');if("string"!==typeof b.moduleValueField)throw Error('setVariablePanel(): The "moduleValueField" property must be a string.');if("inclusive"!==b.filterMode&&"exclusive"!==b.filterMode)throw Error('setVariablePanel(): The "filterMode" property must be "exclusive" or "inclusive"');}this._variableSettings=b;this._variablePanel&&this._createVariablePanel();return this};
ExpressionControl.prototype.setModuleEvaluation=function(a){var b={dataURL:null,dataRoot:null,textField:"text",valueField:"value",fieldDataURL:null,fieldDataRoot:null,fieldTextField:"text",fieldValueField:"value",fieldTypeField:"type"};!1===a?b=!1:jQuery.extend(!0,b,a);if(b){if("string"!==typeof b.dataURL)throw Error('setModuleEvaluation(): The "dataURL" property must be a string.');if(!("string"===typeof b.dataRoot||null===b.dataRoot))throw Error('setModuleEvaluation(): The "dataRoot" property must be a string or null.');
if("string"!==typeof b.textField)throw Error('setModuleEvaluation(): The "textField" property must be a string.');if("string"!==typeof b.valueField)throw Error('setModuleEvaluation(): The "valueField" property must be a string.');if("string"!==typeof b.fieldDataURL)throw Error('setModuleEvaluation(): The "fieldDataURL" property must be a string.');if(!("string"===typeof b.fieldDataRoot||null===b.fieldDataRoot))throw Error('setModuleEvaluation(): The "fieldDataRoot" property must be a string.');if("string"!==
typeof b.fieldTextField)throw Error('setModuleEvaluation(): The "fieldTextField" property must be a string.');if("string"!==typeof b.fieldValueField)throw Error('setModuleEvaluation(): The "fieldValueField" property must be a string.');if("string"!==typeof b.fieldTypeField)throw Error('setModuleEvaluation(): The "fieldTypeField" property must be a string.');}this._evaluationSettings||(this._evaluationSettings={});this._evaluationSettings.module=b;this._evaluationPanel&&this._createModulePanel();return this};
ExpressionControl.prototype.setFormResponseEvaluation=function(a){var b={dataURL:null,dataRoot:null,textField:"text",valueField:"value"};!1===a?b=!1:jQuery.extend(!0,b,a);if(b){if("string"!==typeof b.dataURL)throw Error('setFormResponseEvaluation(): The "dataURL" parameter must be a string.');if(!("string"===typeof b.dataRoot||null===b.dataRoot))throw Error('setFormResponseEvaluation(): The "dataRoot" parameter must be a string or null.');if("string"!==typeof b.textField)throw Error('setFormResponseEvaluation(): The "textField" parameter must be a string.');
if("string"!==typeof b.valueField)throw Error('setFormResponseEvaluation(): The "valueField" parameter must be a string.');}this._evaluationSettings.formResponse=b;this._evaluationPanels.formResponse&&this._createFormResponsePanel();return this};
ExpressionControl.prototype.setBusinessRuleEvaluation=function(a){var b={dataURL:null,dataRoot:null,textField:"text",valueField:"value"};if(!1===a)b=!1;else{jQuery.extend(!0,b,a);if("string"!==typeof b.dataURL)throw Error("setBusinessRuleEvaluation(): The parameter must be a string.");if(!("string"===typeof b.dataRoot||null===b.dataRoot))throw Error("setBusinessRuleEvaluation(): The parameter must be a string or null.");if("string"!==typeof b.textField)throw Error("setBusinessRuleEvaluation(): The parameter must be a string.");
if("string"!==typeof b.valueField)throw Error("setBusinessRuleEvaluation(): The parameter must be a string.");}this._evaluationSettings.businessRule=b;return this};
ExpressionControl.prototype.setUserEvaluation=function(a){var b={defaultUsersDataURL:null,defaultUsersDataRoot:null,defaultUsersLabelField:"text",defaultUsersValueField:"value",userRolesDataURL:null,userRolesDataRoot:null,userRolesLabelField:"text",userRolesValueField:"value",usersDataURL:null,usersDataRoot:null,usersLabelField:"text",usersValueField:"value"};if(!1===a)b=!1;else{jQuery.extend(!0,b,a);if("string"!==typeof b.defaultUsersDataURL)throw Error('setUserEvaluation(): The "defaultUsersDataURL" must be a string.');
if(!("string"===typeof b.defaultUsersDataRoot||null===b.defaultUsersDataRoot))throw Error('setUserEvaluation(): The "defaultUsersDataRoot" must be a string or null.');if("string"!==typeof b.defaultUsersLabelField)throw Error('setUserEvaluation(): The "defaultUsersLabelField" must be a string.');if("string"!==typeof b.defaultUsersValueField)throw Error('setUserEvaluation(): The "defaultUsersValueField" must be a string.');if("string"!==typeof b.userRolesDataURL)throw Error('setUserEvaluation(): The "userRolesDataURL" must be a string.');
if(!("string"===typeof b.userRolesDataRoot||null===b.userRolesDataRoot))throw Error('setUserEvaluation(): The "userRolesDataRoot" must be a string or null.');if("string"!==typeof b.userRolesLabelField)throw Error('setUserEvaluation(): The "userRolesLabelField" must be a string.');if("string"!==typeof b.userRolesValueField)throw Error('setUserEvaluation(): The "userRolesValueField" must be a string.');if("string"!==typeof b.usersDataURL)throw Error('setUserEvaluation(): The "usersDataURL" must be a string.');
if(!("string"===typeof b.usersDataRoot||null===b.usersDataRoot))throw Error('setUserEvaluation(): The "usersDataRoot" must be a string or null.');if("string"!==typeof b.usersLabelField)throw Error('setUserEvaluation(): The "usersLabelField" must be a string.');if("string"!==typeof b.usersValueField)throw Error('setUserEvaluation(): The "usersValueField" must be a string.');}this._evaluationSettings.user=b;this._evaluationPanel&&this._createUserPanel();return this};
ExpressionControl.prototype.setEvaluations=function(a){var b=["module","form","business_rule","user"],c,d;if(!1===a)this._evaluationSettings=!1;else if("object"===typeof a)for(c=0;c<b.length;c+=1)switch(d=a[b[c]]||!1,b[c]){case "module":this.setModuleEvaluation(d);break;case "form":this.setFormResponseEvaluation(d);break;case "business_rule":this.setBusinessRuleEvaluation(d);break;case "user":this.setUserEvaluation(d)}return this};
ExpressionControl.prototype.setOperators=function(a){var b,c,d;if(this._operatorSettings!==a)if(this._operatorSettings={},"object"===typeof a)for(b in this.OPERATORS){if(this.OPERATORS.hasOwnProperty(b))if("boolean"===typeof a[b])this._operatorSettings[b]=a[b]?this.OPERATORS[b]:!1;else if(jQuery.isArray(a[b])){this._operatorSettings[b]=[];for(c=0;c<a[b].length;c+=1)for(d=0;d<this.OPERATORS[b].length;d+=1)if(this.OPERATORS[b][d].text===a[b][c]){this._operatorSettings[b].push(this.OPERATORS[b][d]);
break}}}else if("boolean"===typeof a)this._operatorSettings=a?this.OPERATORS:a;else throw Error("setOperators(): The parameter must be an object literal with settings or boolean.");this._operatorPanel&&this._createOperatorPanel();return this};
ExpressionControl.prototype._getStringOrNumber=function(a){var b;(10*Math.random(1)).toString().replace(".","");var c=!1;a=jQuery.trim(a);"."!==this._decimalSeparator&&(c=0>a.indexOf("."))&&(b=a.replace(this._getDecimalSeparatorRegExp(),"."));c&&!isNaN(b)&&""!==b?(b=b.split("."),a=parseInt(b[0]),a+=b[1]?parseInt(b[1])/Math.pow(10,b[1].length):0):1<a.length&&('"'===a[0]&&'"'===a.slice(-1)?a=a.slice(1,-1):"'"===a[0]&&"'"===a.slice(-1)&&(a=a.slice(1,-1)));return a};
ExpressionControl.prototype._createItem=function(a,b){var c;c=b instanceof SingleItem?b:new SingleItem;c.setFullData(a);c.setText("{{expLabel}}");return c};ExpressionControl.prototype._getOperatorType=function(a){var b,c,d;for(b in this.OPERATORS)if(this.OPERATORS.hasOwnProperty(b)){d=this.OPERATORS[b];for(c=0;c<d.length;c+=1)if(d[c].text===a)return b.toUpperCase()}return null};
ExpressionControl.prototype._onPanelValueGeneration=function(){var a=this;return function(b,c,d){b={};var e,f,g,h;if("variables-list"!==(c.getParent()||{}).id)switch(c.id){case "button-panel-operators":b={expType:a._getOperatorType(d.value),expLabel:d.value,expValue:d.value};break;case "form-response-evaluation":b={expType:"CONTROL",expLabel:c.getItem("form").getSelectedText()+" "+c.getItem("operator").getSelectedText()+" "+d.status,expOperator:d.operator,expValue:d.status,expField:d.form};break;
case "form-module-field-evaluation":f=d.field.split(a._auxSeparator);b=a._getStringOrNumber(d.value);e="string"===typeof d.value?typeof b:typeof d.value;g=c.getItem("field").getSelectedText()+" "+c.getItem("operator").getSelectedText()+" ";h=c.getItem("value");g="Date"===f[1]?g+h.getFormattedDate():"Datetime"===f[1]?g+(h.getFormattedDate()+" "+h._htmlControl[1].value):g+("string"===e?'"'+b+'"':d.value);b={expType:"MODULE",expSubtype:f[1],expLabel:g,expValue:b,expOperator:d.operator,expModule:d.module,
expField:f[0]};break;case "form-business-rule-evaluation":b=a._getStringOrNumber(d.response);e=typeof b;b={expType:"BUSINESS_RULES",expLabel:c.getItem("rule").getSelectedText()+" "+c.getItem("operator").getSelectedText()+" "+("string"===e?'"'+b+'"':b),expValue:b,expOperator:d.operator,expField:d.rule};break;case "form-user-evaluation":f=d.operator.split("|");b=d.value||null;g=c.getItem("value").getSelectedText();switch(f[0]){case "USER_ADMIN":e="equals"===f[1]?"is admin":"is not admin";break;case "USER_ROLE":e=
("equals"===f[1]?"has role":"has not role")+" "+g;break;case "USER_IDENTITY":e=("equals"===f[1]?"==":"!=")+" "+g}g=c.getItem("user").getSelectedText()+" "+e;b={expType:f[0],expLabel:g,expValue:b,expOperator:f[1],expField:d.user};break;case "form-constant-basic":"number"===d.type?(f=d.value.split(a._getDecimalSeparatorRegExp()),b=parseInt(f[0],10),f=f[1]?parseInt(f[1],10)/Math.pow(10,f[1].length):0,b+=f*(0<=b?1:-1),e=d.value):"boolean"===d.type?e=(b="false"===d.value.toLowerCase()||"0"===d.value?!1:
!!d.value)?"TRUE":"FALSE":(b=d.value,e='"'+d.value+'"');b={expType:"CONSTANT",expSubtype:d.type,expLabel:e,expValue:b};break;case "form-constant-date":b={expType:"CONSTANT",expSubtype:"date",expLabel:c.getItem("date").getFormattedDate(),expValue:d.date};break;case "form-constant-timespan":b={expType:"CONSTANT",expSubtype:"timespan",expLabel:d.ammount+d.unittime,expValue:d.ammount+d.unittime};break;default:throw Error("_onPanelValueGeneration(): Invalid source data.");}else b={expType:"VARIABLE",expSubtype:d.type,
expLabel:d.text,expValue:d.value,expModule:d.module};c instanceof FormPanel&&c.reset();a._itemContainer.addItem(a._createItem(b))}};
ExpressionControl.prototype._createOperatorPanel=function(){var a;this._operatorPanel||(this._operatorPanel=new FieldPanelButtonGroup({id:"button-panel-operators"}));if(this._operatorSettings){this._operatorPanel.clearItems();for(a in this._operatorSettings)if(this._operatorSettings.hasOwnProperty(a)&&"object"===typeof this._operatorSettings[a]){usableItems=this._operatorSettings[a];for(i=0;i<usableItems.length;i+=1)this._operatorPanel.addItem({value:usableItems[i].text})}this._operatorPanel.setVisible(!!this._operatorPanel.getItems().length)}else this._operatorPanel.setVisible(!1);
return this._operatorPanel};
ExpressionControl.prototype.addVariablesList=function(a,b){var c,d;d={fieldToFilter:"type",filter:b.typeFilter,filterMode:b.filterMode,title:b.moduleText,data:[],itemsContent:function(a,b){var c="[item]",d,k,c=b.text;k=this.createHTMLElement("div");d=this.createHTMLElement("span");d.className="adam expressionbuilder-variableitem-text";d.textContent=c;c=this.createHTMLElement("span");c.className="adam expressionbuilder-variableitem-datatype";c.textContent=b.type;k.appendChild(d);k.appendChild(c);return k}};
for(c=0;c<a.length;c+=1)d.data.push({value:a[c][b.valueField],text:a[c][b.textField],type:a[c][b.typeField],module:b.moduleValue});newList=new ListPanel(d);newList.getItems().length&&this._variablePanel.addItem(newList);return this};
ExpressionControl.prototype._onLoadVariableDataSuccess=function(){var a=this;return function(b){var c=a._variableSettings,d,e={},f;c.dataRoot&&(b=b[c.dataRoot]);if("hierarchical"===c.dataFormat)for(d=0;d<b.length;d+=1)a.addVariablesList(b[d][c.dataChildRoot],{textField:c.textField,valueField:c.valueField,typeField:c.typeField,typeFilter:c.typeFilter,filterMode:c.filterMode,moduleText:b[d][c.moduleTextField],moduleValue:b[d][c.moduleValueField]});else{f="string"===typeof c.typeFilter?function(a){return c.typeFilter===
a}:jQuery.isArray(c.typeFilter)?function(a){return 0<=c.typeFilter.indexOf(a)}:function(){return!0};for(d=0;d<b.length;d+=1)f(b[d][c.typeField])&&(e[b[d][c.moduleValueField]]||(e[b[d][c.moduleValueField]]={fields:[]}),e[b[d][c.moduleValueField]].fields.push(b[d]));for(d in e)e.hasOwnProperty(d)&&a.addVariablesList(e[d].fields,{textField:c.textField,valueField:c.valueField,typeField:c.typeField,typeFilter:c.typeFilter,filterMode:c.filterMode,moduleText:e[d].fields[0][c.moduleTextField],moduleValue:e[d].fields[0][c.moduleValueField]})}}};
ExpressionControl.prototype._onLoadVariableDataError=function(){};
ExpressionControl.prototype._createVariablePanel=function(){var a=this._variableSettings;this._variablePanel||(this._variablePanel=new MultipleCollapsiblePanel({id:"variables-list",title:translate("LBL_PMSE_EXPCONTROL_VARIABLES_PANEL_TITLE"),onExpand:this._onExpandPanel()}),this._panel.addItem(this._variablePanel));a&&(this._variablePanel.clearItems(),a.dataURL?(this._proxy.url=a.dataURL,this._proxy.getData(null,{success:this._onLoadVariableDataSuccess(),error:this._onLoadVariableDataError()})):this._onLoadVariableDataSuccess()(a.data));
this._variablePanel.setVisible(!!a);return this._variablePanel};
ExpressionControl.prototype._createModulePanel=function(){var a,b=this,c=this._evaluationSettings.module,d;this._evaluationPanels.module||(this._evaluationPanels.module=new FormPanel({id:"form-module-field-evaluation",title:translate("LBL_PMSE_EXPCONTROL_MODULE_FIELD_EVALUATION_TITLE"),items:[{type:"dropdown",name:"module",label:translate("LBL_PMSE_EXPCONTROL_MODULE_FIELD_EVALUATION_MODULE"),width:"100%",required:!0,dependantFields:["field"],required:!0},{type:"dropdown",name:"field",label:translate("LBL_PMSE_EXPCONTROL_MODULE_FIELD_EVALUATION_VARIABLE"),
width:"40%",required:!0,dependantFields:["value"],dependencyHandler:function(a,c,d){var h=b._evaluationSettings.module;c=h.fieldDataURL.replace("{{MODULE}}",d);d?a.setDataURL(c).setDataRoot(h.fieldDataRoot).setLabelField(h.fieldTextField).setValueField(function(a,c){return c[h.fieldValueField]+b._auxSeparator+c[h.fieldTypeField]}).load():a.clearOptions()}},{type:"dropdown",name:"operator",label:"",width:"20%",labelField:"text",valueField:"value",required:!0,options:this.OPERATORS.comparison},{type:"text",
name:"value",label:translate("LBL_PMSE_EXPCONTROL_MODULE_FIELD_EVALUATION_VALUE"),width:"40%",required:!0,dependencyHandler:function(a,c,g){var h=g.split(b._auxSeparator)[1],k=[],l,m;if((h=h&&b._typeToControl[h.toLowerCase()])&&h!==d||"dropdown"===h){d=h;g=a.getForm();m={type:h,width:a.width,label:a.getLabel(),name:a.getName()};"dropdown"===h&&(l=c.getSelectedData().optionItem,c=Object.keys(l),c.forEach(function(a,b,c){k.push({value:a,label:l[a]})}),m.options=k);switch(h){case "date":case "datetime":case "decimal":case "currency":case "float":case "integer":c=
b.OPERATORS.comparison;"date"!==h&&"datetime"!==h&&(m.precision="integer"===h?0:"currency"===h?2:-1,m.groupingSeparator="currency"===h?b._numberGroupingSeparator:"",m.decimalSeparator=b._decimalSeparator);break;default:c=[b.OPERATORS.comparison[2],b.OPERATORS.comparison[5]]}g.getItem("operator").setOptions(c);h=g._createField(m);g.replaceItem(h,a);h.setDependencyHandler(a._dependencyHandler)}}}],onCollapse:function(a){a=a.getItem("value");a instanceof FormPanelDate&&a.closeAll()}}),this._evaluationPanel.addItem(this._evaluationPanels.module));
c?(a=this._evaluationPanels.module.getItem("module"),a.setDataURL(c.dataURL).setDataRoot(c.dataRoot).setLabelField(c.textField).setValueField(c.valueField).load(),this._evaluationPanel.enable(),this._evaluationPanel.setVisible(!0)):this._evaluationPanel.disable();return this._evaluationPanels.module};
ExpressionControl.prototype._createFormResponsePanel=function(){var a,b;this._evaluationPanels.formResponse||(this._evaluationPanels.formResponse=new FormPanel({id:"form-response-evaluation",title:translate("LBL_PMSE_EXPCONTROL_FORM_RESPONSE_EVALUATION_TITLE"),items:[{type:"dropdown",name:"form",label:translate("LBL_PMSE_EXPCONTROL_FORM_RESPONSE_EVALUATION_FORM"),width:"40%"},{type:"dropdown",name:"operator",label:"",width:"20%",options:[this.OPERATORS.comparison[2],this.OPERATORS.comparison[5]],
valueField:"value",labelField:"text"},{type:"dropdown",name:"status",label:translate("LBL_PMSE_EXPCONTROL_FORM_RESPONSE_EVALUATION_STATUS"),width:"40%",options:[{label:"Approved",value:"Approved"},{label:"Rejected",value:"Rejected"}]}]}));if(b=this._evaluationSettings.formResponse)a=this._evaluationPanels.formResponse.getItem("form"),this._evaluationPanel.addItem(this._evaluationPanels.formResponse),a.setDataURL(b.dataURL).setDataRoot(b.dataRoot).setLabelField(b.textField).setValueField(b.valueField).load();
return this._evaluationPanels.formResponse};
ExpressionControl.prototype._createBusinessRulePanel=function(){var a,b=this._evaluationSettings.businessRule;this._evaluationPanels.businessRule||(this._evaluationPanels.businessRule=new FormPanel({id:"form-business-rule-evaluation",type:"form",title:translate("LBL_PMSE_EXPCONTROL_BUSINESS_RULES_EVALUATION_TITLE"),items:[{type:"dropdown",name:"rule",label:translate("LBL_PMSE_EXPCONTROL_BUSINESS_RULES_EVALUATION_BR"),width:"40%",required:!0},{type:"dropdown",label:"",name:"operator",width:"20%",labelField:"text",
options:[this.OPERATORS.comparison[2],this.OPERATORS.comparison[5]]},{type:"text",label:translate("LBL_PMSE_EXPCONTROL_BUSINESS_RULES_EVALUATION_RESPONSE"),name:"response",width:"40%"}]}));b&&(a=this._evaluationPanels.businessRule.getItem("rule"),this._evaluationPanel.addItem(this._evaluationPanels.businessRule),a.setDataURL(b.dataURL).setDataRoot(b.dataRoot).setLabelField(b.textField).setValueField(b.valueField).load());return this};
ExpressionControl.prototype._createUserPanel=function(){var a,b=this._evaluationSettings.user;this._evaluationPanels.user||(this._evaluationPanels.user=new FormPanel({id:"form-user-evaluation",type:"form",title:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_TITLE"),items:[{type:"dropdown",name:"user",label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_USER"),width:"35%",options:[{label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_CURRENT"),value:"current_user"},{label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_SUPERVISOR"),
value:"supervisor"},{label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_OWNER"),value:"owner"}]},{type:"dropdown",name:"operator",label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_OPERATOR"),width:"30%",dependantFields:["value"],options:[{label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_IS_ADMIN"),value:"USER_ADMIN|equals"},{label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_IS_ROLE"),value:"USER_ROLE|equals"},{label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_IS_USER"),value:"USER_IDENTITY|equals"},
{label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_IS_NOT_ADMIN"),value:"USER_ADMIN|not_equals"},{label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_IS_NOT_ROLE"),value:"USER_ROLE|not_equals"},{label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_IS_NOT_USER"),value:"USER_IDENTITY|not_equals"}]},{type:"dropdown",name:"value",label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_VALUE"),width:"35%",required:!0,dependencyHandler:function(a,d,e){switch(e.split("|")[0]){case "USER_ADMIN":a.clearOptions().disable();
break;case "USER_ROLE":a.setDataURL(b.userRolesDataURL).setDataRoot(b.userRolesDataRoot).setLabelField(b.userRolesLabelField).setValueField(b.userRolesValueField).load();break;case "USER_IDENTITY":a.setDataURL(b.usersDataURL).setDataRoot(b.usersDataRoot).setLabelField(b.usersLabelField).setValueField(b.usersValueField).load()}}}]}),this._evaluationPanel.addItem(this._evaluationPanels.user));b?(a=this._evaluationPanels.user.getItem("user"),a.setDataURL(b.defaultUsersDataURL).setDataRoot(b.defaultUsersDataRoot).setLabelField(b.defaultUsersLabelField).setValueField(b.defaultUsersValueField).load(),
this._evaluationPanels.user.enable()):this._evaluationPanels.user.disable();return this};ExpressionControl.prototype._isRegExpSpecialChar=function(a){switch(a){case "\\":case "^":case "$":case "*":case "+":case "?":case ".":case "(":case ")":case "|":case "{":case "}":return!0}return!1};ExpressionControl.prototype._getDecimalSeparatorRegExp=function(){var a="";this._isRegExpSpecialChar(this._decimalSeparator)&&(a="\\");return RegExp(a+this._decimalSeparator,"g")};
ExpressionControl.prototype._getNumberRegExp=function(){var a="";this._isRegExpSpecialChar(this._decimalSeparator)&&(a="\\");return RegExp("^-?\\d+("+(a+this._decimalSeparator)+"\\d+)?$")};ExpressionControl.prototype._onBasicConstantKeyUp=function(){var a=this;return function(b,c,d){d=b.getForm();b=d.getItem("btn_number");d=d.getItem("btn_boolean");c=c.toLowerCase();a._getNumberRegExp().test(c)?(b.enable(),d.enable()):(b.disable(),"true"===c||"false"===c?d.enable():d.disable())}};
ExpressionControl.prototype._createDateConstantPanel=function(){var a=this._constantSettings.date;this._constantPanels.date||(this._constantPanels.date=new FormPanel({id:"form-constant-date",title:translate("LBL_PMSE_EXPCONTROL_CONSTANTS_FIXED_DATE"),items:[{type:"date",name:"date",label:"Date",width:"100%",format:this._dateFormat,required:!0}],onCollapse:function(a){a.getItem("date").close()}}),this._constantPanel.addItem(this._constantPanels.date));a?this._constantPanels.date.enable():this._constantPanels.date.disable();
return this};
ExpressionControl.prototype._createTimespanPanel=function(){var a=this._constantSettings.timespan;this._constantPanels.timespan||(this._constantPanels.timespan=new FormPanel({id:"form-constant-timespan",title:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_TIMESPAN_TITLE"),items:[{type:"text",name:"ammount",label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_TIMESPAN_AMMOUNT"),filter:"integer",width:"40%",required:!0,disabled:!0},{type:"dropdown",label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_TIMESPAN_UNIT"),name:"unittime",
width:"60%",disabled:!0,options:[{label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_TIMESPAN_YEARS"),value:"y"},{label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_TIMESPAN_MONTHS"),value:"m"},{label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_TIMESPAN_WEEKS"),value:"w"},{label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_TIMESPAN_DAYS"),value:"d"},{label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_TIMESPAN_HOURS"),value:"h"},{label:translate("LBL_PMSE_EXPCONTROL_USER_EVALUATION_TIMESPAN_MINUTES"),
value:"min"}]}]}),this._constantPanel.addItem(this._constantPanels.timespan));a?this._constantPanels.timespan.enable():this._constantPanels.timespan.disable();return this};
ExpressionControl.prototype._createBasicConstantPanel=function(){var a=this._constantSettings.basic,b;this._constantPanels.basic||(b=function(a){var b=a.getForm();b.getItem("type").setValue(a.getLabel().substr(4));b.submit()},this._constantPanels.basic=new FormPanel({id:"form-constant-basic",title:translate("LBL_PMSE_EXPCONTROL_CONSTANTS_BASIC"),submitVisible:!1,items:[{name:"value",type:"text",label:translate("LBL_PMSE_EXPCONTROL_CONSTANTS_BASIC_VALUE"),width:"100%",onKeyUp:this._onBasicConstantKeyUp()},
{name:"type",type:"hidden",label:""},{type:"button",label:translate("LBL_PMSE_EXPCONTROL_CONSTANTS_BASIC_ADD_STRING"),name:"btn_string",width:"33%",onClick:b},{type:"button",label:translate("LBL_PMSE_EXPCONTROL_CONSTANTS_BASIC_ADD_NUMBER"),name:"btn_number",width:"33%",disabled:!0,onClick:b},{type:"button",label:translate("LBL_PMSE_EXPCONTROL_CONSTANTS_BASIC_ADD_BOOLEAN"),name:"btn_boolean",width:"33%",onClick:b}],onSubmit:function(a){var b=0,e,f,g,h;if(!a.getItem("type").getValue()){f=["btn_string",
"btn_number","btn_boolean"];for(g=0;g<f.length;g+=1)h=a.getItem(f[g]),h.visible&&!h.isDisabled()&&(e=h,b+=1);if(1===b)a.getItem("type").setValue(e.getvdfvddfv().substr(4));else return!1}}}),this._constantPanel.addItem(this._constantPanels.basic));b=this._constantPanels.basic;a?(b.getItem("btn_string").setVisible(!0===a||!!a.string),b.getItem("btn_number").setVisible(!0===a||!!a.number),b.getItem("btn_boolean").setVisible(!0===a||!!a.boolean),(a=!0===a||a.string||a.number||a.boolean)?(this._constantPanel.setVisible(!0),
b.enable()):b.disable()):b.disable();return this};ExpressionControl.prototype._onExpandPanel=function(){var a=this;return function(b){var c=a._panel.getItems(),d;for(d=0;d<c.length;d+=1)c[d]instanceof CollapsiblePanel&&c[d]!==b&&c[d].collapse()}};
ExpressionControl.prototype._createMainPanel=function(){var a=[];this._externalItemContainer||a.push(this._itemContainer);this._panel.getItems().length||(this._createOperatorPanel(),a.push(this._operatorPanel),this._evaluationPanel=new MultipleCollapsiblePanel({title:translate("LBL_PMSE_EXPCONTROL_EVALUATIONS_TITLE"),onExpand:this._onExpandPanel()}),this._evaluationSettings&&(this._createModulePanel(),this._createFormResponsePanel(),this._createBusinessRulePanel(),this._createUserPanel()),a.push(this._evaluationPanel),
this._evaluationPanel.setVisible(!!this._evaluationPanel.getItems().length),this._constantPanel=new MultipleCollapsiblePanel({title:translate("LBL_PMSE_EXPCONTROL_CONSTANTS_TITLE"),onExpand:this._onExpandPanel()}),this._constantSettings&&(this._createBasicConstantPanel(),this._createDateConstantPanel(),this._createTimespanPanel()),a.push(this._constantPanel),this._constantPanel.setVisible(!!this._constantPanel.getItems().length),this._panel.setItems(a),this._createVariablePanel());return this._panel};
ExpressionControl.prototype.isPanelOpen=function(){return this._panel&&this._panel.isOpen()};ExpressionControl.prototype.open=function(){this.getHTML();this.isPanelOpen()||(this._constantPanel.collapse(!0),this._variablePanel.collapse(!0),this._evaluationPanel.collapse(!0));this._panel.open();return this};ExpressionControl.prototype.close=function(){this._panel.close();return this};
ExpressionControl.prototype.isValid=function(){var a,b,c,d=!0,e=null,f,g=0,h=this._itemContainer.getItems();for(a=0;a<h.length;a+=1){f=h[a].getData();(b="MODULE"===f.expType||"BUSINESS_RULES"===f.expType||"CONTROL"===f.expType||"USER_ADMIN"===f.expType||"USER_ROLE"===f.expType||"USER_IDENTITY"===f.expType||"CONSTANT"===f.expType||"VARIABLE"===f.expType)||"GROUP"===f.expType&&"("===f.expValue||"LOGIC"===f.expType&&"NOT"===f.expValue?d=!(e&&(c||"GROUP"===e.expType&&")"===e.expValue)):(d=e&&("GROUP"===
e.expType&&")"===e.expValue||c||b),d=null===d?!0:d);"GROUP"===f.expType&&(")"===f.expValue?(d=d&&0<g,g-=1):"("===f.expValue&&(g+=1));if(!d)break;e=f;c=b}d&&(e&&(d=d&&"LOGIC"!==e.expType&&"ARITHMETIC"!==e.expType&&!("GROUP"===e.expType&&"("===e.expValue)),d=d&&0===g);return d};
ExpressionControl.prototype.createHTML=function(){this.html||(this._createMainPanel(),this.html=this._panel.getHTML(),this.style.applyStyle(),this.style.addProperties({width:this.width,height:this.height,zIndex:this.zOrder}));return this.html};
