var Tree=function(){};Tree.treeReload=function(a,b){var c,d=$("#adam_tree");d.empty();d.pmtree({id:a,collapsed:!0,items:b,select:function(a){if(c=jCore.getActiveCanvas().customShapes.find("id",a.uid))c.canvas.emptyCurrentSelection(),c.canvas.addToSelection(c),c.canvas.currentLabel&&c.canvas.currentLabel.loseFocus(),c.canvas.project.updatePropertiesGrid(c)},unselect:function(a){}})};
var setSelectedNode=function(a){a="#"+$('a[uid ="'+a.getID()+'"]').attr("desc");$(".treechild").attr("status","unmarked");$(".treechild").css("background","#fff");$(a).css("background","#CEE3F6");$(a).attr("status","marked")},AdamConnectionDragBehavior=function(){jCore.ConnectionDragBehavior.call(this)};AdamConnectionDragBehavior.prototype=new jCore.ConnectionDragBehavior;AdamConnectionDragBehavior.prototype.type="AdamConnectionDragBehavior";var AdamShapeDragBehavior=function(){jCore.CustomShapeDragBehavior.call(this)};
AdamShapeDragBehavior.prototype=new jCore.CustomShapeDragBehavior;AdamShapeDragBehavior.prototype.type="AdamShapeDragBehavior";AdamShapeDragBehavior.prototype.attachDragBehavior=function(a){var b=$(a.getHTML());a={revert:!1,helper:"none",cursorAt:!1,revertDuration:0,disable:!1,grid:[1,1],start:this.onDragStart(a),drag:this.onDrag(a,!0),stop:this.onDragEnd(a,!0),containment:"parent",scroll:!1};b.draggable(a)};var AdamContainerDropBehavior=function(a){jCore.ContainerDropBehavior.call(this,a)};
AdamContainerDropBehavior.prototype=new jCore.ContainerDropBehavior;AdamContainerDropBehavior.prototype.type="AdamContainerDropBehavior";AdamContainerDropBehavior.prototype.dropHook=function(a,b,c){b=c.draggable.attr("id");a=a.canvas.customShapes.find("id",b);"AdamEvent"===a.type&&"BOUNDARY"===a.getEventType()?(a.setPosition(a.oldX,a.oldY),a=!1):a=!0;return a};
AdamContainerDropBehavior.prototype.onDrop=function(a){return function(b,c){var d,e=a.getCanvas(),g,h,f,k;f=[];if(e.readOnly)return!1;a.entered=!1;if(c.helper&&"drag-helper"===c.helper.attr("id"))return!1;k=c.draggable.attr("id");d=e.toolBarShapeFactory(k);if(null===d){d=e.customShapes.find("id",k);if(!d||!a.dropBehavior.dropHook(a,b,c))return!1;if(!d.parent||d.parent.id!==a.id){d=e.currentSelection;for(h=0;h<d.getSize();h+=1)g=d.get(h),k=jCore.Utils.getPointRelativeToPage(g),k=jCore.Utils.pageCoordinatesToShapeCoordinates(a,
null,k.x,k.y),f.push({shape:g,container:a,x:k.x,y:k.y,topLeft:!1});f=new jCore.CommandSwitchContainer(f);f.execute();e.commandStack.add(f);e.multipleDrop=!0}a.updateDimensions(10);e.updatedElement=null}else{b.pageX=b.pageX||b.originalEvent.pageX;b.pageY=b.pageY||b.originalEvent.pageY;k=jCore.Utils.pageCoordinatesToShapeCoordinates(a,b);if(!e.validatePositions(d,k))return e=new MessagePanel({title:"Error",wtype:"Error",message:translate("LBL_PMSE_MESSAGE_CANNOTDROPOUTSIDECANVAS")}),e.show(),!1;a.addElement(d,
k.x,k.y,d.topLeftOnCreation);d.attachListeners();e.updatedElement=d;f=new jCore.CommandCreate(d);e.commandStack.add(f);f.execute();e.hideAllFocusedLabels();d.labels.get(0)&&(d.labels.get(0).getFocus(),$("#"+d.labels.get(0).getID()).find("input").select())}}};var AdamConnectionDropBehavior=function(a){jCore.ConnectionDropBehavior.call(this,a)};AdamConnectionDropBehavior.prototype=new jCore.ConnectionDropBehavior;AdamConnectionDropBehavior.prototype.type="AdamConnectionDropBehavior";
AdamConnectionDropBehavior.prototype.basicRules={AdamEvent:{AdamEvent:{connection:"regular",type:"SEQUENCE"},AdamActivity:{connection:"regular",type:"SEQUENCE"}},AdamActivity:{AdamActivity:{connection:"regular",type:"SEQUENCE"},AdamArtifact:{connection:"dotted",destDecorator:"con_none",type:"ASSOCIATION"},AdamIntermediateEvent:{connection:"regular",type:"SEQUENCE"},AdamEndEvent:{connection:"regular",type:"SEQUENCE"},AdamGateway:{connection:"regular",type:"SEQUENCE"}},AdamStartEvent:{AdamActivity:{connection:"regular",
type:"SEQUENCE"},AdamIntermediateEvent:{connection:"regular",type:"SEQUENCE"},AdamEndEvent:{connection:"regular",type:"SEQUENCE"},AdamGateway:{connection:"regular",type:"SEQUENCE"}},AdamIntermediateEvent:{AdamActivity:{connection:"regular",type:"SEQUENCE"},AdamIntermediateEvent:{connection:"regular",type:"SEQUENCE"},AdamEndEvent:{connection:"regular",type:"SEQUENCE"},AdamGateway:{connection:"regular",type:"SEQUENCE"}},AdamBoundaryEvent:{AdamActivity:{connection:"regular",type:"SEQUENCE"},AdamIntermediateEvent:{connection:"regular",
type:"SEQUENCE"},AdamEndEvent:{connection:"regular",type:"SEQUENCE"},AdamGateway:{connection:"regular",type:"SEQUENCE"}},AdamGateway:{AdamActivity:{connection:"regular",type:"SEQUENCE"},AdamIntermediateEvent:{connection:"regular",type:"SEQUENCE"},AdamEndEvent:{connection:"regular",type:"SEQUENCE"},AdamGateway:{connection:"regular",type:"SEQUENCE"}},AdamArtifact:{AdamActivity:{connection:"dotted",destDecorator:"con_none",type:"ASSOCIATION"}}};
AdamConnectionDropBehavior.prototype.initRules={AdamCanvas:{AdamCanvas:{name:"AdamCanvas to AdamCanvas",rules:AdamConnectionDropBehavior.prototype.basicRules}},AdamActivity:{AdamCanvas:{name:"AdamActivity to AdamCanvas",rules:AdamConnectionDropBehavior.prototype.basicRules}}};
AdamConnectionDropBehavior.prototype.dropStartHook=function(a,b,c){a.srcDecorator=null;a.destDecorator=null;b=c.draggable.attr("id");b=a.canvas.customShapes.find("id",b);var d;if(b)if(d=this.validate(b,a))a.setConnectionType({type:d.type,segmentStyle:d.connection,srcDecorator:d.srcDecorator,destDecorator:d.destDecorator});else if("undefined"!==typeof b){if(!c.helper||"drag-helper"!==c.helper.attr("id"))return!1;a.setConnectionType("none")}return!0};
AdamConnectionDropBehavior.prototype.validate=function(a,b){var c,d,e,g,h;e={AdamEvent:{START:"AdamStartEvent",END:"AdamEndEvent",INTERMEDIATE:"AdamIntermediateEvent",BOUNDARY:"AdamBoundaryEvent"},bpmnArtifact:{TEXTANNOTATION:"bpmnAnnotation"}};if(a&&b){if(a.getID()===b.getID())return!1;if(this.initRules[a.getParent().getType()]&&this.initRules[a.getParent().getType()][b.getParent().getType()])if(g=this.initRules[a.getParent().getType()][b.getParent().getType()].rules,h=this.initRules[a.getParent().getType()][b.getParent().getType()].name,
c=a.getType(),d=b.getType(),"AdamEvent"===c&&e[c]&&e[c][a.getEventType()]&&(c=e[c][a.getEventType()]),"AdamEvent"===d&&e[d]&&e[d][b.getEventType()]&&(d=e[d][b.getEventType()]),e=g[c]&&g[c][d]?g[c][d]:!1,g)switch(h){case "bpmnPool to bpmnPool":a.getParent().getID()!==b.getParent().getID()&&(e=!1);break;case "bpmnLane to bpmnLane":a.getFirstPool(a.parent).getID()!==b.getFirstPool(b.parent).getID()&&(e=this.extraRules[c]&&this.extraRules[c][d]?this.extraRules[c][d]:!1);break;case "bpmnActivity to bpmnLane":e=
this.basicRules[c]&&this.basicRules[c][d]?this.basicRules[c][d]:!1}else e=!1;else c=a.getType(),d=b.getType(),"AdamEvent"===c&&e[c]&&e[c][a.getEventType()]&&(c=e[c][a.getEventType()]),"AdamEvent"===d&&e[d]&&e[d][b.getEventType()]&&(d=e[d][b.getEventType()]),e=this.advancedRules[c]&&this.advancedRules[c][d]?this.advancedRules[c][d]:!1;return e}};
AdamConnectionDropBehavior.prototype.onDrop=function(a){return function(b,c){var d=a.getCanvas(),e=c.draggable.attr("id"),g,h,f,k,p;k=d.currentConnection;a.entered=!1;if(!a.dropBehavior.dropStartHook(a,b,c))return!1;if("none"===a.getConnectionType())return!0;k&&(f=k.srcPort,k=k.destPort,f=f.id===e?f:k.id===e?k:null);if(c.helper&&"drag-helper"===c.helper.attr("id")){console.log("DD");e=a.canvas.connectionSegment.startPoint;g=a.canvas.connectionSegment.pointsTo;if(g.parent&&g.parent.id===a.id)return!0;
g.setPosition(g.oldX,g.oldY);e.x-=g.absoluteX;e.y-=g.absoluteY;f=new jCore.Port({width:10,height:10});k=new jCore.Port({width:10,height:10});h=c.offset.left-a.canvas.getX()-a.getAbsoluteX()+a.canvas.getLeftScroll();p=c.offset.top-a.canvas.getY()-a.getAbsoluteY()+a.canvas.getTopScroll();g.addPort(f,e.x,e.y);a.addPort(k,h,p,!1,f);e=new AdamFlow({srcPort:f,destPort:k,canvas:a.canvas,segmentStyle:a.connectionType.segmentStyle,flo_type:a.connectionType.type});e.setSrcDecorator(new jCore.ConnectionDecorator({width:11,
height:11,canvas:d,decoratorPrefix:"undefined"!==typeof a.connectionType.srcDecorator&&null!==a.connectionType.srcDecorator?a.connectionType.srcDecorator:"adam-decorator",decoratorType:"source",parent:e}));e.setDestDecorator(new jCore.ConnectionDecorator({width:11,height:11,canvas:d,decoratorPrefix:"undefined"!==typeof a.connectionType.destDecorator&&null!==a.connectionType.destDecorator?a.connectionType.destDecorator:"adam-decorator",decoratorType:"target",parent:e}));e.canvas.commandStack.add(new jCore.CommandConnect(e));
console.log("Connection",e);e.connect();e.setSegmentMoveHandlers();d.addConnection(e);e.setTargetShape(k.parent);e.setOriginShape(f.parent);e.savePoints();f.attachListeners(f);k.attachListeners(k);d.triggerCreateEvent(e,[])}else f&&(f.setOldParent(f.getParent()),f.setOldX(f.getX()),f.setOldY(f.getY()),g=c.position.left,h=c.position.top,f.setPosition(g,h),a.dragging=!1,a.getID()!==f.parent.getID()?(f.parent.removePort(f),g=c.offset.left-d.getX()-a.absoluteX+a.canvas.getLeftScroll(),h=c.offset.top-
d.getY()-a.absoluteY+a.canvas.getTopScroll(),a.addPort(f,g,h,!0),d.regularShapes.insert(f)):a.definePortPosition(f,f.getPoint(!0)),f.connection.connect(),d.triggerPortChangeEvent(f),f.connection.disconnect(),e=new jCore.CommandReconnect(f),f.canvas.commandStack.add(e),e=f.getConnection(),k=e.srcPort.getID()===f.getID()?AdamConnectionDropBehavior.prototype.validate(a,e.destPort.getParent()):AdamConnectionDropBehavior.prototype.validate(e.srcPort.getParent(),a))&&(f.setOldParent(f.getParent()),f.setOldX(f.getX()),
f.setOldY(f.getY()),g=c.position.left,h=c.position.top,f.setPosition(g,h),a.dragging=!1,a.getID()!==f.parent.getID()?(f.parent.removePort(f),g=c.offset.left-d.getX()-a.absoluteX+a.canvas.getLeftScroll(),h=c.offset.top-d.getY()-a.absoluteY+a.canvas.getTopScroll(),a.addPort(f,g,h,!0),d.regularShapes.insert(f)):a.definePortPosition(f,f.getPoint(!0)),k={before:{condition:e.flo_condition,type:e.flo_type,segmentStyle:e.segmentStyle,srcDecorator:e.srcDecorator.getDecoratorPrefix(),destDecorator:e.destDecorator.getDecoratorPrefix()},
after:{type:k.type,segmentStyle:k.connection,srcDecorator:k.srcDecorator,destDecorator:k.destDecorator}},e.connect(),d.triggerPortChangeEvent(f),e=new AdamCommandReconnect(f,k),e.execute(),f.canvas.commandStack.add(e));return!1}};var AdamConnectionContainerDropBehavior=function(a){AdamConnectionDropBehavior.call(this,a)};AdamConnectionContainerDropBehavior.prototype=new AdamConnectionDropBehavior;AdamConnectionContainerDropBehavior.prototype.type="AdamConnectionContainerDropBehavior";
AdamConnectionContainerDropBehavior.prototype.defaultSelector=".custom_shape,.port";AdamConnectionContainerDropBehavior.prototype.onDrop=function(a){return function(b,c){AdamConnectionDropBehavior.prototype.onDrop.call(this,a)(b,c)||AdamContainerDropBehavior.prototype.onDrop.call(this,a)(b,c)}};AdamConnectionContainerDropBehavior.prototype.getSpecificType=AdamContainerDropBehavior.prototype.getSpecificType;AdamConnectionContainerDropBehavior.prototype.validDrop=AdamContainerDropBehavior.prototype.validDrop;
AdamConnectionContainerDropBehavior.prototype.dropHook=AdamContainerDropBehavior.prototype.dropHook;var AdamShape=function(a){jCore.CustomShape.call(this,a);this.label=this.labels.get(0)};AdamShape.prototype=new jCore.CustomShape;AdamShape.prototype.type="AdamShape";AdamShape.prototype.adamConnectionDropBehavior=null;AdamShape.prototype.getType=function(){return this.type};AdamShape.prototype.setName=function(a){this.label&&this.label.setMessage(a);return this};
AdamShape.prototype.getName=function(){var a="";this.label&&(a=this.label.getMessage());return a};AdamShape.prototype.getContextMenu=function(){return{}};AdamShape.prototype.getContextMenuCallbacks=function(){return{}};
AdamShape.prototype.setDimension=function(a,b){var c;jCore.CustomShape.prototype.setDimension.call(this,a,b);c="AdamEvent"===this.getType()||"AdamGateway"===this.getType()?3:"AdamActivity"===this.getType()&&"SCRIPTTASK"===this.act_task_type?3:1;this.label&&(this.label.setDimension(.9*this.zoomWidth*c/this.canvas.zoomFactor,this.label.height),this.label.setLabelPosition(this.label.location,this.label.diffX,this.label.diffY));return this};
AdamShape.prototype.dragBehaviorFactory=function(a){if("regular"===a)return this.regularDragBehavior||(this.regularDragBehavior=new jCore.RegularDragBehavior),this.regularDragBehavior;if("connection"===a)return this.connectionDragBehavior||(this.connectionDragBehavior=new AdamConnectionDragBehavior),this.connectionDragBehavior;if("customshapedrag"===a)return this.customShapeDragBehavior||(this.customShapeDragBehavior=new AdamShapeDragBehavior),this.customShapeDragBehavior;this.noDragBehavior||(this.noDragBehavior=
new jCore.NoDragBehavior);return this.noDragBehavior};
AdamShape.prototype.dropBehaviorFactory=function(a,b){if("nodrop"===a)return this.noDropBehavior||(this.noDropBehavior=new jCore.NoDropBehavior(b)),this.noDropBehavior;if("container"===a)return this.containerDropBehavior||(this.containerDropBehavior=new jCore.ContainerDropBehavior(b)),this.containerDropBehavior;if("connection"===a)return this.connectionDropBehavior||(this.connectionDropBehavior=new AdamConnectionDropBehavior(b)),this.connectionDropBehavior;if("connectioncontainer"===a)return this.connectionContainerDropBehavior||
(this.connectionContainerDropBehavior=new AdamConnectionContainerDropBehavior(b)),this.connectionContainerDropBehavior};AdamShape.prototype.getDestElements=function(){var a=[],b,c;for(b=0;b<this.getPorts().getSize();b+=1)c=this.getPorts().get(b),c=c.connection,c.srcPort.parent.getID()===this.getID()&&a.push(c.destPort.parent);return a};
AdamShape.prototype.setDefaultFlow=function(a){var b,c;for(b=0;b<this.getPorts().getSize();b+=1)c=this.getPorts().get(b),c=c.connection,this.updateDefaultFlow(0),c.srcPort.parent.getID()===this.getID()&&(c.getID()===a?(this.updateDefaultFlow(a),c.setFlowCondition(""),c.changeFlowType("default"),c.setFlowType("DEFAULT")):"DEFAULT"===c.getFlowType()&&(c.changeFlowType("sequence"),c.setFlowType("SEQUENCE")));return this};
AdamShape.prototype.updateFlowConditions=function(){var a,b,c;for(a=0;a<this.getPorts().getSize();a+=1)b=this.getPorts().get(a).connection,b.flo_element_origin===this.getID()&&b.flo_condition&&""!==b.flo_condition&&(c=[{id:b.getID(),type:b.type,relatedObject:b,fields:[{field:"condition",newVal:"",oldVal:b.getFlowCondition()}]}],b.setFlowCondition(""),b.getCanvas().triggerDefaultFlowChangeEvent(c))};
var AdamFlow=function(a){jCore.Connection.call(this,a);this.label=this.flo_state=this.flo_y2=this.flo_x2=this.flo_y1=this.flo_x1=this.flo_condition=this.flo_is_inmediate=this.flo_element_dest_type=this.flo_element_dest=this.flo_element_origin_type=this.flo_element_origin=this.flo_name=this.flo_type=this.flo_uid=null;AdamFlow.prototype.initObject.call(this,a)};AdamFlow.prototype=new jCore.Connection;AdamFlow.prototype.type="Connection";
AdamFlow.prototype.initObject=function(a){var b={flo_type:"SEQUENCE",flo_is_inmediate:!0,flo_x1:0,flo_y1:0,flo_x2:0,flo_y2:0,name:""};$.extend(!0,b,a);this.setFlowType(b.flo_type).setFlowUid(b.flo_uid).setIsInmediate(b.flo_is_inmediate).setOriginPoint(b.flo_x1,b.flo_y1).setTargetPoint(b.flo_x2,b.flo_y2);this.setFlowName(b.name||null);this.setFlowOrigin(b.flo_element_origin||null,b.flo_element_origin_type||null);this.setFlowTarget(b.flo_element_dest||null,b.flo_element_dest_type||null);this.setFlowCondition(b.flo_condition||
null);this.setFlowState(b.flo_state||null)};AdamFlow.prototype.getName=function(){return this.flo_name};AdamFlow.prototype.setName=function(a){a&&(this.flo_name=a);return this};AdamFlow.prototype.getFlowCondition=function(){return this.flo_condition};AdamFlow.prototype.setFlowUid=function(a){this.flo_uid=a;return this};AdamFlow.prototype.setFlowType=function(a){this.flo_type=a;return this};AdamFlow.prototype.getFlowType=function(){return this.flo_type};
AdamFlow.prototype.setIsInmediate=function(a){a instanceof Boolean&&(this.flo_is_inmediate=a);return this};AdamFlow.prototype.setOriginPoint=function(a,b){this.flo_x1=a;this.flo_y1=b;return this};AdamFlow.prototype.setTargetPoint=function(a,b){this.flo_x2=a;this.flo_y2=b;return this};AdamFlow.prototype.setFlowName=function(a){this.flo_name=a;return this};AdamFlow.prototype.setFlowOrigin=function(a,b){this.flo_element_origin=a;this.flo_element_origin_type=b;return this};
AdamFlow.prototype.setFlowTarget=function(a,b){this.flo_element_dest=a;this.flo_element_dest_type=b;return this};AdamFlow.prototype.setFlowCondition=function(a){this.flo_condition=a;return this};AdamFlow.prototype.setFlowState=function(a){this.flo_state=a;return this};AdamFlow.prototype.setOriginShape=function(a){a instanceof AdamShape&&(a=this.getNativeType(a),this.flo_element_origin=a.code,this.flo_element_origin_type=a.type);return this};
AdamFlow.prototype.setTargetShape=function(a){a instanceof AdamShape&&(a=this.getNativeType(a),this.flo_element_dest=a.code,this.flo_element_dest_type=a.type);return this};
AdamFlow.prototype.getDBObject=function(){var a=this.getPoints();return{flo_uid:this.flo_uid,flo_type:{regular:"SEQUENCE",segmented:"MESSAGE",dotted:"ASSOCIATION"}[this.segmentStyle],flo_name:this.flo_name,flo_element_origin:this.flo_element_origin,flo_element_origin_type:this.flo_element_origin_type,flo_element_dest:this.flo_element_dest,flo_element_dest_type:this.flo_element_dest_type,flo_is_inmediate:this.flo_is_inmediate,flo_condition:this.flo_condition,flo_state:a}};
AdamFlow.prototype.getNativeType=function(a){var b=a.getType(),c;switch(a.getType()){case "AdamActivity":b="bpmnActivity";c=a.act_uid;break;case "AdamGateway":b="bpmnGateway";c=a.gat_uid;break;case "AdamEvent":b="bpmnEvent";c=a.evn_uid;break;case "AdamArtifact":b="bpmnArtifact",c=a.art_uid}return{type:b,code:c}};
AdamFlow.prototype.showMoveHandlers=function(){jCore.Connection.prototype.showMoveHandlers.call(this);this.canvas.updatedElement=[{relatedObject:this}];$(this.html).trigger("selectelement");return this};AdamFlow.prototype.getSegmentHeight=function(a){return Math.abs(this.lineSegments.get(a).endPoint.y-this.lineSegments.get(a).startPoint.y)};AdamFlow.prototype.getSegmentWidth=function(a){return Math.abs(this.lineSegments.get(a).endPoint.x-this.lineSegments.get(a).startPoint.x)};
AdamFlow.prototype.getLabelCoordinates=function(){var a,b;b=0;var c,d,e;e=this.getSegmentWidth(0)>this.getSegmentHeight(0)?this.getSegmentWidth(0):this.getSegmentHeight(0);for(d=1;d<this.lineSegments.getSize();d+=1)a=this.getSegmentWidth(d),c=this.getSegmentHeight(d),a>e+1?(e=a,b=d):c>e+1&&(e=c,b=d);a=(this.lineSegments.get(b).endPoint.x-this.lineSegments.get(b).startPoint.x)/2;c=(this.lineSegments.get(b).endPoint.y-this.lineSegments.get(b).startPoint.y)/2;a=this.lineSegments.get(b).startPoint.x+
a;b=this.lineSegments.get(b).startPoint.y+c;return new jCore.Point(a,b)};AdamFlow.prototype.connect=function(a){jCore.Connection.prototype.connect.call(this,a);return this};
AdamFlow.prototype.changeFlowType=function(a){var b,c,d={"default":{srcPrefix:"adam-decorator_default",destPrefix:"adam-decorator"},conditional:{srcPrefix:"adam-decorator_conditional",destPrefix:"adam-decorator"},sequence:{srcPrefix:"adam-decorator",destPrefix:"adam-decorator"}};"association"===a?(b="dotted",c="con-none"):b="regular";this.setSegmentStyle(b);this.originalSegmentStyle=b;if("association"===a)this.srcDecorator.setDecoratorPrefix("adam-decorator"),this.srcDecorator.paint();else return this.srcDecorator.setDecoratorPrefix(d[a].srcPrefix).setDecoratorType("source").paint(),
this.destDecorator.setDecoratorPrefix(d[a].destPrefix).setDecoratorType("target").paint(),this.disconnect().connect().setSegmentMoveHandlers().checkAndCreateIntersectionsWithAll(),this;c&&this.srcDecorator?this.destDecorator.setDecoratorPrefix(c):this.destDecorator.setDecoratorPrefix("adam-decorator");this.srcDecorator.paint();this.disconnect();this.connect();return this};
AdamFlow.prototype.saveAndDestroy=function(){jCore.Connection.prototype.saveAndDestroy.call(this);"DEFAULT"===this.getFlowType()&&this.getSrcPort().getParent().updateDefaultFlow("")};var CommandAdam=function(a,b,c){var d=[],e;jCore.Command.call(this,a);for(e=0;e<b.length;e+=1)d.push(a[b[e]]);this.oldValues=d;this.newValues=c;this.propertyNames=b};CommandAdam.prototype=new jCore.Command;CommandAdam.prototype.type="CommandAdam";
CommandAdam.prototype.execute=function(){var a;for(a=0;a<this.newValues.length;a+=1)this.receiver[this.propertyNames[a]]=this.newValues[a];this.canvas.triggerCommandAdam(this.receiver,this.propertyNames,this.oldValues,this.newValues)};CommandAdam.prototype.undo=function(){var a;for(a=0;a<this.newValues.length;a+=1)this.receiver[this.propertyNames[a]]=this.oldValues[a];this.canvas.triggerCommandAdam(this.receiver,this.propertyNames,this.newValues,this.oldValues)};CommandAdam.prototype.redo=function(){this.execute()};
var AdamShapeLayerCommand=function(a,b){jCore.Command.call(this,a);this.layers=[];this.updateType=null;this.beforeStyle=[];this.beforeValues=[];this.afterStyle=[];this.afterValues=[];this.propertyNames=[];AdamShapeLayerCommand.prototype.initObject.call(this,a,b)};AdamShapeLayerCommand.prototype=new jCore.Command;AdamShapeLayerCommand.prototype.type="AdamShapeLayerCommand";
AdamShapeLayerCommand.prototype.initObject=function(a,b){var c,d,e,g,h;this.updateType=b.type;this.layers=b.layers;switch(this.updateType){case "changetypegateway":this.beforeStyle.push(this.layers[0].zoomSprites);d=[];for(c=0;c<this.beforeStyle[0].length;c+=1)d.push("adam-shape-"+(25*c+50)+"-gateway-"+b.changes.toLowerCase());this.afterStyle.push(d);this.propertyNames.push("gat_type");this.beforeValues.push(a.gat_type);this.afterValues.push(b.changes);0===parseInt(a.gat_default_flow)||"PARALLEL"!==
b.changes&&"EVENTBASED"!==b.changes||(this.propertyNames.push("gat_default_flow"),this.beforeValues.push(a.gat_default_flow),this.afterValues.push(0));"EVENTBASED"===b.changes&&(this.propertyNames.push("gat_direction"),this.beforeValues.push(a.gat_direction),this.afterValues.push("UNSPECIFIED"));break;case "changeeventmarker":this.beforeStyle.push(this.layers[0].zoomSprites);d=[];g=b.changes.evn_message&&""!==b.changes.evn_message?b.changes.evn_message:b.changes.evn_marker;h="BOUNDARY"===this.receiver.evn_type?
"INTERMEDIATE":this.receiver.evn_type;for(c=0;c<this.beforeStyle[0].length;c+=1)e="adam-marker-"+(25*c+50)+"-"+h.toLowerCase(),e+="-"+b.changes.evn_behavior.toLowerCase()+"-",e+=g.toLowerCase(),d.push(e);this.afterStyle.push(d);"undefined"!==typeof b.changes.evn_behavior&&(this.propertyNames.push("evn_behavior"),this.beforeValues.push(this.receiver.evn_behavior),this.afterValues.push(b.changes.evn_behavior));"undefined"!==typeof b.changes.evn_marker&&(this.propertyNames.push("evn_marker"),this.beforeValues.push(this.receiver.evn_marker),
this.afterValues.push(b.changes.evn_marker));this.propertyNames.push("evn_message");this.beforeValues.push(this.receiver.evn_message);this.afterValues.push(b.changes.evn_message||"");break;case "changeeventtype":this.beforeStyle.push(this.layers[0].zoomSprites);d=[];for(c=0;c<this.beforeStyle[0].length;c+=1)d.push("adam-shape-"+(25*c+50)+"-event-"+b.changes.evn_type.toLowerCase());this.afterStyle.push(d);d=[];this.beforeStyle.push(this.layers[1].zoomSprites);for(c=0;c<this.beforeStyle[1].length;c+=
1)e="adam-marker-"+(25*c+50)+"-",e+=b.changes.evn_type.toLowerCase()+"-",e+=b.changes.evn_behavior.toLowerCase()+"-",e+=b.changes.evn_marker.toLowerCase(),d.push(e);this.afterStyle.push(d);"undefined"!==typeof b.changes.evn_type&&(this.propertyNames.push("evn_type"),this.beforeValues.push(this.receiver.evn_type),this.afterValues.push(b.changes.evn_type));"undefined"!==typeof b.changes.evn_behavior&&(this.propertyNames.push("evn_behavior"),this.beforeValues.push(this.receiver.evn_behavior),this.afterValues.push(b.changes.evn_behavior));
"undefined"!==typeof b.changes.evn_marker&&(this.propertyNames.push("evn_marker"),this.beforeValues.push(this.receiver.evn_marker),this.afterValues.push(b.changes.evn_marker));"undefined"!==typeof b.changes.evn_message&&(this.propertyNames.push("evn_message"),this.beforeValues.push(this.receiver.evn_message),this.afterValues.push(b.changes.evn_message));break;case "changescripttypeactivity":this.beforeStyle.push(this.layers[0].zoomSprites);d=[];for(c=0;c<this.beforeStyle[0].length;c+=1)d.push("adam-shape-"+
(25*c+50)+"-activity-scripttask-"+b.changes.toLowerCase());this.afterStyle.push(d);this.propertyNames.push("act_script_type");this.beforeValues.push(a.act_script_type);this.afterValues.push(b.changes)}};AdamShapeLayerCommand.prototype.switchDefaultFlow=function(a,b,c){a=this.receiver.canvas.connections.find("id",a);a.changeFlowType(b.toLowerCase());a.setFlowType(b);b=[{id:a.getID(),type:a.type,relatedObject:a,fields:[{field:"type",newVal:b,oldVal:c}]}];this.receiver.getCanvas().triggerDefaultFlowChangeEvent(b)};
AdamShapeLayerCommand.prototype.execute=function(){var a;for(a=0;a<this.layers.length;a+=1)this.layers[a].zoomSprites=this.afterStyle[a],this.layers[a].paint();for(a=0;a<this.propertyNames.length;a+=1)this.receiver[this.propertyNames[a]]=this.afterValues[a],"gat_default_flow"===this.propertyNames[a]&&this.switchDefaultFlow(this.beforeValues[a],"SEQUENCE","DEFAULT"),"AdamGateway"===this.receiver.getType()&&this.receiver.updateFlowConditions();this.canvas.triggerCommandAdam(this.receiver,this.propertyNames,
this.beforeValues,this.afterValues)};AdamShapeLayerCommand.prototype.undo=function(){var a;for(a=0;a<this.layers.length;a+=1)this.layers[a].zoomSprites=this.beforeStyle[a],this.layers[a].paint();for(a=0;a<this.propertyNames.length;a+=1)this.receiver[this.propertyNames[a]]=this.beforeValues[a],"gat_default_flow"===this.propertyNames[a]&&this.switchDefaultFlow(this.beforeValues[a],"DEFAULT","SEQUENCE");this.canvas.triggerCommandAdam(this.receiver,this.propertyNames,this.afterValues,this.beforeValues)};
AdamShapeLayerCommand.prototype.redo=function(){this.execute()};var AdamShapeMarkerCommand=function(a,b){jCore.Command.call(this,a);this.updateType=null;this.markers=[];this.beforeMarkerStyle=[];this.beforeMarkerType=[];this.afterMarkerStyle=[];this.afterMarkerType=[];this.beforeValues=[];this.afterValues=[];this.propertyNames=[];AdamShapeMarkerCommand.prototype.initObject.call(this,a,b)};AdamShapeMarkerCommand.prototype=new jCore.Command;AdamShapeMarkerCommand.prototype.type="AdamShapeMarkerCommand";
AdamShapeMarkerCommand.prototype.initObject=function(a,b){var c,d;this.updateType=b.type;this.markers=b.markers;switch(this.updateType){case "changeactivitymarker":this.beforeMarkerStyle.push(this.markers[0].markerZoomClasses);d=[];for(c=0;c<this.beforeMarkerStyle[0].length;c+=1)d.push("adam-marker-"+(25*c+50)+"-"+b.changes.taskType.toLowerCase());this.afterMarkerStyle.push(d);this.beforeMarkerType.push(this.receiver.act_task_type);this.afterMarkerType.push(b.changes.taskType);this.propertyNames.push("act_task_type");
this.beforeValues.push(this.receiver.act_task_type);this.afterValues.push(b.changes.taskType)}};
AdamShapeMarkerCommand.prototype.execute=function(){var a;for(a=0;a<this.markers.length;a+=1)this.markers[a].markerType=this.afterMarkerType[a],this.markers[a].markerZoomClasses=this.afterMarkerStyle[a],this.markers[a].paint(!0);for(a=0;a<this.propertyNames.length;a+=1)this.receiver[this.propertyNames[a]]=this.afterValues[a];this.canvas.triggerCommandAdam(this.receiver,this.propertyNames,this.beforeValues,this.afterValues)};
AdamShapeMarkerCommand.prototype.undo=function(){var a;for(a=0;a<this.markers.length;a+=1)this.markers[a].markerType=this.beforeMarkerType[a],this.markers[a].markerZoomClasses=this.beforeMarkerStyle[a],this.markers[a].paint(!0);for(a=0;a<this.propertyNames.length;a+=1)this.receiver[this.propertyNames[a]]=this.beforeValues[a];this.canvas.triggerCommandAdam(this.receiver,this.propertyNames,this.afterValues,this.beforeValues)};AdamShapeMarkerCommand.prototype.redo=function(){this.execute()};
var CommandAnnotationResize=function(a){jCore.CommandResize.call(this,a)};CommandAnnotationResize.prototype.type="commandAnnotationResize";CommandAnnotationResize.prototype.execute=function(){jCore.CommandResize.prototype.execute.call(this);this.receiver.paint()};CommandAnnotationResize.prototype.undo=function(){jCore.CommandResize.prototype.undo.call(this);this.receiver.paint()};CommandAnnotationResize.prototype.redo=function(){this.execute()};
var CommandSingleProperty=function(a,b){jCore.Command.call(this,a);this.after=this.before=this.propertyName=null;CommandSingleProperty.prototype.initObject.call(this,b)};CommandSingleProperty.prototype=new jCore.Command;CommandSingleProperty.prototype.type="commandSingleProperty";CommandSingleProperty.prototype.initObject=function(a){this.propertyName=a.propertyName;this.before=a.before;this.after=a.after};
CommandSingleProperty.prototype.execute=function(){this.receiver[this.propertyName]=this.after;this.receiver.canvas.triggerCommandAdam(this.receiver,[this.propertyName],[this.before],[this.after])};CommandSingleProperty.prototype.undo=function(){this.receiver[this.propertyName]=this.before;this.receiver.canvas.triggerCommandAdam(this.receiver,[this.propertyName],[this.after],[this.before])};CommandSingleProperty.prototype.redo=function(){this.execute()};var AdamActivityContainerBehavior=function(){};
AdamActivityContainerBehavior.prototype=new jCore.RegularContainerBehavior;AdamActivityContainerBehavior.prototype.type="AdamActivityContainerBehavior";
AdamActivityContainerBehavior.prototype.addToContainer=function(a,b,c,d,e){var g=0,h=0,f,k,p=!0===e?0:1;k="Canvas"===a.family?a:a.canvas;e=b.getZoomWidth();f=b.getZoomHeight();g=(g+(c-e/2*p))/a.zoomFactor;h=(h+(d-f/2*p))/a.zoomFactor;b.setParent(a);a.getChildren().insert(b);this.addShape(a,b,g,h);b.fixZIndex(b,0);k.addToList(b);"AdamEvent"===b.getType()&&"BOUNDARY"===b.evn_type&&(b.setAttachedTo(a.act_uid),a.boundaryArray.insert(b),a.boundaryPlaces.isEmpty()&&a.makeBoundaryPlaces(b),b.attachToActivity())};
var AdamActivityResizeBehavior=function(){};AdamActivityResizeBehavior.prototype=new jCore.RegularResizeBehavior;AdamActivityResizeBehavior.prototype.type="AdamActivityResizeBehavior";
AdamActivityResizeBehavior.prototype.onResizeStart=function(a){return function(b,c){var d=a.canvas.getZoomFactor();$(this).resizable("option","minHeight",a.getMinHeight()*d);$(this).resizable("option","minWidth",a.getMinWidth()*d);$(this).resizable("option","maxHeight",a.getMaxHeight()*d);$(this).resizable("option","maxWidth",a.getMaxWidth()*d);a.canvas.hideAllFocusedLabels();jCore.RegularResizeBehavior.prototype.onResizeStart.call(this,a)}};
AdamActivityResizeBehavior.prototype.onResize=function(a){return function(b,c){var d;d=a.canvas;a.setPosition(c.position.left/d.zoomFactor,c.position.top/d.zoomFactor);a.setDimension(c.size.width/d.zoomFactor,c.size.height/d.zoomFactor);a.fixConnectionsOnResize(a.resizing,!0);a.updateLabelsPosition(!0,!0);for(d=0;d<a.markersArray.getSize();d+=1)a.markersArray.get(d).paint()}};
AdamActivityResizeBehavior.prototype.onResizeEnd=function(a){return function(b,c){var d,e,g,h=a.canvas;jCore.RegularResizeBehavior.prototype.onResizeEnd.call(this,a)(b,c);d=0;for(e=a.getPorts().getSize();d<e;d+=1)g=a.getPorts().get(d),h.triggerPortChangeEvent(g)}};
AdamActivityResizeBehavior.prototype.updateResizeMinimums=function(a){var b,c;b=a.getChildren();a=$(a.getHTML());var d,e=new jCore.ArrayList;for(c=0;c<b.getSize();c+=1)d=b.get(c),"AdamEvent"===d.type&&"BOUNDARY"===d.evn_type||e.insert(d);c=e.getDimensionLimit();b=c[1]+15;c=c[2]+15;a.resizable("option","minWidth",b);a.resizable("option","minHeight",c)};
var callbackCS,AdamProject=function(){this.canvas=this.description=this.name=this.uid=null;this.url="/rest/v10/Project/";this.restClient=null;this.isWaitingResponse=this.isDirty=this.loaded=!1;this.saveInterval=3E4;this.showWarning=!1;this.dirtyElements=[{activities:{},gateways:{},events:{},artifacts:{},flows:{}},{activities:{},gateways:{},events:{},artifacts:{},flows:{}}];this.propertiesGrid=null;this.process_definition={}};AdamProject.prototype.type="AdamProject";AdamProject.prototype.getUid=function(){return this.uid};
AdamProject.prototype.setUid=function(a){this.uid=a};AdamProject.prototype.setName=function(a){var b,c;this.name=a;b=$("#ProjectTitle");c=$("#txt-title");b.html(a);c.html(a)};AdamProject.prototype.setDescription=function(a){this.description=a;return this};AdamProject.prototype.setCanvas=function(a){a instanceof AdamCanvas?(this.canvas=a,this.canvas.setProject(this),$(this.canvas.html).on("selectelement",this.onSelectElementHandler(this.canvas))):this.canvas=null;return this};
AdamProject.prototype.setRestClient=function(a){a instanceof RestClient&&(this.restClient=a);return this};AdamProject.prototype.setRestURL=function(a){this.url=a;return this};AdamProject.prototype.setSaveInterval=function(a){this.saveInterval=a;return this};
AdamProject.prototype.load=function(a,b){var c=!1,d=this,e,g={};"undefined"!==typeof a&&(this.uid=a);e=App.api.buildURL("pmse_Project/project/"+this.uid,null,null);g={};App.api.call("read",e,g,{success:function(a){d.loadProject(a);c=!0;b&&b.success&&b.success.call(this,a)},error:function(a){}});return c};
AdamProject.prototype.init=function(){var a;a=this;this.loaded&&(window.onbeforeunload=function(){if(a.isDirty&&!a.showWarning)return!0},setInterval(function(){a.save()},this.saveInterval),this.propertiesGrid=new PropertiesGrid("#properties-grid"),this.canvas.commandStack.setHandler(AdamProject.prototype.updateUndoRedo))};
AdamProject.prototype.save=function(){var a=this,b,c={};this.isDirty&&!this.isWaitingResponse&&(this.isWaitingResponse=!0,b=App.api.buildURL("pmse_Project/project/"+this.uid,null,null),c={data:this.getDirtyObject(),id:this.uid,operation:"update",wrapper:"Project"},App.api.call("update",b,c,{success:function(b){console.log(b);a.isWaitingResponse=!1;b.success?a.updateDirtyProject():a.mergeDirtyElements()},error:function(b){a.isWaitingResponse=!1;a.mergeDirtyElements();a.isDirty=!1}}))};
AdamProject.prototype.loadProject=function(a){var b;if(a.project){b=a.project.diagram[0];console.log(b);this.setName(a.project.prj_name);this.setDescription(a.project.prj_description);this.process_definition.pro_module=a.project.process_definition.pro_module;this.process_definition.pro_status=a.project.process_definition.pro_status;this.process_definition.pro_locked_variables=a.project.process_definition.pro_locked_variables;this.process_definition.pro_terminate_variables=a.project.process_definition.pro_terminate_variables;
this.canvas.setDiaUid(b.dia_uid);for(a=0;a<b.activities.length;a+=1)this.loadShape(b.activities[a],"AdamActivity");for(a=0;a<b.events.length;a+=1)this.loadShape(b.events[a],"AdamEvent");for(a=0;a<b.gateways.length;a+=1)this.loadShape(b.gateways[a],"AdamGateway");for(a=0;a<b.artifacts.length;a+=1)this.loadShape(b.artifacts[a],"AdamArtifact");for(a=0;a<b.flows.length;a+=1)this.loadFlow(b.flows[a]);this.loaded=!0}else this.loaded=!1};
AdamProject.prototype.addElement=function(a){var b,c,d,e;if(0<a.relatedElements.length)for(d=0;d<a.relatedElements.length;d+=1)e=a.relatedElements[d],c=this.getUpdateList(e.type),b=e.getDBObject(),b.action="CREATE",c[e.id]=b;else b=this.formatProperty(a.type,"uid"),c=this.getUpdateList(a.type),a.relatedObject[b]=a.id,b=a.relatedObject.getDBObject(),b.action="CREATE",c[a.id]=b;this.isDirty=!0;this.updateToolbar()};
AdamProject.prototype.removeElement=function(a){var b,c,d,e,g,h={};for(d=0;d<a.length;d+=1)c=a[d],e=this.formatProperty(c.type,"uid"),g=this.getUpdateList(c.type),g[c.id]?"CREATE"===g[c.id].action?delete g[c.id]:g[c.id].action="REMOVE":(b={action:"REMOVE"},b[e]=c.id,g[c.id]=b);this.isDirty=!0;!this.isWaitingResponse&&(a=(a=(a=(a=(a=this.dirtyElements[0].activities===h)&&this.dirtyElements[0].gateways===h)&&this.dirtyElements[0].events===h)&&this.dirtyElements[0].artifacts===h)&&this.dirtyElements[0].flows===
h)&&(this.isDirty=!1);this.updateToolbar()};AdamProject.prototype.updateElement=function(a){var b,c,d,e;for(c=0;c<a.length;c+=1)b=a[c],d=this.formatObject(b),e=this.getUpdateList(b.type),e[b.id]?($.extend(!0,e[b.id],d),"Connection"===b.type&&(e[b.id].flo_state=d.flo_state)):(d.action="UPDATE",e[b.id]=d);this.isDirty=!0;this.updateToolbar()};AdamProject.prototype.getDirtyObject=function(){var a;a=this.dirtyElements[0];a.prj_uid=this.getUid();return a};AdamProject.prototype.mergeDirtyElements=function(){this.updateToolbar()};
AdamProject.prototype.updateDirtyProject=function(){this.isDirty=!1;this.dirtyElements[0]=this.dirtyElements[1];this.dirtyElements[1]={activities:{},events:{},gateways:{},flows:{},artifacts:{}};this.updateToolbar()};
AdamProject.prototype.formatObject=function(a){var b,c,d={},e;d[this.formatProperty(a.type,"uid")]=a.id;if(a.adam)for(b=0;b<a.fields.length;b+=1)c=a.fields[b],d[c.field]=c.newVal;else for(b=0;b<a.fields.length;b+=1)c=a.fields[b],e=this.formatProperty(a.type,c.field),"element_uid"===e&&(c.newVal=c.newVal.id),d[e]=c.newVal;return d};
AdamProject.prototype.getUpdateList=function(a){return this.dirtyElements[this.isWaitingResponse?1:0][{AdamActivity:"activities",AdamGateway:"gateways",AdamEvent:"events",AdamFlow:"flows",AdamArtifact:"artifacts",Connection:"flows"}[a]]};AdamProject.prototype.formatProperty=function(a,b){var c={AdamActivity:"act",AdamGateway:"gat",AdamEvent:"evn",AdamArtifact:"art"},d={x:"bou_x",y:"bou_y",width:"bou_width",height:"bou_height"};return"AdamFlow"===a||"Connection"===a?"flo_"+b:d[b]?d[b]:c[a]+"_"+b};
AdamProject.prototype.loadShape=function(a,b){var c,d,e,g,h,f=!0;switch(b){case "AdamEvent":g=a.evn_uid;c=a.evn_type.toLowerCase();"boundary"===c&&(c="intermediate");d=a.evn_behavior.toLowerCase();h=(e=a.evn_message)||a.evn_marker;h=h.toLowerCase();c=new AdamEvent({id:g,canvas:this.canvas,width:33,height:33,style:{cssClasses:[""]},labels:[{message:a.evn_name||"",position:{location:"bottom",diffX:0,diffY:0}}],layers:[{layerName:"first-layer",priority:2,visible:!0,style:{cssClasses:[]},zoomSprites:["adam-shape-50-event-"+
c,"adam-shape-75-event-"+c,"adam-shape-100-event-"+c,"adam-shape-125-event-"+c,"adam-shape-150-event-"+c]},{layerName:"second-layer",priority:3,visible:!0,style:{cssClasses:[]},zoomSprites:["adam-marker-50-"+c+"-"+d+"-"+h,"adam-marker-75-"+c+"-"+d+"-"+h,"adam-marker-100-"+c+"-"+d+"-"+h,"adam-marker-125-"+c+"-"+d+"-"+h,"adam-marker-150-"+c+"-"+d+"-"+h]}],drag:"customshapedrag",resizeHandlers:{type:"Rectangle",total:4,resizableStyle:{cssProperties:{"background-color":"rgb(0, 255, 0)",border:"1px solid black"}},
nonResizableStyle:{cssProperties:{"background-color":"white",border:"1px solid black"}}},drop:{type:"connection"},evn_name:a.evn_name,evn_type:a.evn_type.toLowerCase(),evn_marker:a.evn_marker,evn_behavior:d,evn_message:e,evn_uid:g});"BOUNDARY"===a.evn_type&&(f=!1,g=this.canvas.getCustomShapes().find("id",a.evn_attached_to))&&(g.activityContainerBehavior.addToContainer(g,c,parseInt(a.bou_x,10),parseInt(a.bou_y,10),!0),c.attachListeners());break;case "AdamActivity":g=a.act_uid;h=a.act_task_type;c=a.act_type;
c="USERTASK"===a.act_task_type?new AdamActivity({id:g,act_uid:g,canvas:this.canvas,width:parseInt(a.bou_width,10),height:parseInt(a.bou_height,10),container:"activity",style:{cssClasses:[""]},layers:[{x:-2,y:-2,layerName:"first-layer",priority:2,visible:!0,style:{cssClasses:["adam-activity-task"]}}],connectAtMiddlePoints:!0,drag:"customshapedrag",resizeBehavior:"activityResize",resizeHandlers:{type:"Rectangle",total:8,resizableStyle:{cssProperties:{"background-color":"rgb(0, 255, 0)",border:"1px solid black"}},
nonResizableStyle:{cssProperties:{"background-color":"white",border:"1px solid black"}}},drop:{type:"connection"},labels:[{message:a.act_name||"",width:0,height:0,orientation:"horizontal",position:{location:"center",diffX:0,diffY:0},updateParent:!0,updateParentOnLoad:!1}],markers:[{markerType:h,x:5,y:5,markerZoomClasses:["adam-marker-50-"+h.toLowerCase(),"adam-marker-75-"+h.toLowerCase(),"adam-marker-100-"+h.toLowerCase(),"adam-marker-125-"+h.toLowerCase(),"adam-marker-150-"+h.toLowerCase()]}],act_type:c,
act_task_type:h,act_name:a.act_name,act_script:a.act_script,act_script_type:a.act_script_type,act_default_flow:a.act_default_flow?a.gat_default_flow:0,minHeight:50,minWidth:100,maxHeight:300,maxWidth:400}):new AdamActivity({id:g,act_uid:g,canvas:this.canvas,width:parseInt(a.bou_width,10),height:parseInt(a.bou_height,10),container:"activity",style:{cssClasses:[""]},layers:[{x:-2,y:-2,layerName:"first-layer",priority:2,visible:!0,style:{cssClasses:["adam-activity-task"]}},{x:-2,y:-2,layerName:"second-layer",
priority:3,visible:!0,style:{cssClasses:[]},zoomSprites:["adam-shape-50-activity-scripttask-"+a.act_script_type.toLowerCase(),"adam-shape-75-activity-scripttask-"+a.act_script_type.toLowerCase(),"adam-shape-100-activity-scripttask-"+a.act_script_type.toLowerCase(),"adam-shape-125-activity-scripttask-"+a.act_script_type.toLowerCase(),"adam-shape-150-activity-scripttask-"+a.act_script_type.toLowerCase()]}],connectAtMiddlePoints:!0,drag:"customshapedrag",labels:[{message:a.act_name||"",position:{location:"bottom",
diffX:0,diffY:4},updateParent:!1}],resizeHandlers:{type:"Rectangle",total:4,resizableStyle:{cssProperties:{"background-color":"rgb(0, 255, 0)",border:"1px solid black"}},nonResizableStyle:{cssProperties:{"background-color":"white",border:"1px solid black"}}},drop:{type:"connection"},act_type:c,act_task_type:h,act_name:a.act_name,act_script:a.act_script,act_script_type:a.act_script_type});break;case "AdamGateway":g=a.gat_uid;c=a.gat_type.toLowerCase();d=a.gat_direction.toLowerCase();c=new AdamGateway({id:g,
gat_uid:g,canvas:this.canvas,width:45,height:45,gat_type:c,gat_direction:d,gat_name:a.gat_name,style:{cssClasses:[""]},labels:[{message:a.gat_name||"",position:{location:"bottom",diffX:0,diffY:0}}],layers:[{layerName:"first-layer",priority:2,visible:!0,style:{cssClasses:[]},zoomSprites:["adam-shape-50-gateway-"+c,"adam-shape-75-gateway-"+c,"adam-shape-100-gateway-"+c,"adam-shape-125-gateway-"+c,"adam-shape-150-gateway-"+c]}],connectAtMiddlePoints:!0,drag:"regular",resizeBehavior:"no",resizeHandlers:{type:"Rectangle",
total:4,resizableStyle:{cssProperties:{"background-color":"rgb(0, 255, 0)",border:"1px solid black"}},nonResizableStyle:{cssProperties:{"background-color":"white",border:"1px solid black"}}},drop:{type:"connection"},gat_default_flow:a.gat_default_flow?a.gat_default_flow:0});break;case "AdamArtifact":g=a.art_uid,c=a.art_type,c=new AdamArtifact({id:g,art_uid:g,canvas:this.canvas,width:parseInt(a.bou_width,10),height:parseInt(a.bou_height,10),style:{cssClasses:[]},layers:[{layerName:"first-layer",priority:2,
visible:!0}],connectAtMiddlePoints:!0,drag:"regular",resizeBehavior:"adamArtifactResize",resizeHandlers:{type:"Rectangle",total:8,resizableStyle:{cssProperties:{"background-color":"rgb(0, 255, 0)",border:"1px solid black"}},nonResizableStyle:{cssProperties:{"background-color":"white",border:"1px solid black"}}},labels:[{message:a.at_name||"",width:0,height:0,position:{location:"center-right",diffX:0,diffY:0},updateParent:!0}],drop:{type:"connection"},art_type:c,art_name:a.art_name})}f&&(this.canvas.addElement(c,
parseInt(a.bou_x,10),parseInt(a.bou_y,10),!0),c.attachListeners(),this.canvas.updatedElement=c)};
AdamProject.prototype.loadFlow=function(a){var b,c,d,e,g,h;b=this.getElementByUid(a.flo_element_origin);c=this.getElementByUid(a.flo_element_dest);d=new jCore.Point(a.flo_x1,a.flo_y1);e=new jCore.Point(a.flo_x2,a.flo_y2);g=new jCore.Port({width:10,height:10});h=new jCore.Port({width:10,height:10});b.addPort(g,d.x-b.absoluteX,d.y-b.absoluteY);c.addPort(h,e.x-c.absoluteX,e.y-c.absoluteY,!1,g);b=new AdamFlow({id:a.flo_uid,srcPort:g,destPort:h,canvas:this.canvas,segmentStyle:{SEQUENCE:"regular",MESSAGE:"segmented",
DATAASSOCIATION:"dotted",ASSOCIATION:"dotted",DEFAULT:"regular",CONDITIONAL:"regular"}[a.flo_type],flo_type:a.flo_type,name:a.flo_name,flo_condition:a.flo_condition,flo_state:a.flo_state});b.setSrcDecorator(new jCore.ConnectionDecorator({decoratorPrefix:{SEQUENCE:"adam-decorator",MESSAGE:"adam-decorator_message",DATAASSOCIATION:"adam-decorator",ASSOCIATION:"adam-decorator_",DEFAULT:"adam-decorator_default",CONDITIONAL:"adam-decorator_conditional"}[a.flo_type],decoratorType:"source",style:{cssClasses:[]},
width:11,height:11,canvas:this.canvas,parent:b}));b.setDestDecorator(new jCore.ConnectionDecorator({decoratorPrefix:{SEQUENCE:"adam-decorator",MESSAGE:"adam-decorator_message",DATAASSOCIATION:"adam-decorator_association",ASSOCIATION:"adam-decorator_association",DEFAULT:"adam-decorator",CONDITIONAL:"adam-decorator"}[a.flo_type],decoratorType:"target",style:{cssClasses:[]},width:11,height:11,canvas:this.canvas,parent:b}));b.setSegmentMoveHandlers();this.canvas.addConnection(b);b.setTargetShape(h.parent);
b.setOriginShape(g.parent);b.savePoints();b.checkAndCreateIntersectionsWithAll();g.attachListeners(g);h.attachListeners(h)};AdamProject.prototype.getElementByUid=function(a){var b,c,d;b=this.canvas.getCustomShapes().find("id",a);if(!b)for(c=this.canvas.getCustomShapes(),d=0;d<c.getSize()&&!("AdamActivity"===c.get(d).getType()&&(b=c.get(d),b=b.getChildren().find("id",a)));d+=1);return b};
AdamProject.prototype.updateToolbar=function(){var a,b,c;a=$("#ProjectTitle");b=$("#txt-title");c=$("#ButtonSave > i");c.removeClass();this.isDirty?c.addClass("adam-icon-save-on"):c.addClass("adam-icon-save-off");a.html(this.name);b.html(this.name)};
AdamProject.prototype.updateUndoRedo=function(){var a,b,c,d;c=$("#ButtonUndo > i");d=$("#ButtonRedo > i");a=0<this.canvas.commandStack.getUndoSize();b=0<this.canvas.commandStack.getRedoSize();c.removeClass();c.addClass(a?"adam-icon-undo-on":"adam-icon-undo-off");d.removeClass();d.addClass(b?"adam-icon-redo-on":"adam-icon-redo-off")};AdamProject.prototype.onCanvasClick=function(){};
AdamProject.prototype.updatePropertiesGrid=function(a){if(a){var b;a.getID();var c=[{name:"uid",label:translate("LBL_PMSE_PROPERTY_GRID_UID"),value:a.getID(),type:"text",readOnly:!0},{name:"name",label:translate("LBL_PMSE_PROPERTY_GRID_NAME"),value:a.getName(),type:"text",readOnly:"Connection"===a.type?!1:!0}];"AdamEvent"===a.type&&"BOUNDARY"===a.evn_type||"Connection"===a.type||(c.push({name:"x",label:translate("LBL_PMSE_PROPERTY_GRID_X"),value:a.getX(),type:"text",validate:"integer",readOnly:!0}),
c.push({name:"y",label:translate("LBL_PMSE_PROPERTY_GRID_Y"),value:a.getY(),type:"text",validate:"integer",readOnly:!0}));"AdamEvent"!==a.type&&"AdamGateway"!==a.type&&"Connection"!==a.type&&(c.push({name:"width",label:translate("LBL_PMSE_PROPERTY_GRID_WIDTH"),type:"text",validate:"integer",value:a.getWidth(),readOnly:!0}),c.push({name:"height",label:translate("LBL_PMSE_PROPERTY_GRID_HEIGHT"),type:"text",validate:"integer",value:a.getHeight(),readOnly:!0}));switch(a.type){case "AdamActivity":c.push({name:"act_cancel_remaining_instances",
label:translate("LBL_PMSE_PROPERTY_GRID_CANCEL_REMAINING_INSTANCES"),type:"yesNo",value:a.getCancelRemainingInstances(),readOnly:!0});c.push({name:"act_is_for_compensation",label:translate("LBL_PMSE_PROPERTY_GRID_COMPENSATION"),type:"yesNo",yesNoValueMode:"int",value:a.getIsForCompensation(),readOnly:!0});c.push({name:"act_completion_quantity",label:translate("LBL_PMSE_PROPERTY_GRID_COMPLETION_QUANTITY"),value:a.getCompletionQuantity(),type:"text",validate:"integer",readOnly:!0});c.push({name:"act_is_global",
label:translate("LBL_PMSE_PROPERTY_GRID_GLOBAL"),type:"yesNo",value:a.getIsGlobal(),readOnly:!0});c.push({name:"act_referer",label:translate("LBL_PMSE_PROPERTY_GRID_REFERER"),value:a.act_referer,type:"text",readOnly:!0});c.push({name:"act_start_quantity",label:translate("LBL_PMSE_PROPERTY_GRID_START_QUANTITY"),value:a.getStartQuantity(),type:"text",validate:"integer"});c.push({name:"type",label:translate("LBL_PMSE_PROPERTY_GRID_TYPE"),value:a.getActivityType(),type:"text",readOnly:!0});c.push({name:"act_task_type",
label:translate("LBL_PMSE_PROPERTY_GRID_TASK_TYPE"),options:[{label:translate("LBL_PMSE_PROPERTY_GRID_USER_TASK"),value:"USERTASK",selected:a.act_task_type},{label:translate("LBL_PMSE_PROPERTY_GRID_SCRIPT_TASK"),value:"SCRIPTTASK",selected:a.act_task_type}],type:"select",readOnly:!0});"SCRIPTTASK"===a.act_task_type&&(c.push({name:"act_script",label:translate("LBL_PMSE_PROPERTY_GRID_SCRIPT"),type:"text",value:a.getScript(),readOnly:!0}),c.push({name:"act_script_type",label:translate("LBL_PMSE_PROPERTY_GRID_SCRIPT_TYPE"),
type:"text",value:a.getScriptType(),readOnly:!0}));"none"!==a.act_loop_type.toLowerCase()&&(c.push({name:"act_loop_behavior",label:translate("LBL_PMSE_PROPERTY_GRID_LOOP_BEHAVIOR"),type:"text",value:a.act_loop_behavior,readOnly:!0}),c.push({name:"act_loop_cardinality",label:translate("LBL_PMSE_PROPERTY_GRID_LOOP_CARDINALITY"),type:"text",validate:"integer",value:a.act_loop_cardinality,readOnly:!0}),c.push({name:"act_loop_maximum",label:translate("LBL_PMSE_PROPERTY_GRID_LOOP_MAXIMUM"),type:"text",
validate:"integer",value:a.act_loop_maximum,readOnly:!0}),a=a.act_loop_type.toUpperCase(),c.push({name:"act_loop_type",label:translate("LBL_PMSE_PROPERTY_GRID_LOOP_TYPE"),type:"select",options:[{label:translate("LBL_PMSE_PROPERTY_GRID_NONE"),value:"NONE",selected:a},{label:translate("LBL_PMSE_PROPERTY_GRID_STANDARD"),value:"STANDARD",selected:a},{label:translate("LBL_PMSE_PROPERTY_GRID_MULTI_INSTANCE_PARALLEL"),value:"PARALLEL",selected:a},{label:translate("LBL_PMSE_PROPERTY_GRID_MULTI_INSTANCE_SEQUENCIAL"),
value:"SEQUENCIAL",selected:a}],readOnly:!0}));break;case "AdamGateway":"EVENTBASED"===a.gat_type?(!0,b=[{label:translate("LBL_PMSE_PROPERTY_GRID_UNSPECIFIED"),value:"UNSPECIFIED",selected:a.gat_direction}]):(!0,b=[{label:translate("LBL_PMSE_PROPERTY_GRID_CONVERGING"),value:"CONVERGING",selected:a.gat_direction},{label:translate("LBL_PMSE_PROPERTY_GRID_DIVERGING"),value:"DIVERGING",selected:a.gat_direction}]);c.push({name:"gat_direction",label:translate("LBL_PMSE_PROPERTY_GRID_DIRECTION"),type:"select",
readOnly:!0,options:b});c.push({name:"type",label:translate("LBL_PMSE_PROPERTY_GRID_TYPE"),type:"text",value:a.gat_type,readOnly:!0});break;case "AdamEvent":"INTERMEDIATE"!==a.evn_type&&"BOUNDARY"!==a.evn_type||c.push({name:"action",label:translate("LBL_PMSE_PROPERTY_GRID_ACTION"),type:"select",options:[{label:translate("LBL_PMSE_PROPERTY_GRID_SEND_MESSAGE"),value:"MESSAGE-THROW",selected:a.evn_marker+"-"+a.evn_behavior},{label:translate("LBL_PMSE_PROPERTY_GRID_RECEIVE_MESSAGE"),value:"MESSAGE-CATCH",
selected:a.evn_marker+"-"+a.evn_behavior},{label:translate("LBL_PMSE_PROPERTY_GRID_TIMER"),value:"TIMER-CATCH",selected:a.evn_marker+"-CATCH"}],readOnly:!0});"START"!==a.evn_type&&"BOUNDARY"!==a.evn_type||c.push({name:"evn_is_interrupting",label:translate("LBL_PMSE_PROPERTY_GRID_INTERUPTING"),value:a.evn_is_interrupting,type:"yesNo",readOnly:!0});"START"!==a.evn_type&&"MESSAGE"===a.evn_marker&&(c.push({name:"evn_message",label:translate("LBL_PMSE_PROPERTY_GRID_MESSAGE"),type:"text",value:a.evn_message,
readOnly:!0}),c.push({name:"evn_operation_implementation_ref",label:translate("LBL_PMSE_PROPERTY_GRID_OPERATION_IMPLEMENTATION_REF"),type:"text",value:a.evn_operation_implementation_ref,readOnly:!0}),c.push({name:"evn_operation_name",label:translate("LBL_PMSE_PROPERTY_GRID_OPERATION_NAME"),type:"text",value:a.evn_operation_name,readOnly:!0}));switch(a.evn_type){case "START":c.push({name:"listen",label:translate("LBL_PMSE_PROPERTY_GRID_LISTEN"),type:"select",options:[{label:translate("LBL_PMSE_PROPERTY_GRID_LEAD"),
value:"Leads",selected:a.evn_message},{label:translate("LBL_PMSE_PROPERTY_GRID_DOCUMENT"),value:"Documents",selected:a.evn_message},{label:translate("LBL_PMSE_PROPERTY_GRID_OPPORTUNITY"),value:"Opportunities",selected:a.evn_message},{label:translate("LBL_PMSE_PROPERTY_GRID_OTHER_MODULE"),value:"",selected:a.evn_message}],readOnly:!0});break;case "INTERMEDIATE":"TIMER"===a.evn_marker&&(c.push({name:"evn_time_cycle",label:translate("LBL_PMSE_PROPERTY_GRID_TIME_CYCLE"),type:"text",value:a.evn_time_cycle,
readOnly:!0}),c.push({name:"evn_time_date",label:translate("LBL_PMSE_PROPERTY_GRID_TIME_DATE"),type:"text",value:a.evn_time_date,readOnly:!0}),c.push({name:"evn_time_duration",label:translate("LBL_PMSE_PROPERTY_GRID_TIME_DURATION"),type:"text",value:a.evn_time_duration,readOnly:!0}));break;case "END":c.push({name:"result",label:translate("LBL_PMSE_PROPERTY_GRID_RESULT"),type:"select",options:[{label:translate("LBL_PMSE_PROPERTY_GRID_EMPTY"),value:"EMPTY",selected:a.evn_marker},{label:translate("LBL_PMSE_PROPERTY_GRID_MESSAGE"),
value:"MESSAGE",selected:a.evn_marker},{label:translate("LBL_PMSE_PROPERTY_GRID_TERMINATE"),value:"TERMINATE",selected:a.evn_marker}],readOnly:!0})}c.push({name:"type",label:translate("LBL_PMSE_PROPERTY_GRID_TYPE"),value:a.evn_type,type:"text",readOnly:!0});break;case "Connection":c.push({name:"flo_type",label:translate("LBL_PMSE_PROPERTY_GRID_TYPE"),type:"text",value:a.flo_type,readOnly:!0})}}else this.propertiesGrid.clear()};
AdamProject.prototype.onSelectElementHandler=function(a){return function(){if(1===a.getCurrentSelection().getSize()||"Connection"===a.updatedElement[0].relatedObject.type)"Connection"!==a.updatedElement[0].relatedObject.type?(a.project.updatePropertiesGrid(a.getCurrentSelection().get(0)),setSelectedNode(a.getCurrentSelection().get(0))):a.project.updatePropertiesGrid(a.updatedElement[0].relatedObject)}};
var AdamCanvas=function(a){jCore.Canvas.call(this,a);this.dia_id=null;this.projectUid="";this.currentMenu=this.project=null;this.isClicked=!1;AdamCanvas.prototype.initObject.call(this,a)};AdamCanvas.prototype=new jCore.Canvas;AdamCanvas.prototype.type="AdamCanvas";AdamCanvas.prototype.getProjectUid=function(){return this.projectUid};AdamCanvas.prototype.getType=function(){return this.type};AdamCanvas.prototype.setDiaUid=function(a){this.dia_id=a;return this};
AdamCanvas.prototype.setProjectUid=function(a){this.projectUid=a;return this};AdamCanvas.prototype.setProject=function(a){this.project=a;return this};AdamCanvas.prototype.setCurrentMenu=function(a){this.currentMenu&&this.currentMenu.hide();this.currentMenu=a;return this};AdamCanvas.prototype.initObject=function(a){var b={projectUid:null};$.extend(!0,b,a);this.setProjectUid(b.projectUid).setDiaUid(b.dia_id)};
AdamCanvas.prototype.getContextMenu=function(){var a,b,c,d,e,g,h,f,k,p,t,q,m,l,n,y,r,w,z,A,u,v,x,B,C;c=new HiddenField({name:"pro_module"});g=new TextField({name:"prj_name",label:"Name",required:!0});h=new TextareaField({name:"prj_description",label:"Description"});d=new ItemMatrixField({jtype:"itemmatrix",label:"Locked Fields",name:"pro_locked_variables",submit:!0,fieldWidth:350,fieldHeight:90,visualStyle:"table",nColumns:2});k=new CriteriaField({name:"pro_terminate_variables",label:translate("LBL_PMSE_LABEL_TERMINATE_CASES"),
required:!1,fieldWidth:250,fieldHeight:80,panels:{businessRulesEvaluation:{enabled:!1},formResponseEvaluation:{enabled:!1},math:{enabled:!1},fixedDateEvaluation:{enabled:!1},sugarDateEvaluation:{enabled:!1},unitTimeEvaluation:{enabled:!1},userEvaluation:{enabled:!1}},decimalSeparator:PMSE_DECIMAL_SEPARATOR});e=function(a,e){App.alert.show("upload",{level:"process",title:"LBL_LOADING",autoclose:!1});(new SugarProxy({url:"pmse_Project/CrmData/fields/"+a,uid:"",callback:null})).getData(null,{success:function(g){c.setValue(a);
void 0!==e?d.setList(g.result,PROJECT_LOCKED_VARIABLES):d.setList(g.result);App.alert.dismiss("upload");b.html.style.display="inline"}})};f=new ComboboxField({jtype:"combobox",label:translate("LBL_PMSE_LABEL_MODULE"),name:"comboModules",submit:!1,change:function(){return e(this.value)},proxy:new SugarProxy({url:"pmse_Project/CrmData/modules",uid:"",callback:null})});p=new SugarProxy({url:"pmse_Project/CrmData/project/"+adamUID,uid:adamUID,callback:null});v=function(a){f.value!==w?(B=a.pro_locked_variables,
PROJECT_LOCKED_VARIABLES=d.getLockedField(),A.show()):(u={description:h.value,pro_terminate_variables:k.value,pro_locked_variables:a.pro_locked_variables},null!==g.value&&""!==g.value&&(u={name:g.value,description:h.value,pro_locked_variables:a.pro_locked_variables,pro_terminate_variables:k.value},project.setName(PROJECT_NAME=g.value)),project.process_definition.pro_terminate_variables=k.value,project.setDescription(PROJECT_DESCRIPTION=h.value),p.sendData(u),PROJECT_LOCKED_VARIABLES=d.getLockedField(),
project.process_definition.pro_locked_variables=d.getLockedField(),b.close())};z=new SugarProxy({url:"pmse_Project/CrmData/putData/"+adamUID,uid:adamUID,callback:null});new HiddenField({name:"pro_new_module"});new HiddenField({name:"pro_old_module"});new LabelField({name:"lblAlert",label:translate("LBL_PMSE_FORM_LABEL_THE_WARNING"),options:{marginLeft:35}});A=new MessagePanel({title:"Module change warning",wtype:"Confirm",message:translate("LBL_PMSE_MESSAGE_REMOVEALLSTARTCRITERIA"),buttons:[{jtype:"normal",
caption:translate("LBL_PMSE_BUTTON_OK"),handler:function(){u={prj_name:g.value,prj_description:h.value,pro_locked_variables:B,pro_module:f.value};project.setDescription(PROJECT_DESCRIPTION=h.value);project.setName(PROJECT_NAME=g.value);p.sendData(u);PROJECT_MODULE=f.value;project.canvas.cleanAllFlowConditions();u={pro_new_module:PROJECT_MODULE,pro_old_module:w};z.sendData(u,{success:function(a){console.log(a);a.success?b.close():(errorModule=new MessagePanel({title:"Error",wtype:"Error",message:translate("LBL_PMSE_ADAM_ENGINE_ERROR_UPDATEBPMFLOW")}),
errorModule.show())},failure:function(a,b){}});A.hide()}},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_CANCEL"),handler:function(){f.removeOptions();f.proxy.getData(null,{success:function(a){g.setValue(project.name);h.setValue(project.description);f.setOptions(a.result);f.setValue(w);k.setValue(project.process_definition.pro_terminate_variables);PROJECT_LOCKED_VARIABLES=project.process_definition.pro_locked_variables.slice();e(PROJECT_MODULE||a.result[0].value,!0);d.setLockedFields(PROJECT_LOCKED_VARIABLES);
w=PROJECT_MODULE;A.hide()}})}}]});a=new Form({items:[g,h,f,k,d,c],buttons:[{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_SAVE"),handler:function(){a.submit()}},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_CANCEL"),handler:function(){a.isDirty()?(x=new MessagePanel({title:"Confirm",wtype:"Confirm",message:translate("LBL_PMSE_MESSAGE_CANCELCONFIRM"),buttons:[{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_YES"),handler:function(){PROJECT_LOCKED_VARIABLES=project.process_definition.pro_locked_variables.slice();
x.close();b.close()}},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_NO"),handler:function(){x.close()}}]}),x.show()):b.close()}}],callback:{loaded:function(a){App.alert.show("upload",{level:"process",title:"LBL_LOADING",autoclose:!1});k.setBaseModule(PROJECT_MODULE);g.setValue(project.name);f.proxy.getData(null,{success:function(a){f.setOptions(a.result);f.setValue(PROJECT_MODULE||a.result[0].value);g.setValue(project.name);h.setValue(project.description);k.setValue(project.process_definition.pro_terminate_variables);
PROJECT_LOCKED_VARIABLES=project.process_definition.pro_locked_variables.slice();e(PROJECT_MODULE||a.result[0].value,!0);d.setLockedFields(PROJECT_LOCKED_VARIABLES);w=f.value}})},submit:function(a){console.log("submit");console.log(project.restClient);console.log(g.value+"!=="+project.name);g.value!==project.name?(C=App.api.buildURL("pmse_Project",null,null,{filter:[{name:g.value}]}),App.api.call("read",C,null,{success:function(b){console.log(b);0===b.records.length?v(a):(new MessagePanel({title:"Error",
wtype:"Error",message:translate("LBL_PMSE_MESSAGE_THEPROCESSNAMEALREADYEXISTS",g.value)})).show()}})):v(a)}},proxy:null,language:PMSE_DESIGNER_FORM_TRANSLATIONS});b=new Window({width:580,height:450,modal:!0,title:translate("LBL_PMSE_CONTEXT_MENU_PROCESS_DEFINITION")});b.addPanel(a);t=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_SAVE"),cssStyle:"adam-menu-icon-save",handler:function(){project.save();jCore.getActiveCanvas().RemoveCurrentMenu()},disabled:!project.isDirty});q=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_REFRESH"),
cssStyle:"adam-menu-icon-refresh",handler:function(){document.location.reload(!0)}});m=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_50"),cssStyle:"",handler:function(){jCore.getActiveCanvas().applyZoom(1);$("#zoom").val(1)},disabled:.5===jCore.getActiveCanvas().getZoomFactor()});l=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_75"),cssStyle:"",handler:function(){jCore.getActiveCanvas().applyZoom(2);$("#zoom").val(2)},disabled:.75===jCore.getActiveCanvas().getZoomFactor()});n=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_100"),
cssStyle:"",handler:function(){jCore.getActiveCanvas().applyZoom(3);$("#zoom").val(3)},disabled:1===jCore.getActiveCanvas().getZoomFactor()});y=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_125"),cssStyle:"",handler:function(){jCore.getActiveCanvas().applyZoom(4);$("#zoom").val(4)},disabled:1.25===jCore.getActiveCanvas().getZoomFactor()});r=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_150"),cssStyle:"",handler:function(){jCore.getActiveCanvas().applyZoom(5);$("#zoom").val(5)},disabled:1.5===
jCore.getActiveCanvas().getZoomFactor()});return{items:[new Action({text:translate("LBL_PMSE_CONTEXT_MENU_PROCESS_DEFINITION"),cssStyle:"adam-menu-icon-configure",handler:function(){b.show();b.html.style.display="none"}}),{jtype:"separator"},t,q,{label:translate("LBL_PMSE_CONTEXT_MENU_ZOOM"),icon:"adam-menu-icon-zoom",menu:{items:[m,l,n,y,r]}}]}};AdamCanvas.prototype.onRightClickHandler=function(a,b,c){var d;d=a.getContextMenu();d.items?(d.canvas=this,d=new Menu(d),d.setParent(a),d.show(b,c)):this.RemoveCurrentMenu()};
AdamCanvas.prototype.dropBehaviorFactory=function(a,b){var c;"container"===a?(this.containerDropBehavior||(this.containerDropBehavior=new AdamContainerDropBehavior(b)),c=this.containerDropBehavior):c=jCore.BehavioralElement.prototype.dropBehaviorFactory.call(this,a,b);return c};AdamCanvas.prototype.onCreateElementHandler=function(a){this.RemoveCurrentMenu();this.project instanceof AdamProject&&(this.project.addElement(a),a=this.getDiagramTree(),Tree.treeReload("tree",a))};
AdamCanvas.prototype.onChangeElementHandler=function(a){if(this.project instanceof AdamProject){this.project.updateElement(a);var b=this.getDiagramTree();Tree.treeReload("tree",b);1===a.length&&this.project.updatePropertiesGrid("Connection"!==a[0].type?this.customShapes.find("id",a[0].id):this.connections.find("id",a[0].id))}};
AdamCanvas.prototype.onRemoveElementHandler=function(a){this.project instanceof AdamProject&&(this.project.removeElement(a),a=this.getDiagramTree(),Tree.treeReload("tree",a),this.project.updatePropertiesGrid())};AdamCanvas.prototype.triggerCommandAdam=function(a,b,c,d){var e=[],g;for(g=0;g<b.length;g+=1)e.push({field:b[g],newVal:d[g],oldVal:c[g]});this.updatedElement=[{fields:e,id:a.id,relatedObject:a,type:a.type,adam:!0}];$(this.html).trigger("changeelement")};
AdamCanvas.prototype.triggerFlowConditionChangeEvent=function(a,b){this.updatedElement=[{id:a.id,type:a.type,fields:[{field:"condition",oldVal:b.condition,newVal:a.getFlowCondition()},{field:"type",oldVal:b.type,newVal:a.getFlowType()}]}];$(this.html).trigger("changeelement")};
AdamCanvas.prototype.triggerTextChangeEvent=function(a,b,c){var d;d=c.trim();/<[^\s]/g.test(d)&&(d=d.replace(/</g,"< "));c=this.validateName(a,d);c.valid?(this.updatedElement=[{id:a.parent.id,type:a.parent.type,fields:[{field:"name",oldVal:b,newVal:d}]}],a.parent.setName(d),$(this.html).trigger("changeelement")):(a.parent.updateLabelsPosition(!0,!0),a.parent.setName(b),a=new MessagePanel({title:"Error",wtype:"Error",message:c.message}),a.show())};
AdamCanvas.prototype.triggerDefaultFlowChangeEvent=function(a){this.updatedElement=a;$(this.html).trigger("changeelement")};AdamCanvas.prototype.triggerConnectionConditionChangeEvent=function(a,b){this.updatedElement=[{id:a.id,type:a.type,relatedObject:a,fields:b}];$(this.html).trigger("changeelement")};
AdamCanvas.prototype.triggerPortChangeEvent=function(a){var b=a.connection.srcPort.getID()===a.getID()?"src":"dest",c={src:{x:"x1",y:"y1",parent:"element_origin",type:"element_origin_type"},dest:{x:"x2",y:"y2",parent:"element_dest",type:"element_dest_type"}},d,e,g=[],h;a.connection.savePoints();e=a.connection.getPoints();for(h=0;h<e.length;h+=1)d=a.connection.points[h],g.push(new jCore.Point(d.x/this.zoomFactor,d.y/this.zoomFactor));d="src"===b?g[0]:g[e.length-1];this.updatedElement=[{id:a.connection.getID(),
type:a.connection.type,fields:[{field:c[b].x,oldVal:d.x,newVal:d.x},{field:c[b].y,oldVal:d.y,newVal:d.y},{field:c[b].parent,oldVal:a.getOldParent()?a.getOldParent().getID():null,newVal:a.getParent().getID()},{field:c[b].type,oldVal:a.connection.getNativeType(a.getParent()).type,newVal:a.connection.getNativeType(a.getParent()).type},{field:"state",oldVal:a.connection.getOldPoints(),newVal:g},{field:"condition",oldVal:"",newVal:a.connection.getFlowCondition()}],relatedObject:a}];$(this.html).trigger("changeelement")};
AdamCanvas.prototype.RemoveCurrentMenu=function(){this.currentMenu&&this.currentMenu.hide()};AdamCanvas.prototype.onSelectElementHandler=function(a){this.hideAllFocusedLabels();this.project.onCanvasClick();this.RemoveCurrentMenu()};
AdamCanvas.prototype.onRightClick=function(a){return function(b,c,d){c&&(b=c.pageX-a.x+a.leftScroll,c=c.pageY-a.y+a.topScroll,a.updatedElement=d,a.hideAllFocusedLabels(),"Canvas"!==d.family&&(a.emptyCurrentSelection(),a.addToSelection(d)),a.onRightClickHandler(a.updatedElement,b,c))}};AdamCanvas.prototype.onClickHandler=function(a,b,c){this.RemoveCurrentMenu();this.project.onCanvasClick()};
AdamCanvas.prototype.getTreeItem=function(a){var b="",c="",d={};switch(a.getType()){case "AdamActivity":switch(a.getActivityType()){case "TASK":b="adam-tree-icon-user-task";c=a.getName()&&""!==a.getName()?a.getName():"Task";break;default:b="adam-tree-icon-user-task",c=a.getName()&&""!==a.getName()?a.getName():"Task"}break;case "AdamEvent":switch(a.getEventType()){case "START":b="adam-tree-icon-start";null!==a.getEventMessage()&&""!==a.getEventMessage()&&("Opportunities"===a.getEventMessage()?b="adam-tree-icon-start-opportunities":
"Leads"===a.getEventMessage()?b="adam-tree-icon-start-leads":"Documents"===a.getEventMessage()&&(b="adam-tree-icon-start-documents"));c=a.getName()&&""!==a.getName()?a.getName():"Start";break;case "INTERMEDIATE":null!==a.getEventMarker()&&""!==a.getEventMarker()&&(b="TIMER"===a.getEventMarker()?"adam-tree-icon-intermediate-timer":"adam-tree-icon-intermediate-message");c=a.getName()&&""!==a.getName()?a.getName():"Intermediate";break;case "BOUNDARY":b="adam-tree-icon-intermediate-boundary";c=a.getName()&&
""!==a.getName()?a.getName():"Boundary";break;case "END":b="adam-tree-icon-end",c=a.getName()&&""!==a.getName()?a.getName():"End"}break;case "AdamGateway":b="PARALLEL"===a.getGatewayType()?"adam-tree-icon-gateway-parallel":"adam-tree-icon-gateway-exclusive";c=a.getName()&&""!==a.getName()?a.getName():"Gateway";break;case "AdamData":"DATAOBJECT"===a.getDataType()?(b="bpmn_icon_dataobject",c=a.getName()&&""!==a.getName()?a.getName():"Data Object"):(b="bpmn_icon_datastore",c=a.getName()&&""!==a.getName()?
a.getName():"Data Store");break;case "AdamArtifact":"TEXTANNOTATION"===a.getArtifactType()?(b="adam-tree-icon-textannotation",c=a.getName()&&""!==a.getName()?a.getName():"Text Annotation"):(b="bpmn_icon_group",c=a.getName()&&""!==a.getName()?a.getName():"Group")}return d={name:c,icon:b,id:a.getID()}};
AdamCanvas.prototype.buildRecursiveNode=function(a,b){var c,d=[],e,g;b.children.sort(function(a,b){return a.x-b.x});for(c=0;c<b.children.getSize();c+=1)g=b.children.get(c),"MultipleSelectionContainer"!==g.type&&(e=this.getTreeItem(g),0<g.children.getSize()&&this.buildRecursiveNode(e,g),d.push(e));$.extend(a,{items:d})};AdamCanvas.prototype.getDiagramTree=function(){var a=[],b={name:this.name};this.buildRecursiveNode(b,this);a.push(b);return a};
AdamCanvas.prototype.addConnection=function(a){jCore.Canvas.prototype.addConnection.call(this,a);a.flo_state&&(a.disconnect(!0).connect({algorithm:"user",points:a.flo_state}),a.setSegmentMoveHandlers())};AdamCanvas.prototype.hideAllFocusedLabels=function(){var a=this.customShapes.getSize(),b,c;for(b=0;b<a;b+=1)c=this.customShapes.get(b),c.labels.get(0).loseFocus();return!0};
AdamCanvas.prototype.validateName=function(a,b){var c=a.parent,d,e=this.getCustomShapes().getSize(),g,h="",f=!0,k=b.trim();if(""===k)"AdamActivity"===c.type&&(h=translate("LBL_PMSE_MESSAGE_TASKNAMEEMPTY"),f=!1);else for(g=0;g<e;g+=1)if(d=this.getCustomShapes().get(g),d.getID()!==c.getID()&&d.type===c.type&&d.getName().toUpperCase()===k.toUpperCase()){c=translate("LBL_PMSE_MESSAGE_TASKNAMEALREADYEXISTS");h=c.replace("%s",k);f=!1;break}return{valid:f,message:h}};
AdamCanvas.prototype.validatePositions=function(a,b){var c=!0;b.y<a.getZoomHeight()/2&&(c=!1);b.y>this.getHeight()-a.getZoomHeight()/2-30&&(c=!1);b.x<a.getZoomWidth()/2&&(c=!1);b.x>this.getWidth()-a.getZoomWidth()/2-50&&(c=!1);return c};AdamCanvas.prototype.cleanAllFlowConditions=function(){var a=0,b=this.connections.asArray(),c;for(c=0;c<b.length;c+=1)""!==b[c].flo_condition&&(b[c].flo_condition="",a+=1);return a};
var AdamMarker=function(a){jCore.Shape.call(this,a);this.positions="left top;center top;right top;left bottom;center bottom;right bottom".split(";");this.offset="5 5;0 5;0 5;5 -1;0 -1;-5 -1".split(";");this.markerType=null;AdamMarker.prototype.initObject.call(this,a)};AdamMarker.prototype=new jCore.Shape;AdamMarker.prototype.type="AdamMarker";
AdamMarker.prototype.initObject=function(a){var b={canvas:null,parent:null,position:0,width:19,height:19,markerZoomClasses:[],markerType:null};$.extend(!0,b,a);this.setParent(b.parent).setPosition(b.position).setHeight(b.height).setWidth(b.width).setMarkerZoomClasses(b.markerZoomClasses).setMarkerType(b.markerType)};
AdamMarker.prototype.applyZoom=function(){var a;this.removeAllClasses();this.setProperties();a=this.markerZoomClasses[this.parent.canvas.zoomPropertiesIndex];this.currentZoomClass=this.html.className=a;return this};
AdamMarker.prototype.createHTML=function(){jCore.Shape.prototype.createHTML.call(this);this.html.id=this.id;this.setProperties();this.html.className=this.markerZoomClasses[this.parent.canvas.getZoomPropertiesIndex()];this.currentZoomClass=this.html.className;this.parent.html.appendChild(this.html);return this.html};
AdamMarker.prototype.paint=function(a){(null===this.getHTML()||a)&&this.createHTML();$(this.html).position({of:$(this.parent.html),my:this.positions[this.position],at:this.positions[this.position],offset:this.offset[this.position],collision:"none"})};AdamMarker.prototype.setMarkerType=function(a){this.markerType=a;return this};AdamMarker.prototype.setPosition=function(a){null!==a&&"number"===typeof a&&(this.position=a);return this};AdamMarker.prototype.setParent=function(a){this.parent=a;return this};
AdamMarker.prototype.setEClass=function(a){this.currentZoomClass=a;return this};AdamMarker.prototype.setMarkerZoomClasses=function(a){this.markerZoomClasses=a;return this};AdamMarker.prototype.setProperties=function(){this.html.style.width=this.width*this.parent.getCanvas().getZoomFactor()+"px";this.html.style.height=this.height*this.parent.getCanvas().getZoomFactor()+"px";return this};AdamMarker.prototype.removeAllClasses=function(){this.html.className="";return this};
var AdamEvent=function(a){AdamShape.call(this,a);this.evn_marker=this.evn_type=this.evn_uid=null;this.evn_is_interrupting=!0;this.evn_attached_to=null;this.evn_cancel_activity=!1;this.evn_activity_ref=null;this.evn_wait_for_completion=!1;this.evn_behavior=this.evn_time_duration=this.evn_time_cycle=this.evn_time_date=this.evn_operation_implementation_ref=this.evn_operation_name=this.evn_message=this.evn_condition=this.evn_escalation_code=this.evn_escalation_name=this.evn_error_code=this.evn_error_name=
null;this.numberRelativeToActivity=0;AdamEvent.prototype.initObject.call(this,a)};AdamEvent.prototype=new AdamShape;AdamEvent.prototype.type="AdamEvent";
AdamEvent.prototype.initObject=function(a){var b={evn_is_interrupting:!0,evn_message:"",evn_marker:"EMPTY",evn_type:"start",evn_behavior:"catch"};$.extend(!0,b,a);this.setEventUid(b.evn_uid).setEventType(b.evn_type).setEventMarker(b.evn_marker).setEventMessage(b.evn_message).setBehavior(b.evn_behavior).setCondition(b.evn_condition).setAttachedTo(b.evn_attached_to).setIsInterrupting(b.evn_is_interrupting);b.evn_name&&this.setName(b.evn_name)};
AdamEvent.prototype.setEventUid=function(a){this.evn_uid=a;return this};AdamEvent.prototype.setEventType=function(a){var b={start:"START",end:"END",intermediate:"INTERMEDIATE",boundary:"BOUNDARY"};b[a]&&(this.evn_type=b[a]);return this};AdamEvent.prototype.setEventMarker=function(a){this.evn_marker=a;return this};AdamEvent.prototype.setIsInterrupting=function(a){a instanceof Boolean&&(this.evn_is_interrupting=a);return this};
AdamEvent.prototype.setBehavior=function(a){var b={"catch":"CATCH","throw":"THROW"};b[a]&&(this.evn_behavior=b[a]);return this};AdamEvent.prototype.setAttachedTo=function(a,b){void 0!==b?b instanceof Boolean&&(this.evn_cancel_activity=b):this.evn_cancel_activity=this.evn_cancel_activity||!1;this.evn_attached_to=a;return this};
AdamEvent.prototype.destroy=function(){"AdamEvent"===this.getType()&&"BOUNDARY"===this.getEventType()&&this.parent.boundaryPlaces&&null!==this.numberRelativeToActivity&&(this.parent.boundaryPlaces.get(this.numberRelativeToActivity).available=!0,this.parent.boundaryArray.remove(this));return this};AdamEvent.prototype.setEventMessage=function(a){this.evn_message=a;return this};AdamEvent.prototype.setCondition=function(a){this.evn_condition=a;return this};
AdamEvent.prototype.setCompensationActivity=function(a,b){b?b instanceof Boolean&&(this.evn_wait_for_completion=b):this.evn_wait_for_completion=this.evn_wait_for_completion||!1;this.evn_activity_ref=a;return this};AdamEvent.prototype.setEventError=function(a,b){this.evn_error_name=a;this.evn_error_code=b;return this};AdamEvent.prototype.setEventEscalation=function(a,b){this.evn_escalation_name=a;this.evn_escalation_code=b;return this};
AdamEvent.prototype.setEventOperation=function(a,b){this.evn_operation_name=a;this.evn_operation_implementation_ref=b;return this};AdamEvent.prototype.setEventTimer=function(a,b,c){this.evn_time_date=a;this.evn_time_cycle=b;this.evn_time_duration=c;return this};AdamEvent.prototype.setDefaultFlow=function(a){AdamShape.prototype.setDefaultFlow.call(this,a);this.evn_default_flow=a;return this};
AdamEvent.prototype.getDBObject=function(){var a,b,c=this.getName();"BOUNDARY"===this.evn_type?(a="bpmnActivity",b=this.evn_attached_to):(a="bpmnDiagram",b=this.canvas.dia_id);return{evn_uid:this.evn_uid,evn_name:c,evn_type:this.evn_type,evn_marker:this.evn_marker,evn_is_interrupting:this.evn_is_interrupting,evn_attached_to:this.evn_attached_to,evn_cancel_activity:this.evn_cancel_activity,evn_activity_ref:this.evn_activity_ref,evn_wait_for_completion:this.evn_wait_for_completion,evn_error_name:this.evn_error_name,
evn_error_code:this.evn_error_code,evn_escalation_name:this.evn_escalation_name,evn_escalation_code:this.evn_escalation_code,evn_condition:this.evn_condition,evn_message:this.evn_message,evn_operation_name:this.evn_operation_name,evn_operation_implementation_ref:this.evn_operation_implementation_ref,evn_time_date:this.evn_time_date,evn_time_cycle:this.evn_time_cycle,evn_time_duration:this.evn_time_duration,evn_behavior:this.evn_behavior,bou_x:this.x,bou_y:this.y,bou_width:this.width,bou_height:this.height,
bou_container:a,element_id:b}};AdamEvent.prototype.attachToActivity=function(){var a=this.parent.getAvailableBoundaryPlace();!1!==a?(this.parent.setBoundary(this,a),this.setNumber(a)):(this.destroy(),this.saveAndDestroy());return this};AdamEvent.prototype.setNumber=function(a){this.numberRelativeToActivity=a;return this};
AdamEvent.prototype.createHTML=function(){AdamShape.prototype.createHTML.call(this);"BOUNDARY"===this.evn_type?this.style.addClasses(["adam_boundary_event"]):this.style.addClasses(["adam_event","adam_droppable"]);return this.html};AdamEvent.prototype.getEventType=function(){return this.evn_type};AdamEvent.prototype.getEventMarker=function(){return this.evn_marker};AdamEvent.prototype.getEventMessage=function(){return this.evn_message};
AdamEvent.prototype.getContextMenu=function(){var a,b,c,d,e,g,h,f,k,p,t,q,m,l,n=this,y,r=[];y=this.createConfigureAction();new Action({text:translate("LBL_PMSE_CONTEXT_MENU_START_EVENT"),handler:function(){n.updateEventType("START")},disabled:"START"===this.evn_type});new Action({text:translate("LBL_PMSE_CONTEXT_MENU_INTERMEDIATE_EVENT"),handler:function(){n.updateEventType("INTERMEDIATE")},disabled:"INTERMEDIATE"===this.evn_type});new Action({text:translate("LBL_PMSE_CONTEXT_MENU_END_EVENT"),handler:function(){n.updateEventType("END")},
disabled:"END"===this.evn_type});a=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_DELETE"),cssStyle:"adam-menu-icon-delete",handler:function(){var a;if(a=n.canvas.customShapes.find("id",n.id))a.canvas.emptyCurrentSelection(),a.canvas.addToSelection(a),a.canvas.removeElements()}});b=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_LEADS"),cssStyle:"adam-menu-icon-event-leads",handler:function(){n.updateEventMarker({evn_marker:"MESSAGE",evn_message:"Leads",evn_behavior:"CATCH"})},disabled:"MESSAGE"===
this.evn_marker&&"CATCH"===this.evn_behavior&&"START"===this.evn_type&&"Leads"===this.evn_message});c=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_OPPORTUNITIES"),cssStyle:"adam-menu-icon-event-opportunities",handler:function(){n.updateEventMarker({evn_marker:"MESSAGE",evn_message:"Opportunities",evn_behavior:"CATCH"})},disabled:"MESSAGE"===this.evn_marker&&"CATCH"===this.evn_behavior&&"START"===this.evn_type&&"Opportunities"===this.evn_message});d=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_DOCUMENTS"),
cssStyle:"adam-menu-icon-event-documents",handler:function(){n.updateEventMarker({evn_marker:"MESSAGE",evn_message:"Documents",evn_behavior:"CATCH"})},disabled:"MESSAGE"===this.evn_marker&&"CATCH"===this.evn_behavior&&"START"===this.evn_type&&"Documents"===this.evn_message});e=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_OTHER_MODULES"),handler:function(){n.updateEventMarker({evn_marker:"MESSAGE",evn_message:"",evn_behavior:"CATCH"})},disabled:"MESSAGE"===this.evn_marker&&"CATCH"===this.evn_behavior&&
"START"===this.evn_type&&(""===this.evn_message||null===this.evn_message)});g=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_RECEIVE_MESSAGE"),cssStyle:"adam-menu-icon-event-recive-message",handler:function(){n.updateEventMarker({evn_marker:"MESSAGE",evn_behavior:"CATCH"})},disabled:"MESSAGE"===this.evn_marker&&"CATCH"===this.evn_behavior&&"INTERMEDIATE"===this.evn_type});h=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_SEND_MESSAGE"),cssStyle:"adam-menu-icon-event-send-message",handler:function(){n.updateEventMarker({evn_marker:"MESSAGE",
evn_behavior:"THROW"})},disabled:"MESSAGE"===this.evn_marker&&"THROW"===this.evn_behavior&&"INTERMEDIATE"===this.evn_type});f=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_TIMER"),cssStyle:"adam-menu-icon-event-timer",handler:function(){n.updateEventMarker({evn_marker:"TIMER",evn_behavior:"CATCH"})},disabled:"TIMER"===this.evn_marker&&"CATCH"===this.evn_behavior&&"INTERMEDIATE"===this.evn_type});k=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_DO_NOTHING"),handler:function(){n.updateEventMarker({evn_marker:"EMPTY",
evn_behavior:"THROW"})},disabled:"EMPTY"===this.evn_marker&&"THROW"===this.evn_behavior&&"END"===this.evn_type});p=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_SEND_MESSAGE"),cssStyle:"adam-menu-icon-event-send-message",handler:function(){n.updateEventMarker({evn_marker:"MESSAGE",evn_behavior:"THROW"})},disabled:"MESSAGE"===this.evn_marker&&"THROW"===this.evn_behavior&&"END"===this.evn_type});t=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_TERMINATE_PROCESS"),cssStyle:"adam-menu-icon-event-terminate-process",
handler:function(){n.updateEventMarker({evn_marker:"TERMINATE",evn_behavior:"THROW"})},disabled:"TERMINATE"===this.evn_marker&&"THROW"===this.evn_behavior&&"END"===this.evn_type});q=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_RECEIVE_MESSAGE"),cssStyle:"adam-menu-icon-event-recive-message",handler:function(){n.updateEventMarker({evn_marker:"MESSAGE",evn_behavior:"CATCH"})},disabled:"MESSAGE"===this.evn_marker&&"CATCH"===this.evn_behavior&&"BOUNDARY"===this.evn_type});m=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_TIMER"),
cssStyle:"adam-menu-icon-event-timer",handler:function(){n.updateEventMarker({evn_marker:"TIMER",evn_behavior:"CATCH"})},disabled:"TIMER"===this.evn_marker&&"CATCH"===this.evn_behavior&&"BOUNDARY"===this.evn_type});l={label:"",menu:{items:[]}};switch(this.evn_type){case "START":l.label=translate("LBL_PMSE_CONTEXT_MENU_LISTEN");l.menu.items.push(b);l.menu.items.push(c);l.menu.items.push(d);l.menu.items.push(e);break;case "INTERMEDIATE":l.label=translate("LBL_PMSE_CONTEXT_MENU_ACTION");l.menu.items.push(g);
l.menu.items.push(h);l.menu.items.push(f);break;case "END":l.label=translate("LBL_PMSE_CONTEXT_MENU_RESULT");l.menu.items.push(k);l.menu.items.push(p);l.menu.items.push(t);break;case "BOUNDARY":l.label=translate("LBL_PMSE_CONTEXT_MENU_EVENT"),l.menu.items.push(q),l.menu.items.push(m)}l.icon="adam-menu-icon-convert";r.push(y,{jtype:"separator"});"START"!==this.evn_type&&r.push(l,{jtype:"separator"});r.push(a);return{items:r}};
AdamEvent.prototype.updateEventType=function(a){var b,c,d;b=this.getLayers().get(0);c=this.getLayers().get(1);switch(a){case "START":d={evn_type:a,evn_behavior:"CATCH",evn_marker:"MESSAGE",evn_message:""};break;case "INTERMEDIATE":d={evn_type:a,evn_behavior:"CATCH",evn_marker:"TIMER",evn_message:""};break;case "END":d={evn_type:a,evn_behavior:"THROW",evn_marker:"TERMINATE",evn_message:""}}a=new AdamShapeLayerCommand(this,{layers:[b,c],type:"changeeventtype",changes:d});a.execute();this.canvas.commandStack.add(a);
return this};AdamEvent.prototype.updateEventMarker=function(a){var b;b=this.getLayers().get(1);a=new AdamShapeLayerCommand(this,{layers:[b],type:"changeeventmarker",changes:a});a.execute();this.canvas.commandStack.add(a);return this};
AdamEvent.prototype.createConfigureAction=function(){var a,b,c,d,e,g,h,f=null,k=!1,p,t,q,m,l,n,y,r,w,z=this,A,u={},v,x,B,C,s;l=new SugarProxy({url:"pmse_Project/CrmData/emails/"+this.id,uid:this.id,callback:null});n=[{name:translate("LBL_PMSE_FORM_OPTION_CURRENT_USER"),value:"Current User"},{name:translate("LBL_PMSE_FORM_OPTION_RECORD_OWNER"),value:"Record Owner"},{name:translate("LBL_PMSE_FORM_OPTION_SUPERVISOR"),value:"Supervisor"},{name:translate("LBL_PMSE_LABEL_TEAM"),proxy:new SugarProxy({url:"pmse_Project/CrmData/teams/public",
uid:"",callback:null}),nameField:"text",valueField:"value",showValue:!1}];c=new SugarProxy({url:"pmse_Project/EventDefinition/"+this.id,uid:this.id,callback:null});if("START"!==this.evn_type||""!==this.evn_message&&null!==this.evn_message)switch(h=!1,this.evn_message){case "Leads":f="Leads";break;case "Opportunities":f="Opportunities";break;case "Documents":f="Documents"}else h=!0;switch(this.evn_type){case "START":C=new CriteriaField({name:"evn_criteria",label:translate("LBL_PMSE_LABEL_CRITERIA"),
required:!1,fieldWidth:250,fieldHeight:80,panels:{businessRulesEvaluation:{enabled:!1},formResponseEvaluation:{enabled:!1},math:{enabled:!1},fixedDateEvaluation:{enabled:!1},sugarDateEvaluation:{enabled:!1},unitTimeEvaluation:{enabled:!1},userEvaluation:{enabled:!0}},decimalSeparator:PMSE_DECIMAL_SEPARATOR});v=new ComboboxField({jtype:"combobox",name:"evn_module",label:translate("LBL_PMSE_LABEL_MODULE"),required:!0,readOnly:!h,initialValue:f,helpTooltip:{message:translate("LBL_PMSE_TOOLTIP_EVENT_MODULE")},
change:function(){0<C.items.length?p.show():C.setBaseModule(this.value)},related:"modules",proxy:new SugarProxy({url:"pmse_Project/CrmData/related_modules/"+PROJECT_MODULE,uid:PROJECT_MODULE,callback:null})});d=[v,{jtype:"combobox",name:"evn_params",label:translate("LBL_PMSE_FORM_LABEL_APPLIES_TO"),options:[{text:translate("LBL_PMSE_OPTION_SELECT"),value:""},{text:translate("LBL_PMSE_FORM_OPTION_NEW_RECORDS_ONLY"),value:"new"},{text:translate("LBL_PMSE_FORM_OPTION_UPDATED_RECORDS_ONLY"),value:"updated"}],
required:!0,helpTooltip:{message:translate("LBL_PMSE_TOOLTIP_WHEN_START_EVENT")}},C];g=280;e=500;u={loaded:function(b){z.canvas.emptyCurrentSelection();v.proxy.getData(null,{success:function(b){v.setValue(z.evn_message||b.result[0].value||null);C.setBaseModule(v.value);App.alert.dismiss("upload");a.html.style.display="inline"}})}};p=new MessagePanel({title:"Module change warning",wtype:"Confirm",message:translate("LBL_PMSE_MESSAGE_REMOVEALLSTARTCRITERIA"),buttons:[{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_OK"),
handler:function(){C.clear().setBaseModule(v.value);p.hide()}},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_CANCEL"),handler:function(){v.setValue(C.base_module);p.hide()}}]});break;case "INTERMEDIATE":"MESSAGE"===this.evn_marker&&("THROW"===this.evn_behavior?(x=new ComboboxField({jtype:"combobox",required:!0,name:"evn_criteria",label:translate("LBL_PMSE_LABEL_EMAIL_TEMPLATE"),proxy:new SugarProxy({url:"pmse_Project/CrmData/emailtemplates",uid:"",callback:null})}),v=new ComboboxField({jtype:"combobox",
required:!0,name:"evn_module",label:translate("LBL_PMSE_LABEL_MODULE"),proxy:new SugarProxy({url:"pmse_Project/CrmData/modules",uid:"",callback:null}),change:function(){x.proxy.uid=this.value;x.proxy.url="pmse_Project/CrmData/emailtemplates/"+this.value;x.removeOptions();B=[{text:translate("LBL_PMSE_OPTION_SELECT"),value:""}];x.proxy.getData(null,{success:function(a){B=B.concat(a.result);x.setOptions(B)}})}}),A=new HiddenField({name:"evn_params"}),d=function(){var a=this.parent,b={};b.to=a.items[2].getObject();
b.cc=a.items[3].getObject();b.bcc=a.items[4].getObject();A.setValue(JSON.stringify(b))},d=[v,x,{jtype:"emailpicker",label:translate("LBL_PMSE_FORM_LABEL_EMAIL_TO"),name:"address_to",required:!0,submit:!1,fieldWidth:250,fieldHeight:50,change:d,groups:n,inputPattern:"email",nameField:"fullName",valueField:"emailAddress",proxy:l,varPanel:!0},{jtype:"emailpicker",label:translate("LBL_PMSE_FORM_LABEL_EMAIL_CC"),name:"address_cc",required:!1,submit:!1,fieldWidth:250,fieldHeight:50,change:d,groups:n,inputPattern:"email",
nameField:"fullName",valueField:"emailAddress",proxy:l,varPanel:!0},{jtype:"emailpicker",label:translate("LBL_PMSE_FORM_LABEL_EMAIL_BCC"),name:"address_bcc",required:!1,submit:!1,fieldWidth:250,fieldHeight:50,change:d,groups:n,inputPattern:"email",nameField:"fullName",valueField:"emailAddress",proxy:l,varPanel:!0},A],g=380,e=500,u={loaded:function(c){var d=null,e;z.canvas.emptyCurrentSelection();if(c&&c.evn_params){try{d=JSON.parse(c.evn_params)}catch(g){}if(d)for(A.setValue(c.evn_params),e=0;e<b.items.length;e+=
1)switch(b.items[e].name){case "address_to":b.items[e].setItems(d.to);break;case "address_cc":b.items[e].setItems(d.cc);break;case "address_bcc":b.items[e].setItems(d.bcc)}}v.proxy.getData(null,{success:function(b){b&&b.result&&(v.setOptions(b.result),v.setValue(c.evn_module||b.result[0]&&b.result[0].value||null));x.proxy.uid=v.value;x.proxy.url="pmse_Project/CrmData/emailtemplates/"+v.value;B=[{text:translate("LBL_PMSE_OPTION_SELECT"),value:""}];x.proxy.getData(null,{success:function(b){B=B.concat(b.result);
x.setOptions(B);b&&b.result&&x.setValue(c.evn_criteria||b.result[0]&&b.result[0].value||null);App.alert.dismiss("upload");a.html.style.display="inline"}})}})},submit:function(a){}}):(d=[{jtype:"criteria",name:"evn_criteria",label:translate("LBL_PMSE_LABEL_CRITERIA"),required:!1,fieldWidth:250,fieldHeight:80,restClient:this.parent.project.restClient,panels:{businessRulesEvaluation:{enabled:!1},formResponseEvaluation:{enabled:!1},math:{enabled:!1},fixedDateEvaluation:{enabled:!1},sugarDateEvaluation:{enabled:!1},
unitTimeEvaluation:{enabled:!1}},decimalSeparator:PMSE_DECIMAL_SEPARATOR,base_module:PROJECT_MODULE,base_module_label:translate("LBL_PMSE_ADAM_UI_LBL_TARGET_MODULE")}],g=185,e=500,u={loaded:function(b){z.canvas.emptyCurrentSelection();App.alert.dismiss("upload");a.html.style.display="inline"}}));if("TIMER"===this.evn_marker){q=new HiddenField({name:"evn_timer_type"});r=new TextField({jtype:"text",name:"evn_duration_criteria",label:translate("LBL_PMSE_LABEL_DURATION"),required:!0,helpTooltip:{message:translate("LBL_PMSE_TOOLTIP_DURATION")},
fieldWidth:"50px"});w=new ComboboxField({name:"evn_duration_params",label:translate("LBL_PMSE_LABEL_UNIT"),options:[{text:translate("LBL_PMSE_FORM_OPTION_DAYS"),value:"day"},{text:translate("LBL_PMSE_FORM_OPTION_HOURS"),value:"hour"},{text:translate("LBL_PMSE_FORM_OPTION_MINUTES"),value:"minute"}],initialValue:"hour"});n=[];for(l=1;30>=l;l+=1)n.push({text:translate(l),value:l});new ComboboxField({name:"evn_cyclic_repeat_every",label:translate("LBL_PMSE_LABEL_REPEATSEVERY"),options:n,initialValue:1,
required:!0});new DateField({name:"evn_cyclic_date",label:translate("LBL_PMSE_LABEL_BEGINS"),required:!0,fieldWidth:"100px",readOnly:!0});m=new RadiobuttonField({jtype:"radio",name:"evn_timer_type",label:translate("LBL_PMSE_LABEL_DURATION"),value:!0,labelAlign:"right",onClick:function(a,b){q.setValue("duration");r.enable();w.enable();s.disable();s.clear();s.isValid()}});y=new RadiobuttonField({jtype:"radio",name:"evn_timer_type",label:translate("LBL_PMSE_LABEL_FIXEDDATE"),reverse:!0,labelAlign:"right",
onClick:function(a,b){q.setValue("fixed date");r.disable();w.disable();s.enable()}});s=new CriteriaField({name:"evn_criteria",label:translate("LBL_PMSE_LABEL_CRITERIA"),required:!1,fieldWidth:300,fieldHeight:80,timerCriteria:!0,restClient:this.parent.project.restClient,panels:{businessRulesEvaluation:{enabled:!1},formResponseEvaluation:{enabled:!1},logic:{enabled:!1},group:{enabled:!1},userEvaluation:{enabled:!1},fieldEvaluation:{enabled:!1}},decimalSeparator:PMSE_DECIMAL_SEPARATOR});new RadiobuttonField({jtype:"radio",
name:"evn_timer_type",label:translate("LBL_PMSE_LABEL_CYCLIC"),reverse:!0,labelAlign:"right",onClick:function(a,b){q.setValue("cyclic");r.disable();w.disable()}});d=[q,m,r,w,y,s];g=420;e=500;u={loaded:function(b){s.setBaseModule(PROJECT_MODULE);z.canvas.emptyCurrentSelection();switch(b.evn_params){case "fixed date":m.setValue(!1);y.setValue(!0);q.setValue("fixed date");r.disable();w.disable();break;case "cyclic":q.setValue("cyclic");r.disable();w.disable();break;default:q.setValue("duration"),m.setValue(!0),
y.setValue(!1),r.enable(),r.setValue(b.evn_criteria||""),w.enable(),w.setValue(b.evn_params||"minute"),s.disable()}App.alert.dismiss("upload");a.html.style.display="inline"},submit:function(a){console.log(a)}}}break;case "END":"MESSAGE"===this.evn_marker&&(x=new ComboboxField({jtype:"combobox",name:"evn_criteria",label:translate("LBL_PMSE_LABEL_EMAIL_TEMPLATE"),proxy:new SugarProxy({url:"pmse_Project/CrmData/emailtemplates/",uid:"",callback:null})}),v=new ComboboxField({jtype:"combobox",required:!0,
name:"evn_module",label:translate("LBL_PMSE_LABEL_MODULE"),proxy:new SugarProxy({url:"pmse_Project/CrmData/modules/",uid:"",callback:null}),change:function(){x.proxy.uid=this.value;x.proxy.url="pmse_Project/CrmData/emailtemplates/"+this.value;x.removeOptions();B=[{text:translate("LBL_PMSE_OPTION_SELECT"),value:""}];x.proxy.getData(null,{success:function(a){B=B.concat(a.result);x.setOptions(B)}})}}),A=new HiddenField({name:"evn_params"}),d=function(){var a=this.parent,b={};b.to=a.items[2].getObject();
b.cc=a.items[3].getObject();b.bcc=a.items[4].getObject();A.setValue(JSON.stringify(b))},d=[v,x,{jtype:"emailpicker",label:translate("LBL_PMSE_FORM_LABEL_EMAIL_TO"),name:"address_to",required:!0,submit:!1,fieldWidth:250,fieldHeight:50,change:d,groups:n,inputPattern:"email",nameField:"fullName",valueField:"emailAddress",proxy:l,varPanel:!0},{jtype:"emailpicker",label:translate("LBL_PMSE_FORM_LABEL_EMAIL_CC"),name:"address_cc",required:!1,submit:!1,fieldWidth:250,fieldHeight:50,change:d,groups:n,inputPattern:"email",
nameField:"fullName",valueField:"emailAddress",proxy:l,varPanel:!0},{jtype:"emailpicker",label:translate("LBL_PMSE_FORM_LABEL_EMAIL_BCC"),name:"address_bcc",required:!1,submit:!1,fieldWidth:250,fieldHeight:50,change:d,groups:n,inputPattern:"email",nameField:"fullName",valueField:"emailAddress",proxy:l,varPanel:!0},A],g=380,e=500,u={loaded:function(c){var d=null,e;z.canvas.emptyCurrentSelection();if(c&&c.evn_params){try{d=JSON.parse(c.evn_params)}catch(g){}if(d)for(A.setValue(c.evn_params),e=0;e<b.items.length;e+=
1)switch(b.items[e].name){case "address_to":b.items[e].setItems(d.to);break;case "address_cc":b.items[e].setItems(d.cc);break;case "address_bcc":b.items[e].setItems(d.bcc)}}v.proxy.getData(null,{success:function(b){b&&b.result&&(v.setOptions(b.result),v.setValue(c.evn_module||b.result[0]&&b.result[0].value||null));x.proxy.uid=v.value;x.proxy.url="pmse_Project/CrmData/emailtemplates/"+v.value;B=[{text:translate("LBL_PMSE_OPTION_SELECT"),value:""}];x.proxy.getData(null,{success:function(b){B=B.concat(b.result);
x.setOptions(B);App.alert.dismiss("upload");a.html.style.display="inline"}})}})}})}b=new Form({proxy:c,closeContainerOnSubmit:!0,items:d,buttons:[{jtype:"submit",caption:translate("LBL_PMSE_BUTTON_SAVE")},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_CANCEL"),handler:function(){$(".hasDatepicker").datepicker("hide");b.isDirty()?(t=new MessagePanel({title:"Confirm",wtype:"Confirm",message:translate("LBL_PMSE_MESSAGE_CANCELCONFIRM"),buttons:[{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_YES"),
handler:function(){t.close();a.close()}},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_NO"),handler:function(){t.close()}}]}),t.show()):a.close()}}],callback:u,language:PMSE_DESIGNER_FORM_TRANSLATIONS});a=new Window({width:e,height:g,modal:!0,title:translate("LBL_PMSE_LABEL_EVENT")+": "+this.getName()});a.addPanel(b);"BOUNDARY"===this.evn_type&&(k=!0);"END"===this.evn_type&&"MESSAGE"!==this.evn_marker&&(k=!0);return new Action({text:translate("LBL_PMSE_CONTEXT_MENU_SETTINGS"),cssStyle:"adam-menu-icon-configure",
handler:function(){z.canvas.project.save();a.show();a.html.style.display="none";App.alert.show("upload",{level:"process",title:"LBL_LOADING",autoclose:!1})},disabled:k})};AdamEvent.prototype.stringify=function(){var a=AdamShape.prototype.stringify.call(this),b={evn_marker:this.getEventMarker(),evn_message:this.getEventMessage(),evn_condition:this.evn_condition,evn_attached_to:this.evn_attached_to,evn_is_interrupting:this.evn_is_interrupting,evn_behavior:this.evn_behavior};$.extend(!0,a,b);return a};
var AdamGateway;AdamGateway=function(a){AdamShape.call(this,a);this.gat_default_flow=this.gat_waiting_for_start=this.gat_activation_count=this.gat_event_gateway_type=this.gat_instantiate=this.gat_direction=this.gat_type=this.gat_uid=null;AdamGateway.prototype.initObject.call(this,a)};AdamGateway.prototype=new AdamShape;AdamGateway.prototype.type="AdamGateway";
AdamGateway.prototype.initObject=function(a){var b={gat_direction:"UNSPECIFIED",gat_instantiate:!1,gat_event_gateway_type:"NONE",gat_activation_count:0,gat_waiting_for_start:!0,gat_type:"EXCLUSIVE",gat_default_flow:0};$.extend(!0,b,a);this.setGatewayUid(b.gat_uid).setGatewayType(b.gat_type).setDirection(b.gat_direction).setInstantiate(b.gat_instantiate).setEventGatewayType(b.gat_event_gateway_type).setActivationCount(b.gat_activation_count).setWaitingForStart(b.gat_waiting_for_start).setDefaultFlow(b.gat_default_flow);
b.gat_name&&this.setName(b.gat_name)};AdamGateway.prototype.setGatewayUid=function(a){this.gat_uid=a;return this};AdamGateway.prototype.setGatewayType=function(a){var b={exclusive:"EXCLUSIVE",parallel:"PARALLEL",inclusive:"INCLUSIVE",eventbased:"EVENTBASED"};b[a]&&(this.gat_type=b[a]);return this};AdamGateway.prototype.setDirection=function(a){var b={unspecified:"UNSPECIFIED",diverging:"DIVERGING",converging:"CONVERGING",mixed:"MIXED"};b[a]&&(this.gat_direction=b[a]);return this};
AdamGateway.prototype.setInstantiate=function(a){this.gat_instantiate=a;return this};AdamGateway.prototype.setEventGatewayType=function(a){this.gat_event_gateway_type=a;return this};AdamGateway.prototype.setActivationCount=function(a){this.gat_activation_count=a;return this};AdamGateway.prototype.setWaitingForStart=function(a){this.gat_waiting_for_start=a;return this};
AdamGateway.prototype.setDefaultFlow=function(a){this.html&&(AdamShape.prototype.setDefaultFlow.call(this,a),this.canvas.triggerCommandAdam(this,["gat_default_flow"],[this.gat_default_flow],[a]));this.gat_default_flow=a;return this};
AdamGateway.prototype.getDBObject=function(){var a=this.getName();return{gat_uid:this.gat_uid,gat_name:a,gat_type:this.gat_type,gat_direction:this.gat_direction,gat_instantiate:this.gat_instantiate,gat_event_gateway_type:this.gat_event_gateway_type,gat_activation_count:this.gat_activation_count,gat_waiting_for_start:this.gat_waiting_for_start,gat_default_flow:this.gat_default_flow,bou_x:this.x,bou_y:this.y,bou_width:this.width,bou_height:this.height,bou_container:"bpmnDiagram",element_id:this.canvas.dia_id}};
AdamGateway.prototype.getGatewayType=function(){return this.gat_type};
AdamGateway.prototype.getContextMenu=function(){var a,b,c,d,e,g;c="EXCLUSIVE"===this.gat_type;d="PARALLEL"===this.gat_type;e="INCLUSIVE"===this.gat_type;g="EVENTBASED"===this.gat_type;var h,f=this.getDestElements(),k=1<f.length?!1:!0,p=[],t,q=[],m=this,l,n,y,r,w;r="UNSPECIFIED"===this.gat_direction;w="DIVERGING"===this.gat_direction;var z="CONVERGING"===this.gat_direction;y="MIXED"===this.gat_direction;k=function(a){return function(){var b=new CommandDefaultFlow(m,a);b.execute();m.canvas.commandStack.add(b)}};
b=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_DELETE"),cssStyle:"adam-menu-icon-delete",handler:function(){var a;if(a=m.canvas.customShapes.find("id",m.id))a.canvas.emptyCurrentSelection(),a.canvas.addToSelection(a),a.canvas.removeElements()}});a=this.createConfigureAction();c=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_EXCLUSIVE_GATEWAY"),cssStyle:"adam-menu-icon-gateway-exclusive",handler:function(){m.updateGatewayType("EXCLUSIVE")},disabled:c});d=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_PARELLEL_GATEWAY"),
cssStyle:"adam-menu-icon-gateway-parallel",handler:function(){m.updateGatewayType("PARALLEL")},disabled:d});e=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_INCLUSIVE_GATEWAY"),cssStyle:"adam-menu-icon-gateway-inclusive",handler:function(){m.updateGatewayType("INCLUSIVE")},disabled:e});g=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_EVENT_BASED_GATEWAY"),cssStyle:"adam-menu-icon-gateway-eventbase",handler:function(){m.updateGatewayType("EVENTBASED")},disabled:g});if(1<f.length){h=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_NONE"),
cssStyle:"adam-menu-icon-none",handler:k(""),disabled:0!==m.gat_default_flow?!1:!0});p.push(h);for(h=0;h<this.getPorts().getSize();h+=1)if(l=this.getPorts().get(h),n=l.connection,n.srcPort.parent.getID()===this.getID()){l=n.destPort.parent;switch(l.getType()){case "AdamActivity":t=""!==l.getName()?l.getName():translate("LBL_PMSE_CONTEXT_MENU_DEFAULT_TASK");break;case "AdamEvent":t=""!==l.getName()?l.getName():translate("LBL_PMSE_CONTEXT_MENU_DEFAULT_EVENT");break;case "AdamGateway":t=""!==l.getName()?
l.getName():translate("LBL_PMSE_CONTEXT_MENU_DEFAULT_GATEWAY")}p.push(new Action({text:t,cssStyle:m.getCanvas().getTreeItem(l).icon,handler:k(n.getID()),disabled:m.gat_default_flow===n.getID()?!0:!1}))}k="PARALLEL"===this.gat_type||"EVENTBASED"===this.gat_type?!0:!1;h={label:translate("LBL_PMSE_CONTEXT_MENU_DEFAULT_FLOW"),icon:"adam-menu-icon-default-flow",disabled:k,menu:{items:p}}}q.push(c);q.push(d);"CONVERGING"!==this.gat_direction&&(q.push(e),q.push(g));p={label:translate("LBL_PMSE_CONTEXT_MENU_CONVERT"),
icon:"adam-menu-icon-convert",menu:{items:q}};q=[];new Action({text:translate("LBL_PMSE_CONTEXT_MENU_UNSPECIFIED"),cssStyle:"adam-menu-icon-none",handler:function(){m.updateDirection("UNSPECIFIED")},disabled:r});r=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_CONVERGING"),cssStyle:"adam-menu-icon-gateway-converging",handler:function(){m.updateDirection("CONVERGING");m.cleanFlowConditions()},disabled:z});w=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_DIVERGING"),cssStyle:"adam-menu-icon-gateway-diverging",
handler:function(){m.updateDirection("DIVERGING")},disabled:w});new Action({text:translate("LBL_PMSE_CONTEXT_MENU_MIXED"),cssStyle:"adam-menu-icon-gateway-mixed",handler:function(){m.updateDirection("MIXED")},disabled:y});y={label:translate("LBL_PMSE_CONTEXT_MENU_DIRECTION"),icon:"adam-menu-icon-gateway-direction",menu:{items:[r,w]}};1<f.length?(0<a.size&&q.push(a.action,{jtype:"separator"}),"EVENTBASED"!==this.getGatewayType()&&"INCLUSIVE"!==this.getGatewayType()&&q.push(y,{jtype:"separator"}),q.push(p,
{jtype:"separator"},h,{jtype:"separator"},b)):(0<a.size&&q.push(a.action,{jtype:"separator"}),"EVENTBASED"!==this.getGatewayType()&&"INCLUSIVE"!==this.getGatewayType()&&q.push(y,{jtype:"separator"}),q.push(p,{jtype:"separator"},b));return{items:q}};
AdamGateway.prototype.createConfigureAction=function(){var a,b,c,d,e,g=[],h=this.canvas,f=0,k,p,t,q=this,m,l;m=new SugarProxy({url:"pmse_Project/GatewayDefinition/"+this.id,uid:this.id,callback:null});b=new Window({width:750,height:500,modal:!0,title:translate("LBL_PMSE_LABEL_GATEWAY")+": "+this.getName()});for(d=0;d<this.getPorts().getSize();d+=1)e=this.getPorts().get(d).connection,this.gat_default_flow!==e.getID()&&e.flo_element_origin===this.getID()&&"DEFAULT"!==e.flo_type&&(f+=1);c=new Form({proxy:m,
buttons:[{jtype:"submit",caption:translate("LBL_PMSE_BUTTON_SAVE")},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_CANCEL"),handler:function(){c.isDirty()?(t=new MessagePanel({title:"Confirm",wtype:"Confirm",message:translate("LBL_PMSE_MESSAGE_CANCELCONFIRM"),buttons:[{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_YES"),handler:function(){t.close();b.close()}},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_NO"),handler:function(){t.close()}}]}),t.show()):b.close()}}],callback:{submit:function(a,
c){var d=[];$.each(a,function(a,b){e=h.connections.find("id",a.split("-")[1]);e.setFlowCondition("[]"!==b?b:"");d.push({flo_uid:e.id,flo_condition:e.getFlowCondition()})});m.sendData(d);b.close()},loaded:function(a){q.canvas.emptyCurrentSelection();$(c.body).sortable({connectWith:".adam-field",stop:function(a,b){q.reorderItem(c,b.item.attr("id"))},start:function(a,b){$(".multiple-item-panel").hide();$(c.body).css("cursor","move")}});$(c.body).on("mouseover",".adam-field",function(a){$(c.body).sortable("enable");
$(c.body).css("cursor","row-resize");a.stopPropagation()});$(c.body).on("mouseover",".multiple-item-container",function(a){$(c.body).sortable("disable");$(c.body).css("cursor","default");a.stopPropagation()});l=a.data;if(a&&a.data)for(d=0;d<l.length;d+=1)e=q.canvas.getConnections().find("id",l[d].flo_uid),k=e.getName()&&""!==e.getName()?e.getName():e.getDestPort().parent.getName(),p=translate("LBL_PMSE_LABEL_CRITERIA")+" ("+k+")",g.push({jtype:"criteria",name:"condition-"+e.getID(),label:p,required:!1,
restClient:q.parent.project.restClient,value:e.getFlowCondition(),decimalSeparator:PMSE_DECIMAL_SEPARATOR,base_module:PROJECT_MODULE,base_module_label:translate("LBL_PMSE_ADAM_UI_LBL_TARGET_MODULE"),panels:{math:{enabled:!1},fixedDateEvaluation:{enabled:!1},sugarDateEvaluation:{enabled:!1},unitTimeEvaluation:{enabled:!1}}});c.setItems(g);for(d=0;d<c.items.length;d+=1)html=c.items[d].getHTML(),$(html).find("select, input, textarea").focus(c.onEnterFieldHandler(c.items[d])),c.body.appendChild(html);
c.proxy=null;App.alert.dismiss("upload");b.html.style.display="inline"}},language:PMSE_DESIGNER_FORM_TRANSLATIONS});b.addPanel(c);a="PARALLEL"===this.gat_type||"EVENTBASED"===this.gat_type||"CONVERGING"===this.gat_direction?!0:!1;a=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_SETTINGS"),cssStyle:"adam-menu-icon-configure",handler:function(){b.show();b.html.style.display="none";App.alert.show("upload",{level:"process",title:"LBL_LOADING",autoclose:!1})},disabled:a});return{size:f,action:a}};
AdamGateway.prototype.reorderItem=function(a,b){var c,d,e,g;for(c=0;c<a.items.length;c+=1)if(d=a.items[c],b===d.id){e=c;break}d=$(".adam-panel-body > div").map(function(){return this.id}).get();for(c=0;c<d.length;c+=1)if(b===d[c]){g=c;break}c=a.items[g];a.items[g]=a.items[e];a.items[e]=c};
AdamGateway.prototype.cleanFlowConditions=function(){var a,b,c;for(a=0;a<this.getPorts().getSize();a+=1)b=this.getPorts().get(a),b=b.connection,b.srcPort.parent.getID()===this.getID()&&(c={condition:b.getFlowCondition(),type:b.getFlowType()},b.setFlowCondition(""),b.canvas.triggerFlowConditionChangeEvent(b,c))};
AdamGateway.prototype.updateGatewayType=function(a){var b;b=this.getLayers().get(0);a=new AdamShapeLayerCommand(this,{layers:[b],type:"changetypegateway",changes:a});a.execute();this.canvas.commandStack.add(a);return this};AdamGateway.prototype.updateDirection=function(a){(new CommandSingleProperty(this,{propertyName:"gat_direction",before:this.gat_direction,after:a})).execute()};AdamGateway.prototype.updateDefaultFlow=function(a){this.gat_default_flow=a};
var AdamActivity=function(a){AdamShape.call(this,a);this.act_master_diagram=this.act_default_flow=this.act_referer=this.act_is_global=this.act_method=this.act_protocol=this.act_cancel_remaining_instances=this.act_ordering=this.act_completion_condition=this.act_is_collapsed=this.act_is_adhoc=this.act_loop_behavior=this.act_loop_cardinality=this.act_loop_condition=this.act_loop_maximum=this.act_test_before=this.act_loop_type=this.act_script=this.act_script_type=this.act_instantiate=this.act_implementation=
this.act_task_type=this.act_completion_quantity=this.act_start_quantity=this.act_is_for_compensation=this.act_type=this.act_uid=null;this.boundaryPlaces=new jCore.ArrayList;this.boundaryArray=new jCore.ArrayList;this.markersArray=new jCore.ArrayList;AdamActivity.prototype.initObject.call(this,a)};AdamActivity.prototype=new AdamShape;AdamActivity.prototype.type="AdamActivity";AdamActivity.prototype.activityContainerBehavior=null;AdamActivity.prototype.activityResizeBehavior=null;
AdamActivity.prototype.initObject=function(a){var b={act_type:"TASK",act_loop_type:"NONE",act_is_for_compensation:!1,act_task_type:"EMPTY",act_is_collapsed:!1,act_is_global:!1,act_loop_cardinality:0,act_loop_maximum:0,act_start_quantity:1,act_is_adhoc:!1,act_cancel_remaining_instances:!0,act_instantiate:!1,act_completion_quantity:0,act_implementation:"",act_script:"",act_script_type:"",act_default_flow:0,minHeight:50,minWidth:100,maxHeight:500,maxWidth:600};$.extend(!0,b,a);this.setActivityUid(b.act_uid).setActivityType(b.act_type).setLoopType(b.act_loop_type).setIsForCompensation(b.act_is_for_compensation).setTaskType(b.act_task_type).setIsCollapsed(b.act_is_collapsed).setIsGlobal(b.act_is_global).setLoopCardinality(b.act_loop_cardinality).setLoopMaximun(b.act_loop_maximum).setStartQuantity(b.act_start_quantity).setIsAdhoc(b.act_is_adhoc).setCancelRemainingInstances(b.act_cancel_remaining_instances).setInstantiate(b.act_instantiate).setImplementation(b.act_implementation).setCompletionQuantity(b.act_completion_quantity).setScript(b.act_script).setScriptType(b.act_script_type).setDefaultFlow(b.act_default_flow).setMinHeight(b.minHeight).setMinWidth(b.minWidth).setMaxHeight(b.maxHeight).setMaxWidth(b.maxWidth);
b.act_name&&this.setName(b.act_name);b.markers&&this.addMarkers(b.markers,this)};AdamActivity.prototype.getActivityType=function(){return this.act_type};AdamActivity.prototype.getIsForCompensation=function(){return this.act_is_for_compensation};AdamActivity.prototype.getCancelRemainingInstances=function(){return this.act_cancel_remaining_instances};AdamActivity.prototype.getCompletionQuantity=function(){return this.act_completion_quantity};AdamActivity.prototype.getIsGlobal=function(){return this.act_is_global};
AdamActivity.prototype.getStartQuantity=function(){return this.act_start_quantity};AdamActivity.prototype.getInstantiate=function(){return this.act_instantiate};AdamActivity.prototype.getImplementation=function(){return this.act_implementation};AdamActivity.prototype.getScript=function(){return this.act_script};AdamActivity.prototype.getScriptType=function(){return this.act_script_type};AdamActivity.prototype.getMinHeight=function(){return this.minHeight};AdamActivity.prototype.getMinWidth=function(){return this.minWidth};
AdamActivity.prototype.getMaxHeight=function(){return this.maxHeight};AdamActivity.prototype.getMaxWidth=function(){return this.maxWidth};AdamActivity.prototype.setActivityUid=function(a){this.act_uid=a;return this};AdamActivity.prototype.setActivityType=function(a){this.act_type=a;return this};AdamActivity.prototype.setImplementation=function(a){this.act_implementation=a;return this};AdamActivity.prototype.setLoopType=function(a){this.act_loop_type=a;return this};
AdamActivity.prototype.setIsCollapsed=function(a){_.isBoolean(a)&&(this.act_is_collapsed=a);return this};AdamActivity.prototype.setIsForCompensation=function(a){_.isBoolean(a)&&(this.act_is_for_compensation=a);return this};AdamActivity.prototype.setTaskType=function(a){this.act_task_type=a;return this};AdamActivity.prototype.setIsGlobal=function(a){_.isBoolean(a)&&(this.act_is_global=a);return this};AdamActivity.prototype.setLoopCardinality=function(a){this.act_loop_cardinality=a;return this};
AdamActivity.prototype.setLoopMaximun=function(a){this.act_loop_maximum=a;return this};AdamActivity.prototype.setStartQuantity=function(a){this.act_start_quantity=a;return this};AdamActivity.prototype.setIsAdhoc=function(a){_.isBoolean(a)&&(this.act_is_adhoc=a);return this};AdamActivity.prototype.setCancelRemainingInstances=function(a){_.isBoolean(a)&&(this.act_cancel_remaining_instances=a);return this};AdamActivity.prototype.setInstantiate=function(a){_.isBoolean(a)&&(this.act_instantiate=a);return this};
AdamActivity.prototype.setCompletionQuantity=function(a){this.act_completion_quantity=a;return this};AdamActivity.prototype.setScript=function(a){this.act_script=a;return this};AdamActivity.prototype.setScriptType=function(a){this.act_script_type=a;return this};AdamActivity.prototype.setDefaultFlow=function(a){this.html&&(AdamShape.prototype.setDefaultFlow.call(this,a),this.canvas.triggerCommandAdam(this,["act_default_flow"],[this.act_default_flow],[a]));this.act_default_flow=a;return this};
AdamActivity.prototype.setMinHeight=function(a){this.minHeight=a;return this};AdamActivity.prototype.setMinWidth=function(a){this.minWidth=a;return this};AdamActivity.prototype.setMaxHeight=function(a){this.maxHeight=a;return this};AdamActivity.prototype.setMaxWidth=function(a){this.maxWidth=a;return this};
AdamActivity.prototype.getDBObject=function(){var a=this.getName();return{act_uid:this.act_uid,act_name:a,act_type:this.act_type,act_task_type:this.act_task_type,act_is_for_compensation:this.act_is_for_compensation,act_start_quantity:this.act_start_quantity,act_completion_quantity:this.act_completion_quantity,act_implementation:this.act_implementation,act_instantiate:this.act_instantiate,act_script_type:this.act_script_type,act_script:this.act_script,act_loop_type:this.act_loop_type,act_test_before:this.act_test_before,
act_loop_maximum:this.act_loop_maximum,act_loop_condition:this.act_loop_condition,act_loop_cardinality:this.act_loop_cardinality,act_loop_behavior:this.act_loop_behavior,act_is_adhoc:this.act_is_adhoc,act_is_collapsed:this.act_is_collapsed,act_completion_condition:this.act_completion_condition,act_ordering:this.act_ordering,act_cancel_remaining_instances:this.act_cancel_remaining_instances,act_protocol:this.act_protocol,act_method:this.act_method,act_is_global:this.act_is_global,act_referer:this.act_referer,
act_default_flow:this.act_default_flow,act_master_diagram:this.act_master_diagram,bou_x:this.x,bou_y:this.y,bou_width:this.width,bou_height:this.height,bou_container:"bpmnDiagram",element_id:this.canvas.dia_id}};AdamActivity.prototype.getMarkers=function(){return this.markersArray};
AdamActivity.prototype.containerBehaviorFactory=function(a){"activity"===a?(this.activityContainerBehavior||(this.activityContainerBehavior=new AdamActivityContainerBehavior),a=this.activityContainerBehavior):a=AdamShape.prototype.containerBehaviorFactory.call(this,a);return a};
AdamActivity.prototype.resizeBehaviorFactory=function(a){"activityResize"===a?(this.activityResizeBehavior||(this.activityResizeBehavior=new AdamActivityResizeBehavior),a=this.activityResizeBehavior):a=AdamShape.prototype.resizeBehaviorFactory.call(this,a);return a};AdamActivity.prototype.createHTML=function(){jCore.CustomShape.prototype.createHTML.call(this);this.style.addClasses(["adam_activity","adam_droppable"]);return this.html};
AdamActivity.prototype.makeBoundaryPlaces=function(){var a,b,c,d=0,e=this.boundaryArray.getFirst(),g=0,h=0,f=0,k=0;b=e.parent.getHeight()-e.getHeight()/2;for(a=e.parent.getWidth()-(g+1)*(e.getWidth()+3);0<a+e.getWidth()/2;)c={},c.x=a,c.y=b,c.available=!0,c.number=d,c.location="BOTTOM",e.parent.boundaryPlaces.insert(c),d+=1,g+=1,a=e.parent.getWidth()-(g+1)*(e.getWidth()+3);b=e.parent.getHeight()-(h+1)*(e.getHeight()+3);for(a=-e.getHeight()/2;0<b+e.getHeight()/2;)c={},c.x=a,c.y=b,c.available=!0,c.number=
d,c.location="LEFT",e.parent.boundaryPlaces.insert(c),d+=1,h+=1,b=e.parent.getHeight()-(h+1)*(e.getHeight()+3);b=-e.getWidth()/2;for(a=f*(e.getWidth()+3);a+e.getWidth()/2<e.parent.getWidth();)c={},c.x=a,c.y=b,c.available=!0,c.number=d,c.location="TOP",e.parent.boundaryPlaces.insert(c),d+=1,f+=1,a=f*(e.getWidth()+3);b=k*(e.getHeight()+3);for(a=e.parent.getWidth()-e.getWidth()/2;b+e.getHeight()/2<e.parent.getHeight();)c={},c.x=a,c.y=b,c.available=!0,c.number=d,c.location="RIGHT",e.parent.boundaryPlaces.insert(c),
d+=1,k+=1,b=k*(e.getHeight()+3);return this};AdamActivity.prototype.setBoundary=function(a,b){var c=this.boundaryPlaces.get(b);c.available=!1;a.setPosition(c.x,c.y);return this};AdamActivity.prototype.getAvailableBoundaryPlace=function(){var a=0,b,c=!0,d;for(d=0;d<this.boundaryPlaces.getSize();d+=1)b=this.boundaryPlaces.get(d),b.available&&c&&(a=b.number,c=!1);c&&(a=!1);return a};
AdamActivity.prototype.updateBoundaryPlaces=function(){var a,b,c=0;b=new jCore.ArrayList;for(a=0;a<this.boundaryPlaces.getSize();a+=1)b.insert(this.boundaryPlaces.get(a));this.boundaryPlaces.clear();this.makeBoundaryPlaces();for(a=0;a<this.boundaryPlaces.getSize();a+=1)c<b.getSize()&&(this.boundaryPlaces.get(a).available=b.get(c).available,c+=1);return this};
AdamActivity.prototype.getNumberOfBoundaries=function(){var a,b,c=0;for(b=0;b<this.getChildren().getSize();b+=1)a=this.getChildren().get(b),"AdamEvent"===a.getType()&&"BOUNDARY"===a.evn_type&&(c+=1);return c};
AdamActivity.prototype.updateBoundaryPositions=function(a){var b,c,d,e;if(0<this.getNumberOfBoundaries())for(this.updateBoundaryPlaces(),d=0;d<this.getChildren().getSize();d+=1)if(b=this.getChildren().get(d),"AdamEvent"===b.getType()&&"BOUNDARY"===b.evn_type)for(b.setPosition(this.boundaryPlaces.get(b.numberRelativeToActivity).x,this.boundaryPlaces.get(b.numberRelativeToActivity).y),e=0;e<b.ports.getSize();e+=1)c=b.ports.get(e),c.setPosition(c.x,c.y),c.connection.disconnect().connect(),a&&(c.connection.setSegmentMoveHandlers(),
c.connection.checkAndCreateIntersectionsWithAll())};AdamActivity.prototype.addMarkers=function(a,b){var c,d;if(_.isArray(a))for(d=0;d<a.length;d+=1)c=a[d],c.parent=b,c.canvas=b.canvas,c=new AdamMarker(c),this.markersArray.insert(c);return this};AdamActivity.prototype.paint=function(){var a,b;AdamShape.prototype.paint.call(this);for(a=0;a<this.markersArray.getSize();a+=1)b=this.markersArray.get(a),b.paint()};AdamActivity.prototype.getActivityType=function(){return this.act_type};
AdamActivity.prototype.getContextMenu=function(){var a=this,b,c,d,e=this.getDestElements(),g=1<e.length?!1:!0,h,f=[],k,p,t,q,m=[],l,n,y,r,w,z;b=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_DELETE"),cssStyle:"adam-menu-icon-delete",handler:function(){var b;if(b=a.canvas.customShapes.find("id",a.id))b.canvas.emptyCurrentSelection(),b.canvas.addToSelection(b),b.canvas.removeElements()}});l=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_UNASSIGNED"),cssStyle:"adam-menu-script-none",handler:function(){a.updateScriptType("NONE")},
disabled:"NONE"===this.act_script_type});n=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_ASSIGN_USER"),cssStyle:"adam-menu-script-assign_user",handler:function(){a.updateScriptType("ASSIGN_USER")},disabled:"ASSIGN_USER"===this.act_script_type});y=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_ASSIGN_TEAM"),cssStyle:"adam-menu-script-assign_team",handler:function(){a.updateScriptType("ASSIGN_TEAM")},disabled:"ASSIGN_TEAM"===this.act_script_type});r=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_CHANGE_FIELD"),
cssStyle:"adam-menu-script-change_field",handler:function(){a.updateScriptType("CHANGE_FIELD")},disabled:"CHANGE_FIELD"===this.act_script_type});w=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_ADD_RELATED_RECORD"),cssStyle:"adam-menu-script-add_related_record",handler:function(){a.updateScriptType("ADD_RELATED_RECORD")},disabled:"ADD_RELATED_RECORD"===this.act_script_type});z=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_BUSINESS_RULE"),cssStyle:"adam-menu-script-business_rule",handler:function(){a.updateScriptType("BUSINESS_RULE")},
disabled:"BUSINESS_RULE"===this.act_script_type});c="USERTASK"===this.act_task_type?this.createConfigurateAction():this.actionFactory(this.act_script_type);d=this.createAssignUsersAction();if(1<e.length){t=function(b){return function(){var c=new CommandDefaultFlow(a,b);c.execute();a.canvas.commandStack.add(c)}};h=new Action({text:translate("LBL_PMSE_CONTEXT_MENU_NONE"),cssStyle:"adam-menu-icon-none",handler:t(""),disabled:0!==a.act_default_flow?!1:!0});f.push(h);for(h=0;h<this.getPorts().getSize();h+=
1)if(p=this.getPorts().get(h),q=p.connection,q.srcPort.parent.getID()===this.getID()){p=q.destPort.parent;switch(p.getType()){case "AdamActivity":k=""!==p.getName()?p.getName():translate("LBL_PMSE_CONTEXT_MENU_DEFAULT_TASK");break;case "AdamEvent":k=""!==p.getName()?p.getName():translate("LBL_PMSE_CONTEXT_MENU_DEFAULT_EVENT");break;case "AdamGateway":k=""!==p.getName()?p.getName():translate("LBL_PMSE_CONTEXT_MENU_DEFAULT_GATEWAY")}f.push(new Action({text:k,cssStyle:a.getCanvas().getTreeItem(p).icon,
handler:t(q.getID()),disabled:a.act_default_flow===q.getID()?!0:!1}))}t={label:translate("LBL_PMSE_CONTEXT_MENU_DEFAULT_FLOW"),icon:"adam-menu-icon-default-flow",disabled:g,menu:{items:f}}}c=[c];"USERTASK"===this.act_task_type&&c.push({jtype:"separator"},d);c.push({jtype:"separator"});"SCRIPTTASK"===this.act_task_type&&(m.push(l),m.push(z),m.push(n,y,r,w),c.push({label:translate("LBL_PMSE_CONTEXT_MENU_ACTION_TYPE"),icon:"adam-menu-icon-convert",menu:{items:m}},{jtype:"separator"}));1<e.length&&"USERTASK"===
this.act_task_type?c.push(t,{jtype:"separator"},b):c.push(b);return{items:c}};AdamActivity.prototype.updateDefaultFlow=function(a){this.act_default_flow=a;return this};AdamActivity.prototype.updateTaskType=function(a){var b;b=this.getMarkers().get(0);a=new AdamShapeMarkerCommand(this,{markers:[b],type:"changeactivitymarker",changes:{taskType:a}});a.execute();this.canvas.commandStack.add(a);return this};
AdamActivity.prototype.updateScriptType=function(a){var b;b=this.getLayers().get(1);a=new AdamShapeLayerCommand(this,{layers:[b],type:"changescripttypeactivity",changes:a});a.execute();this.canvas.commandStack.add(a);return this};AdamActivity.prototype.applyZoom=function(){var a,b;AdamShape.prototype.applyZoom.call(this);for(a=0;a<this.markersArray.getSize();a+=1)b=this.markersArray.get(a),b.applyZoom();return this};
AdamActivity.prototype.createConfigurateAction=function(){var a,b,c,d=this,e,g,h,f=this,k=translate("LBL_PMSE_CONTEXT_MENU_FORMS"),p,t,q,m,l,n,y,r,w,z,A,u,v,x,B,C,s;s=new MessagePanel({title:"Confirm",wtype:"Confirm",message:translate("LBL_PMSE_MESSAGE_CANCELCONFIRM")});a=new Window({width:510,height:"USERTASK"===this.act_task_type?340:150,modal:!0,title:translate("LBL_PMSE_FORM_TITLE_ACTIVIY")+": "+this.getName()});"USERTASK"===this.act_task_type?(t="adam-menu-icon-form",e=new SugarProxy({url:"pmse_Project/ActivityDefinition/"+
this.id,uid:this.id,callback:null,data2:{hola:"hola"}}),g=new ItemMatrixField({jtype:"itemmatrix",label:translate("LBL_PMSE_ADAM_DESIGNER_READONLY_FIELDS"),name:"act_readonly_fields",submit:!0,fieldWidth:350,fieldHeight:200,visualStyle:"table",nColumns:2}),c=new Form({items:[g],closeContainerOnSubmit:!0,labelWidth:"16%",buttons:[{jtype:"submit",caption:translate("LBL_PMSE_BUTTON_SAVE")},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_CANCEL"),handler:function(){c.isDirty()?(s.setButtons([{jtype:"normal",
caption:translate("LBL_PMSE_BUTTON_YES"),handler:function(){s.hide();a.close()}},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_NO"),handler:function(){s.hide()}}]),s.show()):a.close()}}],language:PMSE_DESIGNER_FORM_TRANSLATIONS}),g=new ItemMatrixField({jtype:"itemmatrix",label:translate("LBL_PMSE_ADAM_DESIGNER_REQUIRED_FIELDS"),name:"act_required_fields",submit:!0,fieldWidth:350,fieldHeight:200,visualStyle:"table",nColumns:2}),z=new Form({items:[g],closeContainerOnSubmit:!0,labelWidth:"16%",
buttons:[{jtype:"submit",caption:translate("LBL_PMSE_BUTTON_SAVE")},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_CANCEL"),handler:function(){c.isDirty()?(s.setButtons([{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_YES"),handler:function(){s.hide();a.close()}},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_NO"),handler:function(){s.hide()}}]),s.show()):a.close()}}]}),A=new Form({closeContainerOnSubmit:!0,labelWidth:"100%",buttons:[{jtype:"submit",caption:translate("LBL_PMSE_BUTTON_SAVE")},
{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_CANCEL"),handler:function(){c.isDirty()?(s.setButtons([{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_YES"),handler:function(){s.hide();a.close()}},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_NO"),handler:function(){s.hide()}}]),s.show()):a.close()}}]}),v=new HiddenField({name:"act_expected_time"}),u=function(){var a={time:"",unit:""};a.time=x.value;a.unit=B.value;v.setValue(a)},x=new NumberField({name:"evn_criteria",label:translate("LBL_PMSE_LABEL_DURATION"),
helpTooltip:{message:translate("LBL_PMSE_TOOLTIP_DURATION")},fieldWidth:"50px",submit:!1,change:u}),B=new ComboboxField({name:"evn_params",label:translate("LBL_PMSE_LABEL_UNIT"),options:[{text:translate("LBL_PMSE_FORM_OPTION_DAYS"),value:"day"},{text:translate("LBL_PMSE_FORM_OPTION_HOURS"),value:"hour"},{text:translate("LBL_PMSE_FORM_OPTION_MINUTES"),value:"minute"}],initialValue:"hour",submit:!1,change:u}),g=[v,x,B],C=new Form({items:g,closeContainerOnSubmit:!0,buttons:[{jtype:"submit",caption:translate("LBL_PMSE_BUTTON_SAVE")},
{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_CANCEL"),handler:function(){C.isDirty()?(s.setButtons([{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_YES"),handler:function(){s.hide();a.close()}},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_NO"),handler:function(){s.hide()}}]),s.show()):a.close()}}],language:PMSE_DESIGNER_FORM_TRANSLATIONS}),h=function(){switch(this.name){case "combo_teams":m.setValue(l.value);break;case "combo_teams_1":m.setValue(n.value)}},p=new ComboboxField({name:"act_type",
label:translate("LBL_PMSE_FORM_FORM_TYPE"),required:!0,proxy:new SugarProxy({url:"pmse_Project/CrmData/dynaforms/"+adamUID,uid:adamUID,callback:null})}),q=new ComboboxField({name:"act_response_buttons",label:translate("LBL_PMSE_FORM_LABEL_RESPONSE_BUTTONS"),required:!1}),g=new LabelField({name:"lblAssigment",label:translate("LBL_PMSE_FORM_LABEL_OTHER_DERIVATION_OPTIONS"),options:{marginLeft:35}}),r=new CheckboxField({name:"act_reassign",label:translate("LBL_PMSE_FORM_LABEL_RECORD_OWNERSHIP"),required:!1,
value:!1,options:{labelAlign:"right",marginLeft:80},change:function(){$(r.html).children("input").is(":checked")?l.setReadOnly(!1):l.setReadOnly(!0)}}),l=new ComboboxField({name:"act_reassign_team",label:translate("LBL_PMSE_FORM_LABEL_TEAM"),required:!1,readOnly:!0,change:h,proxy:new SugarProxy({url:"pmse_Project/CrmData/teams/reassign",uid:"reassign",callback:null})}),w=new CheckboxField({name:"act_adhoc",label:translate("LBL_PMSE_FORM_LABEL_REASSIGN"),required:!1,value:!1,options:{labelAlign:"right",
marginLeft:80},change:function(){$(w.html).children("input").is(":checked")?n.setReadOnly(!1):n.setReadOnly(!0)}}),n=new ComboboxField({name:"act_adhoc_team",label:translate("LBL_PMSE_FORM_LABEL_TEAM"),required:!1,readOnly:!0,change:h}),y=new ComboboxField({name:"act_adhoc_behavior",label:translate("LBL_PMSE_FORM_LABEL_TYPE"),required:!1,readOnly:!0}),m=new HiddenField({name:"act_adhoc_reassign_team"}),new HiddenField({name:"act_reassignment_type"}),g=[p,q,g,r,l,w,n],h={submit:function(a){a=c.getData();
var d=b.getData(),g=C.getData(),f=z.getData();A.getData();a.act_readonly_fields=JSON.parse(a.act_readonly_fields);f.act_required_fields=JSON.parse(f.act_required_fields);$.extend(!0,d,a);$.extend(!0,d,g);$.extend(!0,d,f);e.sendData(d)},loaded:function(g){var f=[],h=[{text:translate("LBL_PMSE_FORM_OPTION_APPROVE_REJECT"),value:"APPROVE"},{text:translate("LBL_PMSE_FORM_OPTION_ROUTE"),value:"ROUTE"}],k=[{text:translate("LBL_PMSE_FORM_OPTION_ONE_WAY"),value:"ONE_WAY"},{text:translate("LBL_PMSE_FORM_OPTION_ROUND_TRIP"),
value:"ROUND_TRIP"}],t=c.items[0],m=z.items[0],s,C=[],v=[],A=[],D=[];e.getData({module:PROJECT_MODULE},{success:function(c){d.canvas.emptyCurrentSelection();for(s=0;s<c.act_readonly_fields.length;s+=1)A.push({text:c.act_readonly_fields[s].label,value:c.act_readonly_fields[s].name}),c.act_readonly_fields[s].readonly&&C.push(c.act_readonly_fields[s].name);t.getHTML();t.setList(A,C);for(s=0;s<c.act_required_fields.length;s+=1)D.push({text:c.act_required_fields[s].label,value:c.act_required_fields[s].name}),
c.act_required_fields[s].required&&v.push(c.act_required_fields[s].name);m.getHTML();m.setList(D,v);p.proxy.getData(null,{success:function(a){f=f.concat(a.result);p.setOptions(f)}});l.proxy.getData(null,{success:function(b){l.setOptions(b.result);n.setOptions(b.result);App.alert.dismiss("upload");a.html.style.display="inline"}});q.setOptions(h);y.setOptions(k);r.setValue(!1);w.setValue(!1);c&&(c.act_expected_time&&(x.setValue(c.act_expected_time.time),B.setValue(c.act_expected_time.unit),u()),c.act_type&&
p.setValue(c.act_type),c.act_response_buttons&&q.setValue(c.act_response_buttons),c.act_reassign&&"1"===c.act_reassign&&(r.setValue(!0),$(r.html).children("input").prop("checked",!0),l.setReadOnly(!1),c.act_reassign_team&&(l.setValue(c.act_reassign_team),$(l.html).children("select").val(c.act_reassign_team))),c.act_adhoc&&"1"===c.act_adhoc&&(w.setValue(!0),$(w.html).children("input").prop("checked",!0),n.setReadOnly(!1),c.act_adhoc_team&&(n.setValue(c.act_adhoc_team),$(n.html).children("select").val(c.act_adhoc_team))),
b.proxy=null)}})}},c.setCallback({submit:h.submit}),C.setCallback({submit:h.submit}),z.setCallback({submit:h.submit}),A.setCallback({submit:h.submit})):(t="adam-menu-icon-configure",e=null,k="Configuration...",g=[{jtype:"textarea",required:!1,fieldWidth:"250px",fieldHeight:"100px",label:translate("LBL_PMSE_FORM_LABEL_SCRIPT"),name:"act_script",helpTooltip:{message:"Enter the PHP code script"}}],h={submit:function(a){f.act_script!==a.act_script&&f.updateScript(a.act_script)},loaded:function(){d.canvas.emptyCurrentSelection();
var a={};a.act_script=f.act_script;b.data=a;b.applyData(!0)}});b=new Form({items:g,closeContainerOnSubmit:!0,buttons:[{jtype:"submit",caption:translate("LBL_PMSE_BUTTON_SAVE")},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_CANCEL"),handler:function(){b.isDirty()?(s.setButtons([{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_YES"),handler:function(){s.hide();a.close()}},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_NO"),handler:function(){s.hide()}}]),s.show()):a.close()}}],callback:h,
language:PMSE_DESIGNER_FORM_TRANSLATIONS});a.addPanel({title:translate("LBL_PMSE_ADAM_DESIGNER_GENERAL_SETTINGS"),panel:b});c&&a.addPanel({title:translate("LBL_PMSE_ADAM_DESIGNER_READONLY_FIELDS"),panel:c});z&&a.addPanel({title:translate("LBL_PMSE_ADAM_DESIGNER_REQUIRED_FIELDS"),panel:z});C&&a.addPanel({title:translate("LBL_PMSE_ADAM_DESIGNER_EXPECTED_TIME"),panel:C});return new Action({text:k,cssStyle:t,handler:function(){d.canvas.project.save();a.show();a.html.style.display="none";App.alert.show("upload",
{level:"process",title:"LBL_LOADING",autoclose:!1})},disabled:!1})};AdamActivity.prototype.updateScript=function(a){a=new CommandAdam(this,["act_script"],[a]);a.execute();this.canvas.commandStack.add(a);return this};
AdamActivity.prototype.createAssignUsersAction=function(){var a=this,b,c,d,e,g,h,f,k,p,t;t=new MessagePanel({title:"Confirm",wtype:"Confirm",message:translate("LBL_PMSE_MESSAGE_CANCELCONFIRM")});p=new SugarProxy({url:"pmse_Project/ActivityDefinition/"+this.id,uid:this.id,callback:null});k=function(){switch(this.name){case "combo_teams":e.setValue(h.value);d.setValue(null);break;case "combo_users":e.setValue(null),d.setValue(g.value)}};e=new HiddenField({name:"act_assign_team"});d=new HiddenField({name:"act_assign_user"});
g=new ComboboxField({jtype:"combobox",label:translate("LBL_PMSE_FORM_LABEL_ASSIGN_TO_USER"),name:"combo_users",submit:!1,change:k,proxy:new SugarProxy({url:"pmse_Project/CrmData/users",uid:null,callback:null})});h=new ComboboxField({jtype:"combobox",label:translate("LBL_PMSE_FORM_LABEL_ASSIGN_TO_TEAM"),name:"combo_teams",submit:!1,change:k,proxy:new SugarProxy({url:"pmse_Project/CrmData/teams/public",uid:"public",callback:null})});f=new ComboboxField({jtype:"combobox",name:"act_assignment_method",
label:translate("LBL_PMSE_FORM_LABEL_ASSIGNMENT_METHOD"),change:function(){"static"===f.value?(g.setReadOnly(!1),h.setReadOnly(!0)):(g.setReadOnly(!0),h.setReadOnly(!1))},options:[{text:translate("LBL_PMSE_FORM_OPTION_ROUND_ROBIN"),value:"balanced"},{text:translate("LBL_PMSE_FORM_OPTION_SELF_SERVICE"),value:"selfservice"},{text:translate("LBL_PMSE_FORM_OPTION_STATIC_ASSIGNMENT"),value:"static"}],initialValue:"balanced",required:!0});c=new Form({items:[f,h,g,d,e],closeContainerOnSubmit:!0,buttons:[{jtype:"submit",
caption:translate("LBL_PMSE_BUTTON_SAVE")},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_CANCEL"),handler:function(){c.isDirty()?(t.setButtons([{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_YES"),handler:function(){t.hide();b.close()}},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_NO"),handler:function(){t.hide()}}]),t.show()):b.close()}}],callback:{submit:function(a){fData=c.getData();p.sendData(fData)},loaded:function(k){p.getData({module:PROJECT_MODULE},{success:function(k){var l=
[{text:translate("LBL_PMSE_FORM_OPTION_CURRENT_USER"),value:"currentuser"},{text:translate("LBL_PMSE_FORM_OPTION_RECORD_OWNER"),value:"owner"},{text:translate("LBL_PMSE_FORM_OPTION_SUPERVISOR"),value:"supervisor"}];a.canvas.emptyCurrentSelection();h.proxy.getData(null,{success:function(a){h.setOptions(a.result);e.setValue(k.act_assign_team||a.result[0].value)}});g.proxy.getData(null,{success:function(a){l=l.concat(a.result);g.setOptions(l);App.alert.dismiss("upload");b.html.style.display="inline";
d.setValue(k.act_assign_user||l[0].value)}});k&&(f.setValue(k.act_assignment_method),"static"===k.act_assignment_method?(g.setValue(k.act_assign_user),g.setReadOnly(!1),h.setReadOnly(!0)):(h.setValue(k.act_assign_team),g.setReadOnly(!0),h.setReadOnly(!1)));c.proxy=null}})}},language:PMSE_DESIGNER_FORM_TRANSLATIONS});b=new Window({width:500,height:350,title:translate("LBL_PMSE_FORM_USER_DEFINITION")+": "+this.getName(),modal:!0});b.addPanel(c);return new Action({text:translate("LBL_PMSE_CONTEXT_MENU_USERS"),
cssStyle:"adam-menu-icon-user",handler:function(){a.canvas.project.save();b.show();b.html.style.display="none";App.alert.show("upload",{level:"process",title:"LBL_LOADING",autoclose:!1})},disabled:!1})};
AdamActivity.prototype.actionFactory=function(a){var b,c,d=this,e,g,h=null,f=[],k={},p=!1,t="",q,m,l="30%",n,y,r,w,z,A,u,v;A=new MessagePanel({title:"Confirm",wtype:"Confirm",message:translate("LBL_PMSE_MESSAGE_CANCELCONFIRM")});switch(a){case "NONE":b=translate("LBL_PMSE_CONTEXT_MENU_SETTINGS");p=!0;c="adam-menu-icon-configure";break;case "ASSIGN_USER":n=new ComboboxField({jtype:"combobox",label:translate("LBL_PMSE_FORM_LABEL_ASSIGN_TO_USER"),name:"act_assign_user",submit:!0,proxy:new SugarProxy({url:"pmse_Project/CrmData/users",
uid:null,callback:null}),required:!0});v=new CheckboxField({name:"act_update_record_owner",label:translate("LBL_PMSE_FORM_LABEL_UPDATE_RECORD_OWNER"),required:!1,value:!1,options:{labelAlign:"right",marginLeft:80}});h=new SugarProxy({url:"pmse_Project/ActivityDefinition/"+this.id,uid:this.id,callback:null});f=[n,v];q=500;m=160;b=translate("LBL_PMSE_CONTEXT_MENU_SETTINGS");c="adam-menu-icon-configure";k={loaded:function(a){var b=[{text:"Select...",value:""}];d.canvas.emptyCurrentSelection();n.proxy.getData(null,
{success:function(c){b=b.concat(c.result);n.setOptions(b);a&&(n.setValue(a.act_assign_user||b[0].value),a.act_update_record_owner&&1==a.act_update_record_owner&&(v.setValue(!0),$(v.html).children("input").prop("checked",!0)));App.alert.dismiss("upload");e.html.style.display="inline"}})}};t=translate("LBL_PMSE_FORM_LABEL_ASSIGN_USER")+": "+this.getName();break;case "ASSIGN_TEAM":y=new ComboboxField({jtype:"combobox",label:translate("LBL_PMSE_FORM_LABEL_ASSIGN_TO_TEAM"),name:"act_assign_team",submit:!0,
proxy:new SugarProxy({url:"pmse_Project/CrmData/teams/public",uid:"public",callback:null})});v=new CheckboxField({name:"act_update_record_owner",label:translate("LBL_PMSE_FORM_LABEL_UPDATE_RECORD_OWNER"),required:!1,value:!1,options:{labelAlign:"right",marginLeft:80}});new ComboboxField({jtype:"combobox",name:"act_assignment_method",label:translate("LBL_PMSE_FORM_LABEL_ASSIGNMENT_METHOD"),options:[{text:translate("LBL_PMSE_FORM_OPTION_ROUND_ROBIN"),value:"balanced"},{text:translate("LBL_PMSE_FORM_OPTION_SELF_SERVICE"),
value:"selfservice"}],initialValue:"balanced",editable:!1,readOnly:!0});b=new HiddenField({name:"act_assignment_method",initialValue:"balanced"});h=new SugarProxy({url:"pmse_Project/ActivityDefinition/"+this.id,uid:this.id,callback:null});f=[y,v,b];q=500;m=160;b=translate("LBL_PMSE_CONTEXT_MENU_SETTINGS");c="adam-menu-icon-configure";k={loaded:function(a){d.canvas.emptyCurrentSelection();y.proxy.getData(null,{success:function(b){console.log(b);y.setOptions(b.result);a&&(y.setValue(a.act_assign_team||
b.result[0].value),a.act_update_record_owner&&1==a.act_update_record_owner&&(v.setValue(!0),$(v.html).children("input").prop("checked",!0)));App.alert.dismiss("upload");e.html.style.display="inline"}})}};t=translate("LBL_PMSE_FORM_LABEL_ASSIGN_TEAM")+": "+this.getName();break;case "CHANGE_FIELD":l="20%";b=function(){App.alert.show("upload",{level:"process",title:"LBL_LOADING",autoclose:!1});u.proxy.url="pmse_Project/CrmData/fields/"+r.value;u.proxy.getData(null,{success:function(a){App.alert.dismiss("upload");
a&&u.setOptions(a.result,!0)}})};r=new ComboboxField({label:translate("LBL_PMSE_LABEL_MODULE"),name:"act_field_module",submit:!0,change:b,proxy:new SugarProxy({url:"pmse_Project/CrmData/related/"+PROJECT_MODULE,uid:PROJECT_MODULE,callback:null})});u=new UpdaterField({label:translate("LBL_PMSE_LABEL_FIELDS"),name:"act_fields",submit:!0,proxy:new SugarProxy({url:"pmse_Project/CrmData/fields/"+PROJECT_MODULE,uid:null,callback:null}),fieldWidth:470,fieldHeight:260,hasCheckbox:!0});q=670;m=400;b=translate("LBL_PMSE_CONTEXT_MENU_SETTINGS");
c="adam-menu-icon-configure";f=[r,u];h=new SugarProxy({url:"pmse_Project/ActivityDefinition/"+this.id,uid:this.id,callback:null});t=translate("LBL_PMSE_LABEL_CHANGE_FIELDS")+": "+this.getName();k={loaded:function(a){var b=[{text:"<<"+translate("LBL_PMSE_ADAM_UI_LBL_TARGET_MODULE")+">>",value:PROJECT_MODULE}];d.canvas.emptyCurrentSelection();r.proxy.getData(null,{success:function(c){c&&c.success&&(b=b.concat(c.result),r.setOptions(b),u.proxy.uid=PROJECT_MODULE,w=a.act_field_module||PROJECT_MODULE,
u.proxy.url="pmse_Project/CrmData/fields/"+w,u.proxy.getData(null,{success:function(b){b&&(u.setPanelList(b.result),u.setOptions(b.result,!0),u.setValue(a.act_fields||null),App.alert.dismiss("upload"),e.html.style.display="inline")}}))}})}};break;case "ADD_RELATED_RECORD":l="20%";b=function(){App.alert.show("upload",{level:"process",title:"LBL_LOADING",autoclose:!1});u.proxy.uid=r.value;u.proxy.url="pmse_Project/CrmData/addRelatedRecord/"+r.value;u.proxy.getData(null,{success:function(a){App.alert.dismiss("upload");
a&&u.setOptions(a.result,!0)}})};r=new ComboboxField({jtype:"combobox",label:translate("LBL_PMSE_FORM_LABEL_RELATED_MODULE"),name:"act_field_module",submit:!0,change:b,proxy:new SugarProxy({url:"pmse_Project/CrmData/related/"+PROJECT_MODULE,uid:PROJECT_MODULE,callback:null})});u=new UpdaterField({label:translate("LBL_PMSE_LABEL_FIELDS"),name:"act_fields",submit:!0,proxy:new SugarProxy({url:"pmse_Project/CrmData/addRelatedRecord/"+PROJECT_MODULE,uid:null,callback:null}),fieldWidth:470,fieldHeight:260});
q=680;m=420;b=translate("LBL_PMSE_CONTEXT_MENU_SETTINGS");c="adam-menu-icon-configure";f=[r,u];h=new SugarProxy({url:"pmse_Project/ActivityDefinition/"+this.id,uid:this.id,callback:null});t=translate("LBL_PMSE_FORM_TITLE_ADD_RELATED_RECORD")+": "+this.getName();k={loaded:function(a){d.canvas.emptyCurrentSelection();r.proxy.getData(null,{success:function(b){b&&b.success&&(r.setOptions(b.result),w=a.act_field_module||b.result[0].value,u.proxy.uid=PROJECT_MODULE,u.proxy.url="pmse_Project/CrmData/addRelatedRecord/"+
w,u.proxy.getData(null,{success:function(b){u.setOptions(b.result);u.setPanelList(b.result);u.setValue(a.act_fields||null);App.alert.dismiss("upload");e.html.style.display="inline"}}))}})}};break;case "BUSINESS_RULE":z=new ComboboxField({label:translate("LBL_PMSE_LABEL_RULE"),name:"act_fields",submit:!0,proxy:new SugarProxy({url:"pmse_Project/CrmData/rulesets/"+adamUID,uid:adamUID,callback:null})}),h=new HiddenField({name:"act_field_module",initialValue:PROJECT_MODULE}),q=500,m=140,b=translate("LBL_PMSE_CONTEXT_MENU_SETTINGS"),
c="adam-menu-icon-configure",f=[z,h],h=new SugarProxy({url:"pmse_Project/ActivityDefinition/"+this.id,uid:this.id,callback:null}),t=translate("LBL_PMSE_CONTEXT_MENU_BUSINESS_RULE")+": "+this.getName(),k={loaded:function(a){var b=[{text:translate("LBL_PMSE_OPTION_SELECT"),value:"",selected:!0}];d.canvas.emptyCurrentSelection();z.proxy.getData(null,{success:function(c){c&&c.success&&(b=b.concat(c.result),z.setOptions(b),a&&z.setValue(a.act_fields||""));App.alert.dismiss("upload");e.html.style.display=
"inline"}})}}}g=new Form({proxy:h,items:f,closeContainerOnSubmit:!0,buttons:[{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_SAVE"),handler:function(){g.submit()}},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_CANCEL"),handler:function(){g.isDirty()?(A.setButtons([{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_YES"),handler:function(){A.hide();e.close()}},{jtype:"normal",caption:translate("LBL_PMSE_BUTTON_NO"),handler:function(){A.hide()}}]),A.show()):e.close()}}],labelWidth:l,callback:k,
language:PMSE_DESIGNER_FORM_TRANSLATIONS});e=new Window({width:q,height:m,title:t,modal:!0});e.addPanel(g);return new Action({text:b,cssStyle:c,handler:function(){d.canvas.project.save();e.show();e.html.style.display="none";App.alert.show("upload",{level:"process",title:"LBL_LOADING",autoclose:!1})},disabled:p})};var AdamArtifact=function(a){AdamShape.call(this,a);this.art_category_ref=this.art_uid=this.art_type=null;AdamArtifact.prototype.initObject.call(this,a)};AdamArtifact.prototype=new AdamShape;
AdamArtifact.prototype.type="AdamArtifact";AdamArtifact.prototype.adamArtifactResizeBehavior=null;AdamArtifact.prototype.resizeBehaviorFactory=function(a){return"adamArtifactResize"===a?(this.adamArtifactResizeBehavior||(this.adamArtifactResizeBehavior=new AdamArtifactResizeBehavior),this.adamArtifactResizeBehavior):AdamShape.prototype.resizeBehaviorFactory.call(this,a)};
AdamArtifact.prototype.initObject=function(a){var b={art_type:"TEXTANNOTATION"};$.extend(!0,b,a);this.setArtifactType(b.art_type);b.art_name&&this.setName(b.art_name);this.setArtifactUid(b.art_uid||null);this.setCategoryRef(b.art_category_ref||null)};AdamArtifact.prototype.setArtifactType=function(a){this.art_type=a;return this};AdamArtifact.prototype.setCategoryRef=function(a){this.art_category_ref=a;return this};AdamArtifact.prototype.setArtifactUid=function(a){this.art_uid=a;return this};
AdamArtifact.prototype.getDBObject=function(){var a=this.getName();return{art_uid:this.art_uid,art_name:a,art_type:this.art_type,art_category_ref:this.art_category_ref,bou_x:this.x,bou_y:this.y,bou_width:this.width,bou_height:this.height,bou_container:"bpmnDiagram",element_id:this.canvas.dia_id}};AdamArtifact.prototype.createHTML=function(){AdamShape.prototype.createHTML.call(this);this.style.addClasses(["adam_artifact"]);return this.html};AdamArtifact.prototype.paint=function(){};
AdamArtifact.prototype.getArtifactType=function(){return this.art_type};AdamArtifact.prototype.getContextMenu=function(){var a=this;return{items:[new Action({text:"Delete",cssStyle:"adam-menu-icon-delete",handler:function(){var b;if(b=a.canvas.customShapes.find("id",a.id))b.canvas.emptyCurrentSelection(),b.canvas.addToSelection(b),b.canvas.removeElements()}})]}};var PropertiesGrid=function(a){this.element=null;PropertiesGrid.prototype.init.call(this,a)};PropertiesGrid.prototype.type="propertiesGrid";
PropertiesGrid.prototype.init=function(a){this.element=$(a);return this};PropertiesGrid.prototype.load=function(a){this.element.progrid(a);return this};PropertiesGrid.prototype.clear=function(){this.element.empty();return this};PropertiesGrid.prototype.forceFocusOut=function(){try{this.element.find("input, select").trigger("focusout")}catch(a){}};PropertiesGrid.prototype.setWidth=function(a){this.element.progrid("setWidth",a);return this};var AdamArtifactResizeBehavior=function(){};
AdamArtifactResizeBehavior.prototype=new jCore.RegularResizeBehavior;AdamArtifactResizeBehavior.prototype.type="AdamArtifactResizeBehavior";AdamArtifactResizeBehavior.prototype.onResizeStart=function(a){return jCore.RegularResizeBehavior.prototype.onResizeStart.call(this,a)};AdamArtifactResizeBehavior.prototype.onResize=function(a){return function(b,c){jCore.RegularResizeBehavior.prototype.onResize.call(this,a)(b,c)}};
var CommandDefaultFlow=function(a,b){jCore.Command.call(this,a);this.prefix=this.after=this.before=null;CommandDefaultFlow.prototype.initObject.call(this,b)};CommandDefaultFlow.prototype=new jCore.Command;CommandDefaultFlow.prototype.type="CommandDefaultFlow";
CommandDefaultFlow.prototype.initObject=function(a){var b,c;this.prefix={AdamActivity:"act",AdamGateway:"gat"};this.before={defaultDestID:this.receiver[this.prefix[this.receiver.type]+"_default_flow"]||"",connections:[]};this.after={defaultDestID:a,connections:null};c=this.receiver.getPorts();b=c.getSize();for(a=0;a<b;a+=1)this.before.connections.push({id:c.get(a).connection.getID(),condition:c.get(a).connection.getFlowCondition(),type:c.get(a).connection.getFlowType()})};
CommandDefaultFlow.prototype.fireTrigger=function(a){var b,c,d,e,g,h,f=[{id:this.receiver.getID(),type:this.receiver.type,relatedObject:this.receiver,fields:[{field:"default_flow",newVal:this.receiver[this.prefix[this.receiver.type]+"_default_flow"]||0,oldVal:a?this.after.defaultDestID:this.before.defaultDestID}]}];c=this.receiver.getPorts();d=c.getSize();for(b=0;b<d;b+=1)e=c.get(b).connection,g={id:e.getID(),relatedObject:e,type:e.type,fields:[]},h=a?this.after.connections[b].type:this.before.connections[b].type,
e.getFlowType()!==h&&g.fields.push({field:"type",newVal:e.getFlowType(),oldVal:h}),h=a?this.after.connections[b].condition:this.before.connections[b].condition,e.getFlowCondition()!==h&&g.fields.push({field:"condition",newVal:e.getFlowCondition(),oldVal:h}),0<g.fields.length&&f.push(g);this.receiver.getCanvas().triggerDefaultFlowChangeEvent(f)};
CommandDefaultFlow.prototype.execute=function(){var a,b,c,d;this.receiver.setDefaultFlow(""===this.after.defaultDestID?0:this.after.defaultDestID);if(!this.after.connections)for(this.after.connections=[],b=this.receiver.getPorts(),c=b.getSize(),a=0;a<c;a+=1)d=b.get(a).connection,this.after.connections.push({id:d.getID(),condition:d.getFlowCondition(),type:d.getFlowType()});this.fireTrigger()};
CommandDefaultFlow.prototype.undo=function(){var a,b,c;for(a=0;a<this.before.connections.length;a+=1)b=this.receiver.canvas.getConnections().find("id",this.before.connections[a].id),b.setFlowCondition(this.before.connections[a].condition),c=this.before.connections[a].type,b.getFlowType()!==c&&"DEFAULT"!==c&&b.setFlowType(c).changeFlowType(c.toLowerCase());this.receiver.setDefaultFlow(this.before.defaultDestID);this.fireTrigger(!0)};CommandDefaultFlow.prototype.redo=function(){this.execute()};
var CommandConnectionCondition=function(a,b){jCore.Command.call(this,a);this.after=this.before=null;CommandConnectionCondition.prototype.initObject.call(this,b)};CommandConnectionCondition.prototype=new jCore.Command;CommandConnectionCondition.prototype.type="CommandConnectionCondition";CommandConnectionCondition.prototype.initObject=function(a){a=$.trim(a);this.before={condition:this.receiver.getFlowCondition(),type:this.receiver.flo_type};this.after={condition:a,type:a?"CONDITIONAL":"SEQUENCE"}};
CommandConnectionCondition.prototype.updateConditionMarker=function(){this.receiver.getFlowCondition()&&"AdamGateway"!==this.receiver.getSrcPort().parent.type?(this.receiver.setFlowType("CONDITIONAL"),this.receiver.changeFlowType("conditional")):(this.receiver.setFlowType("SEQUENCE"),this.receiver.changeFlowType("sequence"))};
CommandConnectionCondition.prototype.fireTrigger=function(a){var b,c;b=[{field:"condition",oldVal:a?this.after.condition:this.before.condition,newVal:this.receiver.getFlowCondition()}];a=a?this.after.type:this.before.type;c=this.receiver.getFlowType();c!==a&&b.push({field:"type",oldVal:a,newVal:c});this.receiver.canvas.triggerConnectionConditionChangeEvent(this.receiver,b)};
CommandConnectionCondition.prototype.execute=function(){this.receiver.setFlowCondition(this.after.condition);this.updateConditionMarker();this.fireTrigger()};CommandConnectionCondition.prototype.undo=function(){this.receiver.setFlowCondition(this.before.condition);this.updateConditionMarker();this.fireTrigger(!0)};CommandConnectionCondition.prototype.redo=function(){this.execute()};
var AdamCommandReconnect=function(a,b){var c=function(a){jCore.CommandReconnect.call(this,a);c.prototype.initObject.call(this,a,b)};c.prototype=new jCore.CommandReconnect(a);c.prototype.initObject=function(a,b){this.prefix={AdamActivity:"act",AdamGateway:"gat"};this.srcShape=this.receiver.connection.getSrcPort().parent;this.before.type=this.receiver.connection.getFlowType();this.before.condition=this.receiver.connection.getFlowCondition();this.before.defaultFlow="AdamGateway"===this.srcShape.type||
"AdamActivity"===this.srcShape.type?this.srcShape[this.prefix[this.srcShape.type]+"_default_flow"]:"";this.condition=this.after.type=null;this.after.defaultFlow=""};c.prototype.fireTrigger=function(a){var b=[],c=this.receiver.connection,h,f,k;"DEFAULT"!==this.after.type&&"DEFAULT"!==this.before.type||b.push({id:this.srcShape.getID(),relatedObject:this.srcShape,type:this.srcShape.type,fields:[{field:"default_flow",newVal:this.srcShape[this.prefix[this.srcShape.type]+"_default_flow"],oldVal:a?this.after.defaultFlow:
this.before.defaultFlow}]});f={id:c.getID(),relatedObject:c,type:c.type,fields:[]};h=a?this.after.type:this.before.type;k=c.getFlowType();h!==k&&f.fields.push({field:"type",newVal:k,oldVal:h});h=a?this.after.condition:this.before.condition;k=c.getFlowCondition();h!==k&&f.fields.push({field:"condition",newVal:k,oldVal:h});0<f.fields.length&&b.push(f);this.receiver.getCanvas().triggerDefaultFlowChangeEvent(b)};c.prototype.execute=function(){var a=this.receiver.connection;a.setFlowType(this.after.type);
jCore.CommandReconnect.prototype.execute.call(this);if("AdamGateway"===a.getSrcPort().getParent().type||!a.getFlowCondition()&&"AdamArtifact"!==this.srcShape.type&&"AdamArtifact"!==a.getDestPort().parent.type)a.setFlowType("SEQUENCE").changeFlowType("sequence");else if("AdamActivity"===a.getSrcPort().getParent().type&&a.getFlowCondition()&&"AdamArtifact"!==a.getSrcPort().getParent().type&&"AdamArtifact"!==a.getDestPort().getParent().type)a.setFlowType("CONDITIONAL").changeFlowType("conditional");
else if(a.setFlowType("ASSOCIATION").setFlowCondition("").changeFlowType("association"),"AdamActivity"===this.srcShape.type||"AdamGateway"===this.srcShape.type)this.srcShape[this.prefix[this.srcShape.type]+"_default_flow"]="",this.after.defaultFlow="";this.after.type&&this.after.condition||(this.after.type=a.getFlowType(),this.after.condition=a.getFlowCondition());this.fireTrigger()};c.prototype.undo=function(){var a=this.receiver.connection;a.getFlowType();a.getFlowCondition();jCore.CommandReconnect.prototype.undo.call(this);
a.setFlowCondition(this.before.condition).setFlowType(this.before.type).changeFlowType(this.before.type.toLowerCase());this.srcShape.updateDefaultFlow&&this.srcShape.updateDefaultFlow(this.before.defaultFlow);this.fireTrigger(!0)};return new c(a)};
(function(a){function b(b,d){for(var h="",f=0;f<d.length;f++){var k=a("<li>"),h=a("<div>").addClass("treechild").attr({id:f,status:"unmarked"}).css({cursor:"pointer","text-decoration":"none"});h.append(a("<a>").addClass("tree_cat_close category").attr({childid:"c_"+f}).html("&nbsp;&nbsp;&nbsp"));"undefined"!==typeof d[f].icon&&null!==d[f].icon?h.append('<a desc="'+f+'" class="details" name="'+d[f].name+'" uid="'+d[f].id+'" type="'+d[f].type+'"><i class="'+d[f].icon+'"></i> '+d[f].name+"</a>"):h.append('<a desc="'+
f+'" class="details" name="'+d[f].name+'" uid="'+d[f].id+'" type="'+d[f].type+'"><i class="tree-folder-open"></i> '+d[f].name+"</a>");k.append(h);"undefined"!=typeof d[f].items&&null!==d[f].items&&k.append(c(d[f].items,"c_"+f));b.append(k)}}function c(a,b){var d;d=""+('<ul id="'+b+'">');for(var f=0;f<a.length;f++)d+="<li>","undefined"!=typeof a[f].items&&null!==a[f].items?(d+='<div class="treechild" id="'+b+"_"+f+'" status="unmarked" style="cursor:pointer; text-decoration:none;"><a childid = "c_'+
b+"_"+f+'"+ class="tree_cat_close category">&nbsp;&nbsp;&nbsp;</a>',d="undefined"!=a[f].icon&&null!==a[f].icon?d+('<a desc="'+b+"_"+f+'" class="details" name="'+a[f].name+'" uid="'+a[f].id+'" type="'+a[f].type+'"><i class="'+a[f].icon+'"></i> '+a[f].name+"</a>"):d+('<a desc="'+b+"_"+f+'" class="details" name="'+a[f].name+'" uid="'+a[f].id+'" type="'+a[f].type+'"><i class="tree-folder-open"></i> '+a[f].name+"</a>"),d+="</div>",d+=c(a[f].items,"c_"+b+"_"+f)):(d+='<div class="treechild" id="'+b+"_"+
f+'" status="unmarked" style="cursor:pointer; text-decoration:none;"><a class="product">&nbsp;&nbsp;&nbsp;</a>',d="undefined"!=typeof a[f].icon&&null!==a[f].icon?d+('<a desc="'+b+"_"+f+'" class="details" name="'+a[f].name+'" uid="'+a[f].id+'" type="'+a[f].type+'"><i class="'+a[f].icon+'"></i> '+a[f].name+"</a>"):d+('<a desc="'+b+"_"+f+'" class="details" name="'+a[f].name+'" uid="'+a[f].id+'" type="'+a[f].type+'"><i class="tree-folder-open"></i> '+a[f].name+"</a>"),d+="</div>"),d+="</li>";return d+
"</ul>"}var d={init:function(c){var d={container:a(this),id:"root"};return this.each(function(){c&&(d=a.extend(d,c));d.container.append(a("<div>").addClass("content_tree"));var h=a("<ul>").attr({"class":"tree-menu",id:d.id});a(".content_tree").append(h);var f=d.items;"undefined"!=typeof f&&null!==f&&b(h,f);c.collapsed||a("#"+d.id+" ul").each(function(){a(this).css("display","none")});a("#"+d.id+" .category").click(function(){var b="#"+a(this).attr("childid");"none"==a(b).css("display")?a(b).css("display",
"block"):a(b).css("display","none");a(this).hasClass("tree_cat_close")?a(this).removeClass("tree_cat_close").addClass("tree_cat_open"):a(this).removeClass("tree_cat_open").addClass("tree_cat_close")});a(".treechild").hover(function(){if("unmarked"==a(this).attr("status")){var b="#"+a(this).attr("id");a(b).css("background","#EFF5FB")}},function(){if("unmarked"==a(this).attr("status")){var b="#"+a(this).attr("id");a(b).css("background","#fff")}});a(".details").click(function(){var b="#"+a(this).attr("desc");
a(".treechild").attr("status","unmarked");a(".treechild").css("background","#fff");a(b).css("background","#CEE3F6");a(b).attr("status","marked");b={};void 0!==a(this).attr("uid")&&(b.uid=a(this).attr("uid"));void 0!==a(this).attr("name")&&(b.name=a(this).attr("name"));void 0!==a(this).attr("type")&&(b.type=a(this).attr("type"));"undefined"!==typeof d.select&&null!==d.select&&d.select.call(this,b)});a(".treechild > a ").css({"text-decoration":"none"})})},example:function(a,b){}};a.fn.pmtree=function(b){if(d[b])return d[b].apply(this,
Array.prototype.slice.call(arguments,1));if("object"!==typeof b&&b)a.error("Method "+b+" does not exsts!");else return d.init.apply(this,arguments);return!0}})(jQuery);
(function(a){var b={id:null,rows:[],width:"100%",fontSize:"11px",prefix:"progrid",onValueChanged:null,onChangeDiscarded:null,onViewMode:null,onEditMode:null,onRowsInitialized:null,onRowSelected:null,onRowDeselected:null,onGridReady:null},c=0,d=function(b,c){b.name||a.error("name setting is required!");var d=a.extend({label:"",type:"",readOnly:!1,trueLabel:"true",falseLabel:"false",yesNoValueMode:"boolean",validate:"none"},b),e={name:d.name,label:d.label,type:d.type,readOnly:d.readOnly},f=null,g=null,
h=null,y=function(b){"undefined"===typeof b||b?(a(f).find("td").on("selectRow",w),a(f).on("click",function(){a(this).find("td:last").trigger("selectRow")})):(a(f).find("td").off("selectRow",w),a(f).off("click"))},r=function(b){if("undefined"===typeof b||b)a(f).find("td").on("focusout",z);else a(f).find("td").off("focusout",z)},w=function(){var b=a(this).parent().data("rowObject");y(!1);"function"===typeof b.onSelected&&b.onSelected.call(b);b.readOnly?a(f).find("td:last div").focus():b.editMode();
r()},z=function(){var b=a(this).parent().data("rowObject");r(!1);b.editMode(!1,!1);y();"function"===typeof b.onRowDeselected&&b.onRowDeselected.call(b)},A=function(){a(this.getHTML()).find("td:last div").on("focus",function(){a(this.parentNode).trigger("selectRow")}).on("keydown",function(b){b.stopPropagation();13===b.keyCode&&a(this.parentNode).trigger("selectRow")})},u=function(){var b=a(f).find("td:last > *").val();switch(this.type){case "text":b="integer"===d.validate?parseInt(b,10):b;break;case "yesNo":switch(d.yesNoValueMode){case "int":b=
parseInt(b,10);break;case "boolean":b="true"===b?!0:!1}}return b},v=function(){if(!this.readOnly){var a=u.call(this),b=this.getValue();this.editMode(!1);"function"===typeof this.onChangeDiscarded&&a!==b&&this.onChangeDiscarded.call(this,{valueDiscarded:a,currentValue:b})}};e.onValueChanged=null;e.onSelected=null;e.onEditMode=null;e.onViewMode=null;e.onChangeDiscarded=null;e.onRowDeselected=null;e.getValue=function(){return g};e.updateValueText=function(){h=this.getValue();switch(this.type){case "text":h=
g.toString();break;case "yesNo":h=g?d.trueLabel:d.falseLabel;break;case "select":if(!d.options){h="";break}for(i=0;i<d.options.length;i++)if(d.options[i].value===h){h=d.options[i].label;break}}};e.getValueText=function(){return h};e.getHTML=function(){if(!f){var b=this.getValueText();f=document.createElement("tr");a(f).append('<td class="'+c+'-first-col"><div style="width:0px">'+this.label+'</div></td><td class="'+c+'-second-col"><div tabindex="0" style="width:0px">'+(b?b:"")+"</div></td>");a(f).data("rowObject",
this);y(!0);A.call(this)}return f};e.save=function(){if(!d.readOnly){var a=this.getValue(),b=u.call(this);"integer"===d.validate&&"text"===this.type&&(a=parseInt(a,10));if(b!==a&&(g=b,this.updateValueText(),"function"===typeof this.onValueChanged))this.onValueChanged({row:this,newValue:b,previousValue:a});this.editMode(!1)}};e.editMode=function(b,c){var e,h,k=this;h=a(f.parentNode).width();var p=parseInt(a(f).css("font-size"),10);h=h/2-1.82*p;if("undefined"===typeof b||b){switch(this.type){case "text":e=
a("<input>").addClass("input-small").attr({type:"text"}).val(this.getValueText()).css({width:h});if("integer"===d.validate)e.on("keydown",function(a){a.stopPropagation();46==a.keyCode||8==a.keyCode||9==a.keyCode||27==a.keyCode||13==a.keyCode||65==a.keyCode&&!0===a.ctrlKey||35<=a.keyCode&&39>=a.keyCode||(a.shiftKey||(48>a.keyCode||57<a.keyCode)&&(96>a.keyCode||105<a.keyCode))&&a.preventDefault()});break;case "select":e=a("<select>").css({width:"100%"});for(i=0;i<this.options.length;i++)name=this.options[i].label,
e.append(a('<option label="'+name+'" value="'+this.options[i].value+'" '+(this.options[i].value===this.getValue()?'selected="selected"':"")+" "+(this.options[i].disabled?"disabled":"")+" >"+name+"</option>"));break;case "yesNo":"string"===typeof g?(h=g,h="true"===h?!0:!1):h=!!g,e=a("<select>").css({width:"100%"}),e.append(a('<option label="'+d.trueLabel+'" value="'+("int"===d.yesNoValueMode?1:"true")+'" '+(h?'selected="selected"':"")+">"+d.trueLabel+"</option>")),e.append(a('<option label="'+d.falseLabel+
'" value="'+("int"===d.yesNoValueMode?0:"false")+'" '+(h?"":'selected="selected"')+">"+d.falseLabel+"</option>"))}e.on("focusout",function(){k.save()}).on("click",function(a){a.stopPropagation()}).on("keydown",function(a){a.stopPropagation();13===a.keyCode?k.save():27===a.keyCode&&v.call(k)});try{a(f).find("td:last").empty()}catch(q){}a(f).find("td:last").append(e);e.focus();"function"===typeof this.onEditMode&&this.onEditMode.call(this);e.select()}else{try{a(f).find("td:last").empty()}catch(n){}a(f).find("td:last").append(a('<div tabindex="0" style="width: '+
h+'px">'+this.getValueText()+"</div>"));("undefined"===typeof c||c)&&a(f).find("td:last div").focus();A.call(this);"function"===typeof this.onViewMode&&this.onViewMode.call(this)}};c=c||"progrid";"select"===e.type&&(e.options=b.options||[]);switch(e.type){case "text":g="undefined"!==typeof d.value&&null!==d.value&&("int"!==d.validate?d.value.toString():parseInt(d.value,10))||"";break;case "select":if(!d.options){g=null;break}for(i=0;i<d.options.length;i++)if("boolean"===typeof d.options[i].selected&&
d.options[i].selected||"boolean"!==typeof d.options[i].selected&&d.options[i].selected===d.options[i].value){g=d.options[i].value;break}null===g&&d.options[0]&&(g=d.options&&d.options[0].value||null);break;case "yesNo":switch("string"===typeof d.value?(g=d.value.toLowerCase(),g="true"===g?!0:!1):g=!!d.value,d.yesNoValueMode){case "int":g=g?1:0;break;case "literal":g=g?"true":"false"}}e.updateValueText();return e},e=function(b){if("undefined"!==typeof b){var c=parseInt(a(this).find("table.progrid-table").css("font-size"));
isNaN(c)&&(c=0);b=a(this).find("table").find("td div").css({width:"0px"}).end().css({width:b}).width();b=b/2-1.82*c;a(this).find("td div").css({width:b})}},g=function(b){var c,d=!1,e=this.find("tr"),f;for(c=0;c<e.length;c++){for(f=a(e[c]).data("rowObject").label;0<f.length;){if(""===b.label||b.label.charAt(0)<f.charAt(0))d=!0;break}if(d)break}e[c]?a(e[c]).before(b.getHTML()):this.append(b.getHTML())},h=function(b){var e=a(this),f=a(document.createElement("table")),h,m,l;f.css({width:b.width,"font-size":b.fontSize}).addClass("progrid-table").attr({id:b.prefix+
"-propTable-"+c,cellpadding:0,cellspacing:0,border:0});f.append(a("<thead>").append(a("<tr>").append("<th>Name</th>").append("<th>Value</th>")));l=a("<tbody>");for(h=0;h<b.rows.length;h++)m=d(b.rows[h]),m.onSelected=function(){a(this.getHTML()).addClass("row_selected");"function"===typeof b.onRowSelected&&b.onRowSelected.call(e.get(0),{id:b.id,fieldName:this.name,fieldLabel:this.label,fieldType:this.type,value:this.getValue()})},m.onViewMode=function(){"function"===typeof b.onViewMode&&b.onViewMode.call(e.get(0),
{id:b.id,fieldName:this.name,fieldLabel:this.label,fieldType:this.type,value:this.getValue()})},m.onEditMode=function(){"function"===typeof b.onEditMode&&b.onEditMode.call(e.get(0),{id:b.id,fieldName:this.name,fieldLabel:this.label,fieldType:this.type,value:this.getValue()})},m.onRowDeselected=function(){a(this.getHTML()).removeClass("row_selected");"function"===typeof b.onRowDeselected&&b.onRowDeselected.call(e.get(0),{id:b.id,fieldName:this.name,fieldLabel:this.label,fieldType:this.type,value:this.getValue()})},
m.onChangeDiscarded=function(a){"function"===typeof b.onChangeDiscarded&&b.onChangeDiscarded.call(e.get(0),{id:b.id,fieldName:this.name,fieldLabel:this.label,fieldType:this.type,currentValue:a.currentValue,discardedValue:a.valueDiscarded})},m.onValueChanged=function(a){"function"===typeof b.onValueChanged&&b.onValueChanged.call(e.get(0),{id:b.id,fieldName:this.name,fieldLabel:this.label,fieldType:this.type,value:a.newValue,previousValue:a.previousValue})},a(m.getHTML()).addClass(0===h%2?"odd":"even"),
g.call(l,m);f.append(l);"function"===typeof b.onRowsInitialized&&b.onRowsInitialized.call(e.get(0),{rows:b.rows});e.append(f)},f={init:function(d){d=a.extend({},b,d);return this.each(function(){c++;a(this).empty();h.call(this,d);e.call(this,d.width);a(this).trigger("gridready");"function"===typeof d.onGridReady&&d.onGridReady.call(this)})},setWidth:function(a){e.call(this,a)}};a.fn.progrid=function(a){if(f[a])return f[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||
!a)return f.init.apply(this,arguments)}})(jQuery);
