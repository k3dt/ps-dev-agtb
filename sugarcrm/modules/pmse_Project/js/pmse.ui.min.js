var getRelativePosition=function(a,b){var c=$(a).offset(),d=$(b).get(0)instanceof Document?{top:0,left:0}:$(b).offset();return{top:c.top-d.top,left:c.left-d.left}},Base=function(a){var b={id:a&&a.id||jCore.Utils.generateUniqueId()};$.extend(!0,b,a);this.id=b.id};Base.prototype.setId=function(a){this.id=a;return this};Base.prototype.type="Core";Base.prototype.family="Core";Base.prototype.getType=function(){return this.type};Base.prototype.getFamily=function(){return this.family};
Base.prototype.dispose=function(){for(var a in this)this[a]=null};"undefined"!==typeof exports&&(module.exports=Base);var Modal=function(a){Base.call(this,a);this.visible=null;this.loaded=!1;this.clickHander=this.html=null;Modal.prototype.initObject.call(this,a)};Modal.prototype=new Base;Modal.prototype.type="Modal";Modal.prototype.initObject=function(a){var b={visible:!1,clickHander:function(){}};$.extend(!0,b,a);this.setVisible(b.visible).setClickHandler(b.clickHander)};
Modal.prototype.setVisible=function(a){this.visible=a;return this};Modal.prototype.setClickHandler=function(a){this.clickHander=a;return this};Modal.prototype.show=function(){var a;this.html||(a=document.createElement("div"),a.className="adam-modal",a.id=this.id,this.html=a);document.body.appendChild(this.html);this.setVisible(!0);this.loaded||(this.attachListeners(),this.loaded=!0)};Modal.prototype.hide=function(){this.visible&&(document.body.removeChild(this.html),this.setVisible(!1))};
Modal.prototype.attachListeners=function(){var a=this;this.html&&$(this.html).click(function(b){b.stopPropagation();a.clickHander&&a.clickHander()}).mouseover(function(a){a.stopPropagation()}).mouseout(function(a){a.stopPropagation()}).mouseup(function(a){a.stopPropagation()}).mousedown(function(a){a.stopPropagation()})};var Proxy=function(a){Base.call(this,a);this.callback=this.url=null;Proxy.prototype.initObject.call(this,a)};Proxy.prototype=new Base;Proxy.prototype.type="Proxy";
Proxy.prototype.family="Proxy";Proxy.prototype.initObject=function(a){var b={url:null,callback:null};$.extend(!0,b,a);this.setUrl(b.url).setCallback(b.callback)};Proxy.prototype.setUrl=function(a){this.url=a;return this};Proxy.prototype.setCallback=function(a){this.callback=a;return this};Proxy.prototype.getData=function(){console.log("Getting Data from: "+this.url)};Proxy.prototype.sendData=function(a,b){console.log("Sending Data to: "+this.url,a)};
var Element=function(a){Base.call(this,a);this.zOrder=this.visible=this.style=this.html=this.height=this.width=this.y=this.x=null;Element.prototype.initObject.call(this,a)};Element.prototype=new Base;Element.prototype.type="Base";Element.prototype.family="Base";
Element.prototype.initObject=function(a){var b={id:a&&a.id||jCore.Utils.generateUniqueId(),style:{cssProperties:{},cssClasses:[]},width:0,height:0,x:0,y:0,zOrder:1,visible:!0};$.extend(!0,b,a);this.setId(b.id).setStyle(new jCore.Style({belongsTo:this,cssProperties:b.style.cssProperties,cssClasses:b.style.cssClasses})).setDimension(b.width,b.height).setPosition(b.x,b.y).setZOrder(b.zOrder).setVisible(b.visible)};Element.prototype.setId=function(a){this.id=a;this.html&&(this.html.id=this.id);return this};
Element.prototype.setX=function(a){if("number"===typeof a)this.x=a,this.html&&this.style.addProperties({left:this.x});else throw Error("setX: x param is not a number");return this};Element.prototype.setY=function(a){if("number"===typeof a)this.y=a,this.html&&this.style.addProperties({top:this.y});else throw Error("setY: y param is not a number");return this};
Element.prototype.setWidth=function(a){if("number"===typeof a)this.width=a,this.html&&this.style.addProperties({width:this.width});else throw Error("setWidth: w is not a number");return this};Element.prototype.setHeight=function(a){if("number"===typeof a)this.height=a,this.html&&this.style.addProperties({height:this.height});else throw Error("setHeight: h is not a number");return this};Element.prototype.setPosition=function(a,b){this.setX(a);this.setY(b);return this};
Element.prototype.setDimension=function(a,b){this.setWidth(a);this.setHeight(b);return this};Element.prototype.setZOrder=function(a){"number"===typeof a&&0<a&&(this.zOrder=a,this.html&&this.style.addProperties({zIndex:this.zOrder}));return this};Element.prototype.setVisible=function(a){_.isBoolean(a)&&(this.visible=a,this.html&&(a?this.style.addProperties({display:"inline"}):this.style.addProperties({display:"none"})));return this};
Element.prototype.setStyle=function(a){a instanceof jCore.Style&&(this.style=a);return this};Element.prototype.createHTMLElement=function(a){return document.createElement(a)};Element.prototype.createHTML=function(){this.html||(this.html=this.createHTMLElement("div"),this.html.id=this.id,this.style.applyStyle(),this.style.addProperties({position:"absolute",left:this.x,top:this.y,width:this.width,height:this.height,zIndex:this.zOrder}));return this.html};Element.prototype.paint=function(){};
Element.prototype.getHTML=function(){this.html||this.createHTML();return this.html};Element.prototype.calculateWidth=function(a,b){var c=b||"12px arial",d=$(this.createHTMLElement("div"));d.text(a).css({position:"absolute","float":"left","white-space":"nowrap",visibility:"hidden",font:c}).appendTo($("body"));c=d.width();d.remove();return c};var Container=function(a){Element.call(this,a);this.items=[];this.bodyHeight=this.body=null;Container.prototype.initObject.call(this,a)};Container.prototype=new Element;
Container.prototype.type="Container";Container.prototype.family="Container";Container.prototype.initObject=function(a){var b={items:[],body:null};$.extend(!0,b,a);this.setItems(b.items).setBody(b.body).setBodyHeight(b.bodyHeight)};Container.prototype.setItems=function(a){this.items=a;return this};
Container.prototype.setBodyHeight=function(a){this.bodyHeight=a;this.body&&("number"===typeof a?this.body.style.height=a+"px":(this.bodyHeight=null,this.body.style.height=""),this.height=$(this.html).height());return this};Container.prototype.setBody=function(a){this.body=a;return this};Container.prototype.getBody=function(){return this.body};
Container.prototype.createHTML=function(){var a;Element.prototype.createHTML.call(this);a=this.createHTMLElement("div");a.className="j-container";this.html.appendChild(a);this.body=a;this.setBodyHeight(this.bodyHeight);return this.html};
var Window=function(a){Container.call(this,a);this.titleLabelObject=this.closeButtonObject=this.windowHeader=this.modalObject=this.modal=this.title=null;this.loaded=!1;this.closeButton=this.modalHandler=this.destroyOnHide=null;this.panels=[];this.selectedTab=this.tabsContainer=this.modalContainer=null;Window.prototype.initObject.call(this,a)};Window.prototype=new Container;Window.prototype.type="Window";
Window.prototype.initObject=function(a){var b={title:"No Title",modal:!0,modalHandler:null,destroyOnHide:!1,closeButton:!0,panels:[]};$.extend(!0,b,a);this.setTitle(b.title).setModalHandler(b.modalHandler).setModal(b.modal).setVisible(!1).setCloseButton(b.closeButton).setDestroyOnHide(b.destroyOnHide).setPanels(b.panels);this.modalContainer=$("body")};Window.prototype.setTitle=function(a){this.title=a;this.titleLabelObject&&(this.titleLabelObject.innerHTML=a);return this};
Window.prototype.setModalHandler=function(a){this.modalHandler=a;return this};Window.prototype.setModal=function(a){this.modalObject=a?new Modal({clickHandler:this.modalHandler}):null;this.modal=a;return this};Window.prototype.setDestroyOnHide=function(a){this.destroyOnHide=a;return this};Window.prototype.setCloseButton=function(a){this.closeButton=a;return this};
Window.prototype.onTabSelectedHandler=function(){var a=this;return function(){var b;this!==a.selectedTab&&($(a.selectedTab.unselect().getContent().getHTML()).detach(),a.selectedTab=this.select(),b=a.selectedTab.getContent(),b.setHeight($(a.body).innerHeight()),a.body.appendChild(b.getHTML()),"function"===typeof b.load&&b.load())}};
Window.prototype.clearPanels=function(){var a;for(a=0;a<this.panels.length;a+=1)$(this.panels[a].getTab()).remove(),$(this.panels[a].getContent().getHTML()).remove();this.panels=[];return this};Window.prototype.setPanels=function(a){var b;if(!a.hasOwnProperty("length")||"function"!==typeof a.push)return this;this.clearPanels();for(b=0;b<a.length;b+=1)this.addPanel(a[b]);return this};
Window.prototype.addPanel=function(a){var b=a.panel;if(!(a instanceof TabPanelElement))if(a instanceof Panel)b=a,a=new TabPanelElement({content:a});else if(b instanceof Panel)a=new TabPanelElement({title:a.title,content:b});else return this;a.onClick=this.onTabSelectedHandler();a.setParent(this);this.panels.push(a);1===this.panels.length&&(this.selectedTab=a);this.loaded&&(this.tabsContainer.appendChild(a.getTab()),1===this.panels.length&&this.body.appendChild(b.getHTML()));b.setParent(this);return this};
Window.prototype.getPanel=function(a){return this.panels[a]};Window.prototype.getPanels=function(){return this.panels};
Window.prototype.createHTML=function(){var a,b,c,d;Container.prototype.createHTML.call(this);a="-"+parseInt(this.height/2,10)+"px 0 0 -"+parseInt(this.width/2,10)+"px";this.style.addClasses(["adam-window"]);this.style.addProperties({"z-index":1033,left:"50%",top:"50%",margin:a});this.height-=16;this.html.style.height=this.height+"px";c=this.createHTMLElement("div");c.className="adam-window-header";a=this.createHTMLElement("label");a.className="adam-window-title";a.innerHTML=this.title||"&nbsp;";a.title=
a.innerHTML;this.closeButton?(b=this.createHTMLElement("span"),b.className="adam-window-close",c.appendChild(b),this.html.insertBefore(c,this.body),this.closeButtonObject=b):this.html.insertBefore(c,this.body);c.appendChild(a);b=this.createHTMLElement("ul");b.className="adam-tabs";this.html.insertBefore(b,this.body);this.tabsContainer=b;for(d=0;d<this.panels.length;d+=1)b.appendChild(this.panels[d].getTab());1>=d&&(b.style.display="none");this.windowHeader=c;this.titleLabelObject=a;this.body&&(this.body.className=
"adam-window-body",this.body.style.height=this.height-22-(1<d?22:0)+"px");return this.html};Window.prototype.show=function(){var a;this.loaded||this.load();this.modal&&this.modalObject.show();this.selectedTab&&(this.selectedTab.select(),a=this.selectedTab.getContent(),a.setHeight($(this.body).innerHeight()),this.body.appendChild(a.getHTML()),a.load());document.body.appendChild(this.html);this.setVisible(!0)};
Window.prototype.load=function(){this.html||(this.createHTML(),this.attachListeners(),this.loaded=!0)};Window.prototype.close=function(){this.visible&&this.hide();this.dispose&&this.dispose()};Window.prototype.hide=function(a){this.modal&&this.modalObject.hide();document.body.removeChild(this.html);this.setVisible(!1);(a||this.destroyOnHide)&&this.close()};
Window.prototype.attachListeners=function(){var a=this;$(this.html).draggable({cursor:"move",scroll:!1,containment:"document"}).on("keydown keyup keypress",function(a){a.stopPropagation()});this.closeButton&&this.closeButtonObject&&$(this.closeButtonObject).click(function(b){b.stopPropagation();a.hide()})};var TabPanelElement=function(a){Base.call(this,a);this.selected=this.onClick=this.parent=this.content=this.tab=this.title=null;TabPanelElement.prototype.initObject.call(this,a)};
TabPanelElement.prototype.initObject=function(a){var b={title:null,content:null,parent:null,onClick:null};$.extend(!0,b,a);this.onClick=b.onClick;this.setTitle(b.title).setContent(b.content).setParent(b.parent)};TabPanelElement.prototype.setTitle=function(a){this.title=a;return this};TabPanelElement.prototype.getTitle=function(){return this.title};TabPanelElement.prototype.setContent=function(a){a instanceof Panel&&(this.content=a);return this};TabPanelElement.prototype.getContent=function(){return this.content};
TabPanelElement.prototype.setParent=function(a){this.parent=a;return this};TabPanelElement.prototype.getParent=function(){return this.parent};TabPanelElement.prototype.attachListeners=function(){var a=this;$(this.tab).on("click","a",function(a){a.preventDefault()}).on("click",function(){"function"===typeof a.onClick&&a.onClick.call(a)}).on("keydown",function(a){a.stopPropagation()});return this};
TabPanelElement.prototype.createTab=function(){var a,b;if(this.tab)return this.tab;a=document.createElement("li");a.id=this.id;a.className="adam-tab";b=document.createElement("a");b.href="#";this.title?b.appendChild(document.createTextNode(this.title)):b.innerHTML="&nbsp;";a.appendChild(b);this.tab=a;this.attachListeners();return this.tab};TabPanelElement.prototype.getTab=function(){this.tab||(this.createTab(),this.selected?this.select():this.unselect());return this.tab};
TabPanelElement.prototype.isSelected=function(){return this.selected};TabPanelElement.prototype.select=function(){this.selected=!0;this.tab&&$(this.tab).addClass("active");return this};TabPanelElement.prototype.unselect=function(){this.selected=!1;this.tab&&$(this.tab).removeClass("active");return this};var Action=function(a){Base.call(this,a);this.related=this.cssStyle=this.handler=this.hidden=this.disabled=this.text=null;Action.prototype.initObject.call(this,a)};Action.prototype=new Base;
Action.prototype.type="Action";Action.prototype.family="Action";Action.prototype.initObject=function(a){var b={text:null,cssStyle:null,disabled:!1,hidden:!1,handler:function(){},related:null};$.extend(!0,b,a);this.setText(b.text).setCssClass(b.cssStyle).setDisabled(b.disabled).setHidden(b.hidden).setHandler(b.handler).setRelated(b.related)};Action.prototype.setText=function(a){this.text=a;return this};Action.prototype.setHandler=function(a){_.isFunction(a)&&(this.handler=a);return this};
Action.prototype.setCssClass=function(a){this.cssStyle=a;return this};Action.prototype.setDisabled=function(a){_.isBoolean(a)&&(this.disabled=a,this.related&&_.isFunction(this.related.paint)&&this.related.paint());return this};Action.prototype.setHidden=function(a){_.isBoolean(a)&&(this.hidden=a,this.related&&_.isFunction(this.related.paint)&&this.related.paint());return this};Action.prototype.setRelated=function(a){this.related=a;return this};Action.prototype.enable=function(){this.setDisabled(!1)};
Action.prototype.disable=function(){this.setDisabled(!0)};Action.prototype.hide=function(){this.setHidden(!0)};Action.prototype.show=function(){this.setHidden(!1)};Action.prototype.isEnabled=function(){return!this.disabled};Action.prototype.isHidden=function(){return this.hidden};Action.prototype.isAction=!0;
var Menu=function(a){Container.call(this,a);this.items=[];this.currentItem=this.visible=this.canvas=this.parent=this.toolTip=this.state=this.name=null;this.loaded=!1;Menu.prototype.initObject.call(this,a)};Menu.prototype=new Container;Menu.prototype.type="Menu";Menu.prototype.family="Menu";Menu.prototype.initObject=function(a){var b={parent:null,items:[],name:null,state:null,toolTip:null,parentMenu:null,canvas:null,visible:!1,currentItem:null};$.extend(!0,b,a);this.setCanvas(b.canvas).setItems(b.items).setName(b.name).setState(b.state).setParent(b.parent).setToolTip(b.toolTip).setVisible(b.visible).setCurrentItem(b.currentItem)};
Menu.prototype.setItems=function(a){var b,c;for(c=0;c<a.length;c+=1){switch(a[c].jtype){case "separator":b=new SeparatorItem(a[c],this);break;case "checkbox":b=new CheckboxItem(a[c],this);break;default:b=new MenuItem(a[c],this)}this.items.push(b)}this.calculateDimension();return this};Menu.prototype.setName=function(a){this.name=a;return this};Menu.prototype.setState=function(a){this.state=a;return this};Menu.prototype.setToolTip=function(a){this.toolTip=a;return this};
Menu.prototype.setParent=function(a){"object"===typeof a&&(this.parent=a);return this};Menu.prototype.setCanvas=function(a){this.canvas=a;return this};Menu.prototype.setVisible=function(a){this.visible=a;return this};Menu.prototype.setCurrentItem=function(a){this.currentItem&&this.currentItem.hasMenuActive&&(this.currentItem.setFocused(!1),this.currentItem.setHasMenuActive(!1),this.currentItem.setActiveItem(!1),this.currentItem.setActiveMenu(!1));this.currentItem=a;return this};
Menu.prototype.createHTML=function(){Element.prototype.createHTML.call(this);this.style.addClasses(["adam-menu"]);this.setZOrder(1E3);this.generateMenu();return this.html};Menu.prototype.generateMenu=function(){var a,b;b=this.createHTMLElement("ul");b.className="adam-list";for(a=0;a<this.items.length;a+=1)b.appendChild(this.items[a].getHTML());this.html.appendChild(b);return this};Menu.prototype.paint=function(){};
Menu.prototype.show=function(a,b){this.canvas&&(this.loaded||(this.setPosition(a,b),this.calculateItemCoords()),this.canvas.html.appendChild(this.getHTML()),this.loaded||(this.attachListeners(),this.loaded=!0),this.setVisible(!0),"AdamCanvas"===this.parent.type?this.parent.setCurrentMenu(this):"MenuItem"!==this.parent.type&&this.parent.canvas.setCurrentMenu(this))};
Menu.prototype.calculateDimension=function(){var a,b,c,d;b=4;for(c=a=0;c<this.items.length;c+=1){switch(this.items[c].getType()){case "MenuItem":case "CheckboxItem":b+=24;break;case "SeparatorItem":b+=4}d=this.items[c].label||"";""!==d&&(d=this.calculateWidth(d),d>a&&(a=d))}this.setDimension(71+a,b);return this};Menu.prototype.attachListeners=function(){var a;for(a=0;a<this.items.length;a+=1)this.items[a].attachListeners();return this};
Menu.prototype.hide=function(){var a;if(this.canvas&&this.visible){for(a=0;a<this.items.length;a+=1)this.items[a].menu&&this.items[a].menu.hide();this.canvas.html.removeChild(this.getHTML());this.setVisible(!1);"AdamCanvas"===this.parent.type&&this.parent.setCurrentMenu(null)}};
Menu.prototype.calculateItemCoords=function(){var a,b,c;b=2;for(c=0;c<this.items.length;c+=1)switch(this.items[c].getType()){case "CheckboxItem":case "MenuItem":this.items[c].setPosition(this.x,this.y+b);this.items[c].setDimension(this.width-2,24);a=24;b+=a;break;default:this.items[c].setPosition(this.x,b),this.items[c].setDimension(this.width-2,4),a=4,b+=a}};
var Item=function(a,b){Element.call(this,a);this.icon=this.focused=this.disabled=this.toolTip=this.menu=this.parentMenu=this.action=this.label=null;Item.prototype.initObject.call(this,a,b)};Item.prototype=new Element;Item.prototype.type="Item";Item.prototype.family="Item";
Item.prototype.initObject=function(a,b){var c={label:null,menu:null,toolTip:null,parentMenu:b||null,disabled:!1,focused:!1,icon:"adam-menu-icon-empty"};a&&a.isAction?this.loadAction(a,b):($.extend(!0,c,a),this.setLabel(c.label).setToolTip(c.toolTip).setParentMenu(c.parentMenu).setDisabled(c.disabled).setIcon(c.icon).setFocused(c.focused),c.action||(this.action=new Action({text:c.label,cssStyle:c.icon,handler:c.handler})),c.menu&&this.setChildMenu(c.menu))};
Item.prototype.loadAction=function(a,b){this.action=a;this.setLabel(this.action.text);this.setIcon(this.action.cssStyle);this.setDisabled(this.action.disabled);this.setParentMenu(b);this.setFocused(!1);a.menu&&this.setChildMenu(a.menu)};Item.prototype.setLabel=function(a){this.label=a;this.action&&this.action.setText(a);return this};Item.prototype.setIcon=function(a){this.icon=a;this.action&&this.action.setCssClass(a);return this};Item.prototype.paint=function(){};
Item.prototype.setParentMenu=function(a){this.parentMenu=a;return this};Item.prototype.setChildMenu=function(a){a instanceof Menu?(a.setCanvas(this.parentMenu.canvas),a.setParent(this),this.menu=a):(a.canvas=this.parentMenu.canvas,a.parent=this,this.menu=new Menu(a));return this};Item.prototype.setDisabled=function(a){this.disabled=a;return this};Item.prototype.setFocused=function(a){this.focused=a;return this};Item.prototype.setToolTip=function(a){this.toolTip=a;return this};
Item.prototype.createHTML=function(){var a;a=this.createHTMLElement("li");a.className="adam-item";this.disabled&&(a.className+=" adam-disabled");a.id=jCore.Utils.generateUniqueId();return this.html=a};Item.prototype.attachListeners=function(){};Item.prototype.closeMenu=function(){this.parentMenu&&this.parentMenu.canvas&&this.parentMenu.canvas.currentMenu&&this.parentMenu.canvas.currentMenu.hide()};
var CheckboxItem=function(a,b){Item.call(this,a,b);this.itemAnchor=this.checked=null;CheckboxItem.prototype.initObject.call(this,a)};CheckboxItem.prototype=new Item;CheckboxItem.prototype.type="CheckboxItem";CheckboxItem.prototype.initObject=function(a){var b={checked:!1};$.extend(!0,b,a);this.setChecked(b.checked)};CheckboxItem.prototype.setChecked=function(a){_.isBoolean(a)&&(this.checked=a);return this};
CheckboxItem.prototype.createHTML=function(){var a,b;Item.prototype.createHTML.call(this);this.itemAnchor=this.createHTMLElement("a");this.itemAnchor.href="#";a=this.createHTMLElement("span");a.innerHTML=this.label;a.className="adam-label";b=this.createHTMLElement("span");b.className=this.checked?"adam-check-checked":"adam-check-unchecked";this.itemAnchor.appendChild(b);this.itemAnchor.appendChild(a);this.html.appendChild(this.itemAnchor);return this.html};
CheckboxItem.prototype.attachListeners=function(){var a=this;this.html&&$(this.itemAnchor).click(function(b){b.stopPropagation();a.disabled||(a.closeMenu(),a.action.handler(!a.checked))}).mouseover(function(){a.setActiveItem(!0)}).mouseout(function(){a.setActiveItem(!1)}).mouseup(function(a){a.stopPropagation()}).mousedown(function(a){a.stopPropagation()})};
CheckboxItem.prototype.setActiveItem=function(a){this.disabled||(a?(this.style.addClasses(["adam-item-active"]),this.style.applyStyle(),this.parentMenu.setCurrentItem(this)):(this.style.removeClasses(["adam-item-active"]),this.style.applyStyle()))};var SeparatorItem=function(a,b){Item.call(this,a,b)};SeparatorItem.prototype=new Item;SeparatorItem.prototype.type="SeparatorItem";
SeparatorItem.prototype.createHTML=function(){var a,b;b=this.createHTMLElement("li");b.className="adam-item-separator";a=this.createHTMLElement("span");a.className="adam-separator";a.innerHTML=" ";b.appendChild(a);return this.html=b};var MenuItem=function(a,b){Item.call(this,a,b);this.hasMenuActive=this.itemAnchor=null;MenuItem.prototype.initObject.call(this,a)};MenuItem.prototype=new Item;MenuItem.prototype.type="MenuItem";
MenuItem.prototype.initObject=function(a){var b={hasMenuActive:!1};$.extend(!0,b,a);this.setHasMenuActive(b.hasMenuActive)};MenuItem.prototype.setHasMenuActive=function(a){this.hasMenuActive=a;return this};
MenuItem.prototype.createHTML=function(){var a,b;Item.prototype.createHTML.call(this);this.itemAnchor=this.createHTMLElement("a");this.itemAnchor.href="#";this.menu&&(this.itemAnchor.className="adam-item-arrow");a=this.createHTMLElement("span");a.innerHTML=this.label;a.className="adam-label";b=this.createHTMLElement("span");b.className="adam-item-icon "+this.icon;this.itemAnchor.appendChild(b);this.itemAnchor.appendChild(a);this.html.appendChild(this.itemAnchor);return this.html};
MenuItem.prototype.attachListeners=function(){var a=this;this.html&&$(this.itemAnchor).click(function(b){console.log("hasta aqui llego");b.stopPropagation();a.menu||a.disabled||(a.closeMenu(),a.action.handler());b.preventDefault()}).mouseover(function(){a.setActiveItem(!0);a.setActiveMenu(!0)}).mouseout(function(){a.setActiveItem(!1);a.setActiveMenu(!1)}).mouseup(function(a){a.stopPropagation()}).mousedown(function(a){a.stopPropagation()})};
MenuItem.prototype.setActiveItem=function(a){this.disabled||(a?this.focused||(this.style.addClasses(["adam-item-active"]),this.style.applyStyle(),this.parentMenu.setCurrentItem(this)):this.hasMenuActive||(this.style.removeClasses(["adam-item-active"]),this.style.applyStyle(),this.setFocused(!1)))};MenuItem.prototype.setActiveMenu=function(a){this.menu&&!this.disabled&&(a?this.focused||(this.menu.show(this.x+this.width,this.y),this.setHasMenuActive(!0),this.setFocused(!0)):this.hasMenuActive||this.menu.hide())};
var Layout=function(a){Base.call(this,a);Layout.prototype.initObject.call(this,a)};Layout.prototype=new Base;Layout.prototype.type="Layout";Layout.prototype.family="Layout";Layout.prototype.initObject=function(a){};var Tooltip=function(a,b){Element.call(this,a);this.hoverClass=this.hoverParent=this.messageObject=this.parent=this.message=this.css=this.icon=null;Tooltip.prototype.initObject.call(this,a,b)};Tooltip.prototype=new Element;Tooltip.prototype.type="Tooltip";Tooltip.prototype.family="Tooltip";
Tooltip.prototype.initObject=function(a,b){var c={message:null,icon:"adam-tooltip-icon-default",css:"",parent:b||null,hoverParent:!0,hoverClass:"hovered"};$.extend(!0,c,a);this.setIcon(c.icon).setMessage(c.message).setParent(c.parent).setCss(c.css).setHoverClass(c.hoverClass).setHoverParent(c.hoverParent)};Tooltip.prototype.setIcon=function(a){this.icon=a;return this};Tooltip.prototype.setMessage=function(a){this.message=a;return this};Tooltip.prototype.setParent=function(a){this.parent=a;return this};
Tooltip.prototype.setCss=function(a){this.css=a;return this};Tooltip.prototype.setHoverParent=function(a){this.hoverParent=a;return this};Tooltip.prototype.setHoverClass=function(a){this.hoverClass=a;return this};Tooltip.prototype.createHTML=function(){var a,b;b=this.createHTMLElement("a");b.href="#";b.className="adam-tooltip "+this.css;a=this.createHTMLElement("span");a.className=this.icon;b.appendChild(a);this.html=b;this.attachListeners();return this.html};
Tooltip.prototype.attachListeners=function(){var a=this;$(this.html).click(function(a){a.preventDefault()}).mouseover(function(b){b.stopPropagation();a.show(b.pageX,b.pageY)}).mouseout(function(b){b.stopPropagation();a.hide()})};
Tooltip.prototype.show=function(a,b){var c;this.messageObject||(c=this.createHTMLElement("div"),c.className="adam-tooltip-message",c.innerHTML=this.message,c.style.position="absolute",c.style.top=b+10+"px",c.style.left=a+10+"px",c.style.zIndex=1034,this.messageObject=c);document.body.appendChild(this.messageObject);this.hoverParent&&this.parent&&$(this.parent.html).addClass(this.hoverClass)};
Tooltip.prototype.hide=function(){document.body.removeChild(this.messageObject);this.messageObject=null;this.hoverParent&&this.parent&&$(this.parent.html).removeClass(this.hoverClass)};var Panel=function(a){Container.call(this,a);this.layout=this.footer=this.header=null;this.language={};Panel.prototype.initObject.call(this,a)};Panel.prototype=new Container;Panel.prototype.type="Panel";Panel.prototype.family="Panel";Panel.prototype.initObject=function(a){var b={layout:null};$.extend(!0,b,a);this.setHeader(b.header).setFooter(b.footer).setLayout(b.layout)};
Panel.prototype.setHeader=function(a){this.header=a;return this};Panel.prototype.setFooter=function(a){this.footer=a;return this};Panel.prototype.setLayout=function(a){this.layout=a&&a.family&&"Layout"===a.family?a:new Layout(a);return this};
Panel.prototype.createHTML=function(){var a;Container.prototype.createHTML.call(this);this.style.removeProperties("width height position top left z-index".split(" "));this.style.addClasses(["adam-panel"]);this.header?this.html.insertBefore(this.header,this.body):(a=this.createHTMLElement("div"),a.className="adam-panel-header",this.html.insertBefore(a,this.body),this.header=a);this.footer?this.html.appendChild(this.footer):(a=this.createHTMLElement("div"),a.className="adam-panel-footer",this.html.appendChild(a),
this.footer=a);this.body.className="adam-panel-body";return this.html};Panel.prototype.load=function(){};var Form=function(a){Panel.call(this,a);this.proxy=this.url=this.proxyEnabled=null;this.loaded=!1;this.data=null;this.callback={};this.dirty=!1;this.buttons=[];this.parent=this.closeContainerOnSubmit=this.headerHeight=this.footerHeight=this.labelWidth=this.footerAlign=null;Form.prototype.initObject.call(this,a)};Form.prototype=new Panel;Form.prototype.type="Form";
Form.prototype.initObject=function(a){var b={url:null,data:null,proxyEnabled:!0,callback:{},buttons:[],footerAlign:"center",labelWidth:"30%",footerHeight:40,headerHeight:0,closeContainerOnSubmit:!1,language:{ERROR_INVALID_EMAIL:"You must enter a valid email",ERROR_INVALID_INTEGER:"Please enter only integer values",ERROR_REQUIRED_FIELD:"This field is required",ERROR_COMPARISON:"The comparison failed",ERROR_REGEXP:"The pattern text didn't match with the specified one",ERROR_TEXT_LENGTH:"The text length must be",
ERROR_CHECKBOX_VALUES:"Please insert Checkbox values (0 or 1)",ERROR_TEXT:"Please insert text",ERROR_DATE:"Please insert only valid dates",ERROR_PHONE:"Please enter a valid Phone",ERROR_FLOAT:"Please enter only valid float values",ERROR_DECIMAL:"Please enter only valid decimal values",ERROR_URL:"Please enter only valid url",TITLE_BUSINESS_RULE_EVALUATION:"Business Rules Evaluation",LBL_BUSINESS:"Business",LBL_OPERATOR:"Operator",LBL_RESPONSE:"Response",LBL_LOGIC_OPERATORS:"Logic Operators",LBL_GROUP:"Group",
LBL_DIRECTION:"Direction",LBL_MODULE:"Module",LBL_FIELD:"Field",LBL_VALUE:"Value",LBL_TARGET_MODULE:"Target Module",LBL_VARIABLE:"Variable",LBL_USER:"User",TITLE_MODULE_FIELD_EVALUATION:"Module Field Evaluation",TITLE_FORM_RESPONSE_EVALUATION:"Form Response Evaluation",TITLE_USER_EVALUATION:"User Evaluation",LBL_FORM:"Form",LBL_STATUS:"Status",LBL_APPROVED:"Approved",LBL_REJECTED:"Rejected",BUTTON_SUBMIT:"Submit",BUTTON_CANCEL:"Cancel"}};$.extend(!0,b,a);this.language=b.language;this.setUrl(b.url).setData(b.data).setProxyEnabled(b.proxyEnabled).setProxy(b.proxy).setCallback(b.callback).setButtons(b.buttons).setLabelWidth(b.labelWidth).setFooterHeight(b.footerHeight).setHeaderHeight(b.headerHeight).setCloseContainerOnSubmit(b.closeContainerOnSubmit).setFooterAlign(b.footerAlign)};
Form.prototype.setUrl=function(a){this.url=a;return this};Form.prototype.setProxyEnabled=function(a){this.proxyEnabled=a;return this};Form.prototype.setProxy=function(a){a&&a.family&&"Proxy"===a.family?(this.proxy=a,this.url=a.url,this.proxyEnabled=!0):this.proxyEnabled&&(a?(a.url||(a.url=this.url),this.proxy=new Proxy(a)):this.url&&(this.proxy=new Proxy({url:this.url})));return this};Form.prototype.setData=function(a){this.data=a;this.loaded&&this.applyData();return this};
Form.prototype.setCallback=function(a){this.callback=a;return this};Form.prototype.setFooterAlign=function(a){this.footerAlign=a;return this};Form.prototype.setLabelWidth=function(a){this.labelWidth=a;return this};Form.prototype.setFooterHeight=function(a){this.footerHeight=a;return this};Form.prototype.setHeaderHeight=function(a){this.headerHeight=a;return this};
Form.prototype.setHeight=function(a){Panel.prototype.setHeight.call(this,a);this.setBodyHeight(this.height-this.footerHeight-this.headerHeight);return this};Form.prototype.setCloseContainerOnSubmit=function(a){this.closeContainerOnSubmit=a;return this};
Form.prototype.load=function(){console.log("Loading Form:",this.id);var a=this,b=null;this.loaded||(this.proxy?(console.log("Calling Proxy:",this.proxy.url),b=this.getRelatedFields(),this.proxy.getData(b,{success:function(b){console.log("Form "+a.id+": Loaded OK");a.data=b;a.applyData.call(a);a.loaded=!0;a.attachListeners()}})):(this.applyData.call(this),this.attachListeners(),this.loaded=!0))};
Form.prototype.getRelatedFields=function(){var a=[];if(this.items)for(i=0;i<this.items.length;i+=1)this.items[i].related&&a.push(this.items[i].related);return 0<a.length?{related:a.join(",")}:null};Form.prototype.reload=function(){this.loaded=!1;this.load()};
Form.prototype.applyData=function(a){console.log("Data to Load:",this.data);var b,c,d;console.log("Applying Data for:",this.id);if(this.data){if(this.data.related)for(c=0;c<this.items.length;c+=1)"ComboboxField"===this.items[c].getType()&&this.items[c].related&&(d=this.items[c].related,this.data.related[d]&&this.items[c].setOptions(this.data.related[d]));for(b in this.data)if(this.data.hasOwnProperty(b))for(c=0;c<this.items.length;c+=1)if(this.items[c].name===b){this.items[c].setValue(this.data[b]);
break}}this.callback.loaded&&!a&&this.callback.loaded.call(this,this.data,null!==this.proxy)};
Form.prototype.addItem=function(a){var b;if(a&&a.family&&"Field"===a.family)b=a,b.setParent(this);else if($.extend(!0,a,{language:this.language}),a.jtype)switch(a.jtype){case "text":b=new TextField(a,this);break;case "combobox":b=new ComboboxField(a,this);break;case "textarea":b=new TextareaField(a,this);break;case "checkbox":b=new CheckboxField(a,this);break;case "hidden":b=new HiddenField(a,this);break;case "emailpicker":b=new EmailPickerField(a,this);break;case "itemmatrix":b=new ItemMatrixField(a,
this);break;case "multipleitem":b=new MultipleItemField(a,this);break;case "criteria":b=new CriteriaField(a,this);break;case "itemupdater":b=new ItemUpdaterField(a,this);break;case "expression":b=new ExpressionField(a,this);break;case "radio":b=new RadiobuttonField(a,this)}b&&this.items.push(b)};Form.prototype.setItems=function(a){var b;for(b=0;b<a.length;b+=1)this.addItem(a[b]);return this};Form.prototype.setButtons=function(a){var b;for(b=0;b<a.length;b+=1)this.addButton(a[b]);return this};
Form.prototype.reset=function(){var a;for(a=0;a<this.items.length;a+=1)this.items[a].reset();this.setDirty(!1);this.callback.reset&&this.callback.reset()};Form.prototype.submit=function(){var a;this.testRequired()?this.validate()?(a=this.getData(),this.proxy?this.proxy.sendData(a,this.callback):this.callback.submit&&this.callback.submit(a),this.closeContainerOnSubmit&&this.parent&&this.parent.close&&this.parent.close()):this.callback.failed&&this.callback.failed():this.callback.required&&this.callback.required()};
Form.prototype.getData=function(){var a,b={};for(a=0;a<this.items.length;a+=1)$.extend(b,this.items[a].getObjectValue());return b};Form.prototype.setDirty=function(a){this.dirty=a;return this};Form.prototype.isDirty=function(){return this.dirty};
Form.prototype.validate=function(){var a,b=!0,c;for(a=0;a<this.items.length;a+=1)c=this.items[a].isValid(),b=b&&c,!c&&this.items[a].errorTooltip&&($(this.items[a].errorTooltip.html).removeClass("adam-tooltip-error-off"),$(this.items[a].errorTooltip.html).addClass("adam-tooltip-error-on"));return b};Form.prototype.testRequired=function(){var a,b=!0;for(a=0;a<this.items.length;a+=1)b=b&&this.items[a].evalRequired();return b};
Form.prototype.addButton=function(a){a&&a.family&&"Button"===a.family?a.setParent(this):a=new Button(a,this);a&&this.buttons.push(a)};Form.prototype.attachListeners=function(){var a;for(a=0;a<this.items.length;a+=1)this.items[a].attachListeners();for(a=0;a<this.buttons.length;a+=1)this.buttons[a].attachListeners();$(this.body).mousedown(function(a){a.stopPropagation()})};
Form.prototype.onEnterFieldHandler=function(a){var b=this;return function(){var c;for(c=0;c<b.items.length;c+=1)b.items[c]!==a&&b.items[c]instanceof CriteriaField&&b.items[c].hidePanel()}};
Form.prototype.createHTML=function(){var a,b;Panel.prototype.createHTML.call(this);this.footer.style.textAlign=this.footerAlign;for(a=0;a<this.items.length;a+=1)b=this.items[a].getHTML(),$(b).find("select, input, textarea").focus(this.onEnterFieldHandler(this.items[a])),this.body.appendChild(b);for(a=0;a<this.buttons.length;a+=1)this.footer.appendChild(this.buttons[a].getHTML());this.body.style.bottom=this.footerHeight+8+"px";this.footer.style.height=this.footerHeight+"px";return this.html};
Form.prototype.setParent=function(a){this.parent=a;return this};var Field=function(a,b){Element.call(this,a);this.value=this.label=this.parent=null;this.validators=[];this.initialValue=this.messageError=this.required=this.name=null;this.requiredFailed=!1;this.oldRequiredValue=this.proxy=this.submit=this.readOnly=this.change=this.labelObject=this.controlObject=this.errorTooltip=this.helpTooltip=this.fieldWidth=null;Field.prototype.initObject.call(this,a,b)};Field.prototype=new Element;
Field.prototype.type="Field";Field.prototype.family="Field";Field.prototype.initObject=function(a,b){var c={required:!1,label:"",validators:[],value:null,messageError:null,initialValue:null,fieldWidth:null,helpTooltip:null,change:function(){},readOnly:!1,submit:!0,proxy:null};$.extend(!0,c,a);this.setParent(b);this.setRequired(c.required).setLabel(c.label).setName(c.name||this.type+"_"+this.id).setValidators(c.validators).setMessageError(c.messageError).setInitialValue(c.initialValue).setFieldWidth(c.fieldWidth).setHelpTooltip(c.helpTooltip).setErrorTooltip({}).setChangeHandler(c.change).setReadOnly(c.readOnly).setSubmit(c.submit).setProxy(c.proxy).setValue(c.value)};
Field.prototype.setRequired=function(a){this.required=a;return this};Field.prototype.setValue=function(a,b){this.value=b?a:a||this.initialValue;this.html&&this.controlObject&&(this.controlObject.value=this.value);this.proxy&&this.load();return this};Field.prototype.setName=function(a){this.name=a;return this};Field.prototype.setLabel=function(a){this.label=a;return this};
Field.prototype.setValidators=function(a){var b;for(b=0;b<a.length;b+=1)a[b]&&a[b].family&&"Validator"===a[b].family?this.validators.push(a[b]):this.validators.push(this.validatorFactory(a[b]));return this};Field.prototype.setMessageError=function(a){this.messageError=a;return this};Field.prototype.setParent=function(a){this.parent=a;return this};Field.prototype.setInitialValue=function(a){this.initialValue=a;return this};Field.prototype.setFieldWidth=function(a){this.fieldWidth=a;return this};
Field.prototype.setHelpTooltip=function(a){a?(a.css||(a.css="adam-tooltip-help"),this.helpTooltip=new Tooltip(a,this)):this.helpTooltip=null;return this};Field.prototype.setErrorTooltip=function(a){a?(a.css||(a.css="adam-tooltip-error-off"),a.icon||(a.icon="adam-tooltip-icon-error"),a.visible=!1,this.errorTooltip=new Tooltip(a,this)):this.errorTooltip=null;return this};Field.prototype.setChangeHandler=function(a){this.change=a;return this};
Field.prototype.setReadOnly=function(a){this.readOnly=a;this.html&&(this.controlObject.disabled=a);return this};Field.prototype.setSubmit=function(a){this.submit=a;return this};Field.prototype.setProxy=function(a){this.proxy=a;return this};
Field.prototype.validatorFactory=function(a){var b=null,c={email:{pattern:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/},integer:{pattern:/^\s*(\+|-)?\d+\s*$/},required:{pattern:/\S/}};if(a&&a.jtype)switch(a.jtype){case "required":a.criteria&&!a.criteria.trim&&(b=new TextLengthValidator({criteria:{trim:!1,minLength:1},errorMessage:a.errorMessage||this.parent.language.ERROR_REQUIRED_FIELD},
this));break;case "email":case "integer":a.criteria=c[a.jtype].pattern;b=new RegExpValidator($.extend({errorMessage:c[a.jtype].message},a),this);break;case "comparison":b=new ComparisonValidator($.extend({errorMessage:this.parent.language.ERROR_COMPARISON},a),this);break;case "regexp":b=new RegExpValidator($.extend({errorMessage:this.parent.language.ERROR_REGEXP},a),this);break;case "textLength":b=new TextLengthValidator($.extend({errorMessage:this.parent.language.ERROR_TEXT_LENGTH},a),this);break;
case "custom":b=new CustomValidator($.extend({errorMessage:""},a),this);break;case "number":b=new NumberValidator($.extend({errorMessage:""},a),this);break;case "range":b=new RangeValidator($.extend({errorMessage:""},a),this);break;default:b=new Validator($.extend({errorMessage:""},a),this)}else b=new Validator(null,this);return b};Field.prototype.getObjectValue=function(){var a={};this.submit&&(a[this.name]=this.value);return a};
Field.prototype.evalRequired=function(){var a=!0;this.required&&((a=null!==this.value&&""!==this.value&&this.value.trim())?$(this.controlObject).removeClass("required"):$(this.controlObject).addClass("required"));return a};Field.prototype.reset=function(){this.setValue(this.initialValue||null,!0);this.errorTooltip&&($(this.errorTooltip.html).removeClass("adam-tooltip-error-on"),$(this.errorTooltip.html).addClass("adam-tooltip-error-off"));this.required&&this.controlObject&&$(this.controlObject).removeClass("required")};
Field.prototype.attachListeners=function(){};Field.prototype.createHTML=function(){Element.prototype.createHTML.call(this);this.style.removeProperties("position width height top left z-index".split(" "));this.style.addClasses(["adam-field"]);return this.html};
Field.prototype.isValid=function(){var a,b=!0;for(a=0;a<this.validators.length;a+=1)if(b=b&&this.validators[a].isValid(),!b)return this.errorTooltip.setMessage(this.validators[a].getErrorMessage()),$(this.errorTooltip.html).removeClass("adam-tooltip-error-off"),$(this.errorTooltip.html).addClass("adam-tooltip-error-on"),b;b&&($(this.errorTooltip.html).removeClass("adam-tooltip-error-on"),$(this.errorTooltip.html).addClass("adam-tooltip-error-off"));return b};
Field.prototype.onChange=function(){this.required&&this.evalRequired();this.isValid();this.change&&this.change(this);this.parent.setDirty(!0);return this};Field.prototype.doLoad=function(){this.proxy&&this.load()};Field.prototype.load=function(){};var Validator=function(a,b){Base.call(this,a);this.criteria=this.parent=null;this.validated=!1;this.errorMessage=this.valid=null;Validator.prototype.initObject.call(this,a,b)};Validator.prototype=new Base;Validator.prototype.type="Validator";
Validator.prototype.family="Validator";Validator.prototype.initObject=function(a,b){var c={criteria:null,errorMessage:"the validation has failed"};$.extend(!0,c,a);this.setCriteria(c.criteria).setParent(b).setErrorMessage(c.errorMessage)};Validator.prototype.setErrorMessage=function(a){this.errorMessage=a;return this};Validator.prototype.getErrorMessage=function(){return this.errorMessage};Validator.prototype.setCriteria=function(a){this.criteria=a;return this};
Validator.prototype.setParent=function(a){this.parent=a;return this};Validator.prototype.validate=function(){this.valid=!0};Validator.prototype.isValid=function(){this.validate();this.updateTooltip();return this.valid};Validator.prototype.updateTooltip=function(){this.parent&&this.parent.errorTooltip&&(this.valid?$(this.parent.errorTooltip.html).removeClass("adam-tooltip-error-on").addClass("adam-tooltip-error-off"):(this.parent.errorTooltip.setMessage(this.errorMessage),$(this.parent.errorTooltip.html).removeClass("adam-tooltip-error-off").addClass("adam-tooltip-error-on")))};
var RegExpValidator=function(a,b){Validator.call(this,a,b);RegExpValidator.prototype.initObject.call(this,a)};RegExpValidator.prototype=new Validator;RegExpValidator.prototype.type="RegExpValidator";RegExpValidator.prototype.initObject=function(a){var b={errorMessage:"The text pattern doesn't match"};$.extend(!0,b,a);this.setErrorMessage(b.errorMessage)};
RegExpValidator.prototype.validate=function(){this.valid=this.criteria instanceof RegExp&&this.parent&&this.parent.value?this.criteria.test(this.parent.value):!1};var TextLengthValidator=function(a,b){Validator.call(this,a,b);TextLengthValidator.prototype.initObject(this,a)};TextLengthValidator.prototype=new Validator;TextLengthValidator.prototype.type="TextLengthValidator";
TextLengthValidator.prototype.initObject=function(a){var b={errorMessage:"The text length doesn't match with the specified one"};$.extend(!0,b,a);this.setErrorMessage(b.errorMessage)};
TextLengthValidator.prototype.validate=function(){var a=this.criteria.trim?$.trim(this.parent.value):this.parent.value;this.valid=!0;this.criteria.maxLength&&(this.valid=a.length<=parseInt(this.criteria.maxLength,10));this.criteria.minLength&&(this.valid=(null!==this.valid?this.valid:!0)&&a.length>=parseInt(this.criteria.minLength,10))};var CustomValidator=function(a,b){Validator.call(this,a,b)};CustomValidator.prototype=new Validator;CustomValidator.prototype.type="CustomValidator";
CustomValidator.prototype.validate=function(){"function"===typeof this.criteria.validationFunction&&(this.valid=this.criteria.validationFunction.call(this.parent,this.parent.parent));if("undefined"===typeof this.valid||null===this.valid)this.valid=!1};var NumberValidator=function(a,b){Validator.call(this,a,b);NumberValidator.prototype.initObject.call(this,a)};NumberValidator.prototype=new Validator;
NumberValidator.prototype.initObject=function(a){var b={criteria:{decimalSeparator:".",errorMessage:"The value must be a number"}};$.extend(!0,b,a);this.setDecimalSeparator(b.criteria.decimalSeparator).setErrorMessage(b.errorMessage)};NumberValidator.prototype.setDecimalSeparator=function(a){this.criteria.decimalSeparator=a};
NumberValidator.prototype.validate=function(){var a,b,c,d,e;this.valid=!1;if(this.parent&&this.parent.value&&(a=this.parent.value.replace(/\./g,""),a=a.replace(/,/g,""),/^\s*\d+\s*$/.test(a)&&("."===this.criteria.decimalSeparator||","===this.criteria.decimalSeparator)&&(e=","===this.criteria.decimalSeparator?".":",",c=new RegExp("\\"+e,"g"),a=this.parent.value.split(this.criteria.decimalSeparator),b=this.parent.value.match(new RegExp("\\"+this.criteria.decimalSeparator,"g")),!(b&&1<b.length)&&/^\s*\d+\s*$/.test(a[0].replace(new RegExp("\\"+
e,"g"),""))))){if(a[0].match(c)&&0!==a[0].match(c).length){if("0"===a[0].charAt(0))return;b=Math.floor(a[0].length/4);b-=a[0].length%4?0:1;if(a[0].match(c).length!==b)return;c=a[0].length-4;for(d=0;0<c;)a[0].charAt(c)===e&&(d+=1),c-=4;if(d!=b)return}if(!a[1]||/^\s*\d+\s*$/.test(a[1]))this.valid=!0}};var ComparisonValidator=function(a,b){Validator.call(this,a,b);ComparisonValidator.prototype.initObject(this,a)};ComparisonValidator.prototype=new Validator;ComparisonValidator.prototype.type="ComparisonValidator";
ComparisonValidator.prototype.initObject=function(a){var b={errorMessage:"The comparison failed"};$.extend(!0,b,a);this.setErrorMessage(b.errorMessage)};
ComparisonValidator.prototype.validate=function(){var a,b,c={"==":function(a,b){return a===b},">":function(a,b){return a>b},">=":function(a,b){return a>=b},"<":function(a,b){return a<b},"<=":function(a,b){return a<=b}},d=this.parent.parent.items.slice(0),e,f;this.valid=!1;if(c[this.criteria.operator]){switch(this.criteria.compare){case "textLength":a=this.parent.value.length;for(b=0;b<this.criteria.compareWith.length;b+=1){for(f=0;f<d.length&&(e=d.shift(),e.name!==this.criteria.compareWith[f]);f+=
1);if(!c[this.criteria.operator](a,e.value.length))return}break;case "numeric":if(isNaN(this.parent.value.replace(/,/g,"")))return;a=parseFloat(this.parent.value.replace(/,/g,""));for(b=0;b<this.criteria.compareWith.length;b+=1){for(f=0;f<d.length&&(e=d.shift(),e.name!==this.criteria.compareWith[f]);f+=1);if(isNaN(e.value.replace(/,/g,""))||!c[this.criteria.operator](a,parseFloat(e.value.replace(/,/g,""))))return}break;default:for(a=this.parent.value,b=0;b<this.criteria.compareWith.length;b+=1){for(f=
0;f<d.length&&(e=d.shift(),e.name!==this.criteria.compareWith[f]);f+=1);if(!c[this.criteria.operator](a,e.value))return}}this.valid=!0}};var RangeValidator=function(a,b){Validator.call(this,a,b);RangeValidator.prototype.initObject.call(this,a)};RangeValidator.prototype=new Validator;RangeValidator.prototype.initObject=function(a){var b={criteria:{type:"string",dateFormat:"yyyy-mm-dd"},errorMessage:"the value is out of ranges"};$.extend(!0,b,a);this.setCriteria(b.criteria).setErrorMessage(b.errorMessage)};
RangeValidator.prototype.validate=function(){var a=this,b=["minValue","maxValue"],c={string:function(a){return a.toString()},numeric:function(a){return isNaN(a)?NaN:parseFloat(a)},date:function(b){var c,d={},e={},l="yyyy mm dd hh ii ss".split(" ");if("object"===typeof b)b=new Date(b.year,b.month-1,b.day,b.hours||0,b.minutes||0,b.seconds||0,b.milliseconds||0);else if("string"===typeof b){a.criteria.dateFormat=$.trim(a.criteria.dateFormat);for(c=0;c<l.length;c+=1){d[l[c]]=a.criteria.dateFormat.toLowerCase().indexOf(l[c]);
switch(l[c]){case "yyyy":case "mm":case "dd":e[l[c]]=0<=d[l[c]]?b.substr(d[l[c]],l[c].length):"x";break;default:e[l[c]]=(0<=d[l[c]]?b.substr(d[l[c]],2):0)||0}if(isNaN(e[l[c]])||!/^\s*\d+\s*$/.test(e[l[c]]))return null;e[l[c]]=parseInt(e[l[c]],10)}if(0>=e.mm&&0>=e.dd)return null;switch(e.mm){case 4:case 6:case 9:case 11:if(30<e.dd)return null;break;case 2:if((0===e.yyyy%4&&0!==e.yyyy%100||0===e.yyyy%400)&&29<e.dd||28<e.dd)return null;break;default:if(31<e.dd)return null}b=new Date(e.yyyy,0<e.mm&&13>
e.mm?e.mm-1:"x",e.dd,0<=e.hh&&24>e.hh?e.hh:"x",0<=e.ii&&60>e.ii?e.ii:"x",0<=e.ss&&60>e.ss?e.ss:"x")}else return null;return"[object Date]"!==Object.prototype.toString.call(b)?null:isNaN(b.getTime())?null:b}},d,e={};for(d=0;d<b.length;d+=1)this.criteria[b[d]]&&(e[b[d]]=c[this.criteria.type.toLowerCase()](this.criteria[b[d]]));this.criteria.minValue||this.criteria.maxValue?(this.valid=!0,e.maxValue&&(this.valid=c[this.criteria.type.toLowerCase()](this.parent.value)<=e.maxValue),e.minValue&&(this.valid=
this.valid&&c[this.criteria.type.toLowerCase()](this.parent.value)>=e.minValue)):this.valid=!1};var TextField=function(a,b){Field.call(this,a,b);this.maxCharacters=null;TextField.prototype.initObject.call(this,a)};TextField.prototype=new Field;TextField.prototype.type="TextField";TextField.prototype.initObject=function(a){var b={maxCharacters:0};$.extend(!0,b,a);this.setMaxCharacters(b.maxCharacters)};TextField.prototype.setMaxCharacters=function(a){this.maxCharacters=a;return this};
TextField.prototype.createHTML=function(){var a,b;b="";var c;Field.prototype.createHTML.call(this);this.required&&(b="<i>*</i> ");a=this.createHTMLElement("span");a.className="adam-form-label";a.innerHTML=this.label+": "+b;a.style.width=this.parent.labelWidth;this.html.appendChild(a);b=this.createHTMLElement("input");b.id=this.name;b.value=this.value||"";this.fieldWidth&&(b.style.width=this.fieldWidth);this.readOnly&&(c=document.createAttribute("readonly"),b.setAttributeNode(c));this.html.appendChild(b);
this.errorTooltip&&this.html.appendChild(this.errorTooltip.getHTML());this.helpTooltip&&this.html.appendChild(this.helpTooltip.getHTML());this.labelObject=a;this.controlObject=b;return this.html};TextField.prototype.attachListeners=function(){var a=this;this.controlObject&&$(this.controlObject).change(function(){a.setValue(this.value,!0);a.onChange()}).keydown(function(a){a.stopPropagation()});return this};
TextField.prototype.disable=function(){this.labelObject.className="adam-form-label-disabled";this.controlObject.disabled=!0;this.oldRequiredValue||(this.oldRequiredValue=this.required);this.setRequired(!1);$(this.controlObject).removeClass("required")};TextField.prototype.enable=function(){this.labelObject.className="adam-form-label";this.controlObject.disabled=!1;this.oldRequiredValue&&this.setRequired(this.oldRequiredValue)};
var ComboboxField=function(a,b){Field.call(this,a,b);this.options=[];this.related=null;ComboboxField.prototype.initObject.call(this,a)};ComboboxField.prototype=new Field;ComboboxField.prototype.type="ComboboxField";ComboboxField.prototype.initObject=function(a){var b={options:[],related:null};$.extend(!0,b,a);this.setOptions(b.options).setRelated(b.related)};
ComboboxField.prototype.setOptions=function(a){this.options=a;if(this.html){for(a=0;a<this.options.length;a+=1)this.controlObject.appendChild(this.generateOption(this.options[a]));this.value||(this.value=this.controlObject.value)}return this};ComboboxField.prototype.setRelated=function(a){this.related=a;return this};
ComboboxField.prototype.createHTML=function(){var a,b;b="";var c;Field.prototype.createHTML.call(this);this.required&&(b="<i>*</i> ");a=this.createHTMLElement("span");a.className="adam-form-label";a.innerHTML=this.label+": "+b;a.style.width=this.parent.labelWidth;this.html.appendChild(a);b=this.createHTMLElement("select");b.id=this.name;for(c=0;c<this.options.length;c+=1)b.appendChild(this.generateOption(this.options[c]));this.value||(this.value=b.value);this.fieldWidth&&(b.style.width=this.fieldWidth);
this.readOnly&&(c=document.createAttribute("disabled"),b.setAttributeNode(c));this.html.appendChild(b);this.errorTooltip&&this.html.appendChild(this.errorTooltip.getHTML());this.helpTooltip&&this.html.appendChild(this.helpTooltip.getHTML());this.labelObject=a;this.controlObject=b;return this.html};ComboboxField.prototype.removeOptions=function(){if(this.options){for(;this.controlObject.firstChild;)this.controlObject.removeChild(this.controlObject.firstChild);this.options=[]}return this};
ComboboxField.prototype.generateOption=function(a){var b,c,d;b=this.createHTMLElement("option");"object"===typeof a?(c=a.value,d=a.text):c=a;b.selected=this.value===c;b.value=c;b.label=d||c;b.appendChild(document.createTextNode(d||c));return b};ComboboxField.prototype.attachListeners=function(){var a=this;this.controlObject&&$(this.controlObject).change(function(b){a.setValue(this.value,!0);a.onChange()});return this};
ComboboxField.prototype.disable=function(){this.labelObject.className="adam-form-label-disabled";this.controlObject.disabled=!0;this.oldRequiredValue||(this.oldRequiredValue=this.required);this.setRequired(!1);$(this.controlObject).removeClass("required")};ComboboxField.prototype.enable=function(){this.labelObject.className="adam-form-label";this.controlObject.disabled=!1;this.oldRequiredValue&&this.setRequired(this.oldRequiredValue)};
var TextareaField=function(a,b){Field.call(this,a,b);this.fieldHeight=null;TextareaField.prototype.initObject.call(this,a)};TextareaField.prototype=new Field;TextareaField.prototype.type="TextareaField";TextareaField.prototype.initObject=function(a){var b={fieldHeight:null};$.extend(!0,b,a);this.setFieldHeight(b.fieldHeight)};TextareaField.prototype.setFieldHeight=function(a){this.fieldHeight=a;return this};
TextareaField.prototype.createHTML=function(){var a,b="";Field.prototype.createHTML.call(this);this.required&&(b="<i>*</i> ");a=this.createHTMLElement("span");a.className="adam-form-label";a.innerHTML=this.label+": "+b;a.style.width=this.parent.labelWidth;a.style.verticalAlign="top";this.html.appendChild(a);a=this.createHTMLElement("textarea");a.id=this.name;a.value=this.value;this.fieldWidth&&(a.style.width=this.fieldWidth);this.fieldHeight&&(a.style.height=this.fieldHeight);this.readOnly&&(b=document.createAttribute("readonly"),
a.setAttributeNode(b));this.html.appendChild(a);this.errorTooltip&&this.html.appendChild(this.errorTooltip.getHTML());this.helpTooltip&&this.html.appendChild(this.helpTooltip.getHTML());this.controlObject=a;return this.html};TextareaField.prototype.attachListeners=function(){var a=this;this.controlObject&&$(this.controlObject).change(function(){a.setValue(this.value,!0);a.onChange()}).keydown(function(a){a.stopPropagation()});return this};
var CheckboxField=function(a,b){Field.call(this,a,b);this.defaults={onClick:function(a,b){}};$.extend(!0,this.defaults,a)};CheckboxField.prototype=new Field;CheckboxField.prototype.type="CheckboxField";
CheckboxField.prototype.createHTML=function(){var a,b;b="";var c;Field.prototype.createHTML.call(this);this.required&&(b="<i>*</i> ");a=this.createHTMLElement("span");a.className="adam-form-label";a.innerHTML=this.label+": "+b;a.style.width=this.parent.labelWidth;this.html.appendChild(a);b=this.createHTMLElement("input");b.id=this.name;b.type="checkbox";b.checked=this.value?!0:!1;this.readOnly&&(c=document.createAttribute("readonly"),b.setAttributeNode(c));this.html.appendChild(b);this.errorTooltip&&
this.html.appendChild(this.errorTooltip.getHTML());this.helpTooltip&&this.html.appendChild(this.helpTooltip.getHTML());this.labelObject=a;this.controlObject=b;return this.html};
CheckboxField.prototype.attachListeners=function(){var a=this;if(this.controlObject){if("undefined"!==typeof this.defaults.onClick&&"function"===typeof this.defaults.onClick)$(this.controlObject).on("click",function(b,c){return a.defaults.onClick()});$(this.controlObject).change(function(b,c){a.setValue(this.checked?!0:!1,!0);a.onChange()})}return this};CheckboxField.prototype.getObjectValue=function(){var a={};a[this.name]=this.value?!0:!1;return a};
CheckboxField.prototype.evalRequired=function(){var a=!0;this.required&&((a=this.value)?$(this.controlObject).removeClass("required"):$(this.controlObject).addClass("required"));return a};CheckboxField.prototype.disable=function(){this.labelObject.className="adam-form-label-disabled";this.controlObject.disabled=!0;this.oldRequiredValue||(this.oldRequiredValue=this.required);this.setRequired(!1);$(this.controlObject).removeClass("required")};
CheckboxField.prototype.enable=function(){this.labelObject.className="adam-form-label";this.controlObject.disabled=!1;this.oldRequiredValue&&this.setRequired(this.oldRequiredValue)};var RadiobuttonField=function(a,b){Field.call(this,a,b);this.defaults={options:{},onClick:function(a,b){}};$.extend(!0,this.defaults,a)};RadiobuttonField.prototype=new Field;RadiobuttonField.prototype.type="RadiobuttonField";
RadiobuttonField.prototype.createHTML=function(){var a,b,c="";Field.prototype.createHTML.call(this);this.required&&(c="<i>*</i> ");a=this.createHTMLElement("span");a.className="adam-form-label";b=this.createHTMLElement("input");b.name=this.name;b.type="radio";b.value=this.value;"undefined"===typeof this.defaults.labelAlign||"left"===this.defaults.labelAlign?(a.style.width=this.parent.labelWidth,a.innerHTML=this.label+": "+c,a.style.verticalAlign="top",a.style.width=this.parent.labelWidth,this.html.appendChild(a),
this.html.appendChild(b)):"right"===this.defaults.labelAlign&&(a.innerHTML="&nbsp;"+this.label+c,b.style.marginLeft=this.defaults.marginLeft?this.defaults.marginLeft+"px":"0px",a.style.width=this.parent.labelWidth,this.html.appendChild(b),this.html.appendChild(a));b.checked=this.value?!0:!1;this.readOnly&&(a=document.createAttribute("readonly"),b.setAttributeNode(a));this.errorTooltip&&this.html.appendChild(this.errorTooltip.getHTML());this.helpTooltip&&this.html.appendChild(this.helpTooltip.getHTML());
this.controlObject=b;return this.html};RadiobuttonField.prototype.attachListeners=function(){var a=this;if(this.controlObject){if("undefined"!==typeof this.defaults.onClick&&"function"===typeof this.defaults.onClick)$(this.controlObject).on("click",function(b,c){return a.defaults.onClick()});$(this.controlObject).change(function(b,c){a.onChange()})}return this};RadiobuttonField.prototype.getObjectValue=function(){return this.value};
RadiobuttonField.prototype.evalRequired=function(){var a=!0;this.required&&((a=this.value)?$(this.controlObject).removeClass("required"):$(this.controlObject).addClass("required"));return a};RadiobuttonField.prototype.setValue=function(a,b){this.value=b?a:a||this.initialValue;this.html&&this.controlObject&&(this.controlObject.checked=this.value);this.proxy&&this.load();return this};
var LabelField=function(a,b){Field.call(this,a,b);this.submit=!1;this.defaults={options:{marginLeft:10}};$.extend(!0,this.defaults,a)};LabelField.prototype=new Field;LabelField.prototype.type="LabelField";LabelField.prototype.createHTML=function(){var a;Field.prototype.createHTML.call(this);a=this.createHTMLElement("span");a.innerHTML=this.label+":";a.style.verticalAlign="top";a.style.marginLeft=this.defaults.options.marginLeft+"px";this.html.appendChild(a);return this.html};
var HiddenField=function(a,b){Field.call(this,a,b)};HiddenField.prototype=new Field;HiddenField.prototype.type="HiddenField";HiddenField.prototype.createHTML=function(){Element.prototype.createHTML.call(this);return this.html};var EmailGroupField=function(a,b){Field.call(this,a,b)};EmailGroupField.prototype=new Field;EmailGroupField.prototype.type="EmailGroupField";var DateField=function(a,b){Field.call(this,a,b);this.maxCharacters=null;DateField.prototype.initObject.call(this,a)};
DateField.prototype=new Field;DateField.prototype.type="TextField";DateField.prototype.initObject=function(a){var b={maxCharacters:0};$.extend(!0,b,a);this.setMaxCharacters(b.maxCharacters)};DateField.prototype.setMaxCharacters=function(a){this.maxCharacters=a;return this};
DateField.prototype.createHTML=function(){var a,b;b="";var c;Field.prototype.createHTML.call(this);this.required&&(b="<i>*</i> ");a=this.createHTMLElement("span");a.className="adam-form-label";a.innerHTML=this.label+": "+b;a.style.width=this.parent.labelWidth;this.html.appendChild(a);b=this.createHTMLElement("input");b.id=this.name;b.value=this.value||"";$(b).datepicker();this.fieldWidth&&(b.style.width=this.fieldWidth);this.readOnly&&(c=document.createAttribute("readonly"),b.setAttributeNode(c));
this.html.appendChild(b);this.errorTooltip&&this.html.appendChild(this.errorTooltip.getHTML());this.helpTooltip&&this.html.appendChild(this.helpTooltip.getHTML());this.labelObject=a;this.controlObject=b;return this.html};DateField.prototype.attachListeners=function(){var a=this;this.controlObject&&$(this.controlObject).change(function(){a.setValue(this.value,!0);a.onChange()}).keydown(function(a){a.stopPropagation()});return this};
DateField.prototype.disable=function(){this.labelObject.className="adam-form-label-disabled";this.controlObject.disabled=!0;this.oldRequiredValue||(this.oldRequiredValue=this.required);this.setRequired(!1);$(this.controlObject).removeClass("required");$(this.controlObject).datepicker("hide")};DateField.prototype.enable=function(){this.labelObject.className="adam-form-label";this.controlObject.disabled=!1;this.oldRequiredValue&&this.setRequired(this.oldRequiredValue)};
var NumberField=function(a,b){Field.call(this,a,b);this.maxCharacters=null;NumberField.prototype.initObject.call(this,a)};NumberField.prototype=new Field;NumberField.prototype.type="TextField";NumberField.prototype.initObject=function(a){var b={maxCharacters:0};$.extend(!0,b,a);this.setMaxCharacters(b.maxCharacters)};NumberField.prototype.setMaxCharacters=function(a){this.maxCharacters=a;return this};
NumberField.prototype.createHTML=function(){var a,b;b="";var c;Field.prototype.createHTML.call(this);this.required&&(b="<i>*</i> ");a=this.createHTMLElement("span");a.className="adam-form-label";a.innerHTML=this.label+": "+b;a.style.width=this.parent.labelWidth;this.html.appendChild(a);b=this.createHTMLElement("input");b.id=this.name;b.value=this.value||"";this.fieldWidth&&(b.style.width=this.fieldWidth);this.readOnly&&(c=document.createAttribute("readonly"),b.setAttributeNode(c));this.html.appendChild(b);
this.errorTooltip&&this.html.appendChild(this.errorTooltip.getHTML());this.helpTooltip&&this.html.appendChild(this.helpTooltip.getHTML());this.labelObject=a;this.controlObject=b;return this.html};
NumberField.prototype.attachListeners=function(){var a=this;this.controlObject&&$(this.controlObject).change(function(){a.setValue(this.value,!0);a.onChange()}).keydown(function(a){a.stopPropagation()});$(this.controlObject).on("keydown",function(a){a.stopPropagation();46===a.keyCode||8===a.keyCode||9===a.keyCode||27===a.keyCode||13===a.keyCode||65===a.keyCode&&!0===a.ctrlKey||35<=a.keyCode&&39>=a.keyCode||(a.shiftKey||(48>a.keyCode||57<a.keyCode)&&(96>a.keyCode||105<a.keyCode))&&a.preventDefault()}).on("keyup",
function(a){a.stopPropagation()});return this};NumberField.prototype.disable=function(){this.labelObject.className="adam-form-label-disabled";this.controlObject.disabled=!0;this.oldRequiredValue||(this.oldRequiredValue=this.required);this.setRequired(!1);$(this.controlObject).removeClass("required")};NumberField.prototype.enable=function(){this.labelObject.className="adam-form-label";this.controlObject.disabled=!1;this.oldRequiredValue&&this.setRequired(this.oldRequiredValue)};
var CheckboxGroup=function(a,b){Field.call(this,a,b);this.controlObject={};CheckboxGroup.prototype.initObject.call(this,a)};CheckboxGroup.prototype=new Field;CheckboxGroup.prototype.type="CheckboxGroup";CheckboxGroup.prototype.initObject=function(a){var b={items:[]};$.extend(!0,b,a);this.items=b.items};
CheckboxGroup.prototype.createHTML=function(){var a,b;b="";var c,d,e,f,g,h=this;Field.prototype.createHTML.call(this);this.required&&(b="<i>*</i> ");d=this.createHTMLElement("div");d.style.display="inline-block";d.style.width="30%";d.style.verticalAlign="top";a=this.createHTMLElement("span");a.className="adam-form-label";a.innerHTML=this.label+": "+b+"&nbsp;&nbsp;&nbsp;&nbsp;";a.style.width=this.parent.labelWidth;d.appendChild(a);this.html.appendChild(d);d=this.createHTMLElement("div");d.style.display=
"inline-block";d.style.width="40%";f=this.createHTMLElement("ul");for(e=0;e<this.items.length;e+=1)g=this.createHTMLElement("li"),g.style.listStyleType="none",b=this.createHTMLElement("input"),b.id=this.items[e].value,b.type="checkbox",b.checked=this.items[e].checked?!0:!1,this.readOnly&&(c=document.createAttribute("readonly"),b.setAttributeNode(c)),g.appendChild(b),c={control:b},this.items[e].checked&&(c.checked=!0),this.controlObject[this.items[e].value]=c,c=document.createElement("Label"),c.innerHTML=
" &nbsp;&nbsp;"+this.items[e].text,g.appendChild(c),f.appendChild(g),$(b).change(function(){this.checked?h.controlObject[$(this).attr("id")].checked=!0:h.controlObject[$(this).attr("id")].checked=!1});d.appendChild(f);this.html.appendChild(d);this.errorTooltip&&this.html.appendChild(this.errorTooltip.getHTML());this.helpTooltip&&this.html.appendChild(this.helpTooltip.getHTML());this.labelObject=a;return this.html};CheckboxGroup.prototype.attachListeners=function(){return this};
CheckboxGroup.prototype.getObjectValue=function(){var a={},b=[];$.each(this.controlObject,function(a,d){d.checked&&b.push(a)});a[this.name]=b;return a};CheckboxGroup.prototype.evalRequired=function(){var a=!0;this.required&&((a=this.value)?$(this.controlObject).removeClass("required"):$(this.controlObject).addClass("required"));return a};
CheckboxGroup.prototype.disable=function(){this.labelObject.className="adam-form-label-disabled";this.controlObject.disabled=!0;this.oldRequiredValue||(this.oldRequiredValue=this.required);this.setRequired(!1);$(this.controlObject).removeClass("required")};CheckboxGroup.prototype.enable=function(){this.labelObject.className="adam-form-label";this.controlObject.disabled=!1;this.oldRequiredValue&&this.setRequired(this.oldRequiredValue)};
var Button=function(a,b){Element.call(this,a);this.icon=this.action=this.caption=this.parent=null;Button.prototype.initObject.call(this,a,b)};Button.prototype=new Element;Button.prototype.type="Button";Button.prototype.family="Button";
Button.prototype.initObject=function(a,b){var c,d=this;if(a.isAction)this.loadAction(a,b);else switch(c={caption:null,parent:b||null,jtype:"normal",handler:function(){},icon:null},$.extend(!0,c,a),this.setCaption(c.caption).setParent(c.parent).setIcon(c.icon),c.jtype){case "reset":this.action=new Action({text:this.caption,handler:function(){d.parent.reset()},cssStyle:this.icon});break;case "submit":this.action=new Action({text:this.caption,handler:function(){d.parent.submit()},cssStyle:this.icon});
break;case "normal":this.action=new Action({text:this.caption,handler:c.handler,cssStyle:this.icon})}};Button.prototype.loadAction=function(a,b){this.action=a;this.setCaption(this.action.text);this.setIcon(this.action.cssStyle);this.setParent(b)};Button.prototype.setCaption=function(a){this.caption=a;return this};Button.prototype.setIcon=function(a){this.icon=a;return this};Button.prototype.setParent=function(a){this.parent=a;return this};
Button.prototype.createHTML=function(){var a,b;a=this.createHTMLElement("a");a.href="#";a.className="adam-button";a.id=this.id;this.icon&&(b=this.createHTMLElement("span"),b.className=this.icon,a.appendChild(b));b=this.createHTMLElement("span");b.className="adam-button-label";b.innerHTML=this.caption;a.appendChild(b);return this.html=a};Button.prototype.attachListeners=function(){var a=this;$(this.html).click(function(b){b.stopPropagation();b.preventDefault();a.action.handler&&a.action.handler()}).mousedown(function(a){a.stopPropagation()})};
var RestProxy=function(a){Proxy.call(this,a);this.uid=this.sendMethod=this.getMethod=this.restClient=null;RestProxy.prototype.initObject.call(this,a)};RestProxy.prototype=new Proxy;RestProxy.prototype.type="RestProxy";RestProxy.prototype.initObject=function(a){var b={restClient:null,sendMethod:"PUT",getMethod:"GET",uid:null};$.extend(!0,b,a);this.setUid(b.uid).setRestClient(b.restClient).setSendMethod(b.sendMethod).setGetMethod(b.getMethod)};RestProxy.prototype.setUid=function(a){this.uid=a;return this};
RestProxy.prototype.setRestClient=function(a){this.restClient=a;return this};RestProxy.prototype.setSendMethod=function(a){this.sendMethod=a;return this};RestProxy.prototype.setGetMethod=function(a){this.getMethod=a;return this};RestProxy.prototype.getData=function(a){var b,c;this.restClient&&(b=this.getOperation(this.getMethod),this.restClient.consume({operation:b,url:this.url,id:this.uid,data:a,success:function(a,b){(status=b.success)&&(c=b)}}));return c};
RestProxy.prototype.sendData=function(a,b){var c;this.restClient&&(c=this.getOperation(this.sendMethod),c={operation:c,url:this.url,id:this.uid,data:a},b&&(b.success&&(c.success=b.success),b.failure&&(c.failure=b.failure)),this.restClient.consume(c))};RestProxy.prototype.getOperation=function(a){var b;switch(a){case "GET":b="read";break;case "POST":b="create";break;case "PUT":b="update";break;case "DELETE":b="delete"}return b};
var SugarProxy=function(a){Proxy.call(this,a);this.sendMethod=this.getMethod=this.uid=null;SugarProxy.prototype.initObject.call(this,a)};SugarProxy.prototype=new Proxy;SugarProxy.prototype.type="SugarProxy";SugarProxy.prototype.initObject=function(a){var b={sendMethod:"PUT",getMethod:"GET",createMethod:"POST",uid:null};$.extend(!0,b,a);this.setUid(b.uid).setSendMethod(b.sendMethod).setGetMethod(b.getMethod).setCreateMethod(b.createMethod)};SugarProxy.prototype.setUid=function(a){this.uid=a;return this};
SugarProxy.prototype.setSendMethod=function(a){this.sendMethod=a;return this};SugarProxy.prototype.setGetMethod=function(a){this.getMethod=a;return this};SugarProxy.prototype.setCreateMethod=function(a){this.createMethod=a;return this};
SugarProxy.prototype.getData=function(a,b){var c,d=this,e;c=this.getOperation(this.getMethod);e="read"===c&&a?App.api.buildURL(this.url,null,null,a):App.api.buildURL(this.url,null,null);App.api.call(c,e,{},{success:function(a){console.log("getData");console.log(a);b&&b.success&&b.success.call(d,a)}})};
SugarProxy.prototype.sendData=function(a,b){console.log("send data");var c,d=this,e;c=this.getOperation(this.sendMethod);e=App.api.buildURL(this.url,null,null);attributes={data:a};App.api.call(c,e,attributes,{success:function(a){console.log("getData - put");console.log(a);b&&b.success&&b.success.call(d,a)}})};
SugarProxy.prototype.createData=function(a,b){console.log("send data");var c,d=this,e;c=this.getOperation(this.createMethod);e=App.api.buildURL(this.url,null,null);attributes={data:a};App.api.call(c,e,attributes,{success:function(a){console.log("getData - post");console.log(a);b&&b.success&&b.success.call(d,a)}})};
SugarProxy.prototype.removeData=function(a,b){var c=this,d;d=a?App.api.buildURL(this.url,null,null,a):App.api.buildURL(this.url,null,null);App.api.call("delete",d,{},{success:function(a){b&&b.success&&b.success.call(c,a)}})};SugarProxy.prototype.getOperation=function(a){var b;switch(a){case "GET":b="read";break;case "POST":b="create";break;case "PUT":b="update";break;case "DELETE":b="delete"}return b};
var MultipleItemField=function(a,b){this.items=[];Field.call(this,a,b);this.labelObject=this.itemsContainer=this.fieldHeight=this.panel=this.controlObject=null;this.disabled=!1;MultipleItemField.prototype.initObject.call(this,a)};MultipleItemField.prototype=new Field;MultipleItemField.prototype.initObject=function(a){var b={items:JSON.parse(a&&a.value||"[]"),fieldWidth:280,fieldHeight:120,panel:null};$.extend(!0,b,a);this.setPanel(b.panel||new MultipleItemPanel).setItems(b.items).setFieldWidth(b.fieldWidth).setFieldHeight(b.fieldHeight)};
MultipleItemField.prototype.setPanel=function(a){a instanceof MultipleItemPanel&&(this.panel&&$(this.panel.getHTML()).remove(),this.panel=a);return this};MultipleItemField.prototype.setValue=function(a){if(a)try{var b=JSON.parse(a);this.setItems(b)}catch(c){}return this};MultipleItemField.prototype.setFieldWidth=function(a){isNaN(a)||(this.fieldWidth=a);return this};MultipleItemField.prototype.setFieldHeight=function(a){isNaN(a)||(this.fieldHeight=a);return this};
MultipleItemField.prototype.addItem=function(a){var b=this;if(!(a instanceof SingleItem))if("object"===typeof a)a=new SingleItem({label:a.label||"",value:a.value||null});else return this;this.items.push(a);$(this.controlObject).before(a.getHTML());a.onRemove=function(){b.removeItem(this)};this.hidePanel();if(this.parent.loaded)this.onChange();return this};
MultipleItemField.prototype.removeItem=function(a){a=a.id;var b=null,c;for(c=0;c<this.items.length;c+=1)if(this.items[c].id===a){b=c;break}null!==b&&this.items.splice(b,1);this.hidePanel();$(this.controlObject).focus();this.onChange();return this};MultipleItemField.prototype.clear=function(){$(this.itemsContainer).find("> li").remove();this.items=[];return this};MultipleItemField.prototype.setItems=function(a){var b;this.clear();for(b=0;b<a.length;b+=1)this.addItem(a[b]);return this};
MultipleItemField.prototype.hidePanel=function(){var a;$(this.itemsContainer).removeClass("expanded");for(a=0;a<this.items.length;a+=1)$(this.items[a].html).removeClass("focused");this.panel.close();return this};MultipleItemField.prototype.scrollTo=function(){var a=this.html.parentNode;if(a.scrollTop+$(a).outerHeight()<getRelativePosition(this.itemsContainer,a).top+$(this.itemsContainer).outerHeight()+a.scrollTop)this.html.parentNode.scrollTop=$(this.itemsContainer).position().top;else return this};
MultipleItemField.prototype.showPanel=function(){$(this.itemsContainer).addClass("focused");$(this.panel.html).addClass("focused");this.panel.open();$(this.itemsContainer).addClass("expanded");return this};MultipleItemField.prototype.createControlObject=function(){var a=document.createElement("input");a.className="multiple-item-input";return a};
MultipleItemField.prototype.attachListeners=function(){var a,b,c=this;a=this.controlObject;b=this.itemsContainer;$(this.itemsContainer).on("click",function(b){b.stopPropagation();c.disabled||$(a).focus().select()});$(a).focus(function(){c.scrollTo();$(b).addClass("focused");$(c.panel.html).addClass("focused")}).blur(function(){c.hidePanel();$(b).removeClass("focused");$(c.panel.html).removeClass("focused")}).on("keyup",function(a){27===a.keyCode&&c.hidePanel()}).on("keydown",function(a){a.stopPropagation()});
return this};
MultipleItemField.prototype.createHTML=function(){var a,b="",c=this;Field.prototype.createHTML.call(this);this.required&&(b="<i>*</i> ");a=this.createHTMLElement("span");a.className="adam-form-label";a.innerHTML=this.label+": "+b;a.style.width=this.parent.labelWidth;a.style.verticalAlign="top";this.html.appendChild(a);this.labelObject=a;a=this.createHTMLElement("ul");a.className="multiple-item-container";a.id=this.name;this.fieldWidth&&this.fieldHeight&&(b=document.createAttribute("style"),this.fieldWidth&&
(b.value+="width: "+this.fieldWidth+"px; "),this.fieldHeight&&(b.value+="height: "+this.fieldHeight+"px; "),a.setAttributeNode(b));b=this.createControlObject();a.appendChild(b);this.html.appendChild(a);this.errorTooltip&&this.html.appendChild(this.errorTooltip.getHTML());this.helpTooltip&&this.html.appendChild(this.helpTooltip.getHTML());this.itemsContainer=a;this.controlObject=b;$(this.parent.body).on("scroll",function(){c.hidePanel()});this.panel.belongsTo=this.itemsContainer;this.parent.parent.html.appendChild(this.panel.getHTML());
this.setItems(this.items);return this.html};MultipleItemField.prototype.evalRequired=function(){var a=!0;this.required&&((a=0<this.items.length)?$(this.itemsContainer).removeClass("required"):$(this.itemsContainer).addClass("required"));return a};MultipleItemField.prototype.getObject=function(){var a,b=[];for(a=0;a<this.items.length;a+=1)b.push(this.items[a].getObject());return b};MultipleItemField.prototype.getObjectValue=function(){this.value=JSON.stringify(this.getObject());return Field.prototype.getObjectValue.call(this)};
var MultipleItemPanel=function(a){Element.call(this,{style:{cssProperties:{display:"none"},cssClasses:["multiple-item-panel"]}});this.matchParentWidth=this.subpanels=this.buttons=this.isOpen=this.belongsTo=null;MultipleItemPanel.prototype.initObject.call(this,a)};MultipleItemPanel.prototype=new Element;MultipleItemPanel.prototype.type="MultipleItemPanel";
MultipleItemPanel.prototype.initObject=function(a){var b={belongsTo:null,buttons:[],matchParentWidth:!0,width:200};$.extend(!0,b,a);this.belongsTo=b.belongsTo;this.buttons=[];this.subpanels=[];this.isOpen=!1;this.width=b.width;this.matchParentWidth=b.matchParentWidth;this.setButtons(b.buttons)};
MultipleItemPanel.prototype.refreshPosition=function(){var a,b=0,c=0;this.html&&(a=getRelativePosition(this.belongsTo,this.html.parentElement),"absolute"!==this.html.parentElement.style.position&&(b=parseInt($(this.html.parentElement).css("margin-top"),10),c=parseInt($(this.html.parentElement).css("margin-left"),10)),this.matchParentWidth&&this.setWidth($(this.belongsTo).outerWidth()-2),this.setY(a.top+b-1+$(this.belongsTo).outerHeight()),this.setX(a.left+c));return this};
MultipleItemPanel.prototype.setBelongsTo=function(a){this.belongsTo=a;this.refreshPosition();return this};MultipleItemPanel.prototype.createSubpanel=function(a,b){var c;switch(b){case "list":c=new MultipleItemListSubpanel(a)}return c};MultipleItemPanel.prototype.createButtonPanel=function(a){return new MultipleItemButtonPanel(a)};MultipleItemPanel.prototype.showSubPanel=function(a){this.html&&this.html.appendChild(a.getHTML())};
MultipleItemPanel.prototype.addSubpanel=function(a,b){var c;c=a instanceof MultipleItemSubpanel?a:this.createSubpanel(a,b);c.parent=this;this.subpanels.push(c);this.html&&this.html.appendChild(c.getHTML());return this};
MultipleItemPanel.prototype.addButton=function(a){var b,c;if("string"===typeof a.caption){b=new Element({style:{cssClasses:["multiple-item-panel-button"],cssProperties:{position:"relative",width:"auto",height:"auto"}}});if("function"===typeof a.onClick)$(b.getHTML()).on("mousedown",function(c){c.stopPropagation();0!==c.button&&void 0!==c.button||a.onClick.call(b,c)});else $(b).on("mousedown",function(a){a.stopPropagation()});b.getHTML().style.position="relative";b.getHTML().style.width="auto";b.getHTML().style.height=
"auto";c=b.createHTMLElement("span");c.innerHTML=a.caption;b.getHTML().appendChild(c);b.data=a.data;b.name=a.caption;this.buttons.push(b);this.html&&this.html.appendChild(b.getHTML())}return this};MultipleItemPanel.prototype.setButtons=function(a){var b;for(b=0;b<a.length;b+=1)this.addButton(a[b]);return this};MultipleItemPanel.prototype.clear=function(){this.buttons=[];this.subpanels=[];$(this.html).empty();return this};
MultipleItemPanel.prototype.createHTML=function(){var a=Element.prototype.createHTML.call(this),b;a.style.height="auto";for(b=0;b<this.subpanels.length;b+=1)this.html.appendChild(this.subpanels[b].getHTML());$(this.html).on("mousedown",function(a){a.stopPropagation()}).on("click",function(a){a.stopPropagation()}).on("mouseup",function(a){a.stopPropagation()});this.matchParentWidth||(a.style.width=this.width+"em");return a};
MultipleItemPanel.prototype.open=function(){var a;if(this.isOpen||!this.belongsTo)return this;this.html||this.getHTML();this.refreshPosition();for(a=0;a<this.buttons.length;a+=1)this.html.appendChild(this.buttons[a].getHTML());this.isOpen=!0;$(this.html).slideDown();return this};MultipleItemPanel.prototype.close=function(){this.isOpen=!1;$(this.html).hide();return this};
MultipleItemPanel.prototype.remove=function(){$(this.html).remove();delete this.subpanels;delete this.belongsTo;delete this.isOpen;delete this.buttons;delete this.matchParentWidth};var MultipleItemSubpanel=function(a){Element.call(this);this.parent=this.onClose=this.onOpen=this.showContentOnStart=this.visibleHeader=this.collapsable=this.content=this.title=this.header=null;this.language={};MultipleItemSubpanel.prototype.initObject.call(this,a)};MultipleItemSubpanel.prototype=new Element;
MultipleItemSubpanel.prototype.type="mutlipleItemSubPanel";MultipleItemSubpanel.prototype.initObject=function(a){var b={title:"",collapsable:!1,showContentOnStart:!1,visibleHeader:!0,onOpen:null,onClose:null,parent:null};$.extend(!0,b,a);this.parent=b.parent;this.showContentOnStart=b.showContentOnStart;this.onOpen=b.onOpen;this.onClose=b.onClose;this.setTitle(b.title).setIsCollapsable(b.collapsable).isVisibleHeader(b.visibleHeader)};
MultipleItemSubpanel.prototype.isVisibleHeader=function(a){this.visibleHeader=a;this.header&&(this.header.style.display=a?"block":"none");return this};MultipleItemSubpanel.prototype.setTitle=function(a){this.title=a;this.header&&$(this.header).find(".header-text").text(this.title);return this};MultipleItemSubpanel.prototype.setIsCollapsable=function(a){"boolean"===typeof a&&(this.collapsable=a);return this};MultipleItemSubpanel.prototype.reset=function(){};
MultipleItemSubpanel.prototype.close=function(){var a=this;this.isOpen=!1;$(this.html).removeClass("opened").find(".header .bullet").removeClass("adam-menu-icon-arrow-down");$(this.content).slideUp(function(){a.reset()});"function"===typeof this.onClose&&this.onClose.call(this);return this};
MultipleItemSubpanel.prototype.open=function(){var a=$(this.content);this.isOpen=!0;if("none"!==a.css("display"))return this;$(this.html).addClass("opened").find(".header .bullet").addClass("adam-menu-icon-arrow-down");this.displayFormOnStart?$(this.content).css("display","block"):$(this.content).slideDown();"function"===typeof this.onOpen&&this.onOpen.call(this);return this};
MultipleItemSubpanel.prototype.attachListeners=function(){var a=this;$(this.header).on("mousedown",function(b){b.stopPropagation();b.preventDefault();if(0===b.button||void 0===b.button)a.isOpen?a.close():a.open()});return this};MultipleItemSubpanel.prototype.hideLoader=function(){this.content&&$(this.content).find(".loader").remove();return this};
MultipleItemSubpanel.prototype.showLoader=function(){var a;if(this.content){if($(this.content).find(".loader").get(0))return this;a=document.createElement("div");a.className="loader";a.appendChild(document.createTextNode("loading..."));$(this.content).prepend(a)}return this};
MultipleItemSubpanel.prototype.createHTML=function(){var a,b,c;this.html||(Element.prototype.createHTML.call(this),this.html.style.height="auto",this.html.style.width="auto",this.html.style.position="relative",this.html.className="multiple-item-subpanel",a=this.createHTMLElement("div"),a.className="header",c=this.createHTMLElement("div"),c.className="content",this.visibleHeader||(a.style.display="none"),this.collapsable&&(b=this.createHTMLElement("span"),b.className="adam-menu-icon-arrow-right bullet",
c.style.display="none",a.appendChild(b)),b=this.createHTMLElement("span"),b.className="header-text",b.appendChild(document.createTextNode(this.title)),a.appendChild(b),this.header=a,this.content=c,this.html.appendChild(a),this.html.appendChild(c),this.attachListeners(),this.showContentOnStart&&$(a).trigger("mousedown"));return this.html};
var MultipleItemListSubpanel=function(a){MultipleItemSubpanel.call(this,a);this.onItemSelect=this.listMaxHeight=this.items=null;MultipleItemListSubpanel.prototype.initObject.call(this,a)};MultipleItemListSubpanel.prototype=new MultipleItemSubpanel;MultipleItemListSubpanel.prototype.initObject=function(a){var b={items:[],listMaxHeight:null,onItemSelect:null};this.items=[];this.listMaxHeight=b.listMaxHeight;this.onItemSelect=a.onItemSelect;$.extend(!0,b,a);this.setItems(b.items)};
MultipleItemListSubpanel.prototype.selectItem=function(a){this.html&&$(this.html).find("li:eq("+a+")").trigger("mousedown");return this};MultipleItemListSubpanel.prototype.setItems=function(a){var b;if(a.push)for(b=0;b<a.length;b+=1)this.addItem(a[b]);return this};
MultipleItemListSubpanel.prototype.displayItem=function(a){var b,c,d=this,e,f=a.label||a.text;if(this.html){e={label:f};b=$(this.html).find("ul");c=$(document.createElement("li"));c.html(f||"untitled");c.data("value",a.value||null);c.data("label",f);c.data("data",$.extend(!0,e,a.data));if("function"===typeof this.onItemSelect)c.on("mousedown",function(a){a.stopPropagation();0!==a.button&&void 0!==a.button||d.onItemSelect.call(d,$(this).data("value"),$(this).data("data"))});b.append(c)}return this};
MultipleItemListSubpanel.prototype.clear=function(){this.items=[];$(this.content).find("ul").empty();return this};MultipleItemListSubpanel.prototype.addItem=function(a){this.items.push(a);this.displayItem(a);return this};
MultipleItemListSubpanel.prototype.createHTML=function(){var a;MultipleItemSubpanel.prototype.createHTML.call(this);a=this.createHTMLElement("ul");a.className="multiple-item-list";a.style.height="auto";a.style.overflow="auto";this.listMaxHeight&&$(a).css("max-height",this.listMaxHeight);this.content.appendChild(a);for(a=0;a<this.items.length;a+=1)this.displayItem(this.items[a]);return this.html};
var MultipleItemButtonPanel=function(a){Element.call(this,{style:{cssClasses:["multiple-item-button-panel"]}});this.fallbackOnClickHandler=this.label=this.buttonsContainer=this.buttons=null;MultipleItemButtonPanel.prototype.initObject.call(this,a)};MultipleItemButtonPanel.prototype=new Element;
MultipleItemButtonPanel.prototype.initObject=function(a){var b={buttons:[],label:"[Button Panel]",fallbackOnClickHandler:null};$.extend(!0,b,a);this.buttons=[];this.fallbackOnClickHandler=b.fallbackOnClickHandler;this.setButtons(b.buttons).setLabel(b.label)};MultipleItemButtonPanel.prototype.setLabel=function(a){this.label=a;this.html&&$(this.html).find(".label").text(a);return this};
MultipleItemButtonPanel.prototype.getButtonHTML=function(a){var b;if(a.html)return a.html;b=this.createHTMLElement("button");b.value=a.value;b.appendChild(document.createTextNode(a.caption));if("function"===typeof a.onClick)$(b).on("mousedown",function(b){b.stopPropagation();0!==b.button&&void 0!==b.button||a.onClick.call(a)});a.html=b;return a.html};
MultipleItemButtonPanel.prototype.addButton=function(a){"object"===typeof a&&(a.onClick||(a.onClick=this.fallbackOnClickHandler),this.buttons.push(a),this.buttonsContainer&&this.buttonsContainer.appendChild(this.getButtonHTML(a)));return this};MultipleItemButtonPanel.prototype.setButtons=function(a){var b;this.buttons=[];this.buttonsContainer&&$(this.buttonsContainer).empty();for(b=0;b<a.length;b+=1)this.addButton(a[b]);return this};
MultipleItemButtonPanel.prototype.createHTML=function(){var a=0,b,c;if(this.html)return this.html;Element.prototype.createHTML.call(this);this.html.style.position="relative";this.html.style.height="auto";this.html.style.width="auto";this.html.style.display="block";this.html.style.textAlign="center";""!==this.label&&(b=this.createHTMLElement("span"),b.className="pmse-label",b.appendChild(document.createTextNode(this.label)));c=this.createHTMLElement("div");c.className="pmse-container";for(a=0;a<this.buttons.length;a+=
1)c.appendChild(this.getButtonHTML(this.buttons[a]));this.buttonsContainer=c;b&&this.html.appendChild(b);this.html.appendChild(c);return this.html};var SingleItem=function(a){Element.call(this,a);this.data=this.onEdit=this.inEditMode=this.onChange=this.editable=this.panel=this.showValueTooptip=this.onClick=this.onRemove=this.value=this.label=null;SingleItem.prototype.initObject.call(this,a)};SingleItem.prototype=new Element;SingleItem.prototype.type="SingleItem";SingleItem.prototype.family="SingleItem";
SingleItem.prototype.initObject=function(a){var b={label:"",value:null,showValueTooptip:!0,editable:!1,data:{},onClick:null,onChange:null,onEdit:null,onRemove:function(){}};$.extend(!0,b,a);this.onRemove=b.onRemove;this.onClick=b.onClick;this.onChange=b.onChange;this.inEditMode=!1;this.data="object"===typeof b.data?b.data:{};this.setLabel(b.label).setShowValueToolTip(b.showValueTooptip).setValue(b.value).setIsEditable(b.editable).setOnEditHandler(b.onEdit)};
SingleItem.prototype.setOnEditHandler=function(a){delete this.setOnEditHandler;this.onEdit="function"===typeof a?a:null;this.refreshCursor();return this};SingleItem.prototype.refreshCursor=function(){this.html&&(this.html.style.cursor=this.editable?"pointer":"function"===typeof this.onClick?"pointer":"default");return this};SingleItem.prototype.setIsEditable=function(a){this.editable=!!a;return this.refreshCursor()};SingleItem.prototype.setValue=function(a){this.value=a;return this.updateHTML()};
SingleItem.prototype.getValue=function(){return this.value};SingleItem.prototype.setLabel=function(a){this.label=a;return this.updateHTML()};SingleItem.prototype.getLabel=function(){return this.label};SingleItem.prototype.setData=function(a,b){this.data[a]=b};SingleItem.prototype.getData=function(a){return a?this.data[a]:this.data};SingleItem.prototype.showCloseButton=function(){this.html&&$(this.html).find(".multiple-item-close").css("visibility","visible");return this};
SingleItem.prototype.hideCloseButton=function(){this.html&&$(this.html).find(".multiple-item-close").css("visibility","hidden");return this};SingleItem.prototype.setShowValueToolTip=function(a){"boolean"===typeof a&&(this.showValueTooptip=a);return this};
SingleItem.prototype.get_html_translation_table=function(a,b){var c={},d={},e,f={},g={},h={},k={};f[0]="HTML_SPECIALCHARS";f[1]="HTML_ENTITIES";g[0]="ENT_NOQUOTES";g[2]="ENT_COMPAT";g[3]="ENT_QUOTES";h=isNaN(a)?a?a.toUpperCase():"HTML_SPECIALCHARS":f[a];k=isNaN(b)?b?b.toUpperCase():"ENT_COMPAT":g[b];if("HTML_SPECIALCHARS"!==h&&"HTML_ENTITIES"!==h)throw Error("Table: "+h+" not supported");c["38"]="&amp;";"HTML_ENTITIES"===h&&(c["160"]="&nbsp;",c["161"]="&iexcl;",c["162"]="&cent;",c["163"]="&pound;",
c["164"]="&curren;",c["165"]="&yen;",c["166"]="&brvbar;",c["167"]="&sect;",c["168"]="&uml;",c["169"]="&copy;",c["170"]="&ordf;",c["171"]="&laquo;",c["172"]="&not;",c["173"]="&shy;",c["174"]="&reg;",c["175"]="&macr;",c["176"]="&deg;",c["177"]="&plusmn;",c["178"]="&sup2;",c["179"]="&sup3;",c["180"]="&acute;",c["181"]="&micro;",c["182"]="&para;",c["183"]="&middot;",c["184"]="&cedil;",c["185"]="&sup1;",c["186"]="&ordm;",c["187"]="&raquo;",c["188"]="&frac14;",c["189"]="&frac12;",c["190"]="&frac34;",c["191"]=
"&iquest;",c["192"]="&Agrave;",c["193"]="&Aacute;",c["194"]="&Acirc;",c["195"]="&Atilde;",c["196"]="&Auml;",c["197"]="&Aring;",c["198"]="&AElig;",c["199"]="&Ccedil;",c["200"]="&Egrave;",c["201"]="&Eacute;",c["202"]="&Ecirc;",c["203"]="&Euml;",c["204"]="&Igrave;",c["205"]="&Iacute;",c["206"]="&Icirc;",c["207"]="&Iuml;",c["208"]="&ETH;",c["209"]="&Ntilde;",c["210"]="&Ograve;",c["211"]="&Oacute;",c["212"]="&Ocirc;",c["213"]="&Otilde;",c["214"]="&Ouml;",c["215"]="&times;",c["216"]="&Oslash;",c["217"]=
"&Ugrave;",c["218"]="&Uacute;",c["219"]="&Ucirc;",c["220"]="&Uuml;",c["221"]="&Yacute;",c["222"]="&THORN;",c["223"]="&szlig;",c["224"]="&agrave;",c["225"]="&aacute;",c["226"]="&acirc;",c["227"]="&atilde;",c["228"]="&auml;",c["229"]="&aring;",c["230"]="&aelig;",c["231"]="&ccedil;",c["232"]="&egrave;",c["233"]="&eacute;",c["234"]="&ecirc;",c["235"]="&euml;",c["236"]="&igrave;",c["237"]="&iacute;",c["238"]="&icirc;",c["239"]="&iuml;",c["240"]="&eth;",c["241"]="&ntilde;",c["242"]="&ograve;",c["243"]=
"&oacute;",c["244"]="&ocirc;",c["245"]="&otilde;",c["246"]="&ouml;",c["247"]="&divide;",c["248"]="&oslash;",c["249"]="&ugrave;",c["250"]="&uacute;",c["251"]="&ucirc;",c["252"]="&uuml;",c["253"]="&yacute;",c["254"]="&thorn;",c["255"]="&yuml;");"ENT_NOQUOTES"!==k&&(c["34"]="&quot;");"ENT_QUOTES"===k&&(c["39"]="&#39;");c["60"]="&lt;";c["62"]="&gt;";c["38"]&&(d[String.fromCharCode("38")]=c["38"]);for(e in c)c.hasOwnProperty(e)&&"38"!==e&&(d[String.fromCharCode(e)]=c[e]);return d};
SingleItem.prototype.htmlentities=function(a,b,c,d){var e=this.get_html_translation_table("HTML_ENTITIES",b),f="";a=null==a?"":a+"";if(!e)return!1;b&&"ENT_QUOTES"===b&&(e["'"]="&#039;");if(d||null==d)for(f in e)e.hasOwnProperty(f)&&(a=a.split(f).join(e[f]));else a=a.replace(/([\s\S]*?)(&(?:#\d+|#x[\da-f]+|[a-zA-Z][\da-z]*);|$)/g,function(a,b,c){for(f in e)e.hasOwnProperty(f)&&(b=b.split(f).join(e[f]));return b+c});return a};
SingleItem.prototype.updateHTML=function(a){this.html&&(a=("undefined"!==typeof a?a:1)?this.htmlentities(this.getLabel()):this.getLabel(),/\s\s/.test(a)&&(a=a.replace(/\s/g,"&nbsp;")),$(this.html).find("span.pmse-small-label").html(a),this.showValueTooptip&&this.value&&this.html.setAttribute("title",this.value),$(this.html).find(".multiple-item-icon").removeClass().addClass("multiple-item-icon").addClass(this.iconClasses).css("display",this.showIcon?"inline-block":"none"));return this};
SingleItem.prototype.edit=function(){};SingleItem.prototype.prepareEditionPanel=function(){};SingleItem.prototype.exitEditMode=function(){if(!this.inEditMode)return this;this.showCloseButton().panel.close();$(this.html).removeClass("expanded");this.inEditMode=!1;return this};
SingleItem.prototype.onClickHandler=function(){var a=this;return function(b){b.stopPropagation();a.editable?a.inEditMode?a.exitEditMode():(a.panel||(a.panel=new MultipleItemPanel({belongsTo:a.html,width:50})),a.prepareEditionPanel().hideCloseButton().html.parentElement.parentElement.appendChild(a.panel.getHTML()),$(a.html).addClass("expanded"),a.inEditMode=!0,a.panel.open(),"function"===typeof a.onEdit&&a.onEdit.call(a)):"function"===typeof a.onClick&&a.onClick.call(a)}};
SingleItem.prototype.createHTML=function(a){if(this.html)return this.html;var b=document.createElement("li"),c=document.createElement("span"),d=this;c.className="pmse-small-label";"undefined"===typeof a||a?$(c).html(this.htmlentities(this.getLabel()||"")):$(c).html(this.getLabel());b.setAttribute("id",this.id);this.showValueTooptip&&this.value&&b.setAttribute("title",this.value);b.appendChild(c);a=document.createElement("div");a.className="multiple-item-close";$(a).on("click",function(a){a.stopPropagation();
$(d.html).remove();"function"===typeof d.onRemove&&d.onRemove.call(d)});b.appendChild(a);this.html=b;$(b).on("click",d.onClickHandler());this.refreshCursor();return this.html};SingleItem.prototype.getObject=function(){return{label:this.label,value:this.value}};
var EmailPickerField=function(a,b){MultipleItemField.call(this,a,b);this.valueField=this.nameField=this.searchValue=this.selectedHandler=this.groups=this.timer=this.keyDelay=null;this.suggestionsPanel;EmailPickerField.prototype.initObject.call(this,a)};EmailPickerField.prototype=new MultipleItemField;EmailPickerField.prototype.type="EmailPickerField";
EmailPickerField.prototype.initObject=function(a){var b={keyDelay:500,nameField:"text",valueField:"value",groups:[],showValue:!0,language:{LBL_SUGGESTIONS:"Suggestions",LBL_SUGGESTIONS_FOR:"suggestion(s) for",LBL_CONFIGURABLE:"configurable",ERROR_PROPERLY_SET_ITEMS:"All the items must be properly set"},varPanel:!1,fieldsProxy:new SugarProxy({url:"pmse_Project/CrmData/allFields/"+PROJECT_MODULE,uid:PROJECT_MODULE,callback:null}),modulesProxy:new SugarProxy({url:"pmse_Project/CrmData/related/"+PROJECT_MODULE,
uid:PROJECT_MODULE,callback:null})},c={nameField:"text",valueField:"value",showValue:!0};$.extend(!0,b,a);this.language=b.language;this.groups=new jCore.ArrayList;for(a=0;a<b.groups.length;a+=1)b.groups[a]=$.extend({},c,b.groups[a]);this.setKeyDelay(b.keyDelay).setGroups(b.groups).setNameField(b.nameField).setValueField(b.valueField);this.fieldsProxy=b.fieldsProxy;this.modulesProxy=b.modulesProxy;this.varPanel=b.varPanel;this.viewingForm=!1;this.base_module=PROJECT_MODULE;this.base_module_label=translate("LBL_PMSE_ADAM_UI_LBL_TARGET_MODULE")};
EmailPickerField.prototype.setNameField=function(a){this.nameField=a;return this};EmailPickerField.prototype.getNameField=function(){return this.nameField};EmailPickerField.prototype.setValueField=function(a){this.valueField=a;return this};EmailPickerField.prototype.getValueField=function(){return this.valueField};EmailPickerField.prototype.setGroups=function(a){var b;for(b=0;b<a.length;b++)this.groups.insert(a[b]);return this};EmailPickerField.prototype.setKeyDelay=function(a){this.keyDelay=a;return this};
EmailPickerField.prototype.hidePanel=function(){MultipleItemField.prototype.hidePanel.call(this);this.clearSelectedHandler();this.panel.clear()};EmailPickerField.prototype.clearInput=function(){this.searchValue=$(this.controlObject).val("").val();return this};
EmailPickerField.prototype.addItem=function(a){console.log("add item");var b=this.items.length,c=this;"object"===typeof a&&(a.label=a.label||a.name,a.value=a.value||a.emailAddress);a=new EmailItem({label:a.label||"",value:a.value||null,module:a.module,data:a.data});this.items.push(a);$(this.controlObject).before(a.getHTML());a.onRemove=function(){c.removeItem(this)};this.hidePanel();if(this.parent.loaded)this.onChange();if(b+1!==this.items.length)return this;a.getValue()||(a.onClick=function(){c.clearSelectedHandler();
c.selectedHandler=this;$(this.html).addClass("focused");c.loadGroupSuggestions(this.getData("groupName"))});$(this.controlObject).val("").focus().select();this.hidePanel();return this};
EmailPickerField.prototype.processInputValue=function(a){var b=!0,c,d;c=this.suggestionsPanel.items;for(d=0;d<c.length;d+=1)if($.trim(c[d].value)===a){this.suggestionsPanel.selectItem(d);return}/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*\@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/.test(a)||(b=!1);b&&this.addItem({label:a,value:a});return b};EmailPickerField.prototype.hideSuggestionsList=function(){this.suggestionsPanel&&$(this.suggestionsPanel.html).remove();return this};
EmailPickerField.prototype.createHTML=function(){var a;MultipleItemField.prototype.createHTML.call(this);this.createConfigBtn();a=this.createHTMLElement("i");a.appendChild(this.configBtn);this.configBtn=a;this.html.appendChild(a);return this};
EmailPickerField.prototype.createConfigBtn=function(){var a,b,c=this,d,e;a=document.createElement("a");a.id="conf_"+this.id;b=document.createElement("span");b.className="adam-item-icon adam-menu-icon-configure";b.style.top="0px";b.style.position="relative";b.style.display="inline-block";a.appendChild(b);$(this.itemsContainer);this.configBtn=a;$(this.configBtn).on("click",function(a){for(d=0;d<c.parent.items.length;d+=1)e=c.parent.items[d],e.panel&&"MultipleItemPanel"===e.panel.type&&e.panel.close();
c.showListPanel();c.showConfigBtn=!0});return this};
EmailPickerField.prototype.attachListeners=function(){MultipleItemField.prototype.attachListeners.call(this);var a,b=this,c=$(this.itemsContainer);a=$(this.controlObject);a.off("blur");c.on("blur",".multiple-item-input",function(){b.viewingForm||(b.hidePanel(),c.removeClass("focused"),$(b.panel.html).removeClass("focused"))});a.on("click",function(a){b.clearSelectedHandler();b.hideSuggestionsList();b.showPanel()}).on("keyup",function(a){console.log("here suggestion");a.stopPropagation();var c;c=$.trim(this.value);
clearInterval(b.timer);13===a.keyCode?c?b.processInputValue(c)||$(b.controlObject).focus().select():b.showPanel(["groups"]):27===a.keyCode?($(b.controlObject).val(""),b.hidePanel()):c&&c!==b.searchValue&&b.proxy?(b.showPanel(["groups","suggestions"]),b.timer=setInterval(function(){clearInterval(b.timer);c&&(b.loadSuggestions(c),b.searchValue=c)},b.keyDelay)):b.hideSuggestionsList()})};
EmailPickerField.prototype.onSuggestionSelectHandler=function(){var a=this;return function(b,c,d){"group"===c.type&&a.selectedHandler?(a.selectedHandler.setValue(c.groupName),a.selectedHandler.setLabel(c.name),a.selectedHandler.onClick=null,a.hidePanel(),a.onChange()):a.addItem({label:c.name,value:b})}};
EmailPickerField.prototype.showSuggestionsPanel=function(){0===this.panel.subpanels.length&&(this.suggestionsPanel||(this.suggestionsPanel=this.panel.createSubpanel({title:this.language.LBL_SUGGESTIONS,onItemSelect:this.onSuggestionSelectHandler(),listMaxHeight:200},"list")),this.panel.addSubpanel(this.suggestionsPanel));this.suggestionsPanel.clear();this.panel.showSubPanel(this.suggestionsPanel);this.suggestionsPanel.showLoader();this.suggestionsPanel.setTitle(this.language.LBL_SUGGESTIONS);return this};
EmailPickerField.prototype.showGroupsList=function(){var a,b,c=this.groups.getSize(),d=function(a,b){return function(){var c=[],d="",k=!1;this.data.value||(c=["unset"]);"Module"===this.data.name?(d="icon-module",k=!0):"Team"===this.data.name&&(d="adam-menu-icon-group",k=!0);a.addItem(new EmailItem({label:this.data.name,value:this.data.value,showIcon:k,iconClasses:d,data:{proxy:this.data.proxy||null,nameField:this.data.nameField,valueField:this.data.valueField,showValue:this.data.showValue||!1,groupName:b},
cssClasses:c}))}};if(0<this.panel.buttons.length)return this;for(a=0;a<c;a+=1)b=this.groups.get(a),this.panel.addButton({caption:"<b>"+b.name+"</b>"+(b.proxy?"&nbsp;<small>["+this.language.LBL_CONFIGURABLE+"]</small>":""),data:{name:b.name,value:b.value||null,proxy:b.proxy,nameField:b.nameField,valueField:b.valueField,showValue:b.showValue},onClick:d(this,b.name)});return this};
EmailPickerField.prototype.onListItemSelected=function(a,b){var c=this;return function(d,e){var f="{::"+b+"::"+d+"::}";c.addItem(new EmailItem({label:f,value:f,module:a}))}};EmailPickerField.prototype.filterFielsByType=function(a,b){var c=[],d,e;for(d=0;d<a.length;d+=1)e=a[d],e.type===b&&c.push(e);return c};EmailPickerField.prototype.clearSelectedHandler=function(){this.selectedHandler=null;$(this.itemsContainer).find("> li.focused").removeClass("focused");return this};
EmailPickerField.prototype.showListPanel=function(a){var b,c,d=this;MultipleItemField.prototype.showPanel.call(this);this.fieldsProxy.uid=PROJECT_MODULE;this.fieldsProxy.getData(null,{success:function(a){d.panel.clear();c=new MultipleItemListSubpanel({title:translate("LBL_PMSE_ADAM_UI_TITLE_MODULE_FIELDS",translate("LBL_PMSE_LABEL_TARGETMODULE")),collapsable:!1,items:d.filterFielsByType(a.fields,"TextField"),onItemSelect:d.onListItemSelected(PROJECT_MODULE,PROJECT_MODULE)});d.panel.html.appendChild(c.getHTML());
for(b=0;b<a.related_modules.length;b+=1)c=new MultipleItemListSubpanel({title:translate("LBL_PMSE_ADAM_UI_TITLE_MODULE_FIELDS",a.related_modules[b].text),collapsable:!0,items:d.filterFielsByType(a.related_modules[b].fields,"TextField"),onItemSelect:d.onListItemSelected(a.related_modules[b].value,a.related_modules[b].value)}),d.panel.html.appendChild(c.getHTML())}});return this};
EmailPickerField.prototype.showPanel=function(a){var b;a&&a.push||(a=["groups"]);this.panel.clear();for(b=0;b<a.length;b++)switch(a[b]){case "groups":this.showGroupsList();break;case "suggestions":this.showSuggestionsPanel()}MultipleItemField.prototype.showPanel.call(this);return this};
EmailPickerField.prototype.fillSuggestionsList=function(a,b){var c=0,d,e,f=[],g={nameField:this.nameField,valueField:this.valueField,type:"single",showValue:!0},c=0;$.extend(!0,g,b);this.suggestionsPanel.setTitle(this.language.LBL_SUGGESTIONS);if(a.result)for(c=a.result.length,d=0;d<c;d+=1)e="<b>"+a.result[d][g.nameField]+"</b>",a.result[d][g.valueField]&&g.showValue&&(e+="<br/><small>"+a.result[d][g.valueField]+"</small>"),f.push({label:e,value:a.result[d][g.valueField]||a.result[d][g.nameField],
data:{name:a.result[d][g.nameField],type:g.type,groupName:b&&b.name||null}});this.suggestionsPanel.hideLoader();g.resultMessage?this.suggestionsPanel.setTitle(g.resultMessage+" ("+c+")"):this.suggestionsPanel.setTitle(c+" "+this.language.LBL_SUGGESTIONS_FOR+' "'+a.search+'"');this.suggestionsPanel.setItems(f);return this};
EmailPickerField.prototype.loadSuggestions=function(a,b){this.showPanel(["suggestions"]);if(a=$.trim(a||""))this.proxy.uid=a,this.proxy.url="pmse_Project/CrmData/emails/"+a,self=this,this.proxy.getData(null,{success:function(a){self.fillSuggestionsList(a,b)}});return this};
EmailPickerField.prototype.loadGroupSuggestions=function(a){var b=this;this.showPanel(["suggestions"]);a=this.groups.find("name",a);a.proxy.getData(null,{success:function(c){b.fillSuggestionsList(c,$.extend(!0,{resultMessage:a.name+" list",type:"group"},a))}})};
EmailPickerField.prototype.isValid=function(){var a,b=!0;for(a=0;a<this.items.length;a+=1)if(b=b&&!!this.items[a].getValue())$(this.errorTooltip.html).removeClass("adam-tooltip-error-on"),$(this.errorTooltip.html).addClass("adam-tooltip-error-off");else return this.errorTooltip.setMessage(this.language.ERROR_PROPERLY_SET_ITEMS),$(this.errorTooltip.html).removeClass("adam-tooltip-error-off"),$(this.errorTooltip.html).addClass("adam-tooltip-error-on"),b;return b=b&&Field.prototype.isValid.call(this)};
EmailPickerField.prototype.getObject=function(){var a,b=[],c;for(a=0;a<this.items.length;a++)c=this.items[a].getObject(),b.push({name:c.label,emailAddress:c.value,module:c.module});return b};var EmailItem=function(a){SingleItem.call(this,a);this.emailItemType=this.showIcon=this.iconClasses=this.colorAlert=null;EmailItem.prototype.initObject.call(this,a)};EmailItem.prototype=new SingleItem;EmailItem.prototype.type="EmailItem";EmailItem.prototype.emailType={SINGLE:0,GROUP:1};
EmailItem.prototype.initObject=function(a){var b={colorAlert:!0,iconClasses:null,showIcon:!1,emailItemType:this.emailType.SINGLE,module:null};$.extend(!0,b,a);this.colorAlert=b.colorAlert;this.setIconClasses(b.iconClasses).setIconVisible(b.showIcon);this.module=b.module};EmailItem.prototype.setIconVisible=function(a){this.showIcon=a;this.updateHTML();return this};EmailItem.prototype.setIconClasses=function(a){this.iconClasses=a;this.updateHTML();return this};
EmailItem.prototype.updateHTML=function(){SingleItem.prototype.updateHTML.call(this);this.colorAlert&&(null!==this.getValue()?$(this.html).removeClass("unset"):$(this.html).addClass("unset"));return this};
EmailItem.prototype.createHTML=function(){var a;if(this.html)return this.html;SingleItem.prototype.createHTML.call(this);a=this.createHTMLElement("span");a.className="multiple-item-icon";this.iconClasses&&$(a).addClass(this.iconClasses);this.showIcon||(a.style.display="none");$(this.html).prepend(a);return this.html};EmailItem.prototype.getObject=function(){return{label:this.label,value:this.value,module:this.module}};
var ItemMatrixField=function(a,b){Field.call(this,a,b);this.moduleName=null;this.lockedFields=[];this.terminateFields={};this.nColumns=this.visualStyle=this.searchValue=this.selectedHandler=this.keyDelay=this.fieldHeight=this.fieldWidth=null;ItemMatrixField.prototype.initObject.call(this,a)};ItemMatrixField.prototype=new Field;ItemMatrixField.prototype.initObject=function(a){var b={visualStyle:"list",nColumns:2};$.extend(!0,b,a);this.setFieldWidth(b.fieldWidth).setFieldHeight(b.fieldHeight).setName(b.name).setVisualStyle(b.visualStyle).setNColumns(b.nColumns)};
ItemMatrixField.prototype.createHTML=function(){var a,b="";Field.prototype.createHTML.call(this);this.required&&(b="<i>*</i> ");a=this.createHTMLElement("span");a.className="adam-form-label";a.innerHTML=b+this.label+":";a.style.width=this.parent.labelWidth;a.style.verticalAlign="top";this.html.appendChild(a);"list"===this.visualStyle?(a=this.createHTMLElement("ul"),a.className="adam-item-matrix"):(a=this.createHTMLElement("div"),a.className="adam-item-matrix table");this.fieldWidth&&this.fieldHeight&&
(b=document.createAttribute("style"),this.fieldWidth&&(b.value+="width: "+this.fieldWidth+"px; "),this.fieldHeight&&(b.value+="height: "+this.fieldHeight+"px; "),b.value+="display: inline-block; margin: 0; overflow: auto; padding: 3px;",a.setAttributeNode(b));this.html.appendChild(a);this.controlObject=a;return this.html};
ItemMatrixField.prototype.attachListeners=function(){var a=this;$(this.controlObject).on("click",".item-matrix-field",function(){$(this).is(":checked")?a.addLockedFields($(this).attr("value")):a.removeLockedFields($(this).attr("value"))});$(this.controlObject).on("change",".item-matrix-field",function(){a.parent.setDirty(!0)})};ItemMatrixField.prototype.setFieldHeight=function(a){this.fieldHeight=a;return this};ItemMatrixField.prototype.setFieldWidth=function(a){this.fieldWidth=a;return this};
ItemMatrixField.prototype.setNColumns=function(a){this.nColumns=a;return this};ItemMatrixField.prototype.setNameModule=function(a){this.nameModule=a;return this};ItemMatrixField.prototype.setLockedFields=function(a){"object"===typeof a&&a instanceof Array&&(this.lockedFields=a);return this};ItemMatrixField.prototype.setVisualStyle=function(a){this.visualStyle=a;return this};ItemMatrixField.prototype.addLockedFields=function(a){this.lockedFields.push(a);return this};
ItemMatrixField.prototype.removeLockedFields=function(a){a=this.lockedFields.indexOf(a);this.lockedFields.splice(a,1);return this};ItemMatrixField.prototype.setList=function(a,b){var c,d="";if(this.html){$(this.controlObject).empty();this.lockedFields=[];"table"===this.visualStyle&&(d+='<div class="row">');for(c=0;c<a.length;c+=1)d+=this.generateOption(a[c],b),0===(c+1)%this.nColumns&&(d+='</div><div class="row">');"table"===this.visualStyle&&(d+="</div></div>");this.controlObject.innerHTML=d}return this};
ItemMatrixField.prototype.generateOption=function(a,b){var c="",d,e,f;"object"===typeof a&&(d=a.value,e=a.text);"object"===typeof b&&b instanceof Array&&-1!==b.indexOf(d)&&(this.addLockedFields(d),f='checked = "checked"');return c="list"===this.visualStyle?'<li style="list-style-type: none;"><label><input type="checkbox" name="'+d+'" value="'+d+'" class="item-matrix-field" '+f+"/> "+e+"</label></li>":'<div class="box cell"><input type="checkbox" name="'+d+'" value="'+d+'" class="item-matrix-field" '+
f+"/> <span>"+e+"</span></div>"};ItemMatrixField.prototype.getFieldHeight=function(){return this.fieldHeight};ItemMatrixField.prototype.getFieldWidth=function(){return this.fieldWidth};ItemMatrixField.prototype.getNameModule=function(){return this.nameModule};ItemMatrixField.prototype.getLockedField=function(){return this.lockedFields};ItemMatrixField.prototype.getObjectValue=function(){this.value=JSON.stringify(this.lockedFields);return Field.prototype.getObjectValue.call(this)};
var ItemUpdaterField=function(a,b){Field.call(this,a,b);this.fields=[];this.options=[];this.visualObject=this.fieldHeight=null;this.language={};ItemUpdaterField.prototype.initObject.call(this,a)};ItemUpdaterField.prototype=new Field;ItemUpdaterField.prototype.type="ItemUpdaterField";ItemUpdaterField.prototype.initObject=function(a){var b={fields:[],fieldHeight:null,language:{LBL_ERROR_ON_FIELDS:"Please, correct the fields with errors"}};$.extend(!0,b,a);this.language=b.language;this.setFields(b.fields).setFieldHeight(b.fieldHeight)};
ItemUpdaterField.prototype.setFields=function(a){var b,c=[],d;for(b=0;b<a.length;b+=1)"FieldUpdater"===a[b].type?(a[b].setParent(this),c.push(a[b])):(d=new FieldUpdater(item[b],this),c.push(d));this.fields=c;return this};ItemUpdaterField.prototype.setFieldHeight=function(a){this.fieldHeight=a;return this};
ItemUpdaterField.prototype.getObjectValue=function(){var a,b=[];this.convertOptionsToFields();for(a=0;a<this.fields.length;a+=1)b.push(this.fields[a].getJSONObject());this.value=JSON.stringify(b);return Field.prototype.getObjectValue.call(this)};ItemUpdaterField.prototype.getJsonValue=function(){var a,b=[];for(a=0;a<this.options.length;a++)this.options&&this.options[a].active&&(field=new FieldUpdater(this.options[a],this),b.push(field.getJSONObject()));return JSON.stringify(b)};
ItemUpdaterField.prototype.convertOptionsToFields=function(){var a=[],b;for(b=0;b<this.options.length;b+=1)this.options&&this.options[b].active&&a.push(new FieldUpdater(this.options[b],this));this.fields=a;return this};
ItemUpdaterField.prototype.setOptions=function(a){var b,c=[],d;if(a)for(b=0;b<a.length;b+=1)"id"!==a[b].type.toLowerCase()&&(d="FieldOption"===a[b].type?a[b]:new FieldOption({fieldId:a[b].value,fieldName:a[b].text,fieldType:a[b].type.toLowerCase(),fieldItems:a[b].optionItem,required:!!a[b].required},this),c.push(d));this.options=c;if(this.html)for(this.visualObject.innerHTML="",b=0;b<this.options.length;b+=1)insert=this.options[b].getHTML(),0===b%2&&(insert.className+=" updater-inverse"),this.visualObject.appendChild(insert);
return this};
ItemUpdaterField.prototype.createHTML=function(){var a,b="";Field.prototype.createHTML.call(this);this.required&&(b="<i>*</i> ");a=this.createHTMLElement("span");a.className="adam-form-label";a.innerHTML=b+this.label+":";a.style.width=this.parent.labelWidth;a.style.verticalAlign="top";this.html.appendChild(a);a=this.createHTMLElement("div");a.className="adam-item-updater table";a.id=this.id;if(this.fieldWidth||this.fieldHeight)style=document.createAttribute("style"),this.fieldWidth&&(style.value+=
"width: "+this.fieldWidth+"px; "),this.fieldHeight&&(style.value+="height: "+this.fieldHeight+"px; "),style.value+="display: inline-block; margin: 0; overflow: auto; padding: 3px;",a.setAttributeNode(style);for(i=0;i<this.options.length;i+=1)insert=this.options[i].getHTML(),console.log(i%2,"aa"),0===i%2&&(insert.className+=" updater-inverse"),a.appendChild(insert);this.html.appendChild(a);this.errorTooltip&&this.html.appendChild(this.errorTooltip.getHTML());this.helpTooltip&&this.html.appendChild(this.helpTooltip.getHTML());
this.visualObject=a;return this.html};
ItemUpdaterField.prototype.setValue=function(a){this.value=a;if(this.options&&0<this.options.length)try{if((fields=JSON.parse(a))&&0<fields.length)for(i=0;i<fields.length;i+=1)for(j=0;j<this.options.length;j+=1)if(fields[i].field===this.options[j].fieldId){this.options[j].active=!0;this.options[j].checkboxControl.checked=!0;this.options[j].textControl.disabled=!1;this.options[j].fieldValue=fields[i].value;this.options[j].value=fields[i].value;"date"===this.options[j].fieldType?$(this.options[j].textControl).datepicker("option",
{disabled:!1}):"datetime"===this.options[j].fieldType&&$(this.options[j].textControl).datetimepicker("option",{disabled:!1});"checkbox"==this.options[j].fieldType&&(this.options[j].textControl.checked="on"==fields[i].value?!0:!1);this.options[j].textControl.value=fields[i].value;break}}catch(b){}return this};
ItemUpdaterField.prototype.isValid=function(){var a,b=!0,c;for(a=0;a<this.options.length&&(c=this.options[a],b=b&&c.isValid(),b);a+=1);b?($(this.errorTooltip.html).removeClass("adam-tooltip-error-on"),$(this.errorTooltip.html).addClass("adam-tooltip-error-off"),b=b&&Field.prototype.isValid.call(this)):(this.visualObject.scrollTop+=getRelativePosition(c.getHTML(),this.visualObject).top,this.errorTooltip.setMessage(this.language.LBL_ERROR_ON_FIELDS),$(this.errorTooltip.html).removeClass("adam-tooltip-error-off"),
$(this.errorTooltip.html).addClass("adam-tooltip-error-on"));return b};var FieldUpdater=function(a,b){Base.call(this,a);this.module=this.label=this.parent=this.value=this.fieldName=this.field=null;FieldUpdater.prototype.initObject.call(this,a,b)};FieldUpdater.prototype=new Base;FieldUpdater.prototype.type="FieldUpdater";
FieldUpdater.prototype.initObject=function(a,b){if(a&&"FieldOption"===a.type)this.setField(a.fieldId).setFieldName(a.fieldName).setValue(a.fieldValue).setParent(b||null);else{var c={field:null,fieldName:null,value:null,label:null,module:null};$.extend(!0,c,a);this.setField(c.field).setFieldName(c.fieldName).setValue(c.value).setLabel(c.label).setModule(c.module).setParent(b||null)}};FieldUpdater.prototype.setField=function(a,b){this.field=a;"undefined"!==typeof b&&(this.fieldName=b);return this};
FieldUpdater.prototype.setFieldName=function(a){this.fieldName=a;return this};FieldUpdater.prototype.setValue=function(a){this.value=a;return this};FieldUpdater.prototype.setParent=function(a){this.parent=a;return this};FieldUpdater.prototype.setLabel=function(a){this.label=a;return this};FieldUpdater.prototype.setModule=function(a){this.module=a;return this};FieldUpdater.prototype.getLabel=function(){!this.label&&this.field&&this.fieldName&&(this.label=this.fieldName+" = '"+this.value+"'");return this.label};
FieldUpdater.prototype.getJSONObject=function(){return{field:this.field,fieldName:this.fieldName,value:this.value}};var FieldOption=function(a,b){Element.call(this,a);this.value=this.parent=this.textControl=this.checkboxControl=this.fieldItems=this.fieldValue=this.fieldName=this.fieldId=this.active=this.parent=null;this.language={};this.required=this.maxLength=null;FieldOption.prototype.initObject.call(this,a,b)};FieldOption.prototype=new Element;FieldOption.prototype.type="FieldOption";
FieldOption.prototype.initObject=function(a,b){var c;c={active:!1,fieldId:null,fieldValue:"",fieldName:null,fieldType:null,fieldItems:null,maxLength:0,language:{ERROR_FIELD_REQUIRED:"This field is required",ERROR_INVALID_INTEGER:"This field accepts only a integer value",ERROR_INVALID_DATETIME:"This field accepts only a datetime value",ERROR_INVALID_DATE:"This field accepts only a date value",ERROR_INVALID_PHONE:"This field accepts only a phone value",ERROR_INVALID_FLOAT:"This field accepts only a float value",
ERROR_INVALID_DECIMAL:"This field accepts only a decimal value",ERROR_INVALID_URL:"This field accpets only an url",ERROR_INVALID_CURRENCY:"This field accepts only a currency value",ERROR_INVALID_EMAIL:"This field accepts only e-mail addresses"},required:!1};$.extend(!0,c,a);this.language=c.language;this.setParent(b);this.setRequired(c.required).setMaxLength(c.maxLength).setActive(c.active).setFieldId(c.fieldId).setFieldName(c.fieldName).setFieldValue(c.fieldValue).setFieldType(c.fieldType).setFieldItems(c.fieldItems).setMessageError(c.messageError).setErrorTooltip({})};
FieldOption.prototype.setRequired=function(a){this.required=!!a;this.html&&$(this.html).find(".required.noshadow").show();return this};FieldOption.prototype.setMaxLength=function(a){a=parseInt(a,10);isNaN(a)||(this.maxLength=a,this.textControl&&(0<a?this.textControl.maxLength=a:this.textControl.removeAttribute("maxlength")));return this};FieldOption.prototype.setActive=function(a){this.active=a;return this};FieldOption.prototype.setFieldId=function(a){this.fieldId=a;return this};
FieldOption.prototype.setFieldName=function(a){this.fieldName=a;return this};FieldOption.prototype.setFieldValue=function(a){this.value=this.fieldValue=a;this.textControl&&$(this.textControl).val(a);return this};FieldOption.prototype.setFieldType=function(a){this.fieldType=a;return this};FieldOption.prototype.setFieldItems=function(a){this.fieldItems=a;return this};FieldOption.prototype.setParent=function(a){this.parent=a;return this};
FieldOption.prototype.createHTML=function(){var a,b,c,d,e;Element.prototype.createHTML.call(this);this.style.removeProperties("width height position top left z-index".split(" "));this.style.width="100%";this.style.addClasses(["row"]);a=this.createHTMLElement("div");a.className="cell";a.style.width="30%";b=document.createElement("input");b.id="chk_"+this.id;b.type="checkbox";b.className="adam-updater-checkbox";a.appendChild(b);this.checkboxControl=b;b=document.createElement("span");b.innerHTML=this.fieldName;
b.className="adam-updater-label";a.appendChild(b);b=b.cloneNode(!1);b.className="required noshadow";b.textContent="*";b.style.display=this.required?"inline":"none";a.appendChild(b);this.html.appendChild(a);a=this.createHTMLElement("div");a.className="cell";a.style.width="58%";if("dropdown"===this.fieldType){b=document.createElement("select");for(e in this.fieldItems)d=document.createElement("option"),d.value=e,d.style.marginBottom="0px",d.innerHTML=e,b.appendChild(d);b.id="val_"+this.id;b.type="dropdown";
b.className="adam-updater-value";a.appendChild(b);b.value=this.fieldValue;e=document.createAttribute("disabled");b.setAttributeNode(e);this.textControl=b}else"checkbox"===this.fieldType?(d=document.createElement("input"),d.id="val_"+this.id,d.type="checkbox",d.className="adam-updater-checkbox",b=document.createElement("label"),b.htmlFor="label"+this.id,a.appendChild(b),a.appendChild(d),d.checked="on"==this.fieldValue?!0:!1,e=document.createAttribute("disabled"),readAttLabel=document.createAttribute("disabled"),
d.setAttributeNode(e),b.setAttributeNode(readAttLabel),this.textControl=d):(c=document.createElement("input"),c.id="val_"+this.id,c.type="text",c.className="adam-updater-value",c.readOnly="date"===this.fieldType||"datetime"===this.fieldType,a.appendChild(c),c.value=this.fieldValue,e=document.createAttribute("disabled"),c.setAttributeNode(e),"password"===this.fieldType&&(c.type="password"),this.textControl=c);this.setMaxLength(this.maxLength);"date"===this.fieldType&&$(c).datepicker({showOn:"button",
constrainInput:!1,disabled:!0}).next("button").text("").button({icons:{primary:"ui-icon-calendar"}});"datetime"===this.fieldType&&$(c).datetimepicker({showOn:"button",constrainInput:!1,disabled:!0}).next("button").text("").button({icons:{primary:"ui-icon-calendar"}});this.html.appendChild(a);a=this.createHTMLElement("div");a.className="cell";a.style.width="5%";this.errorTooltip&&a.appendChild(this.errorTooltip.getHTML());this.html.appendChild(a);a=this.createHTMLElement("div");a.className="clear";
this.html.appendChild(a);this.attachListeners();return this.html};
FieldOption.prototype.attachListeners=function(){var a=this;$(this.checkboxControl).click(function(b){a.checkboxControl.checked?(a.textControl.disabled=!1,a.setActive(!0).setFieldValue(a.textControl.value),"date"!==a.fieldType&&"datetime"!==a.fieldType||$(a.textControl).datepicker("option",{disabled:!1})):(a.textControl.disabled=!0,a.setActive(!1),$(a.textControl).removeClass("required"),$(a.errorTooltip.html).addClass("adam-tooltip-error-off"),"date"!==a.fieldType&&"datetime"!==a.fieldType||$(a.textControl).datepicker("option",
{disabled:!0}),a.setFieldValue(""))});$(this.textControl).change(function(b){"checkbox"==a.textControl.type&&(a.textControl.value="off",1==a.textControl.checked&&(a.textControl.value="on"));a.setFieldValue(a.textControl.value);!a.isValid()&&a.errorTooltip&&($(a.errorTooltip.html).removeClass("adam-tooltip-error-off"),$(a.errorTooltip.html).addClass("adam-tooltip-error-on"))});$(this.checkboxControl).change(function(b){a.parent.parent.setDirty(!0)})};
FieldOption.prototype.setMessageError=function(a){this.messageError=a;return this};FieldOption.prototype.setErrorTooltip=function(a){a?(a.css||(a.css="adam-tooltip-error-off"),a.icon||(a.icon="adam-tooltip-icon-error"),a.visible=!1,this.errorTooltip=new Tooltip(a,this)):this.errorTooltip=null;return this};FieldOption.prototype.evalRequired=function(){if(this.required)switch(this.fieldType){case "checkbox":return!0;default:return!!this.textControl.value}else return!0};
FieldOption.prototype.validInput=function(){var a=this.textControl.value,b;switch(this.fieldType){case "integer":return/^-?\d+$/.test(a);case "datetime":if(!/^\d\d(\/\d\d){2}(\d){2}\s\d\d(:\d\d){1,2}$/.test(a))return!1;b=a.split(" ");a=b[1];a=a.split(":");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10);a[2]=a[2]?parseInt(a[2],10):null;if(23<a[0]||59<a[1]||a[2]&&59<a[2])return!1;a=b[0];case "date":if(!/^\d\d\/\d\d\/(\d){4}$/.test(a))return!1;a=a.split("/");b={};b.y=parseInt(a[2],10);b.m=parseInt(a[0],
10);b.d=parseInt(a[1],10);if(1>b.m||12<b.m||1>b.d||31<b.d)return!1;if(4===b.m||6===b.m||9===b.m||11===b.m){if(30<b.d)return!1}else if(2===b.m)if(0===b.y%4&&0!==b.y%100||0===b.y%400){if(29<b.d)return!1}else if(28<b.d)return!1;break;case "float":return/^-?\d*(\.\d+)?$/.test(a);case "decimal":return/^-?\d+(\.\d{1,2})?$/.test(a);case "url":return/^(ht|f)tps?:\/\/\w+([\.\-\w]+)?\.([a-z]{2,4}|travel)(:\d{2,5})?(\/.*)?$/i.test(a);case "currency":return/^-?\d*(\.\d+)?$/.test(a);case "email":return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)}return!0};
FieldOption.prototype.isValid=function(){var a=!0,b;if(!this.checkboxControl.checked)return!0;if(a=this.evalRequired()){switch(this.fieldType){case "currency":case "date":case "datetime":case "decimal":case "float":case "integer":case "email":a=this.validInput();break;default:a=this.textControl.value?this.validInput():!0}if(!a){switch(this.fieldType){case "integer":b=this.language.ERROR_INVALID_INTEGER;break;case "datetime":b=this.language.ERROR_INVALID_DATETIME;break;case "date":b=this.language.ERROR_INVALID_DATE;
break;case "phone":b=this.language.ERROR_INVALID_PHONE;break;case "float":b=this.language.ERROR_INVALID_FLOAT;break;case "decimal":b=this.language.ERROR_INVALID_DECIMAL;break;case "url":b=this.language.ERROR_INVALID_URL;break;case "currency":b=this.language.ERROR_INVALID_CURRENCY;break;case "email":b=this.language.ERROR_INVALID_EMAIL;break;case "checkbox":case "dropdown":case "textfield":case "name":case "password":case "textarea":b=""}this.errorTooltip.setMessage(b)}}else this.errorTooltip.setMessage(this.language.ERROR_FIELD_REQUIRED);
a?($(this.errorTooltip.html).removeClass("adam-tooltip-error-on"),$(this.errorTooltip.html).addClass("adam-tooltip-error-off")):($(this.errorTooltip.html).removeClass("adam-tooltip-error-off"),$(this.errorTooltip.html).addClass("adam-tooltip-error-on"));return a};var HtmlPanel=function(a){Panel.call(this,a);this.source=this;this.parent=this.scroll=null;HtmlPanel.prototype.initObject.call(this,a)};HtmlPanel.prototype=new Panel;HtmlPanel.prototype.type="HtmlPanel";
HtmlPanel.prototype.initObject=function(a){var b={source:null,scroll:!0};$.extend(!0,b,a);this.setSource(b.source).setScroll(b.scroll)};HtmlPanel.prototype.setSource=function(a){this.source=a;return this};HtmlPanel.prototype.setScroll=function(a){this.scroll=a;return this};
HtmlPanel.prototype.createHTML=function(){var a,b;Panel.prototype.createHTML.call(this);this.source&&(b=this.scroll?"auto":"none",a=this.createHTMLElement("div"),a.id=this.id,a.innerHTML=this.source,a.style.overflow=b,a.style.height=this.height-2+"px",this.body.appendChild(a),this.body.style.bottom="8px");this.attachListeners();return this.html};HtmlPanel.prototype.setParent=function(a){this.parent=a;return this};HtmlPanel.prototype.attachListeners=function(){$(this.body).on("mousedown",function(a){a.stopPropagation()})};
var CriteriaField=function(a,b){this.decimalSeparator=a.decimalSeparator||".";MultipleItemField.call(this,a,b);this.panels=null;this.editMode=!1;this.viewingForm=this.currentIndex=this.expressionInEdition=null;this.panelSemaphore=!0;this.timerCriteria=this.base_module_label=this.base_module=null;this.typesMap={};CriteriaField.prototype.initObject.call(this,a)};CriteriaField.prototype=new MultipleItemField;CriteriaField.prototype.type="CriteriaField";
CriteriaField.prototype.initObject=function(a){var b={value:null,decimalSeparator:".",restClient:null,base_module:null,base_module_label:null,timerCriteria:!1,panels:{logic:{enabled:!0},group:{enabled:!0},math:{enabled:!0},fieldEvaluation:{enabled:!0,modulesProxy:new SugarProxy({url:"pmse_Project/CrmData/related/"+this.currentModule,uid:this.currentModule,callback:null}),fieldsProxy:new SugarProxy({url:"pmse_Project/CrmData/fields/"+this.currentModule,uid:this.currentModule,callback:null})},businessRulesEvaluation:{enabled:!0,
proxy:new SugarProxy({url:"pmse_Project/CrmData/businessrules/"+project.uid,uid:project.uid,callback:null})},formResponseEvaluation:{enabled:!0,proxy:new SugarProxy({url:"pmse_Project/CrmData/activities/"+project.uid,uid:project.uid,callback:null})},userEvaluation:{enabled:!0,valuesProxy:new SugarProxy({url:"pmse_Project/CrmData/users",uid:null,callback:null}),targetUserProxy:new SugarProxy({url:"pmse_Project/CrmData/defaultUsersList",uid:null,callback:null})},fixedDateEvaluation:{enabled:!0},sugarDateEvaluation:{enabled:!0,
modulesProxy:new SugarProxy({url:"pmse_Project/CrmData/dateFields/"+project.uid,uid:project.uid,callback:null})},unitTimeEvaluation:{enabled:!0},arithmetic:{enabled:!1},variables:{enabled:!1,fieldsProxy:new SugarProxy({url:"pmse_Project/CrmData/fields/"+PROJECT_MODULE,uid:PROJECT_MODULE,callback:null})},numbers:{enabled:!1}}};$.extend(!0,b,a);this.modulesProxy=b.modulesProxy;this.businessRulesProxy=b.businessRulesProxy;this.viewingForm=!1;this.panels=b.panels;this.base_module_label=b.base_module_label;
this.timerCriteria=b.timerCriteria;this.setDecimalSeparator(b.decimalSeparator).setBaseModule(b.base_module).setModuleFieldsProxy(b.moduleFieldsProxy).setControlFormsProxy(b.controlFormsProxy)};CriteriaField.prototype.setBaseModule=function(a){a&&(this.base_module=a,this.panels.fieldEvaluation.modulesProxy.url="pmse_Project/CrmData/related/"+a,this.panels.sugarDateEvaluation.modulesProxy.uid=a);return this};
CriteriaField.prototype.setDecimalSeparator=function(a){"string"===typeof a&&a&&(this.decimalSeparator=a);return this};CriteriaField.prototype.setControlFormsProxy=function(a){a instanceof RestProxy&&(this.controlFormsProxy=a);return this};CriteriaField.prototype.setModuleFieldsProxy=function(a){a instanceof RestProxy&&(this.moduleFieldsProxy=a);return this};
CriteriaField.prototype.showPanel=function(){var a=this.panel,b,c,d;if(this.editMode)for(c=0;c<this.items.length;c+=1)this.items[c].setIsEditMode(!1);else if(this.panel.isOpen)return this;a.clear();d="logic group math arithmetic fieldEvaluation formResponseEvaluation businessRulesEvaluation userEvaluation fixedDateEvaluation sugarDateEvaluation unitTimeEvaluation variables numbers".split(" ");for(c=0;c<d.length;c+=1)if(this.panels[d[c]].enabled){b=null;switch(d[c]){case "formResponseEvaluation":b=
this.createControlPanel();break;case "fieldEvaluation":b=this.createModulesPanel();break;case "logic":b=this.createLogicPanel().getHTML();break;case "group":b=this.createGroupPanel().getHTML();break;case "math":b=this.createMathPanel().getHTML();break;case "arithmetic":b=this.createArithmeticPanel().getHTML();break;case "businessRulesEvaluation":b=this.createBusinessRulePanel();break;case "userEvaluation":b=this.createUserPanel();break;case "fixedDateEvaluation":b=this.createFixedDatePanel();break;
case "sugarDateEvaluation":b=this.createSugarDatePanel();break;case "unitTimeEvaluation":b=this.createUnitTimePanel();break;case "variables":b=this.createVariablePanel();break;case "numbers":b=this.createNumberPanel()}b&&a.html.appendChild(b)}MultipleItemField.prototype.showPanel.call(this)};
CriteriaField.prototype.showEditionPanel=function(a){var b=this.panel,c;b.clear();$(b.html).css("min-width",210);a||(a={});if(!a.type)return this;switch(a.type){case "control":c=this.createControlPanel(a.settings);break;case "modules":c=this.createModulesPanel(a.settings);break;case "business_rules":c=this.createBusinessRulePanel(a.settings);break;case "user":c=this.createUserPanel(a.settings);break;case "fixed_date":c=this.createFixedDatePanel(a.settings);break;case "sugar_date":c=this.createSugarDatePanel(a.settings);
break;case "unit_time":c=this.createUnitTimePanel(a.settings);break;case "variable":c=this.createVariablePanel(a.settings);break;case "number":c=this.createNumberPanel(a.settings)}c&&b.html.appendChild(c);MultipleItemField.prototype.showPanel.call(this);$(b.html).removeClass("focused");$(this.itemsContainer).removeClass("focused expanded");return this};
CriteriaField.prototype.itemEditHandler=function(){var a=this,b={LOGIC:["AND","OR","NOT"],MATH:["+","-"],ARITHMETIC:["+","-","x","/"]};return function(){var c,d,e=this,f={},g;for(d=0;d<a.items.length;d+=1)a.items[d]!==this&&a.items[d].setIsEditMode(!1);a.editMode=!0;a.expressionInEdition=this;a.hidePanel();f.fields=[];switch(this.expType){case "LOGIC":case "ARITHMETIC":case "MATH":this.setOnExitEditHandler(function(){$(c.html).remove();c=null;a.editMode=!1;a.expressionInEdition=null;this.setOnExitEditHandler(null)});
c=new MultipleItemPanel({belongsTo:this.getHTML()});$(c.getHTML()).css("width","auto");for(d=0;d<b[this.expType].length;d+=1)b[this.expType][d]!==this.expValue.value&&c.addButton({caption:b[this.expType][d],onClick:function(){e.setExpressionValue(this.name).setIsEditMode(!1);a.onChange()}});a.parent.parent.html.appendChild(c.getHTML());c.open();break;case "MODULE":g="modules";f.fields.push({defaultSelection:this.expDirection},{defaultSelection:this.expModule.value},{defaultSelection:this.expField.value},
{defaultSelection:this.expOperator.value},{value:this.expValue.value});break;case "CONTROL":g="control";f.fields.push({defaultSelection:this.expField.value},{defaultSelection:this.expValue.value});break;case "BUSINESS_RULES":g="business_rules";f.fields.push({defaultSelection:this.expField.value},{defaultSelection:this.expOperator.value},{value:this.expValue.value});break;case "USER_ADMIN":case "USER_ROLE":case "USER_IDENTITY":d="USER_ADMIN"===this.expType?"equals"===this.expOperator.value?"isAdmin":
"isNotAdmin":"USER_ROLE"===this.expType?"equals"===this.expOperator.value?"isRole":"isNotRole":"equals"===this.expOperator.value?"isUser":"isNotUser";g="user";f.fields.push({defaultSelection:this.expField.value},{defaultSelection:d},{defaultSelection:this.expValue.value});break;case "FIXED_DATE":g="fixed_date";f.fields.push({value:this.expValue.value});break;case "SUGAR_DATE":g="sugar_date";f.fields.push({defaultSelection:this.expValue.value});break;case "UNIT_TIME":g="unit_time";f.fields.push({value:this.expValue.value},
{defaultSelection:this.expUnit});break;case "SUGAR_VAR":g="variable";f.fields.push({value:this.expValue.value});break;case "NUMBER":g="number",f.fields.push({value:this.expValue.value})}"LOGIC"!==this.expType&&"MATH"!==this.expType&&(a.panel.setBelongsTo(this.html),a.showEditionPanel({type:g,settings:f}))}};CriteriaField.prototype.itemExitEditHandler=function(){var a=this;return function(){a.hidePanel();a.panel.belongsTo=a.itemsContainer;a.expressionInEdition=null;a.editMode=!1}};
CriteriaField.prototype.hidePanel=function(){MultipleItemField.prototype.hidePanel.call(this);this.viewingForm&&(this.viewingForm=!1,$(this.itemsContainer).removeClass("focused"));return this};CriteriaField.prototype.removeItem=function(a){var b=$(a.getData("inputArea")),c=b.attr("tab-index");b.remove();this.updatePlaceholdersIndexes();MultipleItemField.prototype.removeItem.call(this,a);$(this.itemsContainer).find("input").filter('[tab-index="'+c+'"]').focus().select();return this};
CriteriaField.prototype.updatePlaceholdersIndexes=function(){$(this.itemsContainer).find("input").each(function(a){$(this).attr("tab-index",a)}).val("")};
CriteriaField.prototype.addItem=function(a){var b=this,c,d=parseInt(this.currentIndex,10);if(a&&(a="SugarExpression"===a.family?a:new SugarExpression($.extend(!0,a,{decimalSeparator:this.decimalSeparator})),("LOGIC"===a.expType&&"NOT"===a.expValue.value||"GROUP"===a.expType)&&a.setIsEditable(!1),a.onClose=function(){var a=this.id,c=null,d;b.hidePanel();for(d=0;d<b.items.length;d+=1)if(b.items[d].id===a){c=d;break}null!==c&&b.items.splice(c,1);b.onChange()},a.onRemove=function(){b.removeItem(this)},
"GROUP"!==a.expType&&(a.setOnEditHandler(this.itemEditHandler()),"LOGIC"!==a&&a.setOnExitEditHandler(this.itemExitEditHandler())),this.controlObject&&(isNaN(d)?c=$(this.controlObject):(c=$(this.itemsContainer).find("input").eq(d),c[0]||(c=$(this.controlObject),d=null)),a.setData("inputArea",this.createControlObject()),c.before(a.getData("inputArea")).before(a.getHTML()),c.before(a.getHTML())),!isNaN(d)&&-1<d?this.items.splice(d,0,a):this.items.push(a),this.html&&(this.updatePlaceholdersIndexes(),
$(this.itemsContainer).find("input").val("").filter(":eq("+(d+1)+")").focus().select(),this.hidePanel(),this.parent.loaded)))this.onChange();return this};
CriteriaField.prototype.createChildForm=function(a){var b=this,c;a.showContentOnStart=this.editMode;a.visibleHeader=!this.editMode;a.submitCaption=this.editMode?"Update":"Add";a.collapsable=!this.editMode;a.cancelButton=!0;a.onCancel=function(){b.editMode?b.updateExpression(b.expressionInEdition,{}):b.hidePanel()};a.onOpen=function(){b.viewingForm=!0;$(b.parent.parent.html).find(".content").not(this.content).slideUp().end().end().find(".multiple-item-subpanel, .multiple-item-button-panel").not(this.html).slideUp()};
a.onClose=function(){$(b.parent.parent.html).find(".multiple-item-subpanel, .multiple-item-button-panel").not(this.html).slideDown();$(b.controlObject).focus();b.viewingForm=!1};c=(new CriteriaForm($.extend(!0,a,{language:this.parent.language}))).getHTML();c.id="#"+a.name+"-panel";return c};CriteriaField.prototype.onLogicSelectHandler=function(){var a=this;return function(){a.addItem(new SugarExpression({expType:"LOGIC",expValue:this.value,decimalSeparator:a.decimalSeparator}))}};
CriteriaField.prototype.onGroupSelectHandler=function(){var a=this;return function(){a.addItem(new SugarExpression({expType:"GROUP",expValue:this.value,editable:!1,decimalSeparator:a.decimalSeparator}))}};CriteriaField.prototype.onArithmeticSelectHandler=function(){var a=this;return function(){a.addItem(new SugarExpression({expType:"ARITHMETIC",expValue:this.value,editable:!0,decimalSeparator:a.decimalSeparator}))}};
CriteriaField.prototype.onMathSelectHandler=function(){var a=this;return function(){a.addItem(new SugarExpression({expType:"MATH",expValue:this.value,editable:!0,decimalSeparator:a.decimalSeparator}))}};CriteriaField.prototype.getRegExpDecimalSeparator=function(){var a="";switch(this.decimalSeparator){case "\\":case "^":case "$":case "*":case "+":case "?":case ".":case "(":case ")":case "|":case "{":case "}":a="\\"}return a+this.decimalSeparator};
CriteriaField.prototype.isNaN=function(a){var b;if("number"===typeof a)return!0;b=this.getRegExpDecimalSeparator();return!(new RegExp("(^(\\+|-)?\\d+$)|(^(\\+|-)?\\d+"+b+"\\d*$)|(^(\\+|-)?\\d*"+b+"\\d+$)|(^(\\+|-)?\\d+("+b+"\\d+)?e(\\+|-)?\\d+$)")).test(a)};CriteriaField.prototype.getSanitizedValue=function(a){var b;"string"===typeof a&&(a=$.trim(a),this.isNaN(a)||(b=new RegExp(this.getRegExpDecimalSeparator(),"g"),a=parseFloat(a.replace(b,"."))));return a};
CriteriaField.prototype.createUserPanel=function(a){var b=this,c={title:this.parent.language.TITLE_USER_EVALUATION,name:"userEvaluation",fields:[{name:"expField",type:"select",label:this.parent.language.LBL_USER,dataSource:{source:b.panels.userEvaluation.targetUserProxy,labelField:"text",valueField:"value"},required:!0},{name:"expOperator",type:"select",label:this.parent.language.LBL_OPERATOR,options:[{label:"Is admin",value:"isAdmin"},{label:"Is role",value:"isRole"},{label:"Is user",value:"isUser"},
{label:"Is not admin",value:"isNotAdmin"},{label:"Is not role",value:"isNotRole"},{label:"Is not user",value:"isNotUser"}],required:!0},{name:"expValue",type:"select",label:this.parent.language.LBL_VALUE,dependsOn:"expOperator",dependencyHandler:function(a){var c=this;if("isAdmin"===a.getValue()||"isNotAdmin"===a.getValue())this.clear().setIsDisabled(!0).setRequired(!1);else{this.setIsDisabled(!1).setRequired(!0);switch(a.getValue()){case "isRole":case "isNotRole":b.panels.userEvaluation.valuesProxy.setUrl("pmse_Project/CrmData/rolesList");
break;case "isUser":case "isNotUser":b.panels.userEvaluation.valuesProxy.setUrl("pmse_Project/CrmData/users")}b.panels.userEvaluation.valuesProxy.getData({module:PROJECT_MODULE},{success:function(a){a.result&&c.fill(a.result,"text","value")}})}},disabled:!0}],onSubmit:function(a){var c={expValue:a.expValue},f,g="not_equals",h="!=";switch(a.expOperator){case "isAdmin":g="equals",h="==";case "isNotAdmin":f=SugarExpression.prototype.eTypes.USER_ADMIN;break;case "isRole":g="equals",h="==";case "isNotRole":f=
SugarExpression.prototype.eTypes.USER_ROLE;break;case "isUser":g="equals",h="==";case "isNotUser":f=SugarExpression.prototype.eTypes.USER_IDENTITY}c.expField={text:this.getFieldByName("expField").getSelectedText()||null,value:a.expField};c.expOperator={text:h,value:g};c.expValue={text:this.getFieldByName("expValue").getSelectedText()||null,value:a.expValue};b.editMode?(b.expressionInEdition.expType=f,b.updateExpression(b.expressionInEdition,c)):(c.expType=f,b.addItem(c));b.viewingForm=!1}};$.extend(!0,
c,a||{});return this.createChildForm(c)};
CriteriaField.prototype.createBusinessRulePanel=function(a){var b=this,c={title:this.parent.language.TITLE_BUSINESS_RULE_EVALUATION,name:"businessRulesEvaluation",fields:[{name:"expField",type:"select",label:this.parent.language.LBL_BUSINESS,dataSource:{source:b.panels.businessRulesEvaluation.proxy},defaultSelection:"[first]",required:!0},{name:"expOperator",type:"select",label:this.parent.language.LBL_OPERATOR,options:SugarExpression.prototype.operators,defaultSelection:"equals",required:!0},{name:"expValue",
type:"long_text",label:this.parent.language.LBL_RESPONSE,required:!1}],onSubmit:function(a){a={expField:{text:this.getFieldByName("expField").getSelectedText()||null,value:a.expField||null},expOperator:a.expOperator,expValue:b.getSanitizedValue(a.expValue)};b.editMode?b.updateExpression(b.expressionInEdition,a):(a.expType="BUSINESS_RULES",b.addItem(a));b.typesMap={TRUE:"bool",FALSE:"bool",NOW:"constant",NULL:"constant"};b.viewingForm=!1}};$.extend(!0,c,a||{});return this.createChildForm(c)};
CriteriaField.prototype.createGroupPanel=function(){var a={label:this.parent.language.LBL_GROUP,buttons:[{caption:"(",value:"(",onClick:this.onGroupSelectHandler()},{caption:")",value:")",onClick:this.onGroupSelectHandler()}]};return this.panel.createButtonPanel(a)};
CriteriaField.prototype.createArithmeticPanel=function(){var a={label:this.parent.language.LBL_OPERATION,buttons:[{caption:"+",value:"+",onClick:this.onArithmeticSelectHandler()},{caption:"-",value:"-",onClick:this.onArithmeticSelectHandler()},{caption:"x",value:"x",onClick:this.onArithmeticSelectHandler()},{caption:"/",value:"/",onClick:this.onArithmeticSelectHandler()}]};return this.panel.createButtonPanel(a)};
CriteriaField.prototype.createMathPanel=function(){var a={label:this.parent.language.LBL_OPERATION,buttons:[{caption:"+",value:"+",onClick:this.onMathSelectHandler()},{caption:"-",value:"-",onClick:this.onMathSelectHandler()}]};return this.panel.createButtonPanel(a)};
CriteriaField.prototype.createFixedDatePanel=function(a){var b=this,c={title:this.parent.language.TITLE_FIXED_DATE,name:"module",fields:[{name:"expValue",type:"date",label:this.parent.language.LBL_VALUE,required:!1}],onSubmit:function(a){a={expValue:a.expValue};b.editMode?b.updateExpression(b.expressionInEdition,a):(a.expType="FIXED_DATE",b.addItem(a));b.viewingForm=!1},onCancel:function(){}};$.extend(!0,c,a||{});return this.createChildForm(c)};
CriteriaField.prototype.createSugarDatePanel=function(a){var b=this,c={title:this.parent.language.TITLE_SUGAR_DATE,name:"module",fields:[{name:"expValue",type:"select",label:this.parent.language.LBL_VALUE,preserveDefaultOptions:!0,dataSource:{source:b.panels.sugarDateEvaluation.modulesProxy,labelField:"text",valueField:"value"},defaultSelection:"[first]",required:!0}],onSubmit:function(a){a={expValue:a.expValue};b.editMode?b.updateExpression(b.expressionInEdition,a):(a.expType="SUGAR_DATE",b.addItem(a));
b.viewingForm=!1},onCancel:function(){}};$.extend(!0,c,a||{});return this.createChildForm(c)};CriteriaField.prototype.onListItemSelected=function(){var a=this;return function(b,c){a.addItem({expValue:b,expType:"SUGAR_VAR"})}};CriteriaField.prototype.createVariablePanel=function(a){a=this.panels.variables.fieldsProxy.getData();variablesList=new MultipleItemListSubpanel({title:this.parent.language.LBL_VARIABLE,collapsable:!0,items:a.result,onItemSelect:this.onListItemSelected()});return variablesList.getHTML()};
CriteriaField.prototype.createUnitTimePanel=function(a){var b=this,c={title:this.parent.language.TITLE_UNIT_TIME,name:"module",fields:[{name:"expValue",type:"number",label:this.parent.language.LBL_VALUE,required:!1},{name:"expUnit",type:"select",label:this.parent.language.LBL_UNIT,options:[{label:"minutes",value:"minutes"},{label:"hours",value:"hours"},{label:"days",value:"days"},{label:"months",value:"months"},{label:"years",value:"years"}],defaultSelection:"minutes",required:!0}],onSubmit:function(a){a=
{expValue:a.expValue,expUnit:a.expUnit};b.editMode?b.updateExpression(b.expressionInEdition,a):(a.expType="UNIT_TIME",b.addItem(a));b.viewingForm=!1},onCancel:function(){}};$.extend(!0,c,a||{});return this.createChildForm(c)};
CriteriaField.prototype.createNumberPanel=function(a){var b=this,c={title:this.parent.language.LBL_NUMBER,name:"module",fields:[{name:"expValue",type:"number",label:this.parent.language.LBL_VALUE,required:!1}],onSubmit:function(a){a={expValue:a.expValue};b.editMode?b.updateExpression(b.expressionInEdition,a):(a.expType="NUMBER",b.addItem(a));b.viewingForm=!1},onCancel:function(){}};$.extend(!0,c,a||{});return this.createChildForm(c)};
CriteriaField.prototype.createLogicPanel=function(){var a={label:this.parent.language.LBL_LOGIC_OPERATORS,buttons:[{caption:"AND",value:"AND",onClick:this.onLogicSelectHandler()},{caption:"OR",value:"OR",onClick:this.onLogicSelectHandler()},{caption:"NOT",value:"NOT",onClick:this.onLogicSelectHandler()}]};return this.panel.createButtonPanel(a)};
CriteriaField.prototype.updateExpression=function(a,b){var c,d=!1,e;for(e in b)if(b.hasOwnProperty(e)){switch(e){case "expDirection":c=this.parent.language.LBL_DIRECTION;break;case "expModule":c=this.parent.language.LBL_MODULE;break;case "expField":c=this.parent.language.LBL_FIELD;break;case "expOperator":c=this.parent.language.LBL_OPERATOR;break;case "expValue":c=this.parent.language.LBL_VALUE;break;case "expUnit":c="Unit"}c=a["setExpression"+c];"function"===typeof c&&(c.call(a,b[e]),d=!0)}a.setIsEditMode(!1);
if(d)this.onChange();return this};
CriteriaField.prototype.createModulesPanel=function(a){var b=this,c,d={title:this.parent.language.TITLE_MODULE_FIELD_EVALUATION,name:"module",fields:[{name:"expDirection",type:"select",label:this.parent.language.LBL_DIRECTION,options:[{label:"before"},{label:"after"}],defaultSelection:"after",required:!0},{name:"expModule",type:"select",label:this.parent.language.LBL_MODULE,options:this.base_module?[{label:"<<"+(this.base_module_label?this.base_module_label:this.base_module)+">>",value:this.base_module||
""}]:[],preserveDefaultOptions:!0,dataSource:{source:b.panels.fieldEvaluation.modulesProxy,labelField:"text",valueField:"value"},defaultSelection:"[first]",required:!0},{name:"expField",type:"select",label:this.parent.language.LBL_VARIABLE,dependsOn:"expModule",required:!0,dependencyHandler:function(a){b.panels.fieldEvaluation.fieldsProxy.uid=a.getValue();b.panels.fieldEvaluation.fieldsProxy.uid?(self=this,b.panels.fieldEvaluation.fieldsProxy.url="pmse_Project/CrmData/fields/"+a.getValue(),b.panels.fieldEvaluation.fieldsProxy.getData(null,
{success:function(a){if(a.result)for(self.fill(a.result,"text","value"),c=0;c<a.result.length;c+=1)b.typesMap[a.result[c].value]=a.result[c].type}})):this.clear()},defaultSelection:"name"},{name:"expOperator",type:"select",label:this.parent.language.LBL_OPERATOR,options:SugarExpression.prototype.operators,defaultSelection:"equals",required:!0},{name:"expValue",type:"text",label:this.parent.language.LBL_VALUE,required:!1}],onSubmit:function(a){a={expDirection:a.expDirection||null,expModule:{text:this.getFieldByName("expModule").getSelectedText()||
null,value:a.expModule||null},expField:{text:this.getFieldByName("expField").getSelectedText()||null,value:a.expField||null},expOperator:{text:this.getFieldByName("expOperator").getSelectedText()||null,value:a.expOperator},expValue:b.getSanitizedValue(a.expValue)};b.editMode?b.updateExpression(b.expressionInEdition,a):(a.expType="MODULE",b.addItem(a));b.viewingForm=!1},onCancel:function(){}};$.extend(!0,d,a||{});return this.createChildForm(d)};
CriteriaField.prototype.createControlPanel=function(a){var b=this,c={title:this.parent.language.TITLE_FORM_RESPONSE_EVALUATION,name:"control",fields:[{name:"expField",type:"select",label:this.parent.language.LBL_FORM,dataSource:{source:this.panels.formResponseEvaluation.proxy},defaultSelection:"[first]",required:!0},{name:"expValue",type:"select",label:this.parent.language.LBL_STATUS,options:[{label:this.parent.language.LBL_APPROVED,value:"Approve"},{label:this.parent.language.LBL_REJECTED,value:"Reject"}],
defaultSelection:"[first]",required:!0}],onSubmit:function(a){a={expField:{text:this.getFieldByName("expField").getSelectedText()||null,value:a.expField||null},expOperator:{text:"==",value:"equals"},expValue:{text:this.getFieldByName("expValue").getSelectedText()||null,value:a.expValue||null}};b.editMode?b.updateExpression(b.expressionInEdition,a):(a.expType="CONTROL",b.addItem(a));b.viewingForm=!1}};$.extend(!0,c,a||{});return this.createChildForm(c)};
CriteriaField.prototype.getInputAreaValidationFunction=function(){var a=this;return function(b){b=$.trim(b).toUpperCase();"AND"===b||"OR"===b||"NOT"===b?(a.panelSemaphore=!1,a.addItem(new SugarExpression({expType:"LOGIC",expValue:b,decimalSeparator:a.decimalSeparator})),this.clear()):"("===b||")"===b?(a.panelSemaphore=!1,a.addItem(new SugarExpression({expType:"GROUP",expValue:b,editable:!1,decimalSeparator:a.decimalSeparator})),this.clear()):a.isNaN(b)?$(this.html).focus().select():(a.panelSemaphore=
!1,a.addItem(new SugarExpression({expType:"NUMBER",expValue:b,decimalSeparator:a.decimalSeparator})),this.clear());a.currentIndex=$(this.html).attr("tab-index");return!0}};
CriteriaField.prototype.createControlObject=function(){var a=new InputArea;a.validationFunction=this.getInputAreaValidationFunction();$(a.getHTML()).on("click",function(a){a.stopPropagation()}).on("keydown",function(a){var c=$(this),d=c.val();37===a.keyCode&&""===d?c.prev().prev().focus().select():39===a.keyCode&&""===d&&c.next().next().focus().select()});return a.getHTML()};
CriteriaField.prototype.attachListeners=function(){MultipleItemField.prototype.attachListeners.call(this);var a,b=this,c=$(this.itemsContainer);a=$(this.controlObject);a.off("blur");c.on("blur",".multiple-item-input",function(){b.viewingForm||(b.hidePanel(),c.removeClass("focused"),$(b.panel.html).removeClass("focused"))}).on("click",".multiple-item-input",function(a){a.stopPropagation();b.showPanel()}).on("keyup",".multiple-item-input",function(a){a.stopPropagation();27!==a.keyCode?b.panelSemaphore?
(!b.panel.isOpen&&""!==this.value||13===a.keyCode)&&b.showPanel():b.panelSemaphore=!0:b.hidePanel()}).on("focus",".multiple-item-input",function(a){$(".hasDatepicker").datepicker("hide");b.currentIndex=$(this).attr("tab-index");a.stopPropagation();b.showPanel()});c.on("click",function(b){b.stopPropagation();$(a).trigger("click")})};
CriteriaField.prototype.isValid=function(){var a,b=!0,c=null,d,e=0,f=0,g="invalid criteria syntax";if(!this.timerCriteria){for(a=0;a<this.items.length;a+=1){d=this.items[a];if(d.expSuperType===SugarExpression.prototype.sTypes.OPERAND||"GROUP"===d.expType&&"("===d.expValue.value||"LOGIC"===d.expType&&"NOT"===d.expValue.value)b=b&&(null===c||"LOGIC"===c.expType||"ARITHMETIC"===c.expType||"GROUP"===c.expType&&"("===c.expValue.value);else{if(null===c){b=!1;break}b=b&&(c.expSuperType===SugarExpression.prototype.sTypes.OPERAND||
"GROUP"===c.expType&&")"===c.expValue.value)}"GROUP"===d.expType&&(")"===d.expValue.value?(b=b&&0<e,e-=1):"("===d.expValue.value&&(e+=1));if(!b)break;c=d}b&&(c&&(b=b&&"LOGIC"!==c.expType&&"ARITHMETIC"!==c.expType&&!("GROUP"===c.expType&&"("===c.expValue.value)),b=b&&0===e)}else if(0<this.items.length){for(a=0;a<this.items.length;a+=1){d=this.items[a];if(d.expSuperType===SugarExpression.prototype.sTypes.OPERAND)b=b&&(null===c||"MATH"===c.expType);else{if(null===c){b=!1;break}b=b&&c.expSuperType===
SugarExpression.prototype.sTypes.OPERAND}if(!b)break;if("SUGAR_DATE"===d.expType||"FIXED_DATE"===d.expType)f+=1;c=d}b&&c&&(b=b&&"MATH"!==c.expType);b&&(b=b&&1===f&&("SUGAR_DATE"===this.items[0].expType||"FIXED_DATE"===this.items[0].expType));b||(g="invalid criteria syntax, format: [Date or Field of date] [+/-] [Time Span]")}b?($(this.errorTooltip.html).removeClass("adam-tooltip-error-on"),$(this.errorTooltip.html).addClass("adam-tooltip-error-off"),b=b&&Field.prototype.isValid.call(this)):(this.errorTooltip.setMessage(g),
$(this.errorTooltip.html).removeClass("adam-tooltip-error-off"),$(this.errorTooltip.html).addClass("adam-tooltip-error-on"));return b?b&&Field.prototype.isValid.call(this):b};
CriteriaField.prototype.getObject=function(){var a,b=[],c,d;for(a=0;a<this.items.length;a+=1){d={};c=this.items[a];switch(c.expType){case "MODULE":d.expDirection=c.expDirection||null;d.expFieldType=this.typesMap[c.expField.value]||c.expFieldType||null;d.expModule=c.expModule&&c.expModule.value||null;d.expField=c.expField.value||null;d.expOperator=c.expOperator&&c.expOperator.value||null;break;case "BUSINESS_RULES":d.expFieldType=this.typesMap[c.expValue.text]||c.expFieldType||null;d.expDirection=
c.expDirection||null;d.expModule=c.expModule&&c.expModule.value||null;d.expField=c.expField.value||null;d.expOperator=c.expOperator&&c.expOperator.value||null;break;case "CONTROL":case "USER_ADMIN":case "USER_ROLE":case "USER_IDENTITY":d.expModule=c.expModule&&c.expModule.value||null;d.expField=c.expField.value||null;d.expOperator=c.expOperator&&c.expOperator.value||null;break;case "UNIT_TIME":d.expUnit=c.expUnit.toLowerCase()||null}d.expValue=c.expValue.value;d.expType=c.expType;d.expLabel=c.getLabel();
b.push(d)}return b};CriteriaField.prototype.createHTML=function(){var a=this;if(this.html)return this.html;MultipleItemField.prototype.createHTML.call(this);$(this.itemsContainer).on("scroll",function(){a.expressionInEdition&&a.updateExpression(a.expressionInEdition,{})});return this.html};var InputArea=function(){Element.call(this);this.textlabel=null};InputArea.prototype=new Element;InputArea.prototype.type="InputArea";
InputArea.prototype.getTextWidth=function(){var a;this.textlabel.innerText=this.html.value;$(this.html).before(this.textlabel);a=$(this.textlabel).width();$(this.textlabel).detach();return a};InputArea.prototype.validationFunction=function(){return!!$.trim(this.html.value)};InputArea.prototype.acceptInput=function(a){};InputArea.prototype.clear=function(){$(this.html).val("").css("width","1px");return this};InputArea.prototype.onBlur=function(){var a=this;return function(){a.clear()}};
InputArea.prototype.onKeyUp=function(){var a=this;return function(b){var c=$(this),d=c.val(),e=!1;37!==b.keyCode&&""!==$.trim(d)&&c.css("width",a.getTextWidth()+8);13===b.keyCode?(b.preventDefault(),(e="function"===typeof a.validationFunction?a.validationFunction.call(a,d):!0)&&a.acceptInput(d)):27===b.keyCode&&a.clear()}};
InputArea.prototype.createHTML=function(){var a,b;this.html||(a=this.createHTMLElement("input"),a.style.width="1px",a.type="text",a.className="multiple-item-input",b=this.createHTMLElement("span"),b.style.display="none",this.textlabel=b,this.html=a,this.style.addProperties({"padding-left":0,"padding-right":0,"margin-right":0,"margin-left":0}),$(this.html).on("keyup",this.onKeyUp()).on("blur",this.onBlur()));return this.html};
CriteriaField.prototype.disable=function(){this.labelObject.className="adam-form-label-disabled";this.controlObject.disabled=!0;this.oldRequiredValue||(this.oldRequiredValue=this.required);this.setRequired(!1);$(this.controlObject).removeClass("required");this.disabled=!0};CriteriaField.prototype.enable=function(){this.labelObject.className="adam-form-label";this.controlObject.disabled=!1;this.oldRequiredValue&&this.setRequired(this.oldRequiredValue);this.disabled=!1};
var CriteriaFormField=function(a){Base.call(this);this.isDisabled=this.restClient=this.control=this.dependencyHandler=this.dependentFields=this.required=this.dependsOn=this.form=this.value=this.label=this.name=null;CriteriaFormField.prototype.initObject.call(this,a||{})};CriteriaFormField.prototype=new Base;CriteriaFormField.prototype.type="CriteriaFormField";
CriteriaFormField.prototype.initObject=function(a){var b={fieldType:"text",name:"",label:"",dependsOn:null,dependencyHandler:null,value:null,required:!1,dependentFields:[],restClient:null,disabled:!1};$.extend(!0,b,a||{});this.fieldType=b.fieldType;this.setName(b.name).setLabel(b.label).setValue(b.value).setDependentFields(b.dependentFields).setDependency(b.dependsOn).setDependencyHandler(b.dependencyHandler).setRequired(b.required).setRestClient().createControl().setIsDisabled(b.disabled)};
CriteriaFormField.prototype.setIsDisabled=function(a){this.isDisabled=!!a;this.control&&(this.control.disabled=!!a);return this};CriteriaFormField.prototype.getIsDisabled=function(){return this.isDisabled};CriteriaFormField.prototype.setRestClient=function(a){this.restClient=a;return this};CriteriaFormField.prototype.setRequired=function(a){"boolean"===typeof a&&(this.required=a);return this};CriteriaFormField.prototype.setName=function(a){this.name=a;return this};
CriteriaFormField.prototype.setLabel=function(a){this.label=a;return this};CriteriaFormField.prototype.setValue=function(a){this.value=a;this.updateHTML();return this};CriteriaFormField.prototype.getValue=function(){return $(this.control).val()};CriteriaFormField.prototype.setDependentFields=function(a){this.dependentFields=a;return this};CriteriaFormField.prototype.addDependentField=function(a){a instanceof CriteriaFormField&&a!==this&&this.dependentFields.push(a);return this};
CriteriaFormField.prototype.setDependency=function(a){a instanceof CriteriaFormField&&(this.dependsOn=a,a.addDependentField(this));return this};CriteriaFormField.prototype.setDependencyHandler=function(a){"function"===typeof a&&(this.dependencyHandler=a);return this};CriteriaFormField.prototype.clear=function(){$(this.control).val("");this.value="";return this};CriteriaFormField.prototype.updateHTML=function(){this.control&&$(this.control).val(this.value||"");return this};
CriteriaFormField.prototype.createControl=function(){return this};CriteriaFormField.prototype.onChangeValueHandler=function(){this.value=$(this.control).val();return this};CriteriaFormField.prototype.reset=function(){$(this.control).removeClass("error");return this};CriteriaFormField.prototype.triggerDependentFields=function(){var a,b;for(a=0;a<this.dependentFields.length;a+=1)b=this.dependentFields[a],"function"===typeof b.dependencyHandler&&b.dependencyHandler.call(b,this);return this};
CriteriaFormField.prototype.getHTML=function(){var a,b=this;if(this.html)return this.html;a=document.createElement("span");a.className="pmse-form-label";a.appendChild(document.createTextNode(this.label));this.control.name=this.name;this.control.id=this.id;$(this.control).on("change",function(){b.onChangeValueHandler();b.isValid();b.triggerDependentFields()});null!==this.value&&$(this.control).val(this.value);this.html=document.createElement("label");this.html.appendChild(a);this.html.appendChild(this.control);
"criteriaFormDateField"===this.type&&($(this.control).datepicker(),$(".datepicker").css("z-index","1034"));return this.html};CriteriaFormField.prototype.isValid=function(){var a=!(!$(this.control).val()&&this.required);a?$(this.control).removeClass("error"):$(this.control).addClass("error");return a};CriteriaFormField.prototype.onAppend=function(){};var CriteriaFormDateField=function(a){CriteriaFormField.call(this,a);this.required=!0};CriteriaFormDateField.prototype=new CriteriaFormField;
CriteriaFormDateField.prototype.type="criteriaFormDateField";CriteriaFormDateField.prototype.createControl=function(){this.control=document.createElement("input");this.control.type="text";this.control.autocomplete="off";$(this.control).on("keydown",function(a){a.stopPropagation()}).on("keyup",function(a){a.stopPropagation()});return this};var CriteriaFormNumberField=function(a){CriteriaFormField.call(this,a);this.required=!0};CriteriaFormNumberField.prototype=new CriteriaFormField;
CriteriaFormNumberField.prototype.type="criteriaFormNumberField";
CriteriaFormNumberField.prototype.createControl=function(){this.control=document.createElement("input");this.control.type="text";this.control.autocomplete="off";$(this.control).on("keydown",function(a){a.stopPropagation();46==a.keyCode||8==a.keyCode||9==a.keyCode||27==a.keyCode||13==a.keyCode||65==a.keyCode&&!0===a.ctrlKey||35<=a.keyCode&&39>=a.keyCode||(a.shiftKey||(48>a.keyCode||57<a.keyCode)&&(96>a.keyCode||105<a.keyCode))&&a.preventDefault()}).on("keyup",function(a){a.stopPropagation()});return this};
var CriteriaFormTextField=function(a){CriteriaFormField.call(this,a)};CriteriaFormTextField.prototype=new CriteriaFormField;CriteriaFormTextField.prototype.type="criteriaFormTextField";CriteriaFormTextField.prototype.createControl=function(){this.control=document.createElement("input");this.control.type="text";$(this.control).on("keydown",function(a){a.stopPropagation()}).on("keyup",function(a){a.stopPropagation()});return this};
var CriteriaFormLongTextField=function(a){CriteriaFormField.call(this,a)};CriteriaFormLongTextField.prototype=new CriteriaFormField;CriteriaFormLongTextField.prototype.type="CriteriaFormLongTextField";CriteriaFormLongTextField.prototype.createControl=function(){this.control=document.createElement("textarea");return this};
var CriteriaFormSelectField=function(a){this.dataSource=this.options=this.preserveDefaultOptions=this.selectedIndex=this.defaultSelection=null;CriteriaFormField.call(this,a);CriteriaFormSelectField.prototype.initObject.call(this,a)};CriteriaFormSelectField.prototype=new CriteriaFormField;CriteriaFormSelectField.prototype.initObject=function(a){var b={dataSource:null,options:[],defaultSelection:null,preserveDefaultOptions:!1};$.extend(!0,b,a);this.options=b.options;this.setDefaultSelection(b.defaultSelection).fill(this.options).setDataSource(b.dataSource).setPreserveDefaultOptions(b.preserveDefaultOptions)};
CriteriaFormSelectField.prototype.setPreserveDefaultOptions=function(a){this.preserveDefaultOptions=a;return this};CriteriaFormSelectField.prototype.setDefaultSelection=function(a){this.defaultSelection=a;return this};CriteriaFormSelectField.prototype.getSelectedText=function(){var a=$(this.control).find("option:selected");return a.get(0)?a.text():null};
CriteriaFormSelectField.prototype.setDataSource=function(a){"object"===typeof a&&(this.dataSource=$.extend(!0,{labelField:"text",valueField:"value",itemsField:"result"},a));return this};CriteriaFormSelectField.prototype.clear=function(){$(this.control).empty();this.value="";return this};
CriteriaFormSelectField.prototype.fill=function(a,b,c){var d,e,f,g,h,k=!1,l=this.defaultSelection;b=b||"label";c=c||"value";$(this.control).empty();for(d=0;d<a.length;d+=1)f=a[d][b],g=a[d][c],h=a[d].selected||!1,e=document.createElement("option"),e.label=f||g,e.value=g||f,k=(e.selected=h)||k,e.appendChild(document.createTextNode(f||g)),this.control.appendChild(e);k||("[first]"===l?$(this.control).find("option:first").attr("selected",!0):"[none]"===l||null===l?this.control.selectedIndex=-1:$(this.control).find('option[value="'+
l+'"]').attr("selected",!0));this.value=$(this.control).val();this.selectedIndex=this.control.selectedIndex;this.triggerDependentFields();return this};
CriteriaFormSelectField.prototype.bind=function(a){var b,c,d,e=[],f=this;this.dataSource&&(this.control||this.createControl(),this.dataSource.source?(a&&(this.dataSource.source.uid=a),this.dataSource.source.getData(null,{success:function(a){b=$(f.control);b.empty();a=a||[];if((a=(d=f.dataSource.itemsField)?a[d]:a)&&a.push){if(f.preserveDefaultOptions){for(c=0;c<f.options.length;c+=1)b={},b[f.dataSource.labelField]=f.options[c].label,b[f.dataSource.valueField]=f.options[c].value,e.push(b);a=$.merge(e,
a)}f.fill(a,f.dataSource.labelField,f.dataSource.valueField)}}})):this.dependsOn&&this.dependsOn.triggerDependentFields());return this};CriteriaFormSelectField.prototype.createControl=function(){this.control=document.createElement("select");return this};CriteriaFormSelectField.prototype.getHTML=function(){this.bind();return CriteriaFormField.prototype.getHTML.call(this)};CriteriaFormSelectField.prototype.onAppend=function(){this.control.selectedIndex=this.selectedIndex};
var CriteriaFormHiddenField=function(a){CriteriaFormField.call(this,a)};CriteriaFormHiddenField.prototype=new CriteriaFormField;CriteriaFormHiddenField.prototype.createControl=function(){this.control=document.createElement("input");this.control.type="hidden";$(this.control).val(this.getValue());return this};CriteriaFormHiddenField.prototype.getHTML=function(){CriteriaFormField.prototype.getHTML.call(this);this.html.style.display="none";this.triggerDependentFields();return this.html};
var CriteriaForm=function(a){MultipleItemSubpanel.call(this,a);this.cancelCaption=this.cancelButton=this.submitCaption=this.onCancel=this.onSubmit=this.fields=null;CriteriaForm.prototype.initObject.call(this,a)};CriteriaForm.prototype.type="CriteriaForm";CriteriaForm.prototype=new MultipleItemSubpanel;
CriteriaForm.prototype.initObject=function(a){var b={fields:[],onSubmit:null,onCancel:null,cancelButton:!1,language:{BUTTON_SUBMIT:"Submit",BUTTON_CANCEL:"Cancel"}};$.extend(!0,b,a);this.language=b.language;this.onSubmit=b.onSubmit;this.onCancel=b.onCancel;this.submitCaption=this.language.BUTTON_SUBMIT;this.cancelButton=b.cancelButton;this.cancelCaption=this.language.BUTTON_CANCEL;this.setFields(b.fields)};CriteriaForm.prototype.getFieldByName=function(a){return this.fields.find("name",a)};
CriteriaForm.prototype.setFields=function(a){var b,c;this.fields=new jCore.ArrayList;for(b=0;b<a.length;b+=1){c=a[b];if(!(a[b]instanceof CriteriaFormField)&&"object"===typeof c)switch(c.dependsOn=c.dependsOn&&this.getFieldByName(c.dependsOn)||null,c.type){case "text":c=new CriteriaFormTextField(c);break;case "number":c=new CriteriaFormNumberField(c);break;case "hidden":c=new CriteriaFormHiddenField(c);break;case "select":c=new CriteriaFormSelectField(c);break;case "long_text":c=new CriteriaFormLongTextField(c);
break;case "date":c=new CriteriaFormDateField(c)}c.form=this;this.fields.insert(c)}return this};CriteriaForm.prototype.getSubmitObject=function(){var a={},b;for(b=0;b<this.fields.getSize();b+=1)a[this.fields.get(b).name]=this.fields.get(b).getValue();return a};CriteriaForm.prototype.isValid=function(){var a,b=!0;for(a=0;a<this.fields.getSize()&&(b=b&&this.fields.get(a).isValid(),b);a+=1);return b};
CriteriaForm.prototype.reset=function(){var a;for(a=0;a<this.fields.getSize();a+=1)this.fields.get(a).reset();return this};CriteriaForm.prototype.createHTML=function(){MultipleItemSubpanel.prototype.createHTML.call(this);$(this.html).addClass("multiple-item-form");return this.html};
CriteriaForm.prototype.open=function(){var a=document.createElement("div"),b=$(this.content),c,d=this,e;b.empty();this.showLoader();MultipleItemSubpanel.prototype.open.call(this);e=this.createHTMLElement("form");$(e).on("submit",function(a){a.preventDefault();d.isValid()&&"function"===typeof d.onSubmit&&(a=d.getSubmitObject(),d.onSubmit.call(d,a))});c=[];for(a=0;a<this.fields.getSize();a+=1)this.fields.get(a),c.push(this.fields.get(a).getHTML());this.hideLoader();for(a=0;a<c.length;a+=1)if(e.appendChild(c[a]),
"function"===typeof c[a].onAppend)c[a].onAppend();c=document.createElement("div");c.style.textAlign="center";a=document.createElement("input");a.type="submit";a.value=this.submitCaption;c.appendChild(a);this.cancelButton&&(a=document.createElement("input"),a.type="button",a.value=this.cancelCaption,c.appendChild(a),$(a).on("click",function(){"function"===typeof d.onCancel&&(d.onCancel.call(d),$(".hasDatepicker").datepicker("hide"))}));e.appendChild(c);b.append(e);return this};
var SugarExpression=function(a){SingleItem.call(this,a);this.decimalSeparator=this.expSuperType=this.editMode=this.onExitEdit=this.onEdit=this.editable=this.expUnit=this.expValue=this.expOperator=this.expField=this.expModule=this.expDirection=this.expType=null;SugarExpression.prototype.initObject.call(this,a)};SugarExpression.prototype=new SingleItem;SugarExpression.prototype.type="SugarExpression";SugarExpression.prototype.family="SugarExpression";
SugarExpression.prototype.operators=[{value:"equals",label:"=="},{value:"major_than",label:">"},{value:"major_equals_than",label:">="},{value:"not_equals",label:"!="},{value:"minor_than",label:"<"},{value:"minor_equals_than",label:"<="}];SugarExpression.prototype.sTypes={OPERAND:0,OPERATOR:1,GROUP:2};
SugarExpression.prototype.eTypes={LOGIC:"LOGIC",GROUP:"GROUP",MATH:"MATH",ARITHMETIC:"ARITHMETIC",MODULE:"MODULE",CONTROL:"CONTROL",DEFAULTMODULE:"DEFAULTMODULE",BUSINESS_RULES:"BUSINESS_RULES",USER_ADMIN:"USER_ADMIN",USER_ROLE:"USER_ROLE",USER_IDENTITY:"USER_IDENTITY",FIXED_DATE:"FIXED_DATE",SUGAR_DATE:"SUGAR_DATE",UNIT_TIME:"UNIT_TIME",SUGAR_VAR:"SUGAR_VAR",NUMBER:"NUMBER"};
SugarExpression.prototype.initObject=function(a){var b={expType:null,expModule:{text:null,value:null},expField:{text:null,value:null},expOperator:{text:null,value:null},expDirection:null,expLabel:null,expValue:{text:null,value:null},expUnit:null,expFieldType:null,editable:!0,onEdit:null,onExitEdit:null,decimalSeparator:"."};$.extend(!0,b,a);this.editMode=!1;this.setDecimalSeparator(b.decimalSeparator).setExpressionType(b.expType).setExpressionValue(b.expValue).setExpressionUnit(b.expUnit).setFieldType(b.expFieldType).setExpressionOperator(b.expOperator).setExpressionModule(b.expModule).setExpressionField(b.expField).setExpressionDirection(b.expDirection).setIsEditable(b.editable).setOnEditHandler(b.onEdit).setOnExitEditHandler(b.onExitEdit).updateLabel();
a=!1;if(b.expLabel){switch(this.expType){case "DEFAULTMODULE":case "CONTROL":case "BUSINESS_RULES":case "MODULE":a=b.expLabel.indexOf(this.expOperator.text);this.expField.text=$.trim(b.expLabel.substr(0,a));this.updateLabel();break;case "USER_ADMIN":case "USER_IDENTITY":case "USER_ROLE":this.label=b.expLabel}a=!0}this.createHTML(b.expLabel);a||this.updateHTML()};
SugarExpression.prototype.setDecimalSeparator=function(a){"string"===typeof a&&a&&(this.decimalSeparator=a,this.expValue&&this.setExpressionValue(this.expValue));return this};SugarExpression.prototype.setOnExitEditHandler=function(a){delete this.setOnExitEditHandler;this.onExitEdit="function"===typeof a?a:null;return this};SugarExpression.prototype.setIsEditable=function(a){this.editable=a;if(this.html)$(this.html).off("click").on("click",this.onClickHandler());this.refreshCursor();return this};
SugarExpression.prototype.setExpressionType=function(a){if(this.eTypes[a])switch(this.expType=this.eTypes[a],this.expType){case "LOGIC":this.expSuperType=this.sTypes.OPERATOR;break;case "GROUP":this.expSuperType=this.sTypes.GROUP;break;case "ARITHMETIC":this.expSuperType=this.sTypes.OPERATOR;case "MATH":this.expSuperType=this.sTypes.OPERATOR;break;case "FIXED_DATE":case "NUMBER":case "SUGAR_VAR":case "SUGAR_DATE":case "UNIT_TIME":case "MODULE":case "CONTROL":case "DEFAULTMODULE":case "BUSINESS_RULES":case "USER_ADMIN":case "USER_IDENTITY":case "USER_ROLE":this.expSuperType=
this.sTypes.OPERAND}document.createElement("li");return this};SugarExpression.prototype.refreshTooltip=function(){this.html&&$(this.html).attr("title",this.getSugarExpressionText());return this};SugarExpression.prototype.updateHTML=function(){this.updateLabel();return SingleItem.prototype.updateHTML.call(this,!1)};
SugarExpression.prototype.createHTML=function(a){if(this.html)return this.html;SingleItem.prototype.createHTML.call(this,!1);""===this.label?this.updateHTML():SingleItem.prototype.updateHTML.call(this,!1);return this.refreshTooltip().html};SugarExpression.prototype.setExpressionModule=function(a){"string"===typeof a&&(a={text:a,value:a});this.expModule=a;return this};
SugarExpression.prototype.setExpressionField=function(a){if("object"===typeof a)this.expField=a;else if("string"===typeof a||"number"===typeof a)this.expField={text:a,value:a};this.updateHTML();return this};SugarExpression.prototype.getObject=function(){return{expType:this.expType,expModule:this.expModule,expField:this.expField,expFieldType:this.expFieldType,expOperator:this.expOperator,expValue:this.expValue,expUnit:this.expUnit,expDirection:this.expDirection,expLabel:this.getLabel()}};
SugarExpression.prototype.getValue=function(){return JSON.stringify(this.getObject())};SugarExpression.prototype.updateLabel=function(){this.expField&&this.expOperator&&this.expValue&&(this.label=this.getFriendlyText());return this};
SugarExpression.prototype.setExpressionOperator=function(a){var b;if("object"===typeof a)this.expOperator=a,this.updateHTML();else if("string"===typeof a)for(b=0;b<this.operators.length;b+=1)if(this.operators[b].label===a||this.operators[b].value===a){this.expOperator={text:this.operators[b].label,value:this.operators[b].value};break}return this};
SugarExpression.prototype.setIsEditMode=function(a){this.editMode=!!a;a?(this.hideCloseButton(),"function"===typeof this.onEdit&&this.onEdit.call(this),$(this.html).addClass("expanded")):(this.showCloseButton(),this.refreshTooltip(),$(this.html).removeClass("expanded"),"function"===typeof this.onExitEdit&&this.onExitEdit.call(this));return this};SugarExpression.prototype.onClickHandler=function(){var a=this;return this.editable?function(b){b.stopPropagation();a.setIsEditMode(!a.editMode)}:null};
SugarExpression.prototype.setExpressionDirection=function(a){this.expDirection=a;return this};
SugarExpression.prototype.formatNumber=function(a,b,c,d,e){if("undefined"==typeof b||"undefined"==typeof c)return a;a=a?a.toString():"";if(a.split)a=a.split(".");else return a;if(2<a.length)return a.join(".");"undefined"!=typeof d&&(0<d&&1<a.length&&(a[1]=parseFloat("0."+a[1]),a[1]=Math.round(a[1]*Math.pow(10,d))/Math.pow(10,d),a[1]=a[1].toString().split(".")[1]),0>=d&&(a[0]=Math.round(parseInt(a[0],10)*Math.pow(10,d))/Math.pow(10,d),a[1]=""));if("undefined"!=typeof e&&0<=e&&(a[1]=1<a.length&&"undefined"!=
typeof a[1]?a[1].substring(0,e):"",a[1].length<e))for(d=a[1].length;d<e;d++)a[1]+="0";for(regex=/(\d+)(\d{3})/;""!=b&&regex.test(a[0]);)a[0]=a[0].toString().replace(regex,"$1"+b+"$2");return a[0]+(1<a.length&&""!=a[1]?c+a[1]:"")};
SugarExpression.prototype.setExpressionValue=function(a){if(void 0===a||null===a)this.expValue={text:"",value:""};else{"object"!==typeof a&&("string"===typeof a&&(a=$.trim(a)),a={text:a,value:a});if("MODULE"===this.expType||"BUSINESS_RULES"===this.expType)if(""===a.value)a.text='""';else if("number"===typeof a.value)a.text=a.value.toString().replace(/\./,this.decimalSeparator);else if("string"===typeof a.value)"$"!==a.text.replace(/("([^"]+)"|(\s+))|('([^']+)'|(\s+))/,"$")?"MODULE"===this.expType||
"TRUE"!==a.text.toUpperCase()&&"FALSE"!==a.text.toUpperCase()&&"NOW"!==a.text.toUpperCase()&&"NULL"!==a.text.toUpperCase()?a.text='"'+a.text+'"':a.text=a.text.toUpperCase():/(^\".+\"$)|(^\'.+\'$)/.test(a.value)?a.text=a.value.replace(/(^\')|(\'$)/g,'"'):a.text='"'+a.value+'"';else throw"The value must be number or string";this.expValue=a}this.updateHTML();return this};SugarExpression.prototype.setExpressionUnit=function(a){this.expUnit=a;this.updateHTML();return this};
SugarExpression.prototype.setFieldType=function(a){this.expFieldType=a;this.updateHTML();return this};
SugarExpression.prototype.getFriendlyText=function(){var a="";switch(this.expType){case "LOGIC":case "GROUP":case "MATH":case "ARITHMETIC":case "FIXED_DATE":case "NUMBER":case "SUGAR_VAR":case "SUGAR_DATE":a=SingleItem.prototype.htmlentities(this.expValue.text);break;case "UNIT_TIME":a=this.expValue.text+"["+this.expUnit+"]";break;case "DEFAULTMODULE":case "CONTROL":case "BUSINESS_RULES":case "MODULE":a="with_in"===this.expOperator?this.expField.text+" "+this.expOperator.text+" ["+SingleItem.prototype.htmlentities(this.expValue.text)+
"]":this.expField.text+" "+this.expOperator.text+" "+this.expValue.text;break;case "USER_ADMIN":a=this.expField.text+" is"+("equals"===this.expOperator.value?"":" not")+" admin";break;case "USER_ROLE":a=this.expField.text+" has"+("equals"===this.expOperator.value?"":" not")+" role "+this.expValue.text;break;case "USER_IDENTITY":a=this.expField.text+" "+this.expOperator.text+" "+this.expValue.text}return a};
SugarExpression.prototype.getSugarExpressionText=function(){var a="",b=[];switch(this.expType){case "LOGIC":case "GROUP":case "MATH":case "ARITHMETIC":case "FIXED_DATE":case "NUMBER":case "SUGAR_VAR":case "SUGAR_DATE":a=this.expValue.text;break;case "UNIT_TIME":a=this.expValue.text+"["+this.expUnit+"]";break;case "CONTROL":case "BUSINESS_RULES":case "MODULE":b.push("{"),null!==this.expDirection&&b.push(this.expDirection),b.push(this.expModule&&this.expModule.value||"NULL"),b.push(this.expField.value),
b.push("}"),a=b.join("::"),a="with_in"===this.expOperator.value||"not_with_in"===this.expOperator.value?a+" "+this.expOperator.text+" ["+this.expValue.text+"]":a+" "+this.expOperator.text+" "+this.expValue.text}return a};var ExpressionField=function(a,b){Field.call(this,a,b);this.expressionFieldControl=this.variablesProxy=null;this.language={};ExpressionField.prototype.initObject.call(this,a)};ExpressionField.prototype=new Field;
ExpressionField.prototype.initObject=function(a){var b={variablesProxy:null,language:{LBL_VARIABLES:"Variables",LBL_CONSTANTS:"Constantes"}};$.extend(!0,b,a);this.language=b.language;this.setVariablesProxy(b.variablesProxy);this.expressionFieldControl=new ExpressionFieldControl({value:this.value,variables:this.getVariables(),onChange:this.onChangeHandler(),language:this.language})};ExpressionField.prototype.getControl=function(){return this.expressionFieldControl};
ExpressionField.prototype.clear=function(){this.expressionFieldControl.clear();return this};ExpressionField.prototype.onChangeHandler=function(){var a=this;return function(){a.value=this.value;a.onChange()}};ExpressionField.prototype.setVariablesProxy=function(a){a instanceof RestProxy&&(this.variablesProxy=a);return this};ExpressionField.prototype.getValue=function(){return this.value};
ExpressionField.prototype.getVariables=function(){var a,b,c=[];if(this.variablesProxy&&(a=this.variablesProxy.getData())&&a.success)for(b=0;b<a.result.length;b++)c.push({label:a.result[b].text,value:a.result[b].value});return c};
ExpressionField.prototype.isValid=function(){var a=this.expressionFieldControl.isValid();if(a)return $(this.errorTooltip.html).removeClass("adam-tooltip-error-on"),$(this.errorTooltip.html).addClass("adam-tooltip-error-off"),a&&Field.prototype.isValid.call(this);this.errorTooltip.setMessage("invalid criteria syntax");$(this.errorTooltip.html).removeClass("adam-tooltip-error-off");$(this.errorTooltip.html).addClass("adam-tooltip-error-on");return a};
ExpressionField.prototype.createHTML=function(){var a,b="";Field.prototype.createHTML.call(this);this.required&&(b="<i>*</i> ");a=this.createHTMLElement("span");a.className="adam-form-label";a.innerHTML=b+this.label+":";a.style.width=this.parent.labelWidth||"auto";this.html.appendChild(a);this.controlObject=a=this.expressionFieldControl.getHTML();this.html.appendChild(a);this.errorTooltip&&this.html.appendChild(this.errorTooltip.getHTML());this.helpTooltip&&this.html.appendChild(this.helpTooltip.getHTML());
return this.html};ExpressionField.prototype.setValue=function(a){this.value=a;this.expressionFieldControl&&this.expressionFieldControl.setValue(a);return this};ExpressionField.prototype.evalRequired=function(){var a=!0;this.required&&((a=this.expressionFieldControl.items.length)?$(this.controlObject).removeClass("required"):$(this.controlObject).addClass("required"));return a};
var ExpressionFieldControl=function(a){Element.call(this,a);this.items=[];this.expressionContainer=this.onChange=this.value=this.isPanelOpen=this.panel=null;this.variables=[];this.initialized=!1;this.language={};ExpressionFieldControl.prototype.initObject.call(this,a)};ExpressionFieldControl.prototype=new Element;ExpressionFieldControl.prototype.expressionType={ARITMETIC:0,LOGIC:1,GROUP:2,EVALUATION:3,VAR:4,CONST:5,SQL:6,INT:7,FLOAT:8,STRING:9,BOOL:10,DATE:11};
ExpressionFieldControl.prototype.expressions=[["+","-","x","/"],["AND","OR","NOT"],["(",")"],"== < <= => > !=".split(" "),[],["NOW","NULL"]];ExpressionFieldControl.prototype.initObject=function(a){var b={variables:[],value:"[]",onChange:null,language:{LBL_VARIABLES:"Variables",LBL_CONSTANTS:"Constants"}};$.extend(!0,b,a);this.language=b.language;this.setVariables(b.variables).setValue(b.value);this.onChange=b.onChange;this.initialized=!0};
ExpressionFieldControl.prototype.setVariables=function(a){a.push&&a.pop&&(this.variables=a);return this};ExpressionFieldControl.prototype.clear=function(){for(;this.items.length;)this.removeItem(this.items[0]);return this};
ExpressionFieldControl.prototype.setValue=function(a){var b=this.value;this.value=a;if(this.value===b)return this;this.clear();if("undefined"!==typeof a&&null!==a&&""!==$.trim(a))for(a=JSON.parse(this.value),b=0;b<a.length;b++)this.addItem(new ExpressionComponent({label:SingleItem.prototype.htmlentities(a[b].value),value:label||a[b].value,data:{type:this.expressionType[a[b].type]},language:this.language}));return this};
ExpressionFieldControl.prototype.removeItem=function(a){var b;for(b=0;b<this.items.length;b++)if(this.items[b]===a){this.items.splice(b,1);$(this.expressionContainer).find("input").eq(b).remove();$(this.expressionContainer).find("input").eq(b).select();break}this.updateValue();return this};
ExpressionFieldControl.prototype.validateInputValue=function(a){var b=0,c,d;if("undefined"===typeof a||null===a||""===$.trim(a))return{valid:!1};if(/^\s*(\+|-)?\d+\s*$/.test(a))return{valid:!0,type:this.expressionType.INT,value:a};if(/^\s*(\+|-)?\d+\.\d+\s*$/.test(a))return{valid:!0,type:this.expressionType.FLOAT,value:a};if(/^\s*(true|false)\s*$/i.test(a))return{valid:!0,type:this.expressionType.BOOL,value:a.toUpperCase()};if(/^\s*\d{4}-((0\d)|(1[0-2]))-(([0-2]\d)|(3[01]))\s*$/.test(a)){b=a.split("-");
b[0]=parseInt(b[0],10);b[1]=parseInt(b[1],10);b[2]=parseInt(b[2],10);switch(b[1]){case 2:b=b[0]%4&&0!=b[0]%100||0===b[0]%400?!(29<b[2]):!(28<b[2]);break;case 4:case 6:case 9:case 11:b=!(30<b[2]);break;default:b=!(31<b[2])}if(b)return{valid:!0,type:this.expressionType.DATE,value:a,label:a}}else{if(/("(?:[^"\\]|\\.)*")|('(?:[^'\\]|\\.)*')/.test(a))return a=a.substr(1,a.length-2),b='"'+a.replace(/"/g,'\\"').replace(/'/g,"\\'")+'"',{valid:!0,type:this.expressionType.STRING,value:a,label:b};for(c in this.expressionType)if(d=
this.expressionType[c],this.expressions[d])for(b=0;b<this.expressions[d].length;b++)if(a.toLowerCase()==this.expressions[d][b].toLowerCase())return{valid:!0,value:this.expressions[d][b],type:d}}return{valid:!1}};
ExpressionFieldControl.prototype.processInput=function(a){var b,c=$(a.parentElement).find("input").index(a);a.value=$.trim(a.value);b=this.validateInputValue(a.value);return b.valid?($(a).val("").css("width","1px"),this.addItem(new ExpressionComponent({label:SingleItem.prototype.htmlentities(b.label||b.value),value:b.value,data:{type:b.type},language:this.language}),c),!0):!1};
ExpressionFieldControl.prototype.createTextInput=function(){var a=this.createHTMLElement("input");a.type="text";a.style.width="1px";a.style.margin="0px";a.style.padding="0px";a.className="multiple-item-input";return a};ExpressionFieldControl.prototype.dispatchOnChangeCallback=function(a){"function"===typeof this.onChange&&this.initialized&&this.onChange.call(this,this.getValue(),a);return this};
ExpressionFieldControl.prototype.updateValue=function(){var a,b="",c=this.getValue();if(this.html){for(a=0;a<this.items.length;a++)b+=this.items[a].getLabel()+" ";this.html.value=this.html.title=$("<div/>").html(b).text()}this.value=JSON.stringify(this.getObject());this.value!==c&&this.dispatchOnChangeCallback(c);return this};
ExpressionFieldControl.prototype.onItemClickHandler=function(){var a=this;return function(){var b=new MultipleItemPanel({belongsTo:this.getHTML()}),c=a.expressions[this.getData("type")],d,e=[],f=this;for(d=0;d<c.length;d++)e.push({caption:c[d],onClick:function(){$(b.html).remove();delete b;f.setValue(this.name).setLabel(this.name);a.dispatchOnChangeCallback()}});b.setButtons(e);document.body.appendChild(b.getHTML());b.open()}};
ExpressionFieldControl.prototype.addItem=function(a,b){var c=this,d,e;a instanceof ExpressionComponent?a.parent=this:(a.type===this.expressionType.STRING&&(e='"'+a.value.replace(/"/g,'\\"').replace(/'/g,"\\'")+'"'),a=new ExpressionComponent({label:SingleItem.prototype.htmlentities(e||a.value),value:a.value,showValueTooltip:!1,data:{type:a.type},language:this.language},this));a.onChange=function(a,b){c.dispatchOnChangeCallback(b)};a.onEdit=function(){var a;for(a=0;a<c.items.length;a++)c.items[a]!==
this&&c.items[a].exitEditMode()};b||0===b||(d=$(this.expressionContainer).find("input:focus").get(0))&&(b=$(this.expressionContainer).find("input").index(d));a.onRemove=function(){c.removeItem(this)};"undefined"===typeof b||null===b||b>=this.items.length?(this.items.push(a),this.html&&(this.expressionContainer.appendChild(a.getHTML()),this.expressionContainer.appendChild(this.createTextInput()),$(this.expressionContainer).find("input:last").focus().select())):(this.items.splice(b,0,a),this.html&&
(0===b?$(this.expressionContainer).prepend(a.getHTML()).prepend(this.createTextInput()):$(this.expressionContainer).find("li").eq(b).before(a.getHTML()).before(this.createTextInput()),$(this.expressionContainer).find("input").eq(b+1).focus().select()));d&&(d.value="",d.style.width="1px");this.updateValue();return this};
ExpressionFieldControl.prototype.onListItemSelected=function(a){var b=this;return function(c,d){var e=new ExpressionComponent({label:c,value:c,showValueTooltip:!1,data:{type:a},language:this.language});b.addItem(e)}};ExpressionFieldControl.prototype.onOperatorClickHandler=function(){var a=this;return function(){a.addItem(new ExpressionComponent({label:this.caption,value:this.caption,showValueTooltip:!1,data:{type:this.value},language:this.language}))}};
ExpressionFieldControl.prototype.setupPanel=function(){var a,b,c,d;b=[];var e,f,g=[];if(!this.panel){this.panel=new MultipleItemPanel({matchParentWidth:!1,width:24,belongsTo:this.html});$(this.panel.getHTML()).addClass("expression-field-panel");a=this.createHTMLElement("ul");a.className="multiple-item-container";this.expressionContainer=a;this.expressionContainer.appendChild(this.createTextInput());for(f in this.expressionType)if("CONST"!==f&&(e=this.expressionType[f],this.expressions[e]))for(j=0;j<
this.expressions[e].length;j++)b.push({caption:this.expressions[e][j],value:e});for(e=0;e<this.expressions[this.expressionType.CONST].length;e++)g.push({label:this.expressions[this.expressionType.CONST][e],value:this.expressions[this.expressionType.CONST][e]});b=new MultipleItemButtonPanel({label:"",fallbackOnClickHandler:this.onOperatorClickHandler(),buttons:b});c=new MultipleItemListSubpanel({title:this.language.LBL_VARIABLES,collapsable:!0,items:this.variables,onItemSelect:this.onListItemSelected(this.expressionType.VAR)});
d=new MultipleItemListSubpanel({title:this.language.LBL_CONSTANTS,collapsable:!0,items:g,onItemSelect:this.onListItemSelected(this.expressionType.CONST),onOpen:function(){c.close()}});c.onOpen=function(){d.close()};this.panel.getHTML().appendChild(a);this.panel.getHTML().appendChild(b.getHTML());this.panel.getHTML().appendChild(c.getHTML());this.panel.getHTML().appendChild(d.getHTML())}return this};
ExpressionFieldControl.prototype.createHTML=function(){var a;if(this.html)return this.html;a=this.createHTMLElement("input");a.type="text";a.readOnly=!0;this.html=a;this.updateValue();this.setupPanel();for(a=0;a<this.items.length;a++)this.expressionContainer.appendChild(this.items[a].getHTML()),this.expressionContainer.appendChild(this.createTextInput());this.attachListeners();return this.html};ExpressionFieldControl.prototype.selectInput=function(){return this};
ExpressionFieldControl.prototype.openPanel=function(){$(this.panel.html).addClass("focused");$(document.body).append(this.panel.getHTML());this.panel.open();$(this.expressionContainer).trigger("click");$(this.controlObject).addClass("focused");this.isPanelOpen=!0;return this};ExpressionFieldControl.prototype.closePanel=function(){var a;this.panel.close();$(this.controlObject).removeClass("focused");for(a=0;a<this.items.length;a++)this.items[a].exitEditMode();this.isPanelOpen=!1;return this};
ExpressionFieldControl.prototype.updateTextInput=function(a,b){var c=$(a).css("font-family"),d=$(a).css("font-size"),c=this.calculateWidth(b||a.value,d+" "+c);a.style.width=(c||1)+"px";return this};ExpressionFieldControl.prototype.checkExternalClickHandler=function(){var a=this;return function(b){a.isPanelOpen&&(b=$(b.target),b[0].id!==a.panel.html.id&&0===b.parents("#"+a.panel.html.id).length&&a.closePanel())}};
ExpressionFieldControl.prototype.attachListeners=function(){var a=this;if(!this.html)return this;$(this.html).on("focus",function(){$(this).addClass("focused");a.selectInput().openPanel()}).on("keydown click",function(b){27===b.which||9===b.which?a.closePanel():a.openPanel()});$(this.expressionContainer).on("click",function(a){$(this).find("input:last").select()}).on("keydown",".multiple-item-input",function(b){13===b.which?(b.preventDefault(),b.stopPropagation(),a.processInput(this)||this.select()):
37===b.which&&""===this.value?(b.preventDefault(),$(this).prev().prev().select()):39===b.which&&""===this.value?(b.preventDefault(),$(this).next().next().select()):27===b.which&&($(a.controlObject).focus(),a.closePanel())}).on("keypress",".multiple-item-input",function(b){a.updateTextInput(this,this.value+String.fromCharCode(b.which))}).on("keyup",".multiple-item-input",function(b){a.updateTextInput(this)}).on("blur",".multiple-item-input",function(b){a.processInput(this)||(this.value="",this.style.width=
"1px")}).on("click",".multiple-item-input",function(a){a.stopPropagation()});$(this.html.parentElement).on("scroll",function(){a.closePanel()});$(document).on("mousedown",this.checkExternalClickHandler());return this};
ExpressionFieldControl.prototype.isValid=function(){var a=!0,b=0,c=null,d;for(d=0;d<this.items.length;d++){if(0===d)switch(this.items[d].getData("type")){case this.expressionType.ARITMETIC:a=!1;break;case this.expressionType.GROUP:a="("===this.items[d].getValue();b++;break;case this.expressionType.LOGIC:a="NOT"===this.items[d].getValue();break;case this.expressionType.EVALUATION:a=!1;break;case this.expressionType.CONST:case this.expressionType.INT:case this.expressionType.FLOAT:case this.expressionType.BOOL:case this.expressionType.STRING:case this.expressionType.DATE:case this.expressionType.VAR:a=
!0}else switch(this.items[d].getData("type")){case this.expressionType.ARITMETIC:case this.expressionType.EVALUATION:if(c.type===this.expressionType.ARITMETIC||c.type===this.expressionType.GROUP&&"("===c.value||c.type===this.expressionType.LOGIC||c.type===this.expressionType.EVALUATION)a=!1;break;case this.expressionType.GROUP:if("("===this.items[d].getValue())if(b++,null===c)a=!0;else{if(c.type===this.expressionType.CONST||c.type===this.expressionType.VAR||c.type===this.expressionType.GROUP&&")"===
c.value||c.type===this.expressionType.INT||c.type===this.expressionType.FLOAT||c.type===this.expressionType.BOOL||c.type===this.expressionType.DATE||c.type===this.expressionType.STRING)a=!1}else if(b--,c.type===this.expressionType.ARITMETIC||c.type===this.expressionType.GROUP&&"("===c.value||c.type===this.expressionType.LOGIC||c.type===this.expressionType.EVALUATION)a=!1;break;case this.expressionType.LOGIC:if("NOT"===this.items[d].getValue())if(null===c)a=!0;else{if(c.type===this.expressionType.LOGIC&&
"NOT"===c.value||c.type===this.expressionType.GROUP&&")"===c.value)a=!1}else if(c.type===this.expressionType.ARITMETIC||c.type===this.expressionType.GROUP&&"("==c.value||c.type===this.expressionType.LOGIC||c.type===this.expressionType.EVALUATION)a=!1;break;case this.expressionType.CONST:case this.expressionType.INT:case this.expressionType.FLOAT:case this.expressionType.BOOL:case this.expressionType.STRING:case this.expressionType.DATE:case this.expressionType.VAR:if(null===c)a=!0;else if(c.type===
this.expressionType.GROUP&&")"===c.value||c.type===this.expressionType.CONST||c.type===this.expressionType.VAR||c.type===this.expressionType.INT||c.type===this.expressionType.FLOAT||c.type===this.expressionType.BOOL||c.type===this.expressionType.STRING||c.type===this.expressionType.DATE)a=!1}if(d===this.items.length-1&&a)switch(this.items[d].getData("type")){case this.expressionType.ARITMETIC:a=!1;break;case this.expressionType.GROUP:a=")"===this.items[d].getValue();break;case this.expressionType.LOGIC:a=
!1;break;case this.expressionType.EVALUATION:a=!1;break;case this.expressionType.CONST:case this.expressionType.INT:case this.expressionType.FLOAT:case this.expressionType.BOOL:case this.expressionType.STRING:case this.expressionType.DATE:case this.expressionType.VAR:a=!0}if(!a)break;c={type:this.items[d].getData("type"),value:this.items[d].getValue()}}return a&&0===b};ExpressionFieldControl.prototype.getValue=function(){return this.value};
ExpressionFieldControl.prototype.getObject=function(){var a=[],b,c=[];for(b in this.expressionType)c[this.expressionType[b]]=b;for(b=0;b<this.items.length;b++)a.push({value:this.items[b].getValue(),type:c[this.items[b].getData("type")]});return a};ExpressionFieldControl.prototype.remove=function(){$(this.html).remove();this.panel.remove();$(this.expressionContainer).remove();delete this.items;delete this.isPanelOpen;delete this.value;delete this.onChange;delete this.variables};
var ExpressionComponent=function(a,b){SingleItem.call(this,$.extend(!0,{editable:!0},a));this.onChange=this.parent=null;this.language={};ExpressionComponent.prototype.initObject.call(this,a,b)};ExpressionComponent.prototype=new SingleItem;ExpressionComponent.prototype.initObject=function(a,b){var c={language:{}};$.extend(!0,c,a);this.parent=b;this.onChange=a.onChange||null;this.language=c.language};
ExpressionComponent.prototype.prepareEditionPanel=function(){var a,b=this.getData("type"),c=this;this.panel.clear();if(b===ExpressionFieldControl.prototype.expressionType.VAR)this.panel.addSubpanel({title:this.language.LBL_VARIABLES,items:this.parent.variables,visibleHeader:!1,onItemSelect:function(a){c.setValue(a);c.setLabel(a);c.parent.updateValue();c.exitEditMode()}},"list"),this.panel.matchParentWidth=!1;else if(b<=ExpressionFieldControl.prototype.expressionType.INT&&ExpressionFieldControl.prototype.expressions[b])for(a=
0;a<ExpressionFieldControl.prototype.expressions[b].length;a++)ExpressionFieldControl.prototype.expressions[b][a]!==this.getValue()&&this.panel.addButton({caption:ExpressionFieldControl.prototype.expressions[b][a],data:{value:ExpressionFieldControl.prototype.expressions[b][a]},onClick:function(){c.setValue(this.data.value);c.setLabel(c.getValue());c.parent.updateValue();c.exitEditMode()}});$(this.panel.getHTML()).css("width","150px");return this};
ExpressionComponent.prototype.createHTML=function(){return SingleItem.prototype.createHTML.call(this,!1)};
var DecisionTable=function(a){Element.call(this,{id:a.id});this.isDirty=this.showDirtyIndicator=this.onDirty=this.onChange=this.onRemoveRow=this.onAddRow=this.onRemoveColumn=this.onAddColumn=this.width=this.rows=this.decisionRows=this.conclusions=this.conditions=this.proxy=this.name=this.dom=this.hitType=this.base_module=null;this.fields=[];this.language={};this.correctlyBuilt=!1;DecisionTable.prototype.initObject.call(this,a||{})};DecisionTable.prototype=new Element;
DecisionTable.prototype.type="DecisionTable";
DecisionTable.prototype.initObject=function(a){var b={name:"",proxy:new SugarProxy({url:"pmse_Project/CrmData/fields/",uid:null,callback:null}),restClient:null,base_module:"",type:"multiple",width:"auto",rows:0,container:null,columns:{conditions:[],conclusions:[]},ruleset:[],onAddColumn:null,onRemoveColumn:null,onChange:null,showDirtyIndicator:!0,language:{SINGLE_HIT:"Single Hit",MULTIPLE_HIT:"Multiple Hit",CONDITIONS:"Conditions",CONCLUSIONS:"Conclusions",ADD_ROW:"Add row",REMOVE_ROW:"Remove row",
CLICK_TO_EDIT:"Click to edit",ERROR_CONCLUSION_VAR_DUPLICATED:"conclusion variable is duplicated",ERROR_EMPTY_RETURN_VALUE:'The "Return" conclusion is empty',ERROR_EMPTY_ROW:"No conditions were specified in row with conclusions, It's allowed only one row with no conditions (default ruleset)",ERROR_NOT_EXISTING_FIELDS:'This Business Rules Table can\'t be created, the following fields must exists for the Module "%s":',ERROR_INCORRECT_BUILD:"This Business Rules Table can't is incorrectly built",MSG_DELETE_ROW:"Do you really want to delete this rule set?",
MIN_ROWS:"The decision table must have at least 1 row",MIN_CONDITIONS_COLS:"The decision table must have at least 1 condition column",MIN_CONCLUSIONS_COLS:"The decision table must have at least 1 conclusion column",LBL_RETURN:"Return",ERROR_NO_VARIABLE_SELECTED:"No variable was selected",ERROR_INVALID_EXPRESSION:"Invalid expression",LBL_VARIABLES:"Variables",LBL_CONSTANTS:"Constants",LBL_ADD_CONDITION:"Add condition",LBL_ADD_CONCLUSION:"Add conclusion",ERROR_MISSING_EXPRESSION_OR_OPERATOR:"missing expression or operator"}};
$.extend(!0,b,a);this.dom={};this.conclusions=[];this.conditions=[];this.decisionRows=0;this.onAddColumn=b.onAddColumn;this.onRemoveColumn=b.onRemoveColumn;this.onChange=b.onChange;this.rows=parseInt(b.rows,10);this.language=b.language;this.setName(b.name).setProxy(b.proxy,b.restClient).setBaseModule(b.base_module).setHitType(b.type).setWidth(b.width).setShowDirtyIndicator(b.showDirtyIndicator);b.container&&($(b.container).append(this.getHTML()),this.isDOMNodeInsertedSupported||this.updateDimensions());
this.auxConclutions=b.columns.conclusions;this.auxConditions=b.columns.conditions;this.rules=b.ruleset;this.getFields()};DecisionTable.prototype.setShowDirtyIndicator=function(a){this.showDirtyIndicator=!!a;return this};DecisionTable.prototype.getIsDirty=function(){return this.isDirty};DecisionTable.prototype.setIsDirty=function(a,b){this.isDirty=a;b||"function"===typeof this.onDirty&&this.onDirty.call(this,a);return this};
DecisionTable.prototype.onChangeVariableHandler=function(){var a=this;return function(b,c){var d;d=this.getHTML();d=$(d.parentElement).find(d.tagName.toLowerCase()).index(d);d="condition"===this.mode?a.validateColumn(d,0):a.validateColumn(d,1);a.setIsDirty(!0);"function"===typeof a.onChange&&a.onChange.call(a,{object:this,newVal:b,oldVal:c},d)}};
DecisionTable.prototype.onChangeValueHandler=function(){var a=this;return function(b,c,d){var e,f,g;f=(g=b instanceof DecisionTableValueEvaluation)?b.getHTML()[0]:b.getHTML();e=f.parentElement;f=$(f.parentElement).find("td").index(f)/(g?2:1);e=$(e.parentElement).find("tr").index(e);g=a.validateColumn(f,g?0:1);g.valid&&(g=a.validateRow(e));a.setIsDirty(!0);"function"===typeof a.onChange&&a.onChange.call(a,{object:b,newVal:c,oldVal:d},g)}};
DecisionTable.prototype.removeAllConclusions=function(){for(;this.conclusions.length;)this.conclusions[0].remove();return this};DecisionTable.prototype.removeAllConditions=function(){for(;this.conditions.length;)this.conditions[0].remove();return this};DecisionTable.prototype.setConditions=function(a){var b;this.removeAllConditions();for(b=0;b<a.length;b+=1)this.addCondition(a[b]);return this};
DecisionTable.prototype.setConclusions=function(a){var b;this.removeAllConclusions();for(b=0;b<a.length;b+=1)this.addConclusion(!a[b],a[b]);return this};
DecisionTable.prototype.setRuleset=function(a){var b,c,d={},e={},f,g,h="",k={};for(b=0;b<this.conditions.length;b+=1)d[this.conditions[b].select.value]?d[this.conditions[b].select.value].push(b):d[this.conditions[b].select.value]=[b];e.result=0;for(b=1;b<this.conclusions.length;b+=1)e[this.conclusions[b].select.value]=b;for(b=0;b<a.length;b+=1){g=a[b].conditions;f={};for(c=0;c<g.length;c+=1)"undefined"===typeof f[g[c].variable_name]&&(f[g[c].variable_name]=-1),f[g[c].variable_name]+=1,"undefined"!==
typeof d[g[c].variable_name]?this.conditions[d[g[c].variable_name][f[g[c].variable_name]]].addValue(g[c].value,g[c].condition):k[g[c].variable_name]=0;f=a[b].conclusions;for(c=0;c<f.length;c+=1)"undefined"!==typeof e[f[c].conclusion_value]?this.conclusions[e[f[c].conclusion_value]].addValue(f[c].value):k[f[c].conclusion_value]=0;this.addDecisionRow()}for(b in k)h+="<li>"+b+"</li>";h?(k=this.createHTMLElement("p"),k.textContent=this.language.ERROR_NOT_EXISTING_FIELDS.replace(/\%s/,this.base_module),
this.html=this.createHTMLElement("div"),this.html.appendChild(k),k=this.createHTMLElement("ul"),$(k).append(h),$(this.html).append(k)):this.correctlyBuilt=!0;this.updateDimensions();return this};DecisionTable.prototype.isDOMNodeInsertedSupported=function(){var a=this.createHTMLElement("div"),b=!1;a.addEventListener("DOMNodeInserted",function(){b=!0});a.appendChild(a.cloneNode());return b};DecisionTable.prototype.setRows=function(a){this.rows=parseInt(a,10);return this.updateDimensions()};
DecisionTable.prototype.setWidth=function(a){this.width=a;return this.updateDimensions()};
DecisionTable.prototype.updateDimensions=function(){if(!this.html)return this;var a,b,c;"auto"!==this.width?(c=$(this.dom.indexTableContainer).outerWidth()+4,a=$(this.dom.conditionsTable).css("width","").outerWidth(),b=$(this.dom.conclusionsTable).css("width","").outerWidth(),a=Math.floor(a/(a+b)*(this.width-c)),b=this.width-c-a):($(this.dom.conditionsHeader.parentElement).css("width","").find("th").css("width",""),$(this.dom.conclusionsTable).css("width",""),$(this.dom.conclusionsHeader.parentElement).css("width",
"").find("th").css("width",""));this.dom.conditionsTableContainer.style.width=this.dom.conditionsHeaderContainer.style.width="auto"!==this.width?a+"px":"auto";this.dom.conclusionsTableContainer.style.width=this.dom.conclusionsHeaderContainer.style.width="auto"!==this.width?b+"px":"auto";this.decisionRows&&this.rows?(a=$(this.dom.conditionsTable).find("tr").outerHeight(),this.dom.indexTableContainer.style.height=this.dom.conditionsTableContainer.style.height=this.dom.conclusionsTableContainer.style.height=
a*this.rows+10+this.rows+"px"):this.dom.indexTableContainer.style.height=this.dom.conditionsTableContainer.style.height=this.dom.conclusionsTableContainer.style.height="auto";a=$(this.dom.conditionsTable).outerWidth();a<$(this.dom.conditionsTableContainer).width()&&"auto"!==this.width&&(this.dom.conditionsTable.style.width="100%",a=$(this.dom.conditionsTable).outerWidth(),a=2*Math.ceil(a/2));$(this.dom.conditionsHeader.parentElement).css("width",a+"px");a=Math.floor(a/this.conditions.length);$(this.dom.conditionsHeader).find("th").css("width",
a+"px");a=$(this.dom.conclusionsTable).outerWidth();a<$(this.dom.conclusionsTableContainer).width()&&"auto"!==this.width&&(this.dom.conclusionsTable.style.width="100%",a=$(this.dom.conclusionsTable).outerWidth(),a=2*Math.ceil(a/2));$(this.dom.conclusionsHeader.parentElement).css("width",a+"px");a=Math.floor(a/this.conclusions.length);$(this.dom.conclusionsHeader).find("th").css("width",a+"px");return this};
DecisionTable.prototype.createRemoveButton=function(){var a=this.createHTMLElement("span");a.className="icon-minus decision-table-remove";return a};
DecisionTable.prototype.addDecisionRow=function(){var a=this.createHTMLElement("tr"),b,c;if(!this.conditions.length||!this.conclusions.length)return this;for(b=0;b<this.conditions.length;b+=1)this.conditions[b].values[this.decisionRows]||this.conditions[b].addValue(),c=this.conditions[b].getValueHTML(this.conditions[b].values.length-1),a.appendChild(c[0]),a.appendChild(c[1]);this.dom.conditionsTable.appendChild(a);a=a.cloneNode(!1);for(b=0;b<this.conclusions.length;b+=1)this.conclusions[b].values[this.decisionRows]||
this.conclusions[b].addValue(),a.appendChild(this.conclusions[b].getValueHTML(this.conclusions[b].values.length-1));this.dom.conclusionsTable.appendChild(a);a=a.cloneNode(!1);c=this.createRemoveButton();this.decisionRows+=1;b=this.createHTMLElement("td");b.appendChild(c);a.appendChild(b);this.dom.indexTable.appendChild(a);1===this.decisionRows&&this.updateDimensions();"function"===typeof this.onAddRow&&this.onAddRow.call(this);return this};
DecisionTable.prototype.removeRowWithoutConfirmation=function(a){for(i=0;i<this.conclusions.length;i+=1)this.conclusions[i].removeValue(a);for(i=0;i<this.conditions.length;i+=1)this.conditions[i].removeValue(a);$(this.dom.indexTable).find("tr:eq("+a+")").remove();$(this.dom.conditionsTable).find("tr:eq("+a+")").remove();$(this.dom.conclusionsTable).find("tr:eq("+a+")").remove();this.decisionRows--;this.setIsDirty(!0);valid=this.validateColumn();"function"===typeof this.onChange&&this.onChange.call(this,
{},valid);"function"===typeof this.onRemoveRow&&this.onRemoveRow.call(this);return this};
DecisionTable.prototype.removeDecisionRow=function(a){var b,c=!1,d=this;if(1===this.decisionRows)return App.alert.show("mininal-error",{level:"warning",messages:this.language.MIN_ROWS,autoClose:!0}),this;for(b=0;b<this.conditions.length;b+=1)if(this.conditions[b].values[a].filledValue()){c=!0;break}if(!c)for(b=0;b<this.conclusions.length;b+=1)if(this.conclusions[b].values[a].filledValue()){c=!0;break}if(c)App.alert.show("message-config-delete-row",{level:"confirmation",messages:this.language.MSG_DELETE_ROW,
onConfirm:function(){return d.removeRowWithoutConfirmation(a)},onCancel:function(){return this}});else return this.removeRowWithoutConfirmation(a)};
DecisionTable.prototype.getFields=function(a){var b=0,c=this,d;if(this.fields.length)return this.fields;App.alert.show("upload",{level:"process",title:"LBL_LOADING",autoclose:!1});this.proxy.setUrl("pmse_Project/CrmData/fields/"+this.base_module);this.proxy.getData(null,{success:function(e){if(e&&e.success){d=[];for(b=0;b<e.result.length;b+=1)d.push({label:e.result[b].text,value:e.result[b].value});c.fields=d;c.setConditions(c.auxConditions);c.setConclusions(c.auxConclutions);c.setRuleset(c.rules);
c.conditions.length||c.addCondition(a);c.conclusions.length||c.addConclusion(!0);c.decisionRows||c.addDecisionRow();App.alert.dismiss("upload");c.setIsDirty(!1)}}});return this};DecisionTable.prototype.setName=function(a){this.name=a;return this};DecisionTable.prototype.setProxy=function(a,b){this.proxy=a;return this};DecisionTable.prototype.setBaseModule=function(a){this.base_module=a;return this};DecisionTable.prototype.setHitType=function(a){this.hitType=a;return this};
DecisionTable.prototype.onRemoveVariableHandler=function(a){var b=this,c;return function(){for(var d,e=0;e<a.length;e+=1)a[e]===this&&(d=a[e],a.splice(e,1));b.updateDimensions();c=b.validateRow();"function"===typeof b.onRemoveColumn&&b.onRemoveColumn.call(this,d);b.setIsDirty(!0);"function"===typeof b.onChange&&b.onChange.call(b,{},c)}};
DecisionTable.prototype.addCondition=function(a){a=new DecisionTableVariable({parent:this,value:a||null,fields:this.fields,language:this.language});var b,c;a.onRemove=this.onRemoveVariableHandler(this.conditions);a.onChangeValue=this.onChangeValueHandler();a.onChange=this.onChangeVariableHandler();this.conditions.push(a);this.html&&this.dom.conditionsHeader.appendChild(a.getHTML());this.proxy.uid=this.base_module||"";for(b=0;b<this.decisionRows;b+=1)a.addValue(),c=a.getValueHTML(b),$(this.dom.conditionsTable).find("tr:eq("+
b+")").append(c[0]).append(c[1]);this.updateDimensions();this.setIsDirty(!0);"function"===typeof this.onAddColumn&&this.onAddColumn.call(this,a);return this};
DecisionTable.prototype.addConclusion=function(a,b){var c=new DecisionTableVariable({returnType:a,mode:"conclusion",fields:this.fields,value:b,parent:this,language:this.language}),d;c.onRemove=this.onRemoveVariableHandler(this.conclusions);c.onChangeValue=this.onChangeValueHandler();c.onChange=this.onChangeVariableHandler();this.conclusions.push(c);this.html&&this.dom.conclusionsHeader.appendChild(c.getHTML());for(d=0;d<this.decisionRows;d+=1)c.addValue(),this.dom.conclusionsTable.childNodes[d].appendChild(c.getValueHTML(d));
this.updateDimensions();this.setIsDirty(!0);"function"===typeof this.onAddColumn&&this.onAddColumn.call(this,c);return this};
DecisionTable.prototype.canBeRemoved=function(a){var b=!1;a.parent===this&&("condition"===a.mode?(b=1<this.conditions.length)||App.alert.show("mininal-column-error",{level:"warning",messages:this.language.MIN_CONDITIONS_COLS,autoClose:!0}):"conclusion"===a.mode&&((b=1<this.conclusions.length)||App.alert.show("mininal-column-error",{level:"warning",messages:this.language.MIN_CONCLUSIONS_COLS,autoClose:!0})));return b};
DecisionTable.prototype.createHTML=function(){if(this.html)return this.html;var a,b,c,d,e,f;c=this.createHTMLElement("thead");plusNode=this.createHTMLElement("span");plusNode.className="icon-plus";plusNode2=this.createHTMLElement("span");plusNode2.className="icon-plus";a=this.createHTMLElement("tr");b=this.createHTMLElement("th");a.appendChild(b);b=this.createHTMLElement("th");d=this.createHTMLElement("button");d.appendChild(plusNode);d.className="decision-table-add-button";d.title=this.language.LBL_ADD_CONDITION;
this.dom.addConditionButton=d;e=this.createHTMLElement("span");e.appendChild(document.createTextNode(this.language.CONDITIONS));e.appendChild(d);b.appendChild(e);b.className="decision-table-separator-border";a.appendChild(b);b=b.cloneNode(!1);d=d.cloneNode(!0);d.title=this.language.LBL_ADD_CONCLUSION;this.dom.addConclusionButton=d;e=e.cloneNode(!1);e.appendChild(document.createTextNode(this.language.CONCLUSIONS));e.appendChild(d);b.appendChild(e);a.appendChild(b);c.appendChild(a);a=this.createHTMLElement("tr");
b=this.createHTMLElement("th");e=this.createHTMLElement("button");e.appendChild(plusNode2);e.title=this.language.ADD_ROW;e.className="decision-table-add-row";b.appendChild(e);a.appendChild(b);b=this.createHTMLElement("th");e=this.createHTMLElement("div");e.className="decision-table-conditions-header";this.dom.conditionsHeaderContainer=e;f=this.createHTMLElement("table");f.appendChild(a.cloneNode(!1));e.appendChild(f);this.dom.conditionsHeader=f.childNodes[0];b.className="decision-table-separator-border";
b.appendChild(e);a.appendChild(b);b=b.cloneNode(!0);this.dom.conclusionsHeaderContainer=b.childNodes[0];this.dom.conclusionsHeaderContainer.className="decision-table-conclusions-header";this.dom.conclusionsHeader=this.dom.conclusionsHeaderContainer.childNodes[0].childNodes[0];a.appendChild(b);d=this.createHTMLElement("tbody");d.appendChild(a);a=this.createHTMLElement("tr");b=this.createHTMLElement("td");e=e.cloneNode(!1);e.className="decision-table-container";this.dom.indexTableContainer=e;f=f.cloneNode(!1);
f.className="decision-table-index";this.dom.indexTable=f;e.appendChild(f);b.appendChild(e);a.appendChild(b);b=b.cloneNode(!0);this.dom.conditionsTable=(this.dom.conditionsTableContainer=b.childNodes[0]).childNodes[0];this.dom.conditionsTable.className="decision-table-conditions";b.className="decision-table-separator-border";a.appendChild(b);b=b.cloneNode(!0);b.className="";this.dom.conclusionsTable=(this.dom.conclusionsTableContainer=b.childNodes[0]).childNodes[0];this.dom.conclusionsTable.className=
"decision-table-conclusions";a.appendChild(b);d.appendChild(a);a=this.createHTMLElement("table");a.className="decision-table";a.appendChild(c);a.appendChild(d);this.html=a;for(c=0;c<this.conditions.length;c+=1)this.dom.conditionsHeader.appendChild(this.conditions[c].getHTML());for(c=0;c<this.conclusions.length;c+=1)this.dom.conclusionsHeader.appendChild(this.conclusions[c].getHTML());this.setShowDirtyIndicator(this.showDirtyIndicator);this.attachListeners();return this.html};
DecisionTable.prototype.attachListeners=function(){var a=this;$(this.dom.conditionsTableContainer).on("scroll",function(){a.dom.conditionsHeaderContainer.scrollLeft=this.scrollLeft;a.dom.conclusionsTableContainer.scrollTop=this.scrollTop});$(this.dom.conditionsHeaderContainer).on("scroll",function(){a.dom.conditionsTableContainer.scrollLeft=this.scrollLeft});$(this.dom.conclusionsTableContainer).add(this.dom.conclusionsHeaderContainer).on("scroll",function(){a.dom.conclusionsHeaderContainer.scrollLeft=
a.dom.conclusionsTableContainer.scrollLeft=this.scrollLeft;a.dom.indexTableContainer.scrollTop=a.dom.conditionsTableContainer.scrollTop=this.scrollTop});$(this.dom.indexTableContainer).on("scroll",function(){a.dom.conditionsTableContainer.scrollTop=a.dom.conclusionsTableContainer.scrollTop=this.scrollTop});$(this.dom.addConclusionButton).on("click",function(){a.addConclusion()});$(this.dom.addConditionButton).on("click",function(){a.addCondition()});$(this.dom.indexTable).on("click","span.decision-table-remove",
function(){a.removeDecisionRow($(a.dom.indexTable).find("span.decision-table-remove").index(this))});$(this.dom.conditionsTable).on("keydown","td",function(b){var c,d=this.parentElement;9===b.keyCode&&((c=$(d.parentElement).find("tr").index(d),$(d).find("td:last").get(0)!==this||b.shiftKey)?$(d).find("td:first").get(0)===this&&b.shiftKey&&(b.preventDefault(),$(a.dom.indexTable).find("span").eq(c).focus()):(b.preventDefault(),$(a.conclusions[0].getValueHTML(c)).find("span").focus()))});$(this.dom.indexTable).on("keydown",
"td",function(b){var c;c=this.parentElement;9===b.keyCode&&((c=$(c.parentElement).find("tr").index(c),b.shiftKey)?0<c&&(b.preventDefault(),$(a.conclusions[a.conclusions.length-1].getValueHTML(c-1)).find("span").focus()):(b.preventDefault(),$(a.conditions[0].getValueHTML(c)[0]).find("span").focus()))});$(this.dom.conclusionsTable).on("keydown","td",function(b){var c,d=this.parentElement;9===b.keyCode&&(c=$(d.parentElement).find("tr").index(d),$(d).find("td:last").get(0)===this&&!b.shiftKey&&c<a.decisionRows-
1?(b.preventDefault(),$(a.dom.indexTable).find("span").eq(c+1).focus()):$(d).find("td:first").get(0)===this&&b.shiftKey&&(b.preventDefault(),$(a.conditions[a.conditions.length-1].getValueHTML(c)[1]).find("span").focus()))});$(this.dom.conditionsTable).on("keydown","td",function(b){var c,d=this.parentElement;9===b.keyCode&&((c=$(d.parentElement).find("tr").index(d),$(d).find("td:last").get(0)!==this||b.shiftKey)?$(d).find("td:first").get(0)===this&&b.shiftKey&&(b.preventDefault(),$(a.dom.indexTable).find("button").eq(c).focus()):
(b.preventDefault(),$(a.conclusions[0].getValueHTML(c)).find("span").focus()))});$(this.dom.indexTable).on("keydown","td",function(b){var c,d=this.parentElement;9===b.keyCode&&((c=$(d.parentElement).find("tr").index(d),$(d).find("td:last").get(0)!==this||b.shiftKey)?$(d).find("td:first").get(0)===this&&b.shiftKey&&0<c&&(b.preventDefault(),$(a.conclusions[a.conclusions.length-1].getValueHTML(c-1)).find("span").focus()):(b.preventDefault(),$(a.conditions[0].getValueHTML(c)[0]).find("span").focus()))});
$(this.dom.conclusionsTable).on("keydown","td",function(b){var c,d=this.parentElement;9===b.keyCode&&(c=$(d.parentElement).find("tr").index(d),$(d).find("td:last").get(0)===this&&!b.shiftKey&&c<a.decisionRows-1?(b.preventDefault(),$(a.dom.indexTable).find("button").eq(c+1).focus()):$(d).find("td:first").get(0)===this&&b.shiftKey&&(b.preventDefault(),$(a.conditions[a.conditions.length-1].getValueHTML(c)[1]).find("span").focus()))});$(this.html).find(".decision-table-add-row").on("click",function(){a.addDecisionRow()});
$(this.dom.conditionsTable).add(this.dom.conclusionsTable).add(this.dom.indexTable).on("focus","td",function(){var b=this.parentElement;$(a.html).find("tr.cell-edit").removeClass("cell-edit");b=$(b.parentElement).find("tr").index(b);$(a.dom.indexTable.childNodes[b]).add(a.dom.conditionsTable.childNodes[b]).add(a.dom.conclusionsTable.childNodes[b]).addClass("cell-edit")}).on("blur","select, input",function(){});$(document).bind("DOMNodeInserted",function(b){b.target===a.html&&a.updateDimensions()});
return this};DecisionTable.prototype.validateConclusions=function(){var a,b={};for(a=0;a<this.conclusions.length;a+=1){if(!this.conclusions[a].returnType&&this.conclusions[a].select.value&&this.conclusions[a].getFilledValuesNum()){if(b[this.conclusions[a].select.value])return $(this.conclusions[a].getHTML()).addClass("error"),{valid:!1,location:"Conclusion # "+(a+1),message:this.language.ERROR_CONCLUSION_VAR_DUPLICATED};b[this.conclusions[a].select.value]=!0}$(this.conclusions[a].getHTML()).removeClass("error")}return{valid:!0}};
DecisionTable.prototype.validateRow=function(a){var b=0,c=this.decisionRows,d,e,f=0;"number"===typeof a&&(b=a,c=a+1);for(d=b;d<c;d+=1){a=b=!1;for(e=0;e<this.conditions.length;e+=1)if(this.conditions[e].values[d].filledValue()){b=!0;break}if(b)if(this.conclusions[0].values[d].filledValue())a=!0;else return $(this.conclusions[0].values[d].getHTML()).addClass("error"),{valid:!1,message:this.language.ERROR_EMPTY_RETURN_VALUE,location:"row # "+(d+1)};$(this.conclusions[0].values[d].getHTML()).removeClass("error");
if(!a)for(e=0;e<this.conclusions.length;e+=1)if(this.conclusions[e].values[d].filledValue()){a=!0;break}if(a&&!b&&(f+=1,1<f))return $(this.dom.conditionsTable).find("tr").eq(d).addClass("error"),{valid:!1,message:this.language.ERROR_EMPTY_ROW,location:"row # "+(d+1)};$(this.dom.conditionsTable).find("tr").eq(d).removeClass("error")}return{valid:!0}};
DecisionTable.prototype.validateColumn=function(a,b){var c,d,e,f=[{type:"condition",collection:this.conditions},{type:"conclusion",collection:this.conclusions}];$(this.dom.conditionsTable).find("tr").removeClass("error");if("number"===typeof a&&"number"===typeof b){if(c=f[b].collection[a].isValid(),!c.valid)return{valid:!1,message:c.message,location:f[b].type+" # "+(a+1)+(isNaN(c.index)?"":" - row "+(c.index+1))}}else for(e=0;e<f.length;e+=1)for(d=0;d<f[e].collection.length;d+=1)if(c=f[e].collection[d].isValid(),
!c.valid)return{valid:!1,message:c.message,location:f[e].type+" # "+(d+1)+(isNaN(c.index)?"":" - row "+(c.index+1))};return{valid:!0}};DecisionTable.prototype.isValid=function(){var a;if(!this.correctlyBuilt)return{valid:!1,message:this.language.ERROR_INCORRECT_BUILD};a=this.validateColumn();if(!a.valid)return a;a=this.validateRow();return a.valid?this.validateConclusions():a};
DecisionTable.prototype.getJSON=function(){var a={id:this.id,base_module:this.base_module,type:this.hitType,name:this.name,columns:{conditions:[],conclusions:[]},ruleset:[]},b,c,d,e,f,g,h=0;if(!this.isValid().valid)return null;g={};for(f=0;f<this.decisionRows;f+=1){for(e=0;e<this.conditions.length;e+=1)this.conditions[e].select.value&&this.conditions[e].values[f].getValue().length&&(g[this.conditions[e].select.value]||(g[this.conditions[e].select.value]={max:0,current:0}),g[this.conditions[e].select.value].current+=
1,g[this.conditions[e].select.value].current>g[this.conditions[e].select.value].max&&(g[this.conditions[e].select.value].max=g[this.conditions[e].select.value].current));for(e in g)g[e].current=0}for(e=0;e<this.conditions.length;e+=1)if(g[this.conditions[e].select.value]){for(f=0;f<g[this.conditions[e].select.value].max;f+=1)a.columns.conditions.push(this.conditions[e].select.value);delete g[this.conditions[e].select.value]}for(e=0;e<this.conclusions.length;e+=1)(this.conclusions[e].returnType||this.conclusions[e].select.value&&
this.conclusions[e].getFilledValuesNum())&&a.columns.conclusions.push(this.conclusions[e].select?this.conclusions[e].select.value:"");for(e=0;e<this.decisionRows;e+=1){b={id:e+1};c=[];d=[];for(f=0;f<this.conditions.length;f+=1)(g=this.conditions[f].getJSON(e))&&c.push(g);for(f=0;f<this.conclusions.length;f+=1)g=this.conclusions[f].getJSON(e),g.value.length&&d.push(g);b.conditions=c;b.conclusions=d;c.length||(h+=1);(c.length||1>=h)&&a.ruleset.push(b)}return a};
var DecisionTableVariable=function(a){Element.call(this);this.onChangeValue=this.onChange=this.onRemove=this.closeButton=this.select=this.returnType=this.mode=this.parent=this.value=this.name=this.values=null;this.fields=[];this.language={};DecisionTableVariable.prototype.initObject.call(this,a)};DecisionTableVariable.prototype=new Element;
DecisionTableVariable.prototype.initObject=function(a){var b={values:[],name:null,value:null,parent:null,mode:"condition",returnType:!1,onRemove:null,onChange:null,onChangeValue:null,fields:[],language:{}};$.extend(!0,b,a);this.language=b.language;this.value=b.value;this.values=[];this.parent=b.parent;this.mode=b.mode;this.onRemove=b.onRemove;this.onChange=b.onChange;this.onChangeValue=b.onChangeValue;this.returnType=b.returnType;this.setFields(b.fields).setValues(b.values).setName(b.name);this.returnType||
(this.select=this.createHTMLElement("select"),this.updateSelect())};DecisionTableVariable.prototype.updateSelect=function(){var a=0,b;$(this.select).empty();if(this.fields.length)for(b=this.createHTMLElement("option"),this.select.appendChild(b),a=0;a<this.fields.length;a+=1)b=this.createHTMLElement("option"),b.label=this.fields[a].label,b.value=this.fields[a].value,b.appendChild(document.createTextNode(this.fields[a].label)),this.value===b.value&&(b.selected=!0),this.select.appendChild(b);return this};
DecisionTableVariable.prototype.setFields=function(a){a.push&&a.pop&&(this.fields=a,this.select&&this.updateSelect());return this};DecisionTableVariable.prototype.setName=function(a){this.name=a;return this};
DecisionTableVariable.prototype.setValues=function(a){if("object"!=typeof a||!a.push)return this;var b=0;if("conclusion"===this.mode)for(b=0;b<a.length;b+=1)"string"!==typeof a[b]&&"number"!==typeof a[b]||this.values.push(new DecisionTableSingleValue({value:a[b],parent:this,fields:this.fields}));else for(b=0;b<a.length;b+=1)this.values.push(new DecisionTableValueEvaluation({value:a[b].value,operator:a[b].operator,parent:this,fields:this.fields,language:this.language}));return this};
DecisionTableVariable.prototype.getValueHTML=function(a){return this.values[a]?this.values[a].getHTML():null};
DecisionTableVariable.prototype.createHTML=function(){if(this.html)return this.html;var a=this.createHTMLElement("th"),b;this.returnType?(b=this.createHTMLElement("span"),b.className="decision-table-return",b.appendChild(document.createTextNode(this.returnType?this.language.LBL_RETURN:this.name||""))):b=this.select;a.appendChild(b);this.returnType||(b=this.createHTMLElement("button"),b.appendChild(document.createTextNode(" ")),b.className="decision-table-close-button",b.title="Remove Column",this.closeButton=
b,a.appendChild(this.closeButton));this.html=a;this.attachListeners();return a};DecisionTableVariable.prototype.removeWithoutConfirmation=function(){for(;this.values.length;)this.values[0].remove();this.values=null;$(this.html).remove();"function"===typeof this.onRemove&&this.onRemove.call(this)};
DecisionTableVariable.prototype.remove=function(){var a=this;this.parent.canBeRemoved(this)&&(this.getFilledValuesNum()?App.alert.show("variable-check",{level:"confirmation",messages:"Do you really want to remove this variable?",onCancel:function(){},onConfirm:function(){a.removeWithoutConfirmation()}}):this.removeWithoutConfirmation())};
DecisionTableVariable.prototype.attachListeners=function(){var a=this;if(!this.html)return this;$(this.select).on("change",function(){var b=a.value;a.name=$(this).find("option:selected").attr("label")||null;a.value=this.value||null;$(this).attr("title",a.name).parent().removeClass("error");"function"===typeof a.onChange&&a.onChange.call(a,a.value,b)});$(this.closeButton).on("click",function(){a.remove()});return this};
DecisionTableVariable.prototype.getFilledValuesNum=function(){var a,b=0;for(a=0;a<this.values.length;a+=1)this.values[a].filledValue()&&(b+=1);return b};DecisionTableVariable.prototype.onRemoveValueHandler=function(){var a=this;return function(){var b;for(b=0;b<a.values.length;b+=1)if(a.values[b]===this){a.values.splice(b,1);break}}};DecisionTableVariable.prototype.onChangeValueHandler=function(){var a=this;return function(b,c){"function"===typeof a.onChangeValue&&a.onChangeValue.call(a,this,b,c)}};
DecisionTableVariable.prototype.addValue=function(a,b){a="conclusion"===this.mode?new DecisionTableSingleValue({value:a,parent:this,fields:this.fields,language:this.language}):new DecisionTableValueEvaluation({value:a,operator:b,parent:this,fields:this.fields,language:this.language});a.onRemove=this.onRemoveValueHandler();a.onChange=this.onChangeValueHandler();this.values.push(a);return this};
DecisionTableVariable.prototype.getJSON=function(a){var b={};if("number"===typeof a){if(this.values[a]){b.value=this.values[a].getValue();if("conclusion"===this.mode)b.conclusion_value=this.returnType?"result":this.select.value,b.conclusion_type=this.returnType?"return":"variable";else if(b.variable_name=this.select.value,b.condition=this.values[a].operator,b.value&&!b.condition||!b.value&&!b.condition)return!1;return b}}else return!1};
DecisionTableVariable.prototype.removeValue=function(a){this.values[a]&&($(this.values[a].getHTML()).remove(),this.values.splice(a,1));return this};
DecisionTableVariable.prototype.isValid=function(){var a={valid:!0},b,c=0,d;$(this.select).parent().removeClass("error");if("conclusion"===this.mode)for(b=0;b<this.values.length;b+=1){d=this.values[b].isValid();if(!d.valid)return d;this.values[b].value.length&&(c+=1)}else for(b=0;b<this.values.length;b+=1)if(d=this.values[b].isValid(),this.values[b].operator&&(c+=1),!d.valid)return a.valid=!1,a.message=d.message,a.index=b,a;c&&this.select&&!this.select.value&&($(this.select.parentElement).addClass("error"),
a={valid:!1,message:this.language.ERROR_NO_VARIABLE_SELECTED});return a};var DecisionTableValue=function(a){Element.call(this);this.parent=this.onChange=this.onRemove=this.expression=this.value=null;this.language={};DecisionTableValue.prototype.initObject.call(this,a)};DecisionTableValue.prototype=new Element;
DecisionTableValue.prototype.initObject=function(a){var b={value:[],onRemove:null,onChange:null,parent:null,fields:[],language:{}};$.extend(!0,b,a||{});this.language=b.language;this.parentElement=b.parent;this.expression=new ExpressionFieldControl({variables:b.fields,onChange:this.onChangeExpressionHandler(),language:this.language},this);this.setValue(b.value);this.onRemove=b.onRemove;this.onChange=b.onChange};
DecisionTableValue.prototype.onChangeExpressionHandler=function(){var a=this;return function(b,c){a.value=this.getObject();"function"===typeof a.onChange&&a.onChange.call(a,b,c)}};DecisionTableValue.prototype.updateHTML=function(){};DecisionTableValue.prototype.setValue=function(a){var b;this.expression.clear();for(b=0;b<a.length;b+=1)this.expression.addItem({value:a[b].value,label:a[b].value,type:ExpressionFieldControl.prototype.expressionType[a[b].type]});this.value=a;this.updateHTML();return this};
DecisionTableValue.prototype.createHTML=function(){};DecisionTableValue.prototype.onEnterCellHandler=function(a){return function(){if("function"===typeof a){var b=a();$(this.parentElement).empty().append(b);$(b).select().focus()}}};
DecisionTableValue.prototype.onLeaveCellHandler=function(a){var b=this;return function(){var c=document.createElement("span"),d=this.parentElement,e=b[a],f=!1;c.tabIndex=0;f=e!==this.value;b[a]=this.value;b[a]?c.appendChild(document.createTextNode(b[a])):c.innerHTML="&nbsp;";try{$(d).empty().append(c)}catch(g){}b.isValid();f&&"function"===typeof b.onChange&&b.onChange.call(b,b[a],e)}};
DecisionTableValue.prototype.isValid=function(){if(this.expression.isValid())return $(this.html).removeClass("error"),{valid:!0};$(this.html).addClass("error");return{valid:!1,message:this.language.ERROR_INVALID_EXPRESSION}};DecisionTableValue.prototype.attachListeners=function(){};DecisionTableValue.prototype.remove=function(){$(this.html).remove();this.expression.remove();"function"===typeof this.onRemove&&this.onRemove.call(this)};DecisionTableValue.prototype.getValue=function(){return this.expression.getObject()};
DecisionTableValue.prototype.filledValue=function(){return!!this.value.length};var DecisionTableSingleValue=function(a){DecisionTableValue.call(this,a)};DecisionTableSingleValue.prototype=new DecisionTableValue;DecisionTableSingleValue.prototype.createValueControl=function(){var a=this;return function(){var b=document.createElement("input");b.type="text";b.value=a.value||"";return b}};
DecisionTableSingleValue.prototype.updateHTML=function(){this.html&&(this.value?$(this.html).find("span").text(this.value):$(this.html).find("span").html("&nbsp;"),$(this.html).find("input").val(this.value));return this};DecisionTableSingleValue.prototype.createHTML=function(){if(this.html)return this.html;var a;a=this.createHTMLElement("td");a.appendChild(this.expression.getHTML());return this.html=a};
var DecisionTableValueEvaluation=function(a){DecisionTableValue.call(this,a);this.operator=null;DecisionTableValueEvaluation.prototype.initObject.call(this,a)};DecisionTableValueEvaluation.prototype=new DecisionTableValue;DecisionTableValueEvaluation.prototype.OPERATORS="== >= <= > < !=".split(" ");DecisionTableValueEvaluation.prototype.initObject=function(a){this.setOperator(a.operator||"")};DecisionTableValueEvaluation.prototype.setOperator=function(a){this.operator=a;return this};
DecisionTableValueEvaluation.prototype.createHTML=function(){if(this.html)return this.html;var a,b,c;a=DecisionTableSingleValue.prototype.createHTML.call(this);b=this.createHTMLElement("td");b.className="decision-table-operator";c=this.createHTMLElement("span");c.tabIndex=0;this.operator?c.appendChild(document.createTextNode(this.operator)):c.innerHTML="&nbsp";b.appendChild(c);this.html=[b,a];this.attachListeners();return this.html};
DecisionTableValueEvaluation.prototype.fillOperators=function(a){var b,c;$(a).append("<option></option>");for(b=0;b<this.OPERATORS.length;b+=1)c=this.createHTMLElement("option"),c.label=c.value=this.OPERATORS[b],c.appendChild(document.createTextNode(this.OPERATORS[b])),c.selected=this.OPERATORS[b]===this.operator,a.appendChild(c);return a};
DecisionTableValueEvaluation.prototype.createValueControl=function(){var a=this;return function(){var b=document.createElement("input");b.type="text";b.value=a.value||"";return b}};DecisionTableValueEvaluation.prototype.createOperatorControl=function(){var a=this;return function(){var b=document.createElement("select");a.fillOperators(b);b.value=a.operator;return b}};
DecisionTableValueEvaluation.prototype.attachListeners=function(){if(!this.html||!this.html.push)return this;$(this.html[0]).on("focus","span",this.onEnterCellHandler(this.createOperatorControl())).on("blur","select",this.onLeaveCellHandler("operator"));return this};DecisionTableValueEvaluation.prototype.filledValue=function(){return!!this.operator&&DecisionTableValue.prototype.filledValue.call(this)};
DecisionTableValueEvaluation.prototype.isValid=function(){var a=DecisionTableValue.prototype.isValid.call(this);a.valid?(a={valid:!!this.value.length===!!this.operator},a.valid?$(this.html).removeClass("error"):($(this.html).addClass("error"),a.message=this.language.ERROR_MISSING_EXPRESSION_OR_OPERATOR)):$(this.html[0]).removeClass("error");return a};DecisionTableValueEvaluation.prototype.getOperator=function(){return this.operator};
var Store=function(a){this.records=[];this.proxy=this.model=null;Store.prototype.initObject.call(this,a)};Store.prototype.type="Store";Store.prototype.initObject=function(a){$.extend(!0,{},a)};Store.prototype.addRecord=function(a){this.records.push(a);return this};Store.prototype.getRecord=function(a){return this.records[a]};Store.prototype.getSize=function(){return this.records.length};
var Grid=function(a){Container.call(this,a);this.columns=[];this.store=null;Grid.prototype.initObject.call(this,a)};Grid.prototype=new Container;Grid.prototype.type="Grid";Grid.prototype.family="Panel";Grid.prototype.initObject=function(a){var b={store:null,columns:[]};$.extend(!0,b,a);this.setStore(b.store).setColumns(b.columns)};
Grid.prototype.createHTML=function(){var a,b,c;Container.prototype.createHTML.call(this);b=document.createElement("table");this.createTableHeaders(b,this.columns);for(a=0;this.store&&a<this.store.getSize();a+=1)c=this.store.getRecord(a),this.createTableRow(b,this.columns,c);this.body.html.appendChild(b)};
Grid.prototype.createTableHeaders=function(a,b){var c=document.createElement("tr"),d,e;for(e=0;e<b.length;e+=1)d=document.createElement("th"),d.innerHTML=b[e].text,c.appendChild(d);a.appendChild(c);return a};Grid.prototype.setParent=function(a){this.parent=a;return this};Grid.prototype.createTableRow=function(a,b,c){var d,e,f=document.createElement("tr");for(d=0;d<b.length;d+=1)e=document.createElement("td"),e.innerHTML=c[b[d].dataIndex]||"",f.appendChild(e);a.appendChild(f);return a};
Grid.prototype.setStore=function(a){this.store=a;return this};Grid.prototype.getStore=function(){return this.store};Grid.prototype.setColumns=function(a){this.columns=a;return this};Grid.prototype.getColumns=function(){return this.columns};
var HistoryPanel=function(a){Panel.call(this,a);this.proxy=this.url=this.proxyEnabled=null;this.loaded=!1;this.data=null;this.callback={};this.dirty=!1;this.buttons=[];this.parent=this.closeContainerOnSubmit=this.headerHeight=this.footerHeight=this.labelWidth=this.footerAlign=null;HistoryPanel.prototype.initObject.call(this,a)};HistoryPanel.prototype=new Panel;HistoryPanel.prototype.type="HistoryPanel";
HistoryPanel.prototype.initObject=function(a){var b={url:null,data:null,proxyEnabled:!0,callback:{},buttons:[],footerAlign:"center",labelWidth:"30%",footerHeight:10,headerHeight:0,closeContainerOnSubmit:!1,logType:"message"};$.extend(!0,b,a);this.setUrl(b.url).setCallback(b.callback).setLabelWidth(b.labelWidth).setFooterAlign(b.footerAlign).setLogType(b.logType)};HistoryPanel.prototype.setUrl=function(a){this.url=a;return this};
HistoryPanel.prototype.setProxyEnabled=function(a){this.proxyEnabled=a;return this};HistoryPanel.prototype.setProxy=function(a){a&&a.family&&"Proxy"===a.family?(this.proxy=a,this.url=a.url,this.proxyEnabled=!0):this.proxyEnabled&&(a?(a.url||(a.url=this.url),this.proxy=new Proxy(a)):this.url&&(this.proxy=new Proxy({url:this.url})));return this};HistoryPanel.prototype.setData=function(a){this.data=a;this.loaded&&this.applyData();return this};
HistoryPanel.prototype.setCallback=function(a){this.callback=a;return this};HistoryPanel.prototype.setFooterAlign=function(a){this.footerAlign=a;return this};HistoryPanel.prototype.setLabelWidth=function(a){this.labelWidth=a;return this};HistoryPanel.prototype.setFooterHeight=function(a){this.footerHeight=a;return this};HistoryPanel.prototype.setHeaderHeight=function(a){this.headerHeight=a;return this};HistoryPanel.prototype.setCloseContainerOnSubmit=function(a){this.closeContainerOnSubmit=a;return this};
HistoryPanel.prototype.setLogType=function(a){this.logType=a;return this};HistoryPanel.prototype.load=function(){this.loaded||(this.proxy&&(this.data=this.proxy.getData()),this.callback.loaded&&this.callback.loaded(this.data,null!==this.proxy),this.attachListeners(),this.loaded=!0)};HistoryPanel.prototype.addLog=function(a){var b;b=new LogField(a);b.setParent(this);a=b.createHTML();this.body.appendChild(a);this.items.push(b);return this};
HistoryPanel.prototype.getData=function(){var a,b={};for(a=0;a<this.items.length;a+=1)$.extend(b,this.items[a].getObjectValue());return b};HistoryPanel.prototype.setDirty=function(a){this.dirty=a;return this};HistoryPanel.prototype.isDirty=function(){return this.dirty};
HistoryPanel.prototype.validate=function(){var a,b=!0,c;for(a=0;a<this.items.length;a+=1)c=this.items[a].isValid(),b=b&&c,!c&&this.items[a].errorTooltip&&($(this.items[a].errorTooltip.html).removeClass("adam-tooltip-error-off"),$(this.items[a].errorTooltip.html).addClass("adam-tooltip-error-on"));return b};HistoryPanel.prototype.testRequired=function(){var a,b=!0;for(a=0;a<this.items.length;a+=1)b=b&&this.items[a].evalRequired();return b};
HistoryPanel.prototype.attachListeners=function(){var a;for(a=0;a<this.items.length;a+=1)this.items[a].attachListeners();$(this.body).mousedown(function(a){a.stopPropagation()})};HistoryPanel.prototype.setHeight=function(a){Panel.prototype.setHeight.call(this,a);this.setBodyHeight(this.height-this.footerHeight-this.headerHeight);return this};
HistoryPanel.prototype.createHTML=function(){var a,b;Panel.prototype.createHTML.call(this);this.footer.style.textAlign=this.footerAlign;for(a=0;a<this.items.length;a+=1)this.items[a].setParent(this),b=this.items[a].getHTML(),this.body.appendChild(b);this.body.style.bottom="8px";return this.html};HistoryPanel.prototype.setParent=function(a){this.parent=a;return this};
HistoryPanel.prototype.getLogField=function(a){var b=null,c;for(c=0;c<this.items.length;c+=1)if(this.items[c].id===a){b=this.items[c];break}return b};var LogField=function(a,b){Field.call(this,a,b);this.submit=!1;this.items=[];this.deleteBtn=!1;this.deleteControl=null;LogField.prototype.initObject.call(this,a)};LogField.prototype=new Field;LogField.prototype.type="LogField";
LogField.prototype.initObject=function(a){var b={marginLeft:10,timeTextSize:11,picture:"/img/default_user.png",user:"",message:"default message",items:[],startDate:"3 July 2013",duration:null,completed:!1,deleteBtn:!1};$.extend(!0,b,a);this.setMarginLeft(b.marginLeft).setPicture(b.picture).setUser(b.user).setTimeTextSize(b.timeTextSize).setStartDate(b.startDate).setMessage(b.message).setDuration(b.duration).setItems(b.items).setCompleted(b.completed).setDeleteBtn(b.deleteBtn)};
LogField.prototype.setMarginLeft=function(a){this.marginLeft=a;return this};LogField.prototype.setPicture=function(a){this.picture=a;return this};LogField.prototype.setUser=function(a){this.user=a;return this};LogField.prototype.setTimeTextSize=function(a){this.timeTextSize=a;return this};LogField.prototype.setStartDate=function(a){this.startDate=a;return this};LogField.prototype.setMessage=function(a){this.message=a;return this};LogField.prototype.setDuration=function(a){this.duration=a;return this};
LogField.prototype.setItems=function(a){this.items=a;return this};LogField.prototype.setCompleted=function(a){this.completed=a;return this};LogField.prototype.setDeleteBtn=function(a){this.deleteBtn=a;return this};
LogField.prototype.createHTML=function(){var a,b;Field.prototype.createHTML.call(this);this.html.style.fontSize="12px";this.html.style.display="table";this.html.style.width="98%";b=this.createHTMLElement("div");b.style.width="70 %";b.style.display="table-cell";a=this.createHTMLElement("img");a.style.width="32px";a.style.height="32px";a.style.cssFloat="left";a.style.marginRight="10px";a.src=this.picture;b.appendChild(a);a=this.createHTMLElement("p");a.innerHTML="<strong>"+this.user+"</strong> "+this.label;
a.style.marginLeft=this.marginLeft+"px";a.style.display="block";b.appendChild(a);a=this.createHTMLElement("time");a.style.color="#707070";a.style.fontSize=this.timeTextSize+"px";a.textContent=this.startDate;b.appendChild(a);this.html.appendChild(b);this.duration&&(b=this.createHTMLElement("div"),b.style.width="10%",b.style.paddingLeft="15px",b.style.display="table-cell",b.style.color="#707070",b.style.fontSize=this.timeTextSize+"px",b.innerHTML="<p> "+this.duration+"</p>",this.durationSection=b,this.html.appendChild(b));
b=this.createHTMLElement("div");b.style.width="2%";b.style.paddingLeft="5px";b.style.display="table-cell";b.style.fontSize=this.timeTextSize+"px";this.completed&&(b.className="adam-completed-log");this.html.appendChild(b);return this.html};
LogField.prototype.attachListeners=function(){var a,b,c,d,e;e=this;$(this.html).click(function(f){a=$(f.currentTarget).attr("id");e.parent.getLogField(a).parent.itemShowed&&e.parent.getLogField(a).parent.itemShowed===a?($("#logPanel").slideToggle(),e.parent.getLogField(a).parent.itemShowed=null):($("#logPanel").remove(),0<e.parent.getLogField(a).items.length?(b=e.createHTMLElement("div"),b.id="logPanel",b.style.display="none",b.style.overflow="auto",b.style.padding="10px",b.style.border="1px solid silver",
b.style.backgroundColor="#FAFAFA",$("#"+a).after(b),"difList"===e.parent.logType?(c=e.parent.getLogField(a).createDifList("before"),$(b).append(c),d=e.createHTMLElement("div"),d.style.width="5%",d.style.cssFloat="left",d.innerHTML="&nbsp;",$(b).append(d),c=e.parent.getLogField(a).createDifList("after"),$(b).append(c),e.parent.getLogField(a).parent.itemShowed=a):b.innerHTML='<h2 style="text-align: center; font-family: Verdana;">"'+e.message+'"<h2>',$("#logPanel").slideToggle()):e.parent.getLogField(a).parent.itemShowed=
null)})};LogField.prototype.createDifList=function(a){var b,c,d="",e,f;b=this.createHTMLElement("div");b.style.width="45%";b.style.position="relative";b.style.cssFloat="left";b.style.backgroundColor="before"===a?"#fdd":"#cfc";for(e=0;e<this.items.length;e+=1)f=this.items[e],c=this.createHTMLElement("p"),d="before"===a?"-":"+",d+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",d+=f.field+": ",d+="before"===a?f.before:f.after,c.innerHTML=d,$(b).append(c);return b};
LogField.prototype.setParent=function(a){this.parent=a;return this};var MessagePanel=function(a){Container.call(this,a);this.windowHeader=this.closeButtonObject=this.modalContainer=this.modalObject=this.modal=null;this.loaded=!1;this.footer=this.message=this.destroyOnHide=null;this.buttons=[];this.headerHeight=this.footerHeight=null;this.positionFixed=!1;MessagePanel.prototype.initObject.call(this,a)};MessagePanel.prototype=new Container;MessagePanel.prototype.type="MessagePanel";
MessagePanel.prototype.classPictureMap={Information:"adam-message-panel-picture-information",Error:"adam-message-panel-picture-error",Warning:"adam-message-panel-picture-warning",Confirm:"adam-message-panel-picture-question"};
MessagePanel.prototype.initObject=function(a){var b={title:"",modal:!0,closeButton:!0,modalHandler:null,destroyOnHide:!1,wtype:"Warning",message:"",footerHeight:40,headerHeight:0,buttons:[],height:100,width:400};$.extend(!0,b,a);this.setTitle(b.title).setModal(b.modal).setVisible(!1).setCloseButton(b.closeButton).setDestroyOnHide(b.destroyOnHide).setMessageType(b.wtype).setMessage(b.message).setFooterHeight(b.footerHeight).setHeaderHeight(b.headerHeight).setButtons(b.buttons).setHeight(b.height).setWidth(b.width);this.modalContainer=
$("body")};MessagePanel.prototype.setTitle=function(a){this.title=a;this.titleLabelObject&&(this.titleLabelObject.innerHTML=a);return this};
MessagePanel.prototype.createHTML=function(){var a,b,c;Container.prototype.createHTML.call(this);parseInt(this.height/2,10);parseInt(this.width/2,10);this.style.addClasses(["adam-message-panel"]);this.style.addProperties({"z-index":1034,left:"50%",top:"50%"});this.height-=16;this.html.style.height=this.height+"px";this.html.tabIndex="-1";c=this.createHTMLElement("div");c.className="adam-message-panel-header";b=this.createHTMLElement("label");b.className="adam-message-panel-title";b.innerHTML=this.title||
"&nbsp;";b.title=b.innerHTML;this.closeButton?(a=this.createHTMLElement("span"),a.className="adam-message-panel-close",c.appendChild(a),this.html.insertBefore(c,this.body),this.closeButtonObject=a):this.html.insertBefore(c,this.body);c.appendChild(b);this.windowHeader=c;this.body&&(this.body.className="adam-message-panel-body",this.body.style.textAlign="center",this.body.style.paddingTop="10px",this.body.style.paddingBottom="10px",a=this.createHTMLElement("div"),a.className=this.classPictureMap[this.wtype],
this.body.appendChild(a),a=this.createHTMLElement("div"),a.className="adam-message-panel-text",a.innerHTML=this.getMessage()||"&nbsp;",this.body.appendChild(a));this.generateButtons(this.wtype);this.footer?this.html.appendChild(this.footer):(a=this.createHTMLElement("div"),a.className="adam-message-panel-footer",this.html.appendChild(a),this.footer=a);for(a=0;a<this.buttons.length;a+=1)this.footer.appendChild(this.buttons[a].getHTML());this.body.style.bottom=this.footerHeight+8+"px";this.footer.style.height=
this.footerHeight+"px";this.footer.style.textAlign="right";this.footer.style.bottom="0px";return this.html};MessagePanel.prototype.show=function(a){this.loaded||this.load(a);this.modal&&(this.modalObject.show(),this.modalObject.html&&(this.modalObject.html.style.zIndex="1034"));this.setHeight($(this.body).innerHeight());document.body.appendChild(this.html);this.setVisible(!0);this.fixPositions()};
MessagePanel.prototype.setModal=function(a){this.modalObject=a?new Modal({clickHandler:this.modalHandler}):null;this.modal=a;return this};MessagePanel.prototype.load=function(a){this.html||(this.createHTML(),this.attachListeners(),this.loaded=!0)};MessagePanel.prototype.setDestroyOnHide=function(a){this.destroyOnHide=a;return this};MessagePanel.prototype.setCloseButton=function(a){this.closeButton=a;return this};
MessagePanel.prototype.attachListeners=function(){var a=this,b,c,d=this;$(this.html).draggable({cursor:"move",scroll:!1,containment:"document"}).on("keydown keyup keypress",function(a){a.stopPropagation()});this.closeButton&&this.closeButtonObject&&$(this.closeButtonObject).click(function(b){b.stopPropagation();a.hide()});for(b=0;b<this.buttons.length;b+=1)this.buttons[b].attachListeners();$("input").blur();$("a").blur();$(this.html).attr("tabindex",-1).focus();setTimeout(function(){$(document).on("focusin",
c)},0);c=function(a){$(a.target).parents().andSelf().is("#"+d.id)||$(d.html).focus()}};MessagePanel.prototype.setMessage=function(a){this.message=a;return this};MessagePanel.prototype.getMessage=function(a){return this.message};MessagePanel.prototype.setMessageType=function(a){this.wtype=a;return this};MessagePanel.prototype.getMessageType=function(a){return this.wtype};
MessagePanel.prototype.hide=function(a){this.modal&&this.modalObject.hide();document.body.removeChild(this.html);this.setVisible(!1);(a||this.destroyOnHide)&&this.close()};MessagePanel.prototype.generateButtons=function(a){var b=this;if(0===this.buttons.length)switch(a){case "Information":case "Error":case "Warning":case "Confirm":this.addButton({jtype:"normal",caption:"OK",handler:function(){b.close()}})}return this};
MessagePanel.prototype.setButtons=function(a){var b;for(b=0;b<a.length;b+=1)this.addButton(a[b],this);return this};MessagePanel.prototype.addButton=function(a){a&&a.family&&"Button"===a.family?a.setParent(this):a=new Button(a,this);a&&this.buttons.push(a)};MessagePanel.prototype.setHeight=function(a){this.setBodyHeight(this.height-this.footerHeight-this.headerHeight);return this};MessagePanel.prototype.setFooterHeight=function(a){this.footerHeight=a;return this};
MessagePanel.prototype.setHeaderHeight=function(a){this.headerHeight=a;return this};MessagePanel.prototype.close=function(){this.visible&&this.hide();this.dispose&&this.dispose()};MessagePanel.prototype.fixPositions=function(){if(!this.positionFixed){var a=$(this.html).width(),b=$(this.html).height(),c=$(this.html).offset(),b=c.top-b/2,a=c.left-a/2;this.html.style.top=b+"px";this.html.style.left=a+"px";this.positionFixed=!0}return this};
var UpdaterField=function(a,b){Field.call(this,a,b);this.fields=[];this.options=[];this.visualObject=this.fieldHeight=null;this.language={};this.panelList=[];UpdaterField.prototype.initObject.call(this,a)};UpdaterField.prototype=new Field;UpdaterField.prototype.type="UpdaterField";
UpdaterField.prototype.initObject=function(a){var b={fields:[],fieldHeight:null,language:{LBL_ERROR_ON_FIELDS:"Please, correct the fields with errors"},hasCheckbox:!1};$.extend(!0,b,a);this.language=b.language;this.setFields(b.fields);this.hasCheckbox=b.hasCheckbox};UpdaterField.prototype.setFields=function(a){var b,c=[];for(b=0;b<a.length;b+=1)"FieldUpdater"===a[b].type?(a[b].setParent(this),c.push(a[b])):c.push(void 0);this.fields=c;return this};
UpdaterField.prototype.getObjectValue=function(){var a,b=[];for(a=0;a<this.options.length;a+=1)this.options[a].disabled||b.push(this.options[a].getJSONObject());this.value=JSON.stringify(b);return Field.prototype.getObjectValue.call(this)};
UpdaterField.prototype.setOptions=function(a){var b,c=[],d,e=[];d={};this.list=a;for(b=0;b<a.length;b+=1){switch(a[b].type){case "TextField":d=new OptionTextField(a[b],this);break;case "TextArea":d=new OptionTextArea(a[b],this);break;case "Date":case "Datetime":d=new OptionDateField(a[b],this);break;case "DropDown":e=[];a[b].optionItem instanceof Array?"assigned_user_id"===a[b].value&&(e=[{text:translate("LBL_PMSE_FORM_OPTION_CURRENT_USER"),value:"currentuser"},{text:translate("LBL_PMSE_FORM_OPTION_RECORD_OWNER"),
value:"owner"},{text:translate("LBL_PMSE_FORM_OPTION_SUPERVISOR"),value:"supervisor"}],d=e.concat(a[b].optionItem),a[b].optionItem=d):(a[b].optionItem&&$.each(a[b].optionItem,function(a,b){e.push({value:a,text:b})}),a[b].optionItem=e);d=new OptionSelectField(a[b],this);break;case "Checkbox":d=new OptionCheckBoxField(a[b],this);break;case "Integer":case "Currency":case "Decimal":case "Float":d=new OptionNumberCriteriaField(a[b],this);break;default:d=new OptionTextField(a[b],this)}c.push(d)}this.options=
c;this.setOptionsHTML();return this};UpdaterField.prototype.setOptionsHTML=function(){var a,b;if(this.html)for(this.visualObject.innerHTML="",a=0;a<this.options.length;a+=1)b=this.options[a].getHTML(),0===a%2&&(b.className+=" updater-inverse"),this.visualObject.appendChild(b);return this};
UpdaterField.prototype.createHTML=function(){var a,b="",c;Field.prototype.createHTML.call(this);this.required&&(b="<i>*</i> ");a=this.createHTMLElement("span");a.className="adam-form-label";a.innerHTML=this.label+": "+b;a.style.width=this.parent.labelWidth;a.style.verticalAlign="top";this.html.appendChild(a);a=this.createHTMLElement("div");a.className="adam-item-updater table";a.id=this.id;if(this.fieldWidth||this.fieldHeight)b=document.createAttribute("style"),this.fieldWidth&&(b.value+="width: "+
this.fieldWidth+"px; "),this.fieldHeight&&(b.value+="height: "+this.fieldHeight+"px; "),b.value+="display: inline-block; margin: 0; overflow: auto; padding: 3px;",a.setAttributeNode(b);for(c=0;c<this.options.length;c+=1)b=this.options[c].getHTML(),0===c%2&&(b.className+=" updater-inverse"),a.appendChild(b);this.html.appendChild(a);this.errorTooltip&&this.html.appendChild(this.errorTooltip.getHTML());this.helpTooltip&&this.html.appendChild(this.helpTooltip.getHTML());this.visualObject=a;return this.html};
UpdaterField.prototype.setValue=function(a){this.value=a;if(this.options&&0<this.options.length)try{var b,c,d;if((b=JSON.parse(a))&&0<b.length)for(c=0;c<b.length;c+=1)for(d=0;d<this.options.length;d+=1)if(b[c].field===this.options[d].field){this.options[d].disabled=!1;this.hasCheckbox&&(this.options[d].checkboxControl.checked=!0);this.options[d].control.disabled=!1;this.options[d].value=b[c].value;"OptionCheckBoxField"===this.options[d].type&&(this.options[d].control.checked=b[c].value);if("OptionDateField"===
this.options[d].type||"OptionNumberCriteriaField"===this.options[d].type)this.options[d].addCriteriaItems(b[c].value),this.options[d].timerCriteria.enable(),this.options[d].disabled=!1;this.options[d].control.value=b[c].value;break}}catch(e){}return this};
UpdaterField.prototype.isValid=function(){var a,b=!0,c;for(a=0;a<this.options.length;a+=1){c=this.options[a];if(c.required)switch(c.type){case "OptionCheckBoxField":c.control.checked||(b=!1);break;case "OptionDateField":0===c.timerCriteria.getObject().length&&(b=!1);break;default:""===c.control.value&&(b=!1)}"OptionDateField"!==c.type||c.timerCriteria.isValid()||(b=!1);c.parent.hasCheckbox&&(c.checkboxControl.checked||(b=!0));if(!b)break}b?($(this.errorTooltip.html).removeClass("adam-tooltip-error-on"),
$(this.errorTooltip.html).addClass("adam-tooltip-error-off"),b=b&&Field.prototype.isValid.call(this)):(this.visualObject.scrollTop+=getRelativePosition(c.getHTML(),this.visualObject).top,this.errorTooltip.setMessage(this.language.LBL_ERROR_ON_FIELDS),$(this.errorTooltip.html).removeClass("adam-tooltip-error-off"),$(this.errorTooltip.html).addClass("adam-tooltip-error-on"));return b};
UpdaterField.prototype.getAddVariableHandler=function(a){var b=this;return function(c){var d,e,f;c="{::"+a+"::"+c+"::}";var g,h;d=b.currentField;"input"===this.parent.belongsTo.tagName.toLowerCase()?(d=$(d.control).get(0),e=d.value,f=d.selectionStart):"textarea"===this.parent.belongsTo.tagName.toLowerCase()?(d=$(d.control).get(0),e=d.value,f=d.selectionStart):"div"===this.parent.belongsTo.tagName.toLowerCase()?(d=$("#plain_email_body").get(0),e=d.value,f=d.selectionStart):(d=$(this.parent.belongsTo).data("textNode"),
e=d.nodeValue,f=editorWindow.getSelection().anchorOffset);f?("{"===e.charAt(f-1)?(g=e.substr(f-1),h=replaceExpression(g,c),g=h===g?g.replace(/\{/,c):h):1<f&&":"===e.charAt(f-1)&&"{"===e.charAt(f-2)?(g=e.substr(f-2),h=replaceExpression(g,c),g=h===g?g.replace(/\{\:/,c):h,f-=1):2<f&&":"===e.charAt(f-1)&&":"===e.charAt(f-2)&&"{"===e.charAt(f-3)&&(g=e.substr(f-3),h=replaceExpression(g,c),g=h===g?g.replace(/\{\:\:/,c):h,f-=2),c=h?e.substr(0,f-1)+g:e.substr(0,f)+c+e.substr(f)):c+=e;"input"===this.parent.belongsTo.tagName.toLowerCase()||
"div"===this.parent.belongsTo.tagName.toLowerCase()||"textarea"===this.parent.belongsTo.tagName.toLowerCase()?d.value=c:d.nodeValue=c;b.multiplePanel.close()}};
UpdaterField.prototype.showPanelOnField=function(a){var b=this;this.currentField=a;this.multiplePanel?this.multiplePanel.close():(this.multiplePanel=new MultipleItemPanel({belongsTo:document.getElementById("email_subject"),matchParentWidth:!1,width:18}),"date"!==a.fieldType&&"datetime"!==a.fieldType&&(this.multiplePanel.addSubpanel({title:translate("LBL_PMSE_ADAM_UI_TITLE_MODULE_FIELDS",translate("LBL_PMSE_LABEL_TARGETMODULE")),collapsable:!0,items:this.panelList,onItemSelect:this.getAddVariableHandler(PROJECT_MODULE)},
"list"),document.body.appendChild(this.multiplePanel.getHTML())));a=$(a.control).get(0);this.multiplePanel.setBelongsTo(a);this.multiplePanel.open();this.multiplePanel.subpanels[0]&&this.multiplePanel.subpanels[0].open();this.multiplePanel.getHTML().style.zIndex="1034";$(".adam-window-close").on("click",function(a){b.multiplePanel&&b.multiplePanel.close()});$(".adam-panel-body").scroll(function(){b.multiplePanel&&b.multiplePanel.close()})};
UpdaterField.prototype.setPanelList=function(a){this.panelList=a;return this};var OptionField=function(a,b){Element.call(this,a);this.field=this.configBtn=this.required=this.maxLength=this.value=this.parent=null;OptionField.prototype.initObject.call(this,a,b)};OptionField.prototype=new Element;OptionField.prototype.type="OptionField";
OptionField.prototype.initObject=function(a,b){var c;c={disabled:!1,value:"",name:null,fieldType:null,maxLength:0,required:!1,configBtn:null,type:null,field:null};$.extend(!0,c,a);this.disabled=c.disabled;b&&b.hasCheckbox&&(this.disabled=!0);this.setParent(b).setRequired(c.required).setMaxLength(c.maxLength).setActive(c.active).setfield(c.value).setName(c.text).createControl().createConfigBtn(c.configBtn);this.fieldType=c.type};OptionField.prototype.setParent=function(a){this.parent=a;return this};
OptionField.prototype.setRequired=function(a){this.required=!!a;this.html&&$(this.html).find(".required.noshadow").show();return this};OptionField.prototype.setMaxLength=function(a){a=parseInt(a,10);isNaN(a)||(this.maxLength=a,this.control&&(0<a?this.control.maxLength=a:this.control.removeAttribute("maxlength")));return this};OptionField.prototype.setActive=function(a){this.active=a;return this};OptionField.prototype.setName=function(a){this.name=a;return this};
OptionField.prototype.setfield=function(a){this.field=a;return this};OptionField.prototype.createControl=function(){return this};OptionField.prototype.createConfigBtn=function(){return this};OptionField.prototype.updateHTML=function(){this.control&&$(this.control).val(this.value||"");return this};
OptionField.prototype.getJSONObject=function(){return"OptionDateField"===this.type||"OptionNumberCriteriaField"===this.type?{field:this.field,name:this.name,value:this.timerCriteria.getObject(),type:this.fieldType}:"OptionCheckBoxField"===this.type?{field:this.field,name:this.name,value:this.control.checked,type:this.fieldType}:{field:this.field,name:this.name,value:this.control.value,type:this.fieldType}};
OptionField.prototype.createHTML=function(){var a,b;Element.prototype.createHTML.call(this);this.style.removeProperties("width height position top left z-index".split(" "));this.style.width="100%";this.style.addClasses(["row"]);a=this.createHTMLElement("div");a.className="cell";a.style.width="20%";this.parent.hasCheckbox&&(b=document.createElement("input"),b.id="chk_"+this.id,b.type="checkbox",b.className="adam-updater-checkbox",a.appendChild(b),this.checkboxControl=b);b=document.createElement("span");
b.innerHTML=this.name;b.className="adam-updater-label";a.appendChild(b);b=b.cloneNode(!1);b.className="required noshadow";b.textContent=" *";b.style.display=this.required?"inline":"none";a.appendChild(b);this.html.appendChild(a);a=this.createHTMLElement("div");a.className="cell";a.style.width="70%";a.appendChild(this.control);this.configBtn&&a.appendChild(this.configBtn);this.html.appendChild(a);a=this.createHTMLElement("div");a.className="cell";a.style.width="5%";this.errorTooltip&&a.appendChild(this.errorTooltip.getHTML());
this.html.appendChild(a);a=this.createHTMLElement("div");a.className="clear";this.html.appendChild(a);this.attachListeners();return this.html};
OptionField.prototype.attachListeners=function(){var a=this;$(this.checkboxControl).click(function(b){a.checkboxControl.checked?(a.timerCriteria?a.timerCriteria.enable():a.control.disabled=!1,a.disabled=!1):(a.timerCriteria?a.timerCriteria.disable():(a.control.disabled=!0,$(a.control).removeClass("required")),a.disabled=!0)});$(this.control).on("change",function(b){a.parent.isValid()});return this};
var OptionTextField=function(a,b){OptionField.call(this,a,b);OptionTextField.prototype.initObject.call(this,a)};OptionTextField.prototype=new OptionField;OptionTextField.prototype.type="OptionTextField";OptionTextField.prototype.initObject=function(a){$.extend(!0,{configBtn:null},a)};
OptionTextField.prototype.createControl=function(){var a=this;this.control=document.createElement("input");this.control.type="text";this.control.style.marginLeft="7px";this.control.disabled=this.disabled;$(this.control).on("blur",function(){a.parent.multiplePanel&&a.parent.multiplePanel.close()});return this};
OptionTextField.prototype.createConfigBtn=function(){var a,b,c=this;a=document.createElement("a");a.id="conf_"+this.id;b=document.createElement("span");b.className="adam-item-icon adam-menu-icon-configure";b.style.top="0px";b.style.position="relative";b.style.display="inline-block";a.appendChild(b);this.configBtn=a;$(this.configBtn).on("click",function(a){a.stopPropagation();a.preventDefault();c.disabled||(c.parent.showPanelOnField(c),c.control.focus())});return this};
var OptionTextArea=function(a,b){OptionField.call(this,a,b);OptionTextArea.prototype.initObject.call(this,a)};OptionTextArea.prototype=new OptionField;OptionTextArea.prototype.type="OptionTextArea";OptionTextArea.prototype.initObject=function(a){$.extend(!0,{configBtn:null},a)};
OptionTextArea.prototype.createControl=function(){var a=this;this.control=document.createElement("textarea");this.control.type="text";this.control.style.marginLeft="7px";this.control.cols="35";this.control.disabled=this.disabled;$(this.control).on("blur",function(){a.parent.multiplePanel&&a.parent.multiplePanel.close()});return this};
OptionTextArea.prototype.createConfigBtn=function(){var a,b,c=this;a=document.createElement("a");a.id="conf_"+this.id;b=document.createElement("span");b.className="adam-item-icon adam-menu-icon-configure";b.style.top="0px";b.style.position="relative";b.style.display="inline-block";a.appendChild(b);this.configBtn=a;$(this.configBtn).on("click",function(a){a.stopPropagation();a.preventDefault();c.disabled||(c.parent.showPanelOnField(c),c.control.focus())});return this};
var OptionNumberField=function(a,b){OptionField.call(this,a,b);OptionNumberField.prototype.initObject.call(this,a);this.configBtn=null};OptionNumberField.prototype=new OptionField;OptionNumberField.prototype.type="OptionNumberField";OptionNumberField.prototype.initObject=function(a){$.extend(!0,{configBtn:null},a)};
OptionNumberField.prototype.createControl=function(){var a=this;this.control=document.createElement("input");this.control.type="text";this.control.style.marginLeft="7px";this.control.disabled=this.disabled;$(this.control).on("blur",function(){a.parent.multiplePanel&&a.parent.multiplePanel.close()});$(this.control).on("keydown",function(a){a.stopPropagation();46===a.keyCode||8===a.keyCode||9===a.keyCode||27===a.keyCode||13===a.keyCode||65===a.keyCode&&!0===a.ctrlKey||35<=a.keyCode&&39>=a.keyCode||
(a.shiftKey||(48>a.keyCode||57<a.keyCode)&&(96>a.keyCode||105<a.keyCode))&&a.preventDefault()}).on("keyup",function(a){a.stopPropagation()});return this};
OptionNumberField.prototype.createConfigBtn=function(){var a,b,c=this;a=document.createElement("a");a.id="conf_"+this.id;b=document.createElement("span");b.className="adam-item-icon adam-menu-icon-configure";b.style.top="0px";b.style.position="relative";b.style.display="inline-block";a.appendChild(b);this.configBtn=a;$(this.configBtn).on("click",function(a){a.stopPropagation();a.preventDefault();c.disabled||(c.parent.showPanelOnField(c),c.control.focus())});return this};
var OptionCheckBoxField=function(a,b){OptionField.call(this,a,b)};OptionCheckBoxField.prototype=new OptionField;OptionCheckBoxField.prototype.type="OptionCheckBoxField";OptionCheckBoxField.prototype.createControl=function(){this.control=document.createElement("input");this.control.type="checkbox";this.control.style.marginLeft="7px";this.control.disabled=this.disabled;return this};
var OptionSelectField=function(a,b){OptionField.call(this,a,b);this.dataSource=this.options=this.preserveDefaultOptions=this.selectedIndex=this.defaultSelection=null;OptionSelectField.prototype.initObject.call(this,a)};OptionSelectField.prototype=new OptionField;OptionSelectField.prototype.initObject=function(a){var b={dataSource:null,optionItem:{},defaultSelection:null,preserveDefaultOptions:!1};$.extend(!0,b,a);this.options=b.optionItem;this.setDefaultSelection(b.defaultSelection).fill(this.options).setDataSource(b.dataSource).setPreserveDefaultOptions(b.preserveDefaultOptions)};
OptionSelectField.prototype.setPreserveDefaultOptions=function(a){this.preserveDefaultOptions=a;return this};OptionSelectField.prototype.setDefaultSelection=function(a){this.defaultSelection=a;return this};OptionSelectField.prototype.getSelectedText=function(){var a=$(this.control).find("option:selected");return a.get(0)?a.text():null};
OptionSelectField.prototype.setDataSource=function(a){"object"===typeof a&&(this.dataSource=$.extend(!0,{labelField:"text",valueField:"value",itemsField:"result"},a));return this};OptionSelectField.prototype.clear=function(){$(this.control).empty();this.value="";return this};
OptionSelectField.prototype.fill=function(a,b,c){var d,e,f=this.defaultSelection;$(this.control).empty();if(a){for(b=0;b<a.length;b+=1)d=a[b].value,e=a[b].text,c=document.createElement("option"),c.label=e,c.value=d,c.selected=!1,c.appendChild(document.createTextNode(e||d)),this.control.appendChild(c);"[first]"===f?$(this.control).find("option:first").attr("selected",!0):"[none]"===f||null===f?this.control.selectedIndex=-1:$(this.control).find('option[value="'+f+'"]').attr("selected",!0);this.value=
$(this.control).val();this.selectedIndex=this.control.selectedIndex}return this};
OptionSelectField.prototype.bind=function(a){var b,c,d=[];if(this.dataSource&&(this.control||this.createControl(),this.dataSource.source&&(a&&(this.dataSource.source.uid=a),a=this.dataSource.source.getData(),b=$(this.control),b.empty(),a=a||[],(a=(b=this.dataSource.itemsField)?a[b]:a)&&a.push))){if(this.preserveDefaultOptions){for(c=0;c<this.options.length;c+=1)b={},b[this.dataSource.labelField]=this.options[c].label,b[this.dataSource.valueField]=this.options[c].value,d.push(b);a=$.merge(d,a)}this.fill(a,
this.dataSource.labelField,this.dataSource.valueField)}return this};OptionSelectField.prototype.createControl=function(){this.control=document.createElement("select");this.control.style.marginLeft="7px";this.control.style.marginBottom="0px";this.control.disabled=this.disabled;return this};OptionSelectField.prototype.getHTML=function(){this.bind();return UpdaterField.prototype.getHTML.call(this)};OptionSelectField.prototype.onAppend=function(){this.control.selectedIndex=this.selectedIndex};
var OptionDateField=function(a,b){OptionField.call(this,a,b);OptionDateField.prototype.initObject.call(this,a)};OptionDateField.prototype=new OptionField;OptionDateField.prototype.type="OptionDateField";OptionDateField.prototype.initObject=function(a){$.extend(!0,{configBtn:null},a)};
OptionDateField.prototype.createControl=function(){var a,b=new CriteriaField({name:"evn_criteria",label:translate("LBL_PMSE_LABEL_CRITERIA"),required:!1,fieldWidth:270,fieldHeight:40,restClient:this.parent.proxy.restClient,timerCriteria:!0,panels:{businessRulesEvaluation:{enabled:!1},formResponseEvaluation:{enabled:!1},logic:{enabled:!1},group:{enabled:!1},userEvaluation:{enabled:!1},fieldEvaluation:{enabled:!1}},decimalSeparator:PMSE_DECIMAL_SEPARATOR},this.parent.parent);b.setBaseModule(PROJECT_MODULE);
this.timerCriteria=b;a=b.getHTML();a.removeChild(a.firstChild);this.control=a;this.parent.hasCheckbox&&b.disable();b.attachListeners();return this};OptionDateField.prototype.addCriteriaItems=function(a){var b;for(b=0;b<a.length;b+=1)this.timerCriteria.addItem(a[b]);return this};var OptionNumberCriteriaField=function(a,b){OptionField.call(this,a,b);OptionNumberCriteriaField.prototype.initObject.call(this,a)};OptionNumberCriteriaField.prototype=new OptionField;
OptionNumberCriteriaField.prototype.type="OptionNumberCriteriaField";OptionNumberCriteriaField.prototype.initObject=function(a){$.extend(!0,{configBtn:null},a)};
OptionNumberCriteriaField.prototype.createControl=function(){var a,b=new CriteriaField({name:"evn_criteria",label:translate("LBL_PMSE_LABEL_CRITERIA"),required:!1,fieldWidth:270,fieldHeight:40,restClient:this.parent.proxy.restClient,panels:{businessRulesEvaluation:{enabled:!1},formResponseEvaluation:{enabled:!1},logic:{enabled:!1},math:{enabled:!1},group:{enabled:!1},userEvaluation:{enabled:!1},fieldEvaluation:{enabled:!1},fixedDateEvaluation:{enabled:!1},sugarDateEvaluation:{enabled:!1},unitTimeEvaluation:{enabled:!1},
arithmetic:{enabled:!0},variables:{enabled:!0},numbers:{enabled:!0}},decimalSeparator:PMSE_DECIMAL_SEPARATOR},this.parent.parent);b.setBaseModule(PROJECT_MODULE);this.timerCriteria=b;a=b.getHTML();a.removeChild(a.firstChild);this.control=a;this.parent.hasCheckbox&&b.disable();b.attachListeners();return this};OptionNumberCriteriaField.prototype.addCriteriaItems=function(a){var b;for(b=0;b<a.length;b+=1)this.timerCriteria.addItem(a[b]);return this};
var NotePanel=function(a){Panel.call(this,a);this.proxy=this.url=this.proxyEnabled=null;this.loaded=!1;this.data=null;this.callback={};this.dirty=!1;this.buttons=[];this.parent=this.closeContainerOnSubmit=this.headerHeight=this.footerHeight=this.labelWidth=this.footerAlign=null;NotePanel.prototype.initObject.call(this,a)};NotePanel.prototype=new Panel;NotePanel.prototype.type="NotePanel";
NotePanel.prototype.initObject=function(a){var b={url:null,data:null,proxyEnabled:!0,callback:{},buttons:[],footerAlign:"center",labelWidth:"30%",footerHeight:10,headerHeight:0,closeContainerOnSubmit:!1,logType:"message",caseId:null,caseIndex:null};$.extend(!0,b,a);this.setUrl(b.url).setCallback(b.callback);this.caseId=b.caseId;this.caseIndex=b.caseIndex};NotePanel.prototype.setUrl=function(a){this.url=a;return this};NotePanel.prototype.setCallback=function(a){this.callback=a;return this};
NotePanel.prototype.load=function(){this.loaded||(this.proxy&&(this.data=this.proxy.getData()),this.callback.loaded&&this.callback.loaded(this.data,null!==this.proxy),this.attachListeners(),this.loaded=!0)};
NotePanel.prototype.addLog=function(a){var b,c,d,e;c=new LogField(a);c.setParent(this);c.logId=a.logId;b=c.createHTML();d=this.createHTMLElement("a");d.id="deleteNoteBtn";d.innerHTML="Delete";c.durationSection.appendChild(d);c.deleteControl=d;$(d).click(function(a){a.preventDefault();a.stopPropagation();console.log("remove button");console.log(c);App.alert.show("upload",{level:"process",title:"LBL_LOADING",autoclose:!1});e=new SugarProxy({url:"pmse_Inbox/delete_notes/"+c.logId,callback:null});e.removeData(null,
{success:function(a){$(c.html).remove();App.alert.dismiss("upload")}})});this.body.appendChild(b);this.items.push(c);a.callback&&a.callback.success();return this};NotePanel.prototype.getData=function(){var a,b={};for(a=0;a<this.items.length;a+=1)$.extend(b,this.items[a].getObjectValue());return b};NotePanel.prototype.setDirty=function(a){this.dirty=a;return this};
NotePanel.prototype.attachListeners=function(){var a,b=this,c,d;for(a=0;a<this.items.length;a+=1)this.items[a].attachListeners();$(this.body).mousedown(function(a){a.stopPropagation()});$(this.addNoteBtn).click(function(a){a.preventDefault();a.stopPropagation();App.alert.show("upload",{level:"process",title:"LBL_LOADING",autoclose:!1});var f=App.api.buildFileURL({module:"Users",id:App.user.id,field:"picture"});b.items[0].value&&""!==b.items[0].value.trim()&&(d={not_content:b.items[0].value,cas_id:b.caseId,
cas_index:b.caseIndex,not_user_id:1},c=new SugarProxy({url:"pmse_Inbox/save_notes/",callback:null}),c.createData(d,{success:function(a){console.log(a);a={name:"log",label:b.items[0].value,user:App.user.attributes.full_name,picture:f,duration:"5 Second",startDate:Date.parse(a.date_entered).toString("MMMM d, yyyy HH:mm"),deleteBtn:!0,logId:a.id};b.addLog(a);b.items[0].setValue("");App.alert.dismiss("upload")}}))})};
NotePanel.prototype.setHeight=function(a){Panel.prototype.setHeight.call(this,a);this.setBodyHeight(this.height-this.footerHeight-this.headerHeight);return this};
NotePanel.prototype.createHTML=function(){var a,b,c,d;Panel.prototype.createHTML.call(this);this.footer.style.textAlign=this.footerAlign;for(a=0;a<this.items.length;a+=1)this.items[a].setParent(this),b=this.items[a].getHTML(),c=this.createHTMLElement("a"),c.href="#",c.className="adam-button",c.id="noteBtn",d=this.createHTMLElement("span"),d.className="adam-button-label",d.innerHTML="Add Note",c.appendChild(d),b.appendChild(c),this.addNoteBtn=c,b.removeChild(b.firstChild),this.body.appendChild(b);
this.body.style.bottom="8px";return this.html};NotePanel.prototype.setParent=function(a){this.parent=a;return this};NotePanel.prototype.getLogField=function(a){var b=null,c;for(c=0;c<this.items.length;c+=1)if(this.items[c].id===a){b=this.items[c];break}return b};var ReassignField=function(a,b){Field.call(this,a,b);this.submit=!1;this.items=[];this.comboId=null;ReassignField.prototype.initObject.call(this,a);$.extend(!0,this.defaults,a)};ReassignField.prototype=new Field;
ReassignField.prototype.type="ReassignField";
ReassignField.prototype.initObject=function(a){var b={marginLeft:50,timeTextSize:11,picture:"/img/default_user.png",user:"",message:"default message",items:[],startDate:"3 July 2013",duration:null,completed:!1,options:[],comboId:"comboboxID"};this.act_name=a.act_name;this.cas_delegate_date=a.cas_delegate_date;this.cas_due_date=a.cas_due_date;this.cas_index=a.cas_index;this.defaultValue=a.defaultValue;this.act_expected_time=a.act_expected_time;$.extend(!0,b,a);this.setMarginLeft(b.marginLeft).setPicture(b.picture).setTask(b.task).setTimeTextSize(b.timeTextSize).setStartDate(b.startDate).setMessage(b.message).setDuration(b.duration).setItems(b.items).setCompleted(b.completed).setOptions(b.options).setComboId(b.comboId)};
ReassignField.prototype.setMarginLeft=function(a){this.marginLeft=a;return this};ReassignField.prototype.setPicture=function(a){this.picture=a;return this};ReassignField.prototype.setTask=function(a){this.task=a;return this};ReassignField.prototype.setTimeTextSize=function(a){this.timeTextSize=a;return this};ReassignField.prototype.setStartDate=function(a){this.startDate=a;return this};ReassignField.prototype.setMessage=function(a){this.message=a;return this};
ReassignField.prototype.setDuration=function(a){this.duration=a;return this};ReassignField.prototype.setItems=function(a){this.items=a;return this};ReassignField.prototype.setCompleted=function(a){this.completed=a;return this};ReassignField.prototype.setOptions=function(a){this.options=a;return this};ReassignField.prototype.setComboId=function(a){this.comboId=a;return this};
ReassignField.prototype.createTableHeaders=function(){var a,b,c,d;d=this.createHTMLElement("div");d.style.fontSize="12px";d.style.display="table";d.style.width="97%";for(a=0;a<this.parent.columns.length;a+=1)b=this.createHTMLElement("div"),b.style.width="20%",b.style.display="table-cell",c=this.createHTMLElement("p"),c.innerHTML="<strong>"+this.parent.columns[a]+"</strong> ",b.appendChild(c),d.appendChild(b);this.html.appendChild(d);this.parent.hasHeaders=!0};
ReassignField.prototype.createHTML=function(){var a,b,c,d;Field.prototype.createHTML.call(this);this.parent.hasHeaders||this.createTableHeaders();d=this.createHTMLElement("div");d.style.fontSize="12px";d.style.display="table";d.style.width="97%";b=this.createHTMLElement("div");b.style.width="20%";b.style.display="table-cell";b.style.marginLeft="5px";a=this.createHTMLElement("p");a.innerHTML=this.act_name;b.appendChild(a);d.appendChild(b);b=this.createHTMLElement("div");b.style.width="20%";b.style.display=
"table-cell";b.style.marginLeft="5px";a=this.createHTMLElement("p");a.innerHTML=this.cas_delegate_date;b.appendChild(a);d.appendChild(b);b=this.createHTMLElement("div");b.style.width="20%";b.style.display="table-cell";b.style.marginLeft="5px";a=this.createHTMLElement("p");a.innerHTML=this.act_expected_time;b.appendChild(a);d.appendChild(b);b=this.createHTMLElement("div");b.style.width="20%";b.style.display="table-cell";b.style.marginLeft="5px";a=this.createHTMLElement("p");a.innerHTML=this.cas_due_date;
b.appendChild(a);d.appendChild(b);a=this.createHTMLElement("div");a.style.width="20%";a.style.display="table-cell";b.style.marginLeft="5px";a.style.fontSize=this.timeTextSize+"px";b=this.createHTMLElement("select");b.id=this.comboId;for(c=0;c<this.options.length;c+=1)b.appendChild(this.generateOption(this.options[c]));this.control=b;a.appendChild(b);d.appendChild(a);this.html.appendChild(d);return this.html};
ReassignField.prototype.generateOption=function(a){var b,c,d;b=this.createHTMLElement("option");"object"===typeof a?(c=a.value,d=a.text):c=a;b.selected=this.defaultValue===c;b.value=c;b.label=d||c;b.appendChild(document.createTextNode(d||c));return b};ReassignField.prototype.attachListeners=function(){};
ReassignField.prototype.createDifList=function(a){var b,c,d="",e,f;b=this.createHTMLElement("div");b.style.width="45%";b.style.position="relative";b.style.cssFloat="left";b.style.backgroundColor="before"===a?"#fdd":"#cfc";for(e=0;e<this.items.length;e+=1)f=this.items[e],c=this.createHTMLElement("p"),d="before"===a?"-":"+",d+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",d+=f.field+": ",d+="before"===a?f.before:f.after,c.innerHTML=d,$(b).append(c);return b};
ReassignField.prototype.setParent=function(a){this.parent=a;return this};ReassignField.prototype.getObjectValue=function(){var a={};a.cas_id=this.comboId;a.cas_user_id=this.control.value;a.cas_index=this.cas_index;a.old_cas_user_id=this.defaultValue;return a};var ReassignForm=function(a){Form.call(this,a);ReassignForm.prototype.initObject.call(this,a)};ReassignForm.prototype=new Form;ReassignForm.prototype.type="ReassignForm";
ReassignForm.prototype.initObject=function(a){var b={columns:[]};this.hasHeaders=!1;$.extend(!0,b,a);this.setColumns(b.columns)};ReassignForm.prototype.setColumns=function(a){this.columns=a};
