var jCore=function(e,ta){var pa=!1,ua=!1,s=null,D,k,O,ea,y,va,ha,P,ia,R,S,T,X,U,Y,Z,$,ja,sa,G,aa,qa,fa,I,J,ba,na,z,V,ra,ka,la,B,A,m,F,W,L,M,r,oa,ga,u,p,t,C,h,v,n,w,N,ca,Q,da,E,K,ma,H,g;D=function(){var a=[],b=0,c,d;return{id:Math.random(),get:function(b){return a[b]},insert:function(c){a[b]=c;b+=1;return this},remove:function(d){c=this.indexOf(d);if(-1===c)return!1;b-=1;a.splice(c,1);return!0},getSize:function(){return b},isEmpty:function(){return 0===b},indexOf:function(c){for(d=0;d<b;d+=1)if(c.id===
a[d].id)return d;return-1},find:function(b,c){var d,x;for(d=0;d<a.length;d+=1)if(x=a[d],x[b]===c)return x},contains:function(a){return-1!==this.indexOf(a)?!0:!1},sort:function(b){var c=!1;b&&(a.sort(b),c=!0);return c},asArray:function(){return a},getFirst:function(){return a[0]},getLast:function(){return a[b-1]},popLast:function(){var c;b-=1;c=a[b];a.splice(b,1);return c},getDimensionLimit:function(){var c=[1E5,-1,-1,1E5];for(d=0;d<b;d+=1)c[0]>a[d].y&&(c[0]=a[d].y),c[1]<a[d].x+a[d].width&&(c[1]=a[d].x+
a[d].width),c[2]<a[d].y+a[d].height&&(c[2]=a[d].y+a[d].height),c[3]>a[d].x&&(c[3]=a[d].x);return c},clear:function(){0!==b&&(a=[],b=0);return this},getCanvas:function(){return 0<this.getSize()?this.get(0).getCanvas():void 0}}};"undefined"!==typeof exports&&(module.exports=D);k=function(a,b){this.x=a;this.y=b};k.prototype.type="Point";k.prototype.getX=function(){return this.x};k.prototype.getY=function(){return this.y};k.prototype.add=function(a){return new k(this.x+a.x,this.y+a.y)};k.prototype.subtract=
function(a){return new k(this.x-a.x,this.y-a.y)};k.prototype.multiply=function(a){return new k(this.x*a,this.y*a)};k.prototype.equals=function(a){return Math.abs(this.x-a.x)<O.eps&&Math.abs(this.y-a.y)<O.eps};k.prototype.getDistance=function(a){return Math.sqrt((this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y))};k.prototype.getSquaredDistance=function(a){return(this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y)};k.prototype.getManhattanDistance=function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-
a.y)};k.prototype.clone=function(){return new k(this.x,this.y)};"undefined"!==typeof exports&&(module.exports=k);O={pi:Math.acos(-1),eps:1E-8,cross:function(a,b){return a.x*b.y-a.y*b.x},area:function(a,b,c){b=b.clone();c=c.clone();return this.cross(b.subtract(a),c.subtract(a))},onSegment:function(a,b,c){return Math.abs(this.area(b,c,a))<this.eps&&a.x>=Math.min(b.x,c.x)&&a.x<=Math.max(b.x,c.x)&&a.y>=Math.min(b.y,c.y)&&a.y<=Math.max(b.y,c.y)},perpendicularSegmentIntersection:function(a,b,c,d){var f,
l=null;if(a.x>b.x||a.y>b.y)f=a.clone(),a=b.clone(),b=f;if(c.x>d.x||c.y>d.y)f=c.clone(),c=d.clone(),d=f;a.x===b.x?c.y===d.y&&c.x<a.x&&a.x<d.x&&a.y<c.y&&c.y<b.y&&(l=new k(a.x,c.y)):a.y===b.y&&c.x===d.x&&a.x<c.x&&c.x<b.x&&c.y<a.y&&a.y<d.y&&(l=new k(c.x,a.y));return l},segmentIntersection:function(a,b,c,d,f){var l=this.area(c,d,a),q=this.area(c,d,b),x=this.area(a,b,c),e=this.area(a,b,d),g;if((0<l&&0>q||0>l&&0<q)&&(0<x&&0>e||0>x&&0<e))return!0;g=!1;f&&(0===l&&this.onSegment(a,c,d)?g=!0:0===q&&this.onSegment(b,
c,d)?g=!0:0===x&&this.onSegment(c,a,b)?g=!0:0===e&&this.onSegment(d,a,b)&&(g=!0));return g},segmentIntersectionPoint:function(a,b,c,d){return a.add(b.subtract(a).multiply(this.cross(c.subtract(a),d.subtract(a))/this.cross(b.subtract(a),d.subtract(c))))},pointInRectangle:function(a,b,c){return a.x>=b.x&&a.x<=c.x&&a.y>=b.y&&a.y<=c.y},pointInCircle:function(a,b,c){return b.getDistance(a)<=c},pointInRhombus:function(a,b,c){var d,f=b.length-1;for(d=0;d<b.length;f=d,d+=1)if(this.segmentIntersection(c,a,
b[f],b[d],!0)&&!1===this.onSegment(a,b[f],b[d]))return!1;return!0}};"undefined"!==typeof exports&&(module.exports=O);ea={pageCoordinatesToShapeCoordinates:function(a,b,c,d){c=c?c:b.pageX;b=d?d:b.pageY;d=a.getCanvas();c+=d.getLeftScroll()-a.getAbsoluteX()-d.getX();b+=d.getTopScroll()-a.getAbsoluteY()-d.getY();return new k(c,b)},getPointRelativeToPage:function(a){var b=a.getCanvas(),c=a.absoluteX+b.getX()-b.getLeftScroll()+a.zoomWidth/2;a=a.absoluteY+b.getY()-b.getTopScroll()+a.zoomHeight/2;return new k(c,
a)},generateUniqueId:function(){var a=function(a,b){"undefined"===typeof a&&(a=0);"undefined"===typeof b&&(b=999999999);return Math.floor(Math.random()*(b-a+1))+a},b=function(a,b){"undefined"===typeof a&&(a="");var c,q=function(a,b){var c="",d;a=parseInt(a,10).toString(16);if(b<a.length)return a.slice(a.length-b);if(b>a.length){c="";for(d=0;d<1+(b-a.length);d+=1)c+="0";return c+a}return a};this.php_js||(this.php_js={});this.php_js.uniqidSeed||(this.php_js.uniqidSeed=Math.floor(123456789*Math.random()));
this.php_js.uniqidSeed+=1;c=a+q(parseInt((new Date).getTime()/1E3,10),8);c+=q(this.php_js.uniqidSeed,5);b&&(c+=(10*Math.random()).toFixed(8).toString());return c},c;do c=b(a(0,999999999),!0),c=c.replace(".","0");while(32!==c.length);return c}};y=function(a){this.canvas=(this.receiver=a)?a.getCanvas():null};y.prototype.family="Command";y.prototype.execute=function(a){};y.prototype.undo=function(a){};y.prototype.redo=function(a){};va=function(a,b){function c(){}var d,f,l;d=[];f=[];l=a||20;b&&"[object Function]"===
{}.toString.call(b)&&(c=b);return{add:function(a){f=[];d.push(a);d.length>l&&d.shift();c()},addToRedo:function(a){f.push(a)},undo:function(){var a;if(0===d.length)return console.log("undo(): can't undo because there are no actions to undo"),!1;a=d.pop();a.undo();f.unshift(a);c();return!0},redo:function(){var a;if(0===f.length)return console.log("redo(): can't redo because there are no actions to redo"),!1;a=f.shift();a.redo();d.push(a);c();return!0},clearStack:function(){console.log("CommandStack.clearStack(): WARNING - clearing the stacks");
f=[];d=[]},debug:function(a){var b;console.log("Debugging command stack:");console.log("Undo stack size: "+d.length);if(a)for(b=0;b<d.length;b+=1)console.log(b+1+") "+d[b].type);console.log("Redo stack size: "+f.length);if(a)for(b=0;b<f.length;b+=1)console.log(b+1+") "+f[b].type)},getRedoSize:function(){return f.length},getUndoSize:function(){return d.length},setHandler:function(a){a&&"[object Function]"==={}.toString.call(a)&&(c=a);return this}}};ha=function(a){y.call(this,a);this.before={x:this.receiver.getOldX(),
y:this.receiver.getOldY(),width:this.receiver.getOldWidth(),height:this.receiver.getOldHeight()};this.after={x:this.receiver.getX(),y:this.receiver.getY(),width:this.receiver.getWidth(),height:this.receiver.getHeight()}};ha.prototype=new y;ha.prototype.type="CommandResize";ha.prototype.execute=function(){var a=this.receiver,b=a.getCanvas();a.setPosition(this.after.x,this.after.y).setDimension(this.after.width,this.after.height);a.fixConnectionsOnResize(a.resizing,!0);b.triggerDimensionChangeEvent(a,
this.before.width,this.before.height,this.after.width,this.after.height);this.after.x===this.before.x&&this.after.y===this.before.y||b.triggerPositionChangeEvent([a],[{x:this.before.x,y:this.before.y}],[{x:this.after.x,y:this.after.y}]);return this};ha.prototype.undo=function(){var a=this.receiver,b=a.getCanvas();a.setPosition(this.before.x,this.before.y).setDimension(this.before.width,this.before.height);a.fixConnectionsOnResize(a.resizing,!0);b.triggerDimensionChangeEvent(a,this.after.width,this.after.height,
this.before.width,this.before.height);this.after.x===this.before.x&&this.after.y===this.before.y||b.triggerPositionChangeEvent([a],[{x:this.after.x,y:this.after.y}],[{x:this.before.x,y:this.before.y}]);return this};ha.prototype.redo=function(){this.execute();return this};P=function(a){y.call(this,a)};P.prototype=new y;P.prototype.type="CommandConnect";P.prototype.buildConnection=function(){var a=this.receiver,b=a.canvas,c=a.getSrcPort(),d=a.getDestPort();c.parent.ports.insert(c);d.parent.ports.insert(d);
c.parent.html.appendChild(c.getHTML());d.parent.html.appendChild(d.getHTML());b.addConnection(a);return b.updatedElement=a};P.prototype.execute=function(){var a=this.buildConnection();a.canvas.triggerCreateEvent(a,[]);return this};P.prototype.undo=function(){this.receiver.saveAndDestroy();this.receiver.canvas.triggerRemoveEvent(this.receiver,[this.receiver]);return this};P.prototype.redo=function(){this.execute();return this};ia=function(a){y.call(this,a);this.before={x:this.receiver.getOldX(),y:this.receiver.getOldY(),
parent:this.receiver.getOldParent()};this.after={x:this.receiver.getX(),y:this.receiver.getY(),parent:this.receiver.getParent()}};ia.prototype=new y;ia.prototype.type="CommandReconnect";ia.prototype.execute=function(){var a=this.receiver,b=this.after.parent,c=this.before.parent;b.canvas.currentConnection&&(b.canvas.currentConnection.hidePortsAndHandlers(),b.canvas.currentConnection=null);b.getID()!==c.getID()?(c.removePort(a),a.canvas.regularShapes.insert(a)):b.definePortPosition(a,new k(this.after.x+
Math.round(a.getWidth()/2),this.after.y+Math.round(a.getHeight()/2)));a.connection.disconnect().connect().setSegmentMoveHandlers().checkAndCreateIntersectionsWithAll();this.receiver.canvas.triggerPortChangeEvent(a);return this};ia.prototype.undo=function(){var a=this.receiver,b=this.after.parent,c=this.before.parent;b.canvas.currentConnection&&(b.canvas.currentConnection.hidePortsAndHandlers(),b.canvas.currentConnection=null);b.getID()!==c.getID()?(b.removePort(a),c.addPort(a,this.before.x,this.before.y,
!0),a.canvas.regularShapes.insert(a)):b.definePortPosition(a,new k(this.before.x+Math.round(a.getWidth()/2),this.before.y+Math.round(a.getHeight()/2)));a.connection.disconnect().connect().setSegmentMoveHandlers().checkAndCreateIntersectionsWithAll();this.receiver.canvas.triggerPortChangeEvent(a);return this};ia.prototype.redo=function(){this.execute();return this};R=function(a,b){y.call(this,a);this.oldPoints=[];this.newPoints=[];R.prototype.initObject.call(this,b)};R.prototype=new y;R.prototype.type=
"CommandResize";R.prototype.initObject=function(a){var b={oldPoints:[],newPoints:[]},c;e.extend(!0,b,a);this.oldPoints=[];for(a=0;a<b.oldPoints.length;a+=1)c=b.oldPoints[a],this.oldPoints.push(new k(c.x,c.y));this.newPoints=[];for(a=0;a<b.newPoints.length;a+=1)c=b.newPoints[a],this.newPoints.push(new k(c.x,c.y))};R.prototype.common=function(a){var b=this.receiver;e(b.destDecorator.getHTML()).trigger("click");b.hidePortsAndHandlers();b.disconnect(!0).connect({algorithm:"user",points:this[a]});b.setSegmentMoveHandlers();
b.checkAndCreateIntersectionsWithAll();b.showPortsAndHandlers();b.canvas.triggerConnectionStateChangeEvent(b);return this};R.prototype.execute=function(){this.common("newPoints");return this};R.prototype.undo=function(){this.common("oldPoints");return this};R.prototype.redo=function(){this.execute();return this};S=function(a){y.call(this,a);this.after=this.before=null;this.relatedShapes=[];S.prototype.initObject.call(this,a)};S.prototype=new y;S.prototype.type="CommandMove";S.prototype.initObject=
function(a){var b,c=[],d=[];for(b=0;b<a.getSize();b+=1)this.relatedShapes.push(a.get(b)),c.push({x:a.get(b).getOldX(),y:a.get(b).getOldY()}),d.push({x:a.get(b).getX(),y:a.get(b).getY()});this.before={shapes:c};this.after={shapes:d};this.isDragged=!0};S.prototype.execute=function(){var a,b;for(a=0;a<this.relatedShapes.length;a+=1)b=this.relatedShapes[a],this.isDragged||b.setPosition(this.after.shapes[a].x,this.after.shapes[a].y),b.refreshChildrenPositions(!0),b.refreshConnections(!1,this.isDragged);
this.isDragged=!1;this.canvas.triggerPositionChangeEvent(this.relatedShapes,this.before.shapes,this.after.shapes)};S.prototype.undo=function(){var a,b;for(a=0;a<this.relatedShapes.length;a+=1)b=this.relatedShapes[a],b.setPosition(this.before.shapes[a].x,this.before.shapes[a].y).refreshChildrenPositions(!0),b.refreshConnections(!1,this.isDragged);this.canvas.triggerPositionChangeEvent(this.relatedShapes,this.after.shapes,this.before.shapes)};S.prototype.redo=function(){this.execute()};T=function(a){y.call(this,
a);this.after=this.before=null;T.prototype.initObject.call(this,a)};T.prototype=new y;T.prototype.type="CommandCreate";T.prototype.initObject=function(a){this.before={};this.after={x:a.getX(),y:a.getY(),parent:a.getParent()}};T.prototype.execute=function(){var a=this.receiver,b=a.parent;b.getChildren().contains(a)||b.getChildren().insert(a);this.after.parent.html.appendChild(a.getHTML());a.canvas.addToList(a);a.showOrHideResizeHandlers(!1);a.canvas.triggerCreateEvent(a,[]);return this};T.prototype.undo=
function(){this.receiver.parent.getChildren().remove(this.receiver);this.receiver.saveAndDestroy();this.receiver.canvas.triggerRemoveEvent(this.receiver,[this.receiver]);return this};T.prototype.redo=function(){this.execute();return this};X=function(a){y.call(this,a[0].shape);this.after=this.before=null;this.relatedShapes=[];X.prototype.initObject.call(this,a)};X.prototype=new y;X.prototype.type="CommandSwitchContainer";X.prototype.initObject=function(a){var b,c,d=[],f=[];for(b=0;b<a.length;b+=1)c=
a[b],this.relatedShapes.push(c.shape),d.push({parent:c.shape.parent,x:c.shape.getOldX(),y:c.shape.getOldY(),topLeft:!0}),f.push({parent:c.container,x:c.x,y:c.y,topLeft:c.topLeft});this.before={shapes:d};this.after={shapes:f}};X.prototype.execute=function(){var a,b;for(a=0;a<this.relatedShapes.length;a+=1)b=this.relatedShapes[a],this.before.shapes[a].parent.swapElementContainer(b,this.after.shapes[a].parent,this.after.shapes[a].x,this.after.shapes[a].y,this.after.shapes[a].topLeft),b.refreshChildrenPositions().refreshConnections();
this.canvas.triggerParentChangeEvent(this.relatedShapes,this.before.shapes,this.after.shapes)};X.prototype.undo=function(){var a,b;for(a=0;a<this.relatedShapes.length;a+=1)b=this.relatedShapes[a],this.before.shapes[a].parent.swapElementContainer(b,this.before.shapes[a].parent,this.before.shapes[a].x,this.before.shapes[a].y,this.before.shapes[a].topLeft),b.refreshChildrenPositions().refreshConnections();this.canvas.triggerParentChangeEvent(this.relatedShapes,this.after.shapes,this.before.shapes)};
X.prototype.redo=function(){this.execute()};U=function(a){y.call(this,a);this.stackCommandConnect=[];this.currentSelection=new D;this.currentConnection=null;this.relatedElements=[];U.prototype.initObject.call(this,a)};U.prototype=new y;U.prototype.type="CommandDelete";U.prototype.initObject=function(a){var b,c;for(b=0;b<a.getCurrentSelection().getSize()>0;b+=1)c=a.getCurrentSelection().get(b),this.currentSelection.insert(c);a.currentConnection&&(this.currentConnection=a.currentConnection)};U.prototype.saveAndDestroy=
function(a,b,c){var d,f,l=null,q=a.canvas;a.hasOwnProperty("children")&&(l=a.children);a.destroy&&a.destroy();for(d=0;d<l.getSize();d+=1)f=l.get(d),this.saveAndDestroy(f,!1,c);for(;a.ports&&0<a.ports.getSize();)d=a.ports.getFirst().connection,c&&this.relatedElements.push(d),this.stackCommandConnect.push(new P(d)),d.saveAndDestroy();b&&(b=a.parent,b.getChildren().remove(a),b.isResizable()&&b.resizeBehavior.updateResizeMinimums(a.parent),a.html=e(a.html).detach()[0]);c&&this.relatedElements.push(a);
q.removeFromList(a);return!0};U.prototype.execute=function(){var a,b,c=this.receiver,d=!1,f=null;0===this.relatedElements.length&&(d=!0);c.emptyCurrentSelection();for(b=0;b<this.currentSelection.getSize();b+=1)a=this.currentSelection.get(b),c.addToSelection(a);1===c.currentSelection.getSize()&&(f=a);for(b=[];0<c.getCurrentSelection().getSize();)a=c.getCurrentSelection().getFirst(),this.saveAndDestroy(a,!0,d),b.push(a.stringify());c.currentConnection=this.currentConnection;if(a=c.currentConnection)this.relatedElements.push(a),
this.stackCommandConnect.push(new P(a)),a.saveAndDestroy();c.triggerRemoveEvent(f,this.relatedElements);return this};U.prototype.undo=function(){var a,b,c=this.currentSelection.getFirst();for(a=0;a<this.currentSelection.getSize();a+=1)b=this.currentSelection.get(a),b.canvas.addToList(b),b.parent.getChildren().insert(b),b.parent.html.appendChild(b.getHTML()),J.prototype.updateResizeMinimums(b.parent),b.showOrHideResizeHandlers(!1);for(a=this.stackCommandConnect.length-1;0<=a;a-=1)this.stackCommandConnect[a].buildConnection();
this.receiver.triggerCreateEvent(c,this.relatedElements);return this};U.prototype.redo=function(){this.execute();return this};Y=function(a,b){y.call(this,a);this.stackCommandConnect=[];this.stackCommandCreate=[];Y.prototype.initObject.call(this,a,b)};Y.prototype=new y;Y.prototype.type="CommandPaste";Y.prototype.initObject=function(a,b){var c={stackCommandConnect:[],stackCommandCreate:[]};e.extend(!0,c,b);this.stackCommandConnect=c.stackCommandConnect;this.stackCommandCreate=c.stackCommandCreate};
Y.prototype.execute=function(){var a,b;for(a=0;a<this.stackCommandCreate.length;a+=1)b=this.stackCommandCreate[a],b.redo();for(a=0;a<this.stackCommandConnect.length;a+=1)b=this.stackCommandConnect[a],b.redo();return this};Y.prototype.undo=function(){var a,b;for(a=0;a<this.stackCommandCreate.length;a+=1)b=this.stackCommandCreate[a],b.undo();for(a=0;a<this.stackCommandConnect.length;a+=1)b=this.stackCommandConnect[a],b.undo();return this};Y.prototype.redo=function(){this.execute();return this};Z=function(a,
b){y.call(this,a);this.after=this.before=null;Z.prototype.initObject.call(this,a,b)};Z.prototype=new y;Z.prototype.type="CommandEditLabel";Z.prototype.initObject=function(a,b){var c=0,d=0;a.parent&&(c=a.parent.height,d=a.parent.width);this.before={message:a.message,width:a.width,height:a.height,parentHeight:c,parentWidth:d};this.after={message:b,width:0,height:0,parentHeight:d,parentWidth:c}};Z.prototype.execute=function(a){this.receiver.setMessage(this.after.message);this.receiver.updateDimension();
0===this.after.width&&(this.after.width=this.receiver.width,this.after.height=this.receiver.height,0!==this.after.parentWidth&&(this.after.parentWidth=this.receiver.parent.width,this.after.parentHeight=this.receiver.parent.height));this.receiver.paint();a||(this.receiver.canvas.triggerTextChangeEvent(this.receiver,this.before.message,this.after.message),this.after.parentWidth===this.before.parentWidth&&this.before.parentHeight===this.after.parentHeight||this.receiver.canvas.triggerDimensionChangeEvent(this.receiver.parent,
this.before.parentWidth,this.before.parentHeight,this.after.parentWidth,this.after.parentHeight))};Z.prototype.undo=function(a){this.receiver.setMessage(this.before.message);this.receiver.parent&&this.receiver.parent.setDimension(this.before.parentWidth,this.before.parentHeight);this.receiver.setDimension(this.before.width,this.before.height);this.receiver.updateDimension();this.receiver.paint();this.receiver.canvas.triggerTextChangeEvent(this.receiver,this.after.message,this.before.message);this.after.parentWidth!==
this.before.parentWidth&&this.before.parentHeight!==this.after.parentHeight&&this.receiver.canvas.triggerDimensionChangeEvent(this.receiver.parent,this.after.parentWidth,this.after.parentHeight,this.before.parentWidth,this.before.parentHeight)};Z.prototype.redo=function(){this.execute()};$=function(){};$.prototype.type="ContainerBehavior";$.prototype.family="ContainerBehavior";$.prototype.addToContainer=function(a,b,c,d,f){};$.prototype.removeFromContainer=function(a){};$.prototype.addShape=function(a,
b,c,d){};$.prototype.isContainer=function(){return!1};ja=function(){};ja.prototype=new $;ja.prototype.type="RegularContainerBehavior";ja.prototype.addToContainer=function(a,b,c,d,f){var l=0,q=0,x,e,g=!0===f?0:1;e="Canvas"===a.family?a:a.canvas;f=b.getZoomWidth();x=b.getZoomHeight();l=(l+(c-f/2*g))/e.zoomFactor;q=(q+(d-x/2*g))/e.zoomFactor;b.setParent(a);a.getChildren().insert(b);this.addShape(a,b,l,q);b.fixZIndex(b,0);a.updateDimensions(10);e.addToList(b)};ja.prototype.removeFromContainer=function(a){var b=
a.parent;b.getChildren().remove(a);b.isResizable()&&b.resizeBehavior.updateResizeMinimums(a.parent);a.parent=null};ja.prototype.addShape=function(a,b,c,d){b.setPosition(c,d);a.getHTML().appendChild(b.getHTML());b.paint();b.updateHTML();return this};sa=function(){};sa.prototype=new $;sa.prototype.type="NoContainerBehavior";G=function(){};G.prototype.type="DragBehavior";G.prototype.family="DragBehavior";G.prototype.attachDragBehavior=function(a){var b=e(a.getHTML());a={revert:!1,helper:"none",cursorAt:!1,
revertDuration:0,grid:[1,1],start:this.onDragStart(a),drag:this.onDrag(a),stop:this.onDragEnd(a)};b.draggable(a)};G.prototype.onDragStart=function(a){return function(a,c){}};G.prototype.onDrag=function(a){return function(a,c){}};G.prototype.onDragEnd=function(a){return function(a,c){}};G.prototype.dragStartHook=function(a){};G.prototype.dragHook=function(a){};G.prototype.dragEndHook=function(){};aa=function(){};aa.prototype=new G;aa.prototype.type="RegularDragBehavior";aa.prototype.attachDragBehavior=
function(a){var b=e(a.getHTML());G.prototype.attachDragBehavior.call(this,a);b.draggable({cursor:"move"})};aa.prototype.onDragStart=function(a){return function(b,c){var d=a.canvas,f=d.currentLabel,l;d.hideCurrentConnection();f&&(f.loseFocus(),e(f.textField).focusout());d.currentSelection.contains(a)||(d.emptyCurrentSelection(),d.addToSelection(a));for(l=0;l<d.currentSelection.getSize();l+=1)f=d.currentSelection.get(l),f.setOldX(f.getX()),f.setOldY(f.getY()),f.setOldParent(f.getParent());a.increaseParentZIndex(a.getParent());
return!0}};aa.prototype.onDrag=function(a){return function(b,c){a.setPosition(c.helper.position().left,c.helper.position().top);a.canvas.showOrHideSnappers(a)}};aa.prototype.onDragEnd=function(a){return function(b,c){var d;a.setPosition(c.helper.position().left,c.helper.position().top);a.decreaseParentZIndex(a.oldParent);a.dragging=!1;a.canvas.verticalSnapper.hide();a.canvas.horizontalSnapper.hide();a.changedContainer||(d=new S(a),d.execute(),a.canvas.commandStack.add(d));a.changedContainer=!1}};
qa=function(){};qa.prototype=new G;qa.prototype.type="NoDragBehavior";qa.prototype.onDragStart=function(a){return function(b,c){a.canvas.hideCurrentConnection();return!1}};fa=function(){};fa.prototype=new G;fa.prototype.type="ConnectionDragBehavior";fa.prototype.attachDragBehavior=function(a){var b=e(a.getHTML()),c;c={helper:a.createDragHelper,cursorAt:{top:0,left:0},revert:!0};G.prototype.attachDragBehavior.call(this,a);b.draggable(c);b.draggable("enable")};fa.prototype.onDragStart=function(a){return function(b,
c){var d=a.canvas.currentLabel;a.canvas.emptyCurrentSelection();d&&(d.loseFocus(),e(d.textField).focusout());if("CustomShape"!==a.family)return!1;a.setOldX(a.getX());a.setOldY(a.getY());a.startConnectionPoint.x+=a.getAbsoluteX();a.startConnectionPoint.y+=a.getAbsoluteY();return!0}};fa.prototype.onDrag=function(a){return function(b,c){var d=a.getCanvas(),f=new k;d.connectionSegment&&e(d.connectionSegment.getHTML()).remove();f.x=b.pageX-d.getX()+d.getLeftScroll();f.y=b.pageY-d.getY()+d.getTopScroll();
d.connectionSegment=new w({startPoint:a.startConnectionPoint,endPoint:f,parent:d,zOrder:2*A.MAX_ZINDEX});d.connectionSegment.pointsTo=a;d.connectionSegment.paint()}};fa.prototype.onDragEnd=function(a){return function(b,c){a.canvas.connectionSegment&&e(a.canvas.connectionSegment.getHTML()).remove();a.setPosition(a.getOldX(),a.getOldY());a.dragging=!1}};I=function(){};I.prototype=new G;I.prototype.type="CustomShapeDragBehavior";I.prototype.attachDragBehavior=function(a){var b=e(a.getHTML());a={revert:!1,
helper:"none",cursorAt:!1,revertDuration:0,disable:!1,grid:[1,1],start:this.onDragStart(a),drag:this.onDrag(a,!0),stop:this.onDragEnd(a,!0)};b.draggable(a)};I.prototype.onDragStart=function(a){return function(b,c){aa.prototype.onDragStart.call(this,a)(b,c);a.previousXDragPosition=a.getX();a.previousYDragPosition=a.getY();a.canvas.snapToGuide&&a.canvas.startSnappers(b)}};I.prototype.onDragProcedure=function(a,b,c,d,f,l){var q,x,e,g,k,h,m=a.canvas;if(b)for(a.canvas.snapToGuide&&a.canvas.processGuides(f,
l,a),a.setPosition(l.helper.position().left/m.zoomFactor,l.helper.position().top/m.zoomFactor),g=a.x-a.previousXDragPosition,k=a.y-a.previousYDragPosition,a.previousXDragPosition=a.x,a.previousYDragPosition=a.y,q=0;q<a.canvas.currentSelection.getSize();q+=1)e=a.canvas.currentSelection.get(q),e.id!==a.id&&e.setPosition(e.x+g,e.y+k);else a.setPosition(a.x,a.y);if(b)for(q=0;q<a.canvas.currentSelection.getSize();q+=1)for(e=a.canvas.currentSelection.get(q),x=0;x<e.children.getSize();x+=1)h=e.children.get(x),
I.prototype.onDragProcedure.call(this,h,!1,g,k,f,l);else for(q=0;q<a.children.getSize();q+=1)h=a.children.get(q),I.prototype.onDragProcedure.call(this,h,!1,c,d,f,l);if(b)for(q=0;q<a.canvas.currentSelection.getSize();q+=1)for(e=a.canvas.currentSelection.get(q),x=0;x<e.ports.getSize();x+=1)b=e.ports.get(x),f=b.connection,b.setPosition(b.x,b.y),a.canvas.sharedConnections.find("id",f.getID())?f.srcPort.parent.getID()===e.getID()&&f.move(g*m.zoomFactor,k*m.zoomFactor):f.disconnect().connect();else for(q=
0;q<a.ports.getSize();q+=1)b=a.ports.get(q),f=b.connection,b.setPosition(b.x,b.y),a.canvas.sharedConnections.find("id",f.getID())?f.srcPort.parent.getID()===a.getID()&&f.move(c*m.zoomFactor,d*m.zoomFactor):f.setSegmentColor(B.GREY,!1).setSegmentStyle("regular",!1).disconnect().connect()};I.prototype.onDrag=function(a,b,c,d){var f=this;return function(l,q){f.onDragProcedure(a,b,c,d,l,q)}};I.prototype.dragEndProcedure=function(a,b,c,d){var f,l,q,x;f=a.canvas;b?(a.setPosition(d.helper.position().left/
f.zoomFactor,d.helper.position().top/f.zoomFactor),a.wasDragged=!0):a.setPosition(a.x,a.y);if(b)for(f=0;f<a.canvas.currentSelection.getSize();f+=1)for(q=a.canvas.currentSelection.get(f),l=0;l<q.children.getSize();l+=1)x=q.children.get(l),x.changedContainer=!0,I.prototype.dragEndProcedure.call(this,x,!1,c,d);else for(f=0;f<a.children.getSize();f+=1)x=a.children.get(f),I.prototype.dragEndProcedure.call(this,x,!1,c,d);if(b)for(f=0;f<a.canvas.currentSelection.getSize();f+=1)for(q=a.canvas.currentSelection.get(f),
l=0;l<q.ports.getSize();l+=1)b=q.ports.get(l),c=b.connection,b.setPosition(b.x,b.y),a.canvas.sharedConnections.find("id",c.getID())?c.srcPort.parent.getID()===q.getID()&&(c.disconnect(!0).connect({algorithm:"user",points:c.points,dx:parseFloat(e(c.html).css("left")),dy:parseFloat(e(c.html).css("top"))}),c.checkAndCreateIntersectionsWithAll()):(c.setSegmentColor(c.originalSegmentColor,!1).setSegmentStyle(c.originalSegmentStyle,!1),c.setSegmentMoveHandlers(),c.checkAndCreateIntersectionsWithAll());
else for(f=0;f<a.ports.getSize();f+=1)b=a.ports.get(f),c=b.connection,b.setPosition(b.x,b.y),a.canvas.sharedConnections.find("id",c.getID())?c.srcPort.parent.getID()===a.getID()&&c.checkAndCreateIntersectionsWithAll():(c.setSegmentColor(c.originalSegmentColor,!1).setSegmentStyle(c.originalSegmentStyle,!1).disconnect().connect(),c.setSegmentMoveHandlers(),c.checkAndCreateIntersectionsWithAll())};I.prototype.onDragEnd=function(a){var b,c=this;return function(d,f){c.dragEndProcedure(a,!0,d,f);a.dragging=
!1;a.canvas.verticalSnapper.hide();a.canvas.horizontalSnapper.hide();a.changedContainer||(b=new S(a.canvas.currentSelection),b.execute(),a.canvas.commandStack.add(b));a.changedContainer=!1;a.decreaseParentZIndex(a.oldParent)}};J=function(){};J.prototype.type="ResizeBehavior";J.prototype.family="ResizeBehavior";J.prototype.init=function(a){var b=e(a.getHTML()),c={handles:a.getHandlesIDs(),disable:!1,start:this.onResizeStart(a),resize:this.onResize(a),stop:this.onResizeEnd(a)};b.resizable(c);this.updateResizeMinimums(a.parent)};
J.prototype.onResizeStart=function(a){};J.prototype.onResize=function(a){};J.prototype.onResizeEnd=function(a){};J.prototype.updateResizeMinimums=function(a){var b;b=a.getChildren().getDimensionLimit();var c=e(a.getHTML());a=b[1]+15;b=b[2]+15;c.resizable("option","minWidth",a);c.resizable("option","minHeight",b);return this};ba=function(){};ba.prototype=new J;ba.prototype.type="RegularResizeBehavior";ba.prototype.init=function(a){var b=e(a.getHTML());J.prototype.init.call(this,a);b.resizable("enable");
a.applyStyleToHandlers("resizableStyle");a.showOrHideResizeHandlers(!1)};ba.prototype.onResizeStart=function(a){return function(b,c){a.resizing=!0;a.dragging=!1;a.oldWidth=a.width;a.oldHeight=a.height;a.oldX=a.x;a.oldY=a.y;a.oldAbsoluteX=a.absoluteX;a.oldAbsoluteY=a.absoluteY;a.ports&&a.initPortsChange();1<a.canvas.currentSelection.getSize()&&(a.canvas.emptyCurrentSelection(),a.canvas.addToSelection(a));a.showOrHideResizeHandlers(!1);a.calculateLabelsPercentage();return!0}};ba.prototype.onResize=
function(a){return function(b,c){var d=a.canvas;a.setPosition(c.position.left/d.zoomFactor,c.position.top/d.zoomFactor);a.setDimension(c.size.width/d.zoomFactor,c.size.height/d.zoomFactor);a.fixConnectionsOnResize(a.resizing,!0);a.updateLabelsPosition()}};ba.prototype.onResizeEnd=function(a){return function(b,c){var d,f;a.resizing=!1;ba.prototype.onResize.call(this,a)(b,c);a.showOrHideResizeHandlers(!0);a.parent.updateDimensions(10);a.ports&&a.firePortsChange();d=new ha(a);a.canvas.commandStack.add(d);
d.execute();for(d=0;d<a.labels.getSize();d+=1)f=a.labels.get(d),f.setLabelPosition(f.location,f.diffX,f.diffY);return!0}};na=function(){};na.prototype=new J;na.prototype.type="NoResizeBehavior";na.prototype.init=function(a){var b=e(a.getHTML());J.prototype.init.call(this,a);b.resizable("disable");b.removeClass("ui-state-disabled");a.applyStyleToHandlers("nonResizableStyle");a.showOrHideResizeHandlers(!1)};na.prototype.updateResizeMinimums=function(a){};z=function(a){this.selectors=a||[]};z.prototype.type=
"DropBehavior";z.prototype.family="DropBehavior";z.prototype.defaultSelector="";z.prototype.attachDropBehavior=function(a){var b=e(a.getHTML());a={accept:this.defaultSelector,drop:this.onDrop(a),over:this.onDragEnter(a),out:this.onDragLeave(a),greedy:!0};b.droppable(a)};z.prototype.onDragEnter=function(a){return function(a,c){}};z.prototype.onDragLeave=function(a){return function(a,c){}};z.prototype.onDrop=function(a){return function(a,c){}};z.prototype.setSelectors=function(a,b){var c;a&&(this.selectors=
a);for(b?0<a.length&&(c=1):c=0;c<a.length;c+=1);return this};z.prototype.updateSelectors=function(a,b){var c=e(a.getHTML()),d,f;b&&(this.selectors=b);0<this.selectors.length&&(d=this.selectors[0]);for(f=1;f<this.selectors.length;f+=1)d+=","+this.selectors[f];c.droppable({accept:d});return this};z.prototype.dragEnterHook=function(){return!0};z.prototype.dragLeaveHook=function(){return!0};z.prototype.dropStartHook=function(a,b,c){return!0};z.prototype.dropHook=function(a,b,c){return!0};z.prototype.dropEndHook=
function(a,b,c){return!0};V=function(a){z.call(this,a)};V.prototype=new z;V.prototype.type="ConnectionDropBehavior";V.prototype.defaultSelector=".custom_shape,.port";V.prototype.setSelectors=function(a,b){z.prototype.setSelectors.call(this,a,b);this.selectors.push(".port");this.selectors.push(".custom_shape");return this};V.prototype.onDragEnter=function(a){return function(b,c){a.entered=!0}};V.prototype.onDragLeave=function(a){return function(b,c){a.entered=!1}};V.prototype.onDrop=function(a){return function(b,
c){var d=a.getCanvas(),f=c.draggable.attr("id"),l,q,e,g,k;l=d.currentConnection;a.entered=!1;if(!a.dropBehavior.dropStartHook(a,b,c))return!1;if("none"===a.getConnectionType())return!0;l&&(e=l.srcPort,l=l.destPort,e=e.id===f?e:l.id===f?l:null);if(c.helper&&"drag-helper"===c.helper.attr("id")){l=a.canvas.connectionSegment.startPoint;q=a.canvas.connectionSegment.pointsTo;if(q.parent&&q.parent.id===a.id)return!0;q.setPosition(q.oldX,q.oldY);l.x-=q.absoluteX;l.y-=q.absoluteY;e=new r({width:8,height:8});
f=new r({width:8,height:8});g=c.offset.left-a.canvas.getX()-a.getAbsoluteX()+a.canvas.getLeftScroll();k=c.offset.top-a.canvas.getY()-a.getAbsoluteY()+a.canvas.getTopScroll();q.addPort(e,l.x,l.y);a.addPort(f,g,k,!1,e);l=new p({srcPort:e,destPort:f,canvas:a.canvas,segmentStyle:a.connectionType});l.setSrcDecorator(new u({width:11,height:11,canvas:d,decoratorPrefix:"con_normal",decoratorType:"source",parent:l}));l.setDestDecorator(new u({width:11,height:11,canvas:d,decoratorPrefix:"con_normal",decoratorType:"target",
parent:l}));l.canvas.commandStack.add(new P(l));l.connect();l.setSegmentMoveHandlers();d.addConnection(l);l.checkAndCreateIntersectionsWithAll();e.attachListeners(e);f.attachListeners(f);d.triggerCreateEvent(l,[])}else e&&(e.setOldParent(e.getParent()),e.setOldX(e.getX()),e.setOldY(e.getY()),f=c.position.left,l=c.position.top,e.setPosition(f,l),a.dragging=!1,a.getID()!==e.parent.getID()?(e.parent.removePort(e),f=c.offset.left-d.getX()-a.absoluteX+a.canvas.getLeftScroll(),l=c.offset.top-d.getY()-a.absoluteY+
a.canvas.getTopScroll(),a.addPort(e,f,l,!0),d.regularShapes.insert(e)):a.definePortPosition(e,e.getPoint(!0)),e.connection.connect(),d.triggerPortChangeEvent(e),e.connection.disconnect(),d=new ia(e),e.canvas.commandStack.add(d));return!1}};ra=function(a){z.call(this,a)};ra.prototype=new z;ra.prototype.type="NoDropBehavior";ra.prototype.attachDropBehavior=function(a){e(a.getHTML());z.prototype.attachDropBehavior.call(this,a);e(a).droppable("accept","")};ka=function(a){z.call(this,a)};ka.prototype=
new z;ka.prototype.type="ContainerDropBehavior";ka.prototype.defaultSelector=".custom_shape";ka.prototype.onDrop=function(a){return function(b,c){var d=null,f=a.getCanvas(),l,e,x,g;x=[];if(f.readOnly)return!1;a.entered=!1;if(c.helper&&"drag-helper"===c.helper.attr("id"))return!1;g=c.draggable.attr("id");d=f.toolBarShapeFactory(g);if(null===d){d=f.customShapes.find("id",g);if(!d||!a.dropBehavior.dropHook(a,b,c))return!1;if(!d.parent||d.parent.id!==a.id){d=f.currentSelection;for(e=0;e<d.getSize();e+=
1)l=d.get(e),g=ea.getPointRelativeToPage(l),g=ea.pageCoordinatesToShapeCoordinates(a,null,g.x,g.y),x.push({shape:l,container:a,x:g.x,y:g.y,topLeft:!1});x=new X(x);x.execute();f.commandStack.add(x);f.multipleDrop=!0}a.updateDimensions(10);f.updatedElement=null}else g=ea.pageCoordinatesToShapeCoordinates(a,b),a.addElement(d,g.x,g.y,d.topLeftOnCreation),d.attachListeners(),f.updatedElement=d,x=new T(d),f.commandStack.add(x),x.execute()}};la=function(a){z.call(this,a)};la.prototype=new z;la.prototype.type=
"ConnectionContainerDropBehavior";la.prototype.defaultSelector=".custom_shape,.port";la.prototype.setSelectors=function(a,b){z.prototype.setSelectors.call(this,a,b);this.selectors.push(".port");this.selectors.push(".custom_shape");return this};la.prototype.onDrop=function(a){return function(b,c){V.prototype.onDrop.call(this,a)(b,c)||ka.prototype.onDrop.call(this,a)(b,c)}};B=function(a,b,c,d){this.red=a?a:0;this.green=b?b:0;this.blue=c?c:0;this.opacity=d?d:1};B.prototype.type="Color";B.GREY=new B(192,
192,192,1);B.prototype.getRed=function(){return this.red};B.prototype.getGreen=function(){return this.green};B.prototype.getBlue=function(){return this.blue};B.prototype.getOpacity=function(){return this.opacity};B.prototype.setRed=function(a){"number"===typeof a&&0<=a&&255>=a&&(this.red=a);return this};B.prototype.setGreen=function(a){"number"===typeof a&&0<=a&&255>=a&&(this.green=a);return this};B.prototype.setBlue=function(a){"number"===typeof a&&0<=a&&255>=a&&(this.blue=a);return this};B.prototype.setOpacity=
function(a){"number"===typeof a&&0<=a&&255>=a&&(this.opacity=a);return this};B.prototype.getCSS=function(){return"rgba("+this.red+","+this.green+","+this.blue+","+this.opacity+")"};A=function(a){this.belongsTo=this.cssClasses=this.cssProperties=null;A.prototype.initObject.call(this,a)};A.prototype.type="Style";A.MAX_ZINDEX=100;A.prototype.initObject=function(a){var b={cssClasses:[],cssProperties:{},belongsTo:null};e.extend(!0,b,a);this.cssClasses=b.cssClasses;this.cssProperties=b.cssProperties;this.belongsTo=
b.belongsTo};A.prototype.applyStyle=function(){if(!this.belongsTo.html)throw Error("applyStyle(): can't apply style to an object with no html");var a,b;e(this.belongsTo.html).css(this.cssProperties);for(a=0;a<this.cssClasses.length;a+=1)b=this.cssClasses[a],e(this.belongsTo.html).hasClass(b)||e(this.belongsTo.html).addClass(b);return this};A.prototype.addProperties=function(a){e.extend(!0,this.cssProperties,a);e(this.belongsTo.html).css(a);return this};A.prototype.getProperty=function(a){return this.cssProperties[a]||
e(this.belongsTo.html).css(a)||ta.getComputedStyle(this.belongsTo.html,null).getPropertyValue(a)};A.prototype.removeProperties=function(a){var b,c;for(c=0;c<a.length;c+=1)b=a[c],this.cssProperties.hasOwnProperty(b)&&(e(this.belongsTo.html).css(b,""),delete this.cssProperties[b]);return this};A.prototype.addClasses=function(a){var b,c;if(a&&a instanceof Array)for(b=0;b<a.length;b+=1)if(c=a[b],"string"===typeof c)-1===this.cssClasses.indexOf(c)&&(this.cssClasses.push(c),e(this.belongsTo.html).addClass(c));
else throw Error("addClasses(): array element is not of type string");else throw Error("addClasses(): parameter must be of type Array");return this};A.prototype.removeClasses=function(a){var b,c;if(a&&a instanceof Array)for(b=0;b<a.length;b+=1)if(c=a[b],"string"===typeof c)c=this.cssClasses.indexOf(c),-1!==c&&(e(this.belongsTo.html).removeClass(this.cssClasses[c]),this.cssClasses.splice(c,1));else throw Error("removeClasses(): array element is not of type string");else throw Error("removeClasses(): parameter must be of type Array");
return this};A.prototype.removeAllClasses=function(){this.cssClasses=[];e(this.belongsTo.html).removeClass();return this};A.prototype.containsClass=function(a){return-1!==this.cssClasses.indexOf(a)};A.prototype.getClasses=function(){return this.cssClasses};A.prototype.stringify=function(){return{cssClasses:this.cssClasses}};m=function(a){this.style=this.html=this.canvas=this.id=null;this.zoomHeight=this.zoomWidth=this.zoomY=this.zoomX=this.oldAbsoluteY=this.oldAbsoluteX=this.absoluteY=this.absoluteX=
this.oldY=this.oldX=this.y=this.x=this.oldHeight=this.oldWidth=this.height=this.width=0;this.zOrder=1;this.visible=!0;this.dragBehavior=null;this.savedOptions={};m.prototype.initObject.call(this,a)};m.prototype.type="JCoreObject";m.prototype.family="CoreObject";m.prototype.paint=function(){};m.prototype.attachListeners=function(){};m.prototype.initObject=function(a){var b={id:a&&a.id||ea.generateUniqueId(),style:{cssProperties:{},cssClasses:[]},width:0,height:0,x:0,y:0,zOrder:1,visible:!0,canvas:null};
e.extend(!0,b,a);this.setID(b.id).setStyle(new A({belongsTo:this,cssProperties:b.style.cssProperties,cssClasses:b.style.cssClasses})).setCanvas(b.canvas).setDimension(b.width,b.height).setPosition(b.x,b.y).setZOrder(b.zOrder).setVisible(b.visible).setSavedOptions(b)};m.prototype.createHTMLDiv=function(){return document.createElement("div")};m.prototype.createHTML=function(){this.html||(this.html=this.createHTMLDiv(),this.html.id=this.id,this.style.applyStyle(),this.style.addProperties({position:"absolute",
left:this.zoomX,top:this.zoomY,width:this.zoomWidth,height:this.zoomHeight,zIndex:this.zOrder}));return this.html};m.prototype.setPosition=function(a,b){this.setX(a);this.setY(b);return this};m.prototype.setDimension=function(a,b){this.setWidth(a);this.setHeight(b);return this};m.prototype.setX=function(a){if("number"===typeof a)this.x=a=Math.round(a),this.zoomX=this.canvas?this.x*this.canvas.zoomFactor:this.x,this.setAbsoluteX(),this.html&&this.style.addProperties({left:this.zoomX});else throw Error("setX : parameter newX is not a number");
return this};m.prototype.setY=function(a){"number"===typeof a&&(this.y=a=Math.round(a),this.zoomY=this.canvas?this.y*this.canvas.zoomFactor:this.y,this.setAbsoluteY(),this.html&&this.style.addProperties({top:this.zoomY}));return this};m.prototype.setAbsoluteX=function(){this.absoluteX=this.parent?this.zoomX+this.parent.absoluteX:this.zoomX;return this};m.prototype.setOldX=function(a){"number"===typeof a&&(this.oldX=a);return this};m.prototype.setOldY=function(a){"number"===typeof a&&(this.oldY=a);
return this};m.prototype.setAbsoluteY=function(){this.absoluteY=this.parent?this.zoomY+this.parent.absoluteY:this.zoomY;return this};m.prototype.setWidth=function(a){"number"===typeof a&&0<=a&&(this.width=a,this.canvas?(this.zoomWidth=this.width*this.canvas.zoomFactor,a=Math.floor(this.zoomWidth),this.zoomWidth=0===a%2?a+1:a):this.zoomWidth=this.width,this.html&&this.style.addProperties({width:this.zoomWidth}));return this};m.prototype.setHeight=function(a){"number"===typeof a&&0<=a&&(this.height=
a,this.canvas?(this.zoomHeight=this.height*this.canvas.zoomFactor,a=Math.floor(this.zoomHeight),this.zoomHeight=0===a%2?a+1:a):this.zoomHeight=this.height,this.html&&this.style.addProperties({height:this.zoomHeight}));return this};m.prototype.setZOrder=function(a){"number"===typeof a&&0<a&&(this.zOrder=a,this.html&&this.style.addProperties({zIndex:this.zOrder}));return this};m.prototype.setCanvas=function(a){a&&"Canvas"===a.family&&(this.canvas=a);return this};m.prototype.setStyle=function(a){a.type&&
"Style"===a.type&&(this.style=a);return this};m.prototype.setVisible=function(a){"boolean"===typeof a&&(this.visible=a,this.html&&(a?this.style.addProperties({display:"inline"}):this.style.addProperties({display:"none"})));return this};m.prototype.setID=function(a){this.id=a;this.html&&(this.html.id=this.id);return this};m.prototype.getID=function(){return this.id};m.prototype.getHTML=function(){return null===this.html?this.createHTML():this.html};m.prototype.getZOrder=function(){return this.zOrder};
m.prototype.getCanvas=function(){return this.canvas};m.prototype.getWidth=function(){return this.width};m.prototype.getHeight=function(){return this.height};m.prototype.getX=function(){return this.x};m.prototype.getY=function(){return this.y};m.prototype.getAbsoluteX=function(){return this.absoluteX};m.prototype.getAbsoluteY=function(){return this.absoluteY};m.prototype.getStyle=function(){return this.style};m.prototype.getVisible=function(){return this.visible};m.prototype.getZoomX=function(){return this.zoomX};
m.prototype.getZoomY=function(){return this.zoomY};m.prototype.getZoomWidth=function(){return this.zoomWidth};m.prototype.getZoomHeight=function(){return this.zoomHeight};m.prototype.getOldX=function(){return this.oldX};m.prototype.getOldY=function(){return this.oldY};m.prototype.getOldWidth=function(){return this.oldWidth};m.prototype.getOldHeight=function(){return this.oldHeight};m.prototype.setSavedOptions=function(a){this.savedOptions=a;return this};m.prototype.stringify=function(){return{id:this.getID(),
x:this.getX(),y:this.getY(),width:this.getWidth(),height:this.getHeight(),type:this.type,style:this.getStyle().stringify(),drag:this.savedOptions.drag}};m.prototype.parseJSON=function(a){this.initObject(a)};m.prototype.TOP=0;m.prototype.RIGHT=1;m.prototype.BOTTOM=2;m.prototype.LEFT=3;m.prototype.HORIZONTAL=0;m.prototype.VERTICAL=1;m.prototype.ZOOMSCALES=5;F=function(a){m.call(this,a);this.orientation=this.color=this.parent=this.representation=null};F.prototype=new m;F.prototype.setParent=function(a){this.parent=
a;return this};F.prototype.getParent=function(){return this.parent};F.prototype.setRepresentation=function(a){this.representation=a;return this};F.prototype.getRepresentation=function(){return this.representation};F.prototype.setOrientation=function(a){this.orientation=a;return this};F.prototype.getOrientation=function(){return this.orientation};F.prototype.paint=function(){this.representation.paint.call(this);this.style.applyStyle();return this};F.prototype.setColor=function(a){this.color=a;return this};
F.prototype.getColor=function(){return this.color};L=function(a){F.call(this,a);this.category=null;this.visible=!1;this.nonResizableStyle=this.resizableStyle=null;L.prototype.initObject.call(this,a)};L.prototype=new F;L.prototype.type="ResizeHandler";L.prototype.initObject=function(a){var b={width:4,height:4,parent:null,orientation:null,representation:null,resizableStyle:{},nonResizableStyle:{},zOrder:2};e.extend(!0,b,a);b.resizableStyle.cssProperties&&(b.resizableStyle.cssProperties.zIndex=b.zOrder);
b.nonResizableStyle.cssProperties&&(b.nonResizableStyle.cssProperties.zIndex=b.zOrder);this.setParent(b.parent).setWidth(b.width).setHeight(b.height).setOrientation(b.orientation).setRepresentation(b.representation).setResizableStyle(b.resizableStyle).setNonResizableStyle(b.nonResizableStyle);this.id=b.orientation+b.parent.id+"resizehandler"};L.prototype.setParent=function(a){this.parent=a;return this};L.prototype.getParent=function(){return this.parent};L.prototype.paint=function(){if(!this.html)throw Error("paint(): This handler has no html");
F.prototype.paint.call(this);this.setVisible(this.visible);return this};L.prototype.setCategory=function(a){"string"===typeof a&&(this.category=a);"resizable"===this.category?(this.color=new B(0,255,0),this.style.addClasses(["ui-resizable-handle","ui-resizable-"+this.orientation])):(this.color=new B(255,255,255),this.style.removeClasses(["ui-resizable-handle","ui-resizable-"+this.orientation]));return this};L.prototype.setResizableStyle=function(a){this.resizableStyle=new A({belongsTo:this,cssProperties:a.cssProperties,
cssClasses:a.cssClasses});return this};L.prototype.setNonResizableStyle=function(a){this.nonResizableStyle=new A({belongsTo:this,cssProperties:a.cssProperties,cssClasses:a.cssClasses});return this};M=function(a){F.call(this,a);this.orientation=null;this.visible=!1;this.zOrder=2;M.prototype.initObject.call(this,a)};M.prototype=new F;M.prototype.type="SegmentMoveHandler";M.prototype.initObject=function(a){var b={width:4,height:4,parent:null,orientation:null,representation:new Q,color:new B(0,255,0)};
e.extend(!0,b,a);this.setWidth(b.width).setHeight(b.height).setParent(b.parent).setColor(b.color).setOrientation(b.orientation).setRepresentation(b.representation)};M.prototype.paint=function(){F.prototype.paint.call(this);this.setVisible(this.visible);return this};M.prototype.attachListeners=function(a){var b=e(a.html);b.on("click",a.onClick(a));b.on("mousedown",a.onMouseDown(a));b.draggable({start:a.onDragStart(a),drag:a.onDrag(a),stop:a.onDragEnd(a),axis:a.orientation===a.HORIZONTAL?"y":"x"});
return this};M.prototype.onMouseDown=function(a){return function(b,c){a.parent.parent.canvas.draggingASegmentHandler=!0}};M.prototype.onClick=function(a){return function(a,c){a.stopPropagation()}};M.prototype.onDragStart=function(a){return function(b,c){var d=a.parent,f,l;d.getParent().savePoints({saveToOldPoints:!0});for(l=0;l<d.parent.lineSegments.getSize();l+=1)f=d.parent.lineSegments.get(l),f.clearIntersections();d.parent.clearAllIntersections();b.stopPropagation()}};M.prototype.onDrag=function(a){return function(b,
c){a.parent.moveSegment(c.position.left,c.position.top)}};M.prototype.onDragEnd=function(a){return function(b,c){var d=a.parent.getParent(),f=d.canvas;f.draggingASegmentHandler=!1;a.onDrag(a)(b,c);d.savePoints();d=new R(d,{oldPoints:d.getOldPoints(),newPoints:d.getPoints()});d.execute();f.commandStack.add(d)}};r=function(a){m.call(this);this.percentage=this.direction=this.oldParent=this.parent=this.representation=this.connection=null;this.defaultZOrder=this.zOrder=1;this.realY=this.realX=0;this.dragging=
!1;r.prototype.initObject.call(this,a)};r.prototype=new m;r.prototype.TOWARDS_CENTER=5;r.prototype.type="Port";r.prototype.initObject=function(a){var b={width:8,height:8,visible:!1,parent:null};e.extend(!0,b,a);e.extend(!0,b,{representation:new da({width:b.width,height:b.height,center:new k(0,0),visible:!0})});this.setVisible(b.visible).setParent(b.parent).setDimension(b.width,b.height).setRepresentation(b.representation)};r.prototype.createHTML=function(){m.prototype.createHTML.call(this);this.html.style.background=
"red";this.html.style.borderRadius="1em";this.html.style.MozBorderRadius="1em";this.style.addClasses(["port"]);return this.html};r.prototype.applyBorderMargin=function(a){a=a?1:-1;this.x+=a*this.parent.border[this.direction].x;this.y+=a*this.parent.border[this.direction].y;this.zoomX=this.x;this.zoomY=this.y;this.setAbsoluteX();this.setAbsoluteY();this.html&&this.style.addProperties({left:this.zoomX,top:this.zoomY});return this};r.prototype.setX=function(a){this.zoomX=this.x=a;this.realX=this.canvas?
this.x/this.canvas.zoomFactor:this.x;this.setAbsoluteX();this.html&&this.style.addProperties({left:this.zoomX});return this};r.prototype.setY=function(a){this.zoomY=this.y=a;this.setAbsoluteY();this.realY=this.canvas?this.y/this.canvas.zoomFactor:this.y;this.html&&this.style.addProperties({top:this.zoomY});return this};r.prototype.setWidth=function(a){this.zoomWidth=this.width=a;this.html&&this.style.addProperties({width:this.zoomWidth});return this};r.prototype.setHeight=function(a){this.zoomHeight=
this.height=a;this.html&&this.style.addProperties({height:this.zoomHeight});return this};r.prototype.paint=function(){this.setVisible(this.visible);this.style.applyStyle();return this};r.prototype.repaint=function(a){a.style.addProperties({left:a.x,top:a.y});a.connection.disconnect();a.connection.connect();a.connection.setSegmentMoveHandlers();a.connection.checkAndCreateIntersectionsWithAll();return this};r.prototype.onDragStart=function(a,b){return function(b,d){a.dragging=!0;a.setColor("#40CA09");
a.connection.disconnect();return!0}};r.prototype.onDrag=function(a,b,c,d){return function(f,l){d.connectionSegment&&e(d.connectionSegment.getHTML()).remove();b.x=f.pageX-d.getX()+d.getLeftScroll();b.y=f.pageY-d.getY()+d.getTopScroll();d.connectionSegment=new w({startPoint:c.getPoint(!1),endPoint:b,parent:d});d.connectionSegment.pointsTo=a;d.connectionSegment.createHTML();d.connectionSegment.paint()}};r.prototype.onDragEnd=function(a,b,c){return function(b,f){c.connectionSegment&&e(c.connectionSegment.getHTML()).remove();
a.repaint(a);a.connection.showPortsAndHandlers();c.currentConnection=a.connection;a.dragging=!1;a.setColor("red")}};r.prototype.determinePercentage=function(){var a,b;if(!this.parent)return!1;this.direction===this.TOP||this.direction===this.BOTTOM?(a=this.parent.getZoomWidth(),b=this.x):(a=this.parent.getZoomHeight(),b=this.y);this.percentage=Math.round(b/a*100);return!0};r.prototype.show=function(){this.visible=!0;this.paint();this.html.style.zIndex=3;return this};r.prototype.hide=function(){this.visible=
!1;this.paint();this.html.style.zIndex=1;return this};r.prototype.saveAndDestroy=function(){this.parent.removePort(this);this.html=e(this.html).detach()[0];return this};r.prototype.attachListeners=function(a){var b;b=a.connection.srcPort.getPoint(!1).equals(a.getPoint(!1))?a.connection.destPort:a.connection.srcPort;b={start:a.onDragStart(a,b),drag:a.onDrag(a,a.getPoint(!1),b,a.parent.canvas),stop:a.onDragEnd(a,b,a.parent.canvas)};e(a.html).draggable(b);e(a.html).mouseover(function(){a.setColor("#40CA09");
e(a.html).css("cursor","Move")});e(a.html).mouseleave(function(){a.dragging||a.setColor("red")});return a};r.prototype.setColor=function(a){this.html.style.background=a;return this};r.prototype.moveTowardsTheCenter=function(a){var b=r.prototype.TOWARDS_CENTER,c=[0,-b,0,b],b=[b,0,-b,0],d=1;a&&(d=-1);this.setPosition(this.x+c[this.direction]*d,this.y+b[this.direction]*d);return this};r.prototype.setDirection=function(a){if(0<=a&&4>a)this.direction=a;else throw Error("setDirection(): parameter '"+a+
"'is not valid");return this};r.prototype.getDirection=function(){return this.direction};r.prototype.setParent=function(a,b){this.canvas&&b&&(this.canvas.updatedElement={id:this.id,type:this.type,fields:[{field:"parent",oldVal:this.parent,newVal:a}]},e(this.canvas.html).trigger("changeelement"));this.parent=a;return this};r.prototype.getParent=function(){return this.parent};r.prototype.setOldParent=function(a){this.oldParent=a;return this};r.prototype.getOldParent=function(){return this.oldParent};
r.prototype.setConnection=function(a){if(a&&"Connection"===a.family)this.connection=a;else throw Error("setConnection(): parameter is not valid");return this};r.prototype.getConnection=function(){return this.connection};r.prototype.getRepresentation=function(){return this.representation};r.prototype.setRepresentation=function(a){if(a instanceof N)this.representation=a;else throw Error("setRepresentation(): parameter must be an instance of any regularShape");return this};r.prototype.getPoint=function(a){parseInt(this.parent.style.getProperty("border"),
10);return a?new k(this.getX()+Math.round(this.getWidth()/2),this.getY()+Math.round(this.getHeight()/2)):new k(this.getAbsoluteX()+Math.round(this.getWidth()/2),this.getAbsoluteY()+Math.round(this.getHeight()/2))};r.prototype.getPercentage=function(){return this.percentage};r.prototype.stringify=function(){var a={},b={x:this.getX(),y:this.getY(),realX:this.realX,realY:this.realY,parent:this.getParent().getID()};e.extend(!0,a,b);return a};oa=function(){m.call(this)};oa.prototype=new m;oa.prototype.type=
"Router";oa.prototype.createRoute=function(){return!0};ga=function(){oa.call(this);this.mindist=20};ga.prototype=new oa;ga.prototype.type="ManhattanConnectionRouter";ga.prototype.createRoute=function(a){var b,c,d,f=[];b=a.srcPort.getPoint(!1);c=a.srcPort.direction;d=a.destPort.getPoint(!1);this.route(a,d,a.destPort.direction,b,c,f);return f};ga.prototype.route=function(a,b,c,d,f,l){var e,g,h,m,n=!1;g=b;e=d;a=this.getSegment2(c,f,b,d,["UP","RIGHT","DOWN","LEFT"]);l.push(d);if(1!=a){do{if(5===a){var p;
0===f&&(h=new k(e.x,e.y-this.mindist),p=0>h.x-g.x?1:3);1===f&&(h=new k(e.x+this.mindist,e.y),p=0>h.y-g.y?2:0);2===f&&(h=new k(e.x,e.y+this.mindist),p=0>h.x-g.x?1:3);3===f&&(h=new k(e.x-this.mindist,e.y),p=0<h.y-g.y?0:2);e=h;f=p}4===a&&(0===c&&(h=new k(g.x,g.y-this.mindist),p=0>h.x-e.x?1:3),1===c&&(h=new k(g.x+this.mindist,g.y),p=0<h.y-e.y?0:2),2===c&&(h=new k(g.x,g.y+this.mindist),p=0>h.x-e.x?1:3),3===c&&(h=new k(g.x-this.mindist,g.y),p=0>h.y-e.y?2:0),g=h,m=!0,c=p);if(3===a){var r=d=0;e.y<g.y&&(d=
this.positive(e.y-g.y));e.x<g.x&&(r=this.positive(e.x-g.x));0===f&&(0===f&&0===c?e.y<g.y?h=new k(e.x,e.y-this.mindist):(d=this.positive(e.y-g.y),h=new k(e.x,e.y-(this.mindist+d))):(h=0,h=(e.y+g.y)/2,h=new k(e.x,h)));1===f&&(1===f&&1===c?h=new k(e.x+(this.mindist+r),e.y):(h=(e.x+g.x)/2,h=new k(h,e.y)));2===f&&(2===f&&2===c?h=new k(e.x,e.y+(this.mindist+d)):(h=(e.y+g.y)/2,h=new k(e.x,h)));3===f&&(3===f&&3===c?e.x<g.x?h=new k(e.x-this.mindist,e.y):(r=this.positive(e.x-g.x),h=new k(e.x-(this.mindist+
r),e.y)):(h=(e.x+g.x)/2,h=new k(h,e.y)));e=h}else if(2==a)if(0==n)if(0===c||2===c)h=new k(g.x,e.y);else{if(1===c||3===c)h=new k(e.x,g.y)}else if(0===c||2===c)h=e.x<g.x&&e.y>g.y?2===c?new k(g.x,e.y):new k(e.x,g.y):new k(g.x,e.y);else if(1===c||3===c)h=new k(e.x,g.y);a--;m?(m=!1,n=!0):l.push(h)}while(1<a);n&&l.push(g)}l.push(b)};ga.prototype.getSegment2=function(a,b,c,d,f){if(a===b)return 3;if(0===a&&2===b&&c.x===d.x&&c.y>d.y||1===a&&3===b&&c.x<d.x&&c.y===d.y||2===a&&0===b&&c.x===d.x&&c.y<d.y||3===
a&&1===b&&c.x>d.x&&c.y===d.y)return 1;if(1===a&&0===b)return c.x<d.x&&c.y<d.y?2:4;if(0===a&&1===b)return c.x<d.x||c.y<d.y?4:2;if(2===a&&0===b)return c.y<d.y?3:5;if(0===a&&2===b)return c.y>d.y?3:5;if(3===a&&0===b)return c.x>d.x&&c.y<d.y?2:4;if(0===a&&3===b)return c.x<d.x&&c.y>d.y?2:4;if(2===a&&1===b)return c.x<d.x&&c.y<d.y||c.y>d.y?4:2;if(1===a&&2===b)return c.x<d.x&&c.y>d.y?2:4;if(3===a&&1===b)return c.x<d.x?5:3;if(1===a&&3===b)return c.x>d.x?5:3;if(3===a&&2===b)return c.x<d.x&&c.y>d.y||c.y<d.y?4:
2;if(2===a&&3===b)return c.x<d.x&&c.y<d.y?2:4;this.getSegment2(b,a,c,d,f)};ga.prototype.positive=function(a){0>a&&(a*=-1);return a};u=function(a){m.call(this,a);this.decoratorPrefix=this.decoratorType=this.parent=null;this.spriteDirection={0:"top",1:"right",2:"bottom",3:"left"};this.width=this.height=11;this.cssClass=this.sprite=this.separator=null;u.prototype.initObject.call(this,a)};u.prototype=new m;u.prototype.type="ConnectionDecorator";u.prototype.initObject=function(a){var b={sprite:"bpmn_zoom",
decoratorPrefix:"",separator:"_",decoratorType:"target",parent:null};e.extend(!0,b,a);this.setDecoratorType(b.decoratorType).setDecoratorPrefix(b.decoratorPrefix).setSeparator(b.separator).setSprite(b.sprite).setParent(b.parent).setCssClass("")};u.prototype.paint=function(){var a,b,c,d;b="source"===this.decoratorType?this.parent.getSrcPort():this.parent.getDestPort();a=b.getPoint(!1);c=b.getDirection();b=b.canvas;d=[a.y-this.zoomHeight,a.y-Math.round(this.zoomHeight/2),a.y,a.y-Math.round(this.zoomHeight/
2)];a=[a.x-Math.round(this.zoomWidth/2)+1,a.x,a.x-Math.round(this.zoomWidth/2)+1,a.x-this.zoomWidth];null===this.getHTML()&&this.createHTML();if(null===this.decoratorType)return this.html=null,this;this.style.removeClasses([this.cssClass]);this.setCssClass([this.prefix,parseInt(100*b.zoomFactor,10),this.decoratorType,this.spriteDirection[c]].join(this.separator));this.style.addClasses([this.sprite,this.getCssClass()]);this.style.addProperties({top:d[c],left:a[c]});this.parent.html.appendChild(this.html);
return this};u.prototype.createHTML=function(){this.html=document.createElement("div");this.html.id=this.id;this.style.applyStyle();this.style.addProperties({position:"absolute",left:0,top:0,height:this.zoomHeight,width:this.zoomWidth,zIndex:A.MAX_ZINDEX});return this.html};u.prototype.attachListeners=function(){e(this.getHTML()).click(this.onClick(this)).on("mousedown",this.onMouseDown(this));return this};u.prototype.applyZoom=function(){this.setDimension(this.width,this.height);return this};u.prototype.onMouseDown=
function(a){return function(b,c){b.preventDefault();3===b.which&&(a.parent.canvas.updatedElement=a.parent,e(a.parent.canvas.html).trigger("rightclick"));b.stopPropagation()}};u.prototype.onClick=function(a){return function(b,c){var d=a.parent,f=a.parent.canvas.currentConnection,l=d.canvas;l.emptyCurrentSelection();f&&f.hidePortsAndHandlers();d.showPortsAndHandlers();l.currentConnection=d;b.stopPropagation()}};u.prototype.stringify=function(){var a={},b={decoratorType:this.getDecoratorType(),decoratorPrefix:this.getDecoratorPrefix()};
e.extend(!0,a,b);return a};u.prototype.getDecoratorType=function(){return this.decoratorType};u.prototype.setDecoratorType=function(a){this.decoratorType=a;return this};u.prototype.getDecoratorPrefix=function(){return this.prefix};u.prototype.setDecoratorPrefix=function(a){this.prefix=a;return this};u.prototype.setParent=function(a){this.parent=a;return this};u.prototype.getParent=function(){return this.parent};u.prototype.setSeparator=function(a){this.separator=a;return this};u.prototype.setSprite=
function(a){this.sprite=a;return this};u.prototype.getSeparator=function(){return this.separator};u.prototype.setCssClass=function(a){this.cssClass=a;return this};u.prototype.getCssClass=function(){return this.cssClass};p=function(a){m.call(this,a);this.destDecorator=this.srcDecorator=this.destPort=this.srcPort=null;this.lineSegments=new D;this.points=[];this.oldPoints=[];this.originalSegmentColor=this.segmentColor=this.originalSegmentStyle=this.segmentStyle=null;this.zOrder=this.defaultZOrder=2;
this.intersectionWith=new D;p.prototype.initObject.call(this,a)};p.prototype=new m;p.prototype.type="Connection";p.prototype.family="Connection";p.prototype.router=new ga;p.prototype.initObject=function(a){var b={srcPort:new r,destPort:new r,segmentColor:new B(0,0,0),segmentStyle:"regular"};e.extend(!0,b,a);this.setSrcPort(b.srcPort).setDestPort(b.destPort).setSegmentStyle(b.segmentStyle,!1).setSegmentColor(b.segmentColor,!1);this.originalSegmentStyle=b.segmentStyle;this.originalSegmentColor=b.segmentColor;
this.getSrcPort().setConnection(this);this.getDestPort().setConnection(this)};p.prototype.createHTML=function(){this.html=document.createElement("div");this.html.id=this.id;this.style.addProperties({position:"absolute",left:0,top:0,height:0,width:0,zIndex:this.zOrder});return this.html};p.prototype.setSegmentMoveHandlers=function(){var a,b,c=[this.HORIZONTAL,this.VERTICAL],d=this.destPort.direction===this.TOP||this.destPort.direction===this.BOTTOM?1:0;for(a=this.lineSegments.getSize()-1;0<=a;a-=1)b=
this.lineSegments.get(a),b.orientation=c[d],b.hasMoveHandler=!1,a<this.lineSegments.getSize()-1&&0<a&&(b.nextNeighbor=this.lineSegments.get(a+1),b.previousNeighbor=this.lineSegments.get(a-1),b.hasMoveHandler=!0,b.addSegmentMoveHandler()),d=1-d;return this};p.prototype.removeAllSegmentHandlers=function(){var a,b;for(b=0;b<this.lineSegments.getSize();b+=1)a=this.lineSegments.get(b),a.hasMoveHandler&&e(a.moveHandler.html).remove();return this};p.prototype.showMoveHandlers=function(){var a,b;for(a=0;a<
this.lineSegments.getSize();a+=1)(b=this.lineSegments.get(a).moveHandler)&&b.setVisible(!0);return this};p.prototype.hideMoveHandlers=function(){var a,b;for(a=0;a<this.lineSegments.getSize();a+=1)(b=this.lineSegments.get(a).moveHandler)&&b.setVisible(!1);return this};p.prototype.hidePortsAndHandlers=function(){this.hidePorts();this.hideMoveHandlers();return this};p.prototype.showPortsAndHandlers=function(){this.showPorts();this.showMoveHandlers();return this};p.prototype.paint=function(a){var b={algorithm:"manhattan",
points:[],dx:0,dy:0};e.extend(!0,b,a);try{null===this.html&&this.createHTML();e(this.html).empty();this.oldPoint=null;switch(b.algorithm){case "manhattan":this.createManhattanRoute();break;case "user":this.createUserDefinedRoute(b.points,b.dx,b.dy);break;default:throw Error("Connection.paint(): the algorithm provided is not correct");}this.style.applyStyle();this.style.addProperties({top:0,left:0});null!==this.destDecorator&&(this.destDecorator.paint(),this.destDecorator.attachListeners());null!==
this.srcDecorator&&this.srcDecorator.paint();this.oldPoint=null}catch(c){console.log(c.message)}return this};p.prototype.disconnect=function(a){this.clearAllIntersections();this.hideMoveHandlers();a&&this.savePoints();this.lineSegments.clear();e(this.html).empty();return this};p.prototype.connect=function(a){this.paint(a);return this};p.prototype.hidePorts=function(){this.srcPort.hide();this.destPort.hide();return this};p.prototype.showPorts=function(){this.srcPort.show();this.destPort.show();return this};
p.prototype.savePoints=function(a){var b,c="points";b={saveToOldPoints:!1};e.extend(!0,b,a);b.saveToOldPoints&&(c="oldPoints");this[c]=[];for(a=0;a<this.lineSegments.getSize();a+=1)b=this.lineSegments.get(a),0===a&&this[c].push(new k(b.startPoint.x,b.startPoint.y)),this[c].push(new k(b.endPoint.x,b.endPoint.y));return this};p.prototype.createUserDefinedRoute=function(a,b,c){var d=new k(b,c);for(b=1;b<a.length;b+=1)c=new w({startPoint:(new k(parseInt(a[b-1].x,10),parseInt(a[b-1].y,10))).add(d),endPoint:(new k(parseInt(a[b].x,
10),parseInt(a[b].y,10))).add(d),parent:this,canvas:this.canvas,color:this.segmentColor}),this.addSegment(c);return this};p.prototype.createManhattanRoute=function(){var a=this.router.createRoute(this),b,c;for(b=1;b<a.length;b+=1)c=new w({startPoint:new k(parseInt(a[b-1].x,10),parseInt(a[b-1].y,10)),endPoint:new k(parseInt(a[b].x,10),parseInt(a[b].y,10)),parent:this,canvas:this.canvas,color:this.segmentColor}),this.addSegment(c);return this};p.prototype.addSegment=function(a){a.setStyle(this.segmentStyle);
a.paint();this.lineSegments.insert(a);return this};p.prototype.saveAndDestroy=function(){this.canvas.currentConnection&&(this.hidePortsAndHandlers(),this.canvas.currentConnection=null);this.canvas.removeConnection(this);this.srcPort.saveAndDestroy();this.destPort.saveAndDestroy();this.html=e(this.html).detach()[0];return this};p.prototype.fixZIndex=function(){var a=this.srcPort.parent,b=this.destPort.parent,a=Math.min((a.parent?a.parent:a.canvas).getZOrder(),a.getZOrder()-1),b=Math.min((b.parent?
b.parent:b.canvas).getZOrder(),b.getZOrder()-1);this.setZOrder(Math.max(a,b)+2);return this};p.prototype.checkAndCreateIntersections=function(a){var b,c,d,f,l=!1,e;for(b=0;b<this.lineSegments.getSize();b+=1)for(d=this.lineSegments.get(b),c=0;c<a.lineSegments.getSize();c+=1)if(f=a.lineSegments.get(c),e=O.perpendicularSegmentIntersection(d.startPoint,d.endPoint,f.startPoint,f.endPoint))l=!0,d.createIntersectionWith(f,e);l&&(this.intersectionWith.find("id",a.getID())||this.intersectionWith.insert(a),
a.intersectionWith.find("id",this.getID())||a.intersectionWith.insert(this));return l};p.prototype.checkAndCreateIntersectionsWithAll=function(){var a,b;for(a=0;a<this.canvas.connections.getSize();a+=1)b=this.canvas.connections.get(a),b.getID()!==this.getID()&&this.checkAndCreateIntersections(b);for(a=0;a<this.lineSegments.getSize();a+=1)b=this.lineSegments.get(a),b.intersections.getSize()&&b.paintWithIntersections();return this};p.prototype.clearIntersectionsWith=function(a){var b,c,d,f;for(b=0;b<
this.lineSegments.getSize();b+=1){f=!1;for(c=this.lineSegments.get(b);;){if(d=c.intersections.find("idOtherConnection",a.getID()))c.intersections.remove(d),d.destroy();else break;f=!0}f&&c.paintWithIntersections()}this.intersectionWith.remove(a);a.intersectionWith.remove(this);return this};p.prototype.clearAllIntersections=function(){for(var a;0<this.intersectionWith.getSize();)a=this.intersectionWith.get(0),a.clearIntersectionsWith(this);return this};p.prototype.move=function(a,b){var c,d;c=parseFloat(this.html.style.top);
d=parseFloat(this.html.style.left);e(this.html).css({top:c+b,left:d+a});return this};p.prototype.stringify=function(){return{segmentStyle:this.getSegmentStyle(),srcPort:this.getSrcPort().stringify(),destPort:this.getDestPort().stringify(),state:this.savePoints()&&this.points,srcDecoratorPrefix:this.getSrcDecorator().getDecoratorPrefix(),destDecoratorPrefix:this.getDestDecorator().getDecoratorPrefix()}};p.prototype.setSegmentColor=function(a,b){var c,d;this.segmentColor=a;if(this.html&&b)for(c=0;c<
this.lineSegments.getSize();c+=1)d=this.lineSegments.get(c),d.setColor(this.segmentColor),d.paint();return this};p.prototype.getSegmentColor=function(){return this.segmentColor};p.prototype.setSegmentStyle=function(a,b){var c,d;this.segmentStyle=a;if(this.html&&b)for(c=0;c<this.lineSegments.getSize();c+=1)d=this.lineSegments.get(c),d.setStyle(this.segmentStyle),d.paint();return this};p.prototype.getSegmentStyle=function(){return this.segmentStyle};p.prototype.setSrcPort=function(a){this.srcPort=a;
return this};p.prototype.getSrcPort=function(){return this.srcPort};p.prototype.setDestPort=function(a){this.destPort=a;return this};p.prototype.getDestPort=function(){return this.destPort};p.prototype.getSrcDecorator=function(){return this.srcDecorator};p.prototype.getDestDecorator=function(){return this.destDecorator};p.prototype.getLineSegments=function(){return this.lineSegments};p.prototype.setSrcDecorator=function(a){"ConnectionDecorator"===a.type&&(this.srcDecorator=a);return this};p.prototype.setDestDecorator=
function(a){"ConnectionDecorator"===a.type&&(this.destDecorator=a);return this};p.prototype.getZOrder=function(){return h.prototype.getZOrder.call(this)};p.prototype.getOldPoints=function(){return this.oldPoints};p.prototype.getPoints=function(){return this.points};t=function(a){m.call(this,a);this.children=this.dropBehavior=this.containerBehavior=null;t.prototype.initObject.call(this,a)};t.prototype=new m;t.prototype.type="BehavioralElement";t.prototype.noDropBehavior=null;t.prototype.containerDropBehavior=
null;t.prototype.connectionDropBehavior=null;t.prototype.connectionContainerDropBehavior=null;t.prototype.noContainerBehavior=null;t.prototype.regularContainerBehavior=null;t.prototype.initObject=function(a){var b={drop:{type:"nodrop",selectors:[],overwrite:!1},container:"nocontainer"};e.extend(!0,b,a);this.setDropBehavior(b.drop.type,b.drop.selectors,b.drop.overwrite);this.setContainerBehavior(b.container);this.children=new D};t.prototype.dropBehaviorFactory=function(a,b){if("nodrop"===a)return this.noDropBehavior||
(this.noDropBehavior=new ra(b)),this.noDropBehavior;if("container"===a)return this.containerDropBehavior||(this.containerDropBehavior=new ka(b)),this.containerDropBehavior;if("connection"===a)return this.connectionDropBehavior||(this.connectionDropBehavior=new V(b)),this.connectionDropBehavior;if("connectioncontainer"===a)return this.connectionContainerDropBehavior||(this.connectionContainerDropBehavior=new la(b)),this.connectionContainerDropBehavior};t.prototype.containerBehaviorFactory=function(a){if("regular"===
a)return this.regularContainerBehavior||(this.regularContainerBehavior=new ja),this.regularContainerBehavior;this.noContainerBehavior||(this.noContainerBehavior=new sa);return this.noContainerBehavior};t.prototype.updateChildrenPosition=function(a,b){var c=this.getChildren(),d,f,l=[],e=[],g=[];for(f=0;f<c.getSize();f+=1)d=c.get(f),0===a&&0===b||this.canvas.currentSelection.contains(d)||(l.push(d),e.push({x:d.x,y:d.y}),g.push({x:d.x+a,y:d.y+b})),d.setPosition(d.x+a,d.y+b);0<l.length&&this.canvas.triggerPositionChangeEvent(l,
e,g);return this};t.prototype.isContainer=function(){return this.containerBehavior&&"NoContainerBehavior"!==this.containerBehavior.type};t.prototype.setContainerBehavior=function(a){e.extend(!0,this.savedOptions,{container:a});this.containerBehavior=this.containerBehaviorFactory(a);return this};t.prototype.addElement=function(a,b,c,d){this.containerBehavior.addToContainer(this,a,b,c,d);return this};t.prototype.removeElement=function(a){this.containerBehavior.removeFromContainer(a);return this};t.prototype.swapElementContainer=
function(a,b,c,d,f){c=c?c:a.getX();d=d?d:a.getY();a.changedContainer=!0;this.removeElement(a);b.addElement(a,c,d,f);return this};t.prototype.getChildren=function(){return this.children};t.prototype.updateDimensions=function(a){"Canvas"!==this.family&&(this.updateSize(a),this.refreshConnections(),J.prototype.updateResizeMinimums(this),t.prototype.updateDimensions.call(this.parent,a));return this};t.prototype.setDropBehavior=function(a,b,c){this.dropBehavior=this.dropBehaviorFactory(a,b);this.dropBehavior.setSelectors(b,
c);this.html&&this.dropBehavior&&(this.dropBehavior.attachDropBehavior(this),e.extend(!0,this.savedOptions.drop,{type:a,overwrite:c}),b&&b.hasOwnProperty("length")&&(this.dropBehavior.updateSelectors(this,b,c),e.extend(!0,this.savedOptions.drop,{selectors:b})));return this};t.prototype.setDropAcceptedSelectors=function(a,b){a&&a.hasOwnProperty("length")&&this.dropBehavior.updateSelectors(this,a,b);return this};t.prototype.updateBehaviors=function(){this.dropBehavior&&(this.dropBehavior.attachDropBehavior(this),
this.dropBehavior.updateSelectors(this));return this};t.prototype.stringify=function(){var a=m.prototype.stringify.call(this);e.extend(!0,a,{container:this.savedOptions.container,drop:this.savedOptions.drop});return a};C=function(a){m.call(this,a);this.visible=this.parent=this.priority=this.layerName=null;this.currentZoomClass="";this.zoomSprites=[];C.prototype.initObject.call(this,a)};C.prototype=new m;C.prototype.type="Layer";C.prototype.initObject=function(a){var b={x:0,y:0,parent:null,layerName:"defaultLayerName",
priority:0,visible:!0,zoomSprites:["","","","",""]};e.extend(!0,b,a);this.setParent(b.parent).setPosition(b.x,b.y).setLayerName(b.layerName).setPriority(b.priority).setVisible(b.visible).setZoomSprites(b.zoomSprites).setProperties()};C.prototype.applyZoom=function(){this.setProperties()};C.prototype.comparisonFunction=function(a,b){return a.priority>b.priority};C.prototype.createHTML=function(a){this.setProperties();m.prototype.createHTML.call(this,a);return this.html};C.prototype.paint=function(){e(this.html);
var a;this.style.removeClasses([this.currentZoomClass]);a=this.zoomSprites[this.canvas.zoomPropertiesIndex];this.style.addClasses([a]);this.currentZoomClass=a;this.style.applyStyle();return this};C.prototype.setProperties=function(){if(!this.parent)return this;this.id=this.parent.getID()+"Layer-"+this.layerName;this.setDimension(this.parent.getWidth(),this.parent.getHeight());this.canvas=this.parent.canvas;return this};C.prototype.getLayerName=function(){return this.layerName};C.prototype.getPriority=
function(){return this.priority};C.prototype.setLayerName=function(a){"string"===typeof a&&""!==a&&(this.layerName=a);return this};C.prototype.setPriority=function(a){"number"===typeof a&&(this.priority=a);return this};C.prototype.setParent=function(a){a&&(this.parent=a);return this};C.prototype.getParent=function(){return this.parent};C.prototype.setZoomSprites=function(a){var b;this.zoomSprites=["","","","",""];for(b=0;b<a.length;b+=1)this.zoomSprites[b]=a[b];return this};C.prototype.stringify=
function(){var a={},b={id:this.getID(),x:this.getX(),y:this.getY(),layerName:this.getLayerName(),priority:this.getPriority(),style:{cssClasses:this.style.getClasses()},zoomSprites:this.zoomSprites};e.extend(!0,a,b);return a};h=function(a){this.xCorners=[0,0,0,0];this.yCorners=[0,0,0,0];this.xMidPoints=[0,0,0,0];this.yMidPoints=[0,0,0,0];this.cornerResizeHandlers=new D;this.midResizeHandlers=new D;t.call(this,a);this.oldParent=this.parent=this.center=null;this.defaultZOrder=1;this.entered=this.wasDragged=
this.dragging=!1;this.resizeBehavior=null;this.repainted=this.resizing=!1;this.fixed=!0;this.topLeftOnCreation=this.changedContainer=!1;h.prototype.initObject.call(this,a)};h.prototype=new t;h.prototype.type="Shape";h.prototype.family="Shape";h.prototype.noDragBehavior=null;h.prototype.regularDragBehavior=null;h.prototype.connectionDragBehavior=null;h.prototype.customShapeDragBehavior=null;h.prototype.cornersIdentifiers=["nw","ne","se","sw"];h.prototype.midPointIdentifiers=["n","e","s","w"];h.prototype.MAX_ZINDEX=
100;h.prototype.DEFAULT_RADIUS=6;h.prototype.initObject=function(a){var b={topLeft:!1,resizeBehavior:"no",resizeHandlers:{type:"None",total:4,resizableStyle:{cssProperties:{"background-color":"rgb(0, 255, 0)",border:"1px solid black"}},nonResizableStyle:{cssProperties:{"background-color":"white",border:"1px solid black"}}},drag:"disabled"};e.extend(!0,b,a);this.resizeBehavior=this.resizeBehaviorFactory(b.resizeBehavior);"disabled"!==b.drag&&this.setDragBehavior(b.drag);this.createHandlers(b.resizeHandlers.type,
b.resizeHandlers.total,b.resizeHandlers.resizableStyle,b.resizeHandlers.nonResizableStyle);this.topLeftOnCreation=b.topLeft};h.prototype.createHandlers=function(a,b,c,d){if("Rectangle"===a){if(!b||8!==b&&4!==b&&0!==b)b=4;for(a=0;a<b&&4>a;a+=1)this.cornerResizeHandlers.insert(new L({parent:this,zOrder:A.MAX_ZINDEX+3,representation:new Q,orientation:this.cornersIdentifiers[a],resizableStyle:c,nonResizableStyle:d}));b-=4;for(a=0;a<b;a+=1)this.midResizeHandlers.insert(new L({parent:this,zOrder:A.MAX_ZINDEX+
3,representation:new Q,orientation:this.midPointIdentifiers[a],resizableStyle:c,nonResizableStyle:d}))}return this};h.prototype.updateHandlers=function(){var a,b;for(b=0;b<this.cornerResizeHandlers.getSize();b+=1)a=this.cornerResizeHandlers.get(b),a.setPosition(this.xCorners[b]-Math.round(a.width/2)-1,this.yCorners[b]-Math.round(a.height/2)-1);for(b=0;b<this.midResizeHandlers.getSize();b+=1)a=this.midResizeHandlers.get(b),a.setPosition(this.xMidPoints[b]-Math.round(a.width/2)-1,this.yMidPoints[b]-
Math.round(a.height/2)-1);return this};h.prototype.showOrHideResizeHandlers=function(a){var b;a||(a=!1);for(b=0;b<this.cornerResizeHandlers.getSize();b+=1)this.cornerResizeHandlers.get(b).setVisible(a);for(b=0;b<this.midResizeHandlers.getSize();b+=1)this.midResizeHandlers.get(b).setVisible(a);return this};h.prototype.applyStyleToHandlers=function(a){var b;for(b=0;b<this.cornerResizeHandlers.getSize();b+=1)this.cornerResizeHandlers.get(b)[a].applyStyle();for(b=0;b<this.midResizeHandlers.getSize();b+=
1)this.midResizeHandlers.get(b)[a].applyStyle();return this};h.prototype.attachListeners=function(){var a=e(this.html);a.on("mousedown",this.onMouseDown(this));a.on("mouseup",this.onMouseUp(this));a.on("click",this.onClick(this));this.updateBehaviors();return this};h.prototype.onMouseDown=function(a){return function(a,c){}};h.prototype.onMouseUp=function(a){return function(a,c){}};h.prototype.onClick=function(a){return function(a,c){}};h.prototype.createHTML=function(){var a;t.prototype.createHTML.call(this);
for(a=0;a<this.cornerResizeHandlers.getSize();a+=1)this.addResizeHandler(this.cornerResizeHandlers.get(a),this.xCorners[a],this.yCorners[a]);for(a=0;a<this.midResizeHandlers.getSize();a+=1)this.addResizeHandler(this.midResizeHandlers.get(a),this.xMidPoints[a],this.yMidPoints[a]);return this.html};h.prototype.dragBehaviorFactory=function(a){if("regular"===a)return this.regularDragBehavior||(this.regularDragBehavior=new aa),this.regularDragBehavior;if("connection"===a)return this.connectionDragBehavior||
(this.connectionDragBehavior=new fa),this.connectionDragBehavior;if("customshapedrag"===a)return this.customShapeDragBehavior||(this.customShapeDragBehavior=new I),this.customShapeDragBehavior;this.noDragBehavior||(this.noDragBehavior=new qa);return this.noDragBehavior};h.prototype.isDraggable=function(){return this.dragBehavior&&"NoDragBehavior"!==this.dragBehavior.type};h.prototype.setDragBehavior=function(a){this.dragBehavior=this.dragBehaviorFactory(a);this.html&&this.dragBehavior&&this.dragBehavior.attachDragBehavior(this);
return this};h.prototype.updateBehaviors=function(){t.prototype.updateBehaviors.call(this);this.dragBehavior&&this.dragBehavior.attachDragBehavior(this);this.resizeBehavior&&this.resizeBehavior.init(this);return this};h.prototype.addResizeHandler=function(a,b,c){if(this.html)return this.html.appendChild(a.getHTML()),a.setPosition(b-Math.round(a.width/2)-1,c-Math.round(a.height/2)-1),a.setCategory("resizable"),this};h.prototype.paint=function(){var a;for(a=0;a<this.cornerResizeHandlers.getSize();a+=
1)this.cornerResizeHandlers.get(a).paint();for(a=0;a<this.midResizeHandlers.getSize();a+=1)this.midResizeHandlers.get(a).paint();this.resizeBehavior&&(a="NoResizeBehavior"===this.resizeBehavior.type?"nonResizableStyle":"resizableStyle",this.applyStyleToHandlers(a));return this};h.prototype.updateHTML=function(){return this};h.prototype.saveAndDestroy=function(){this.html=e(this.html).detach()[0];this.canvas.removeFromList(this);return this};h.prototype.updateSize=function(a){var b=this.children.getDimensionLimit(),
c=b[3],d=b[0],f=b[1],b=b[2],l=this.getX(),e=this.getY(),g=this.getWidth(),h=this.getHeight(),k=0,m=0,n=!1,p=!1;a="undefined"!==a?a:15;0>c&&(k=a-c,n=!0,this.oldAbsoluteX=this.oldX=this.x,this.oldY=this.y,this.oldAbsoluteY=this.absoluteY);0>d&&(m=a-d,n=!0,this.oldAbsoluteX=this.oldX=this.x,this.oldY=this.y,this.oldAbsoluteY=this.absoluteY);g+=k;h+=m;f>this.width&&(g+=f-this.width+a,p=!0,this.oldWidth=this.width);b>this.height&&(h+=b-this.height+a,p=!0,this.oldHeight=this.height);this.setPosition(l-
k,e-m);this.setDimension(g,h);n&&this.changePosition(this.oldX,this.oldY,this.absoluteX,this.absoluteY);p&&this.changeSize(this.oldWidth,this.oldHeight);this.updateChildrenPosition(k,m);return this};h.prototype.applyZoom=function(){this.refreshShape();return this};h.prototype.setDimension=function(a,b){t.prototype.setDimension.call(this,a,b);this.xCorners&&(this.xCorners=[0,Math.round(this.zoomWidth),Math.round(this.zoomWidth),0],this.yCorners=[0,0,Math.round(this.zoomHeight),Math.round(this.zoomHeight)],
this.xMidPoints=[Math.round(this.zoomWidth/2),Math.round(this.zoomWidth),Math.round(this.zoomWidth/2),0],this.yMidPoints=[0,Math.round(this.zoomHeight/2),Math.round(this.zoomHeight),Math.round(this.zoomHeight/2)],this.updateHandlers());return this};h.prototype.changeParent=function(a,b,c,d,f,l){l.updatedElement={id:this.id,type:this.type,fields:[{field:"x",oldVal:a,newVal:this.x},{field:"y",oldVal:b,newVal:this.y},{field:"absoluteX",oldVal:c,newVal:this.absoluteX},{field:"absoluteY",oldVal:d,newVal:this.absoluteY},
{field:"parent",oldVal:f,newVal:this.parent}],relatedObject:this};e(l.html).trigger("changeelement");return this};h.prototype.changeSize=function(a,b){var c=this.canvas;c.updatedElement={id:this.id,type:this.type,fields:[{field:"width",oldVal:a,newVal:this.width},{field:"height",oldVal:b,newVal:this.height}],relatedObject:this};e(c.html).trigger("changeelement");return this};h.prototype.changePosition=function(a,b,c,d){c=this.canvas;c.updatedElement=[{id:this.id,type:this.type,fields:[{field:"x",
oldVal:a,newVal:this.x},{field:"y",oldVal:b,newVal:this.y}],relatedObject:this}];e(c.html).trigger("changeelement");return this};h.prototype.setFixed=function(a){"boolean"===typeof a&&(this.fixed=a);return this};h.prototype.fixZIndex=function(a,b){var c,d,f,l;a.setZOrder(parseInt(a.parent.html.style.zIndex,10)+b+parseInt(a.defaultZOrder,10));for(c=0;c<a.children.getSize();c+=1)d=a.children.get(c),d.fixZIndex(d,0);if(a.ports)for(c=0;c<a.ports.getSize();c+=1)d=a.ports.get(c),f=d.connection.srcPort.parent,
l=d.connection.destPort.parent,f=parseInt(f.html.style.zIndex,10),l=parseInt(l.html.style.zIndex,10),d.connection.style.addProperties({zIndex:Math.max(f+1,l+1)});return this};h.prototype.increaseZIndex=function(){this.fixZIndex(this,A.MAX_ZINDEX);return this};h.prototype.decreaseZIndex=function(){this.fixZIndex(this,0);return this};h.prototype.increaseParentZIndex=function(a){"Canvas"!==a.family&&(a.style.addProperties({zIndex:parseInt(a.html.style.zIndex,10)+1}),a.increaseParentZIndex(a.parent));
return this};h.prototype.decreaseParentZIndex=function(a){a&&"Canvas"!==a.family&&(a.style.addProperties({zIndex:parseInt(a.html.style.zIndex,10)-1}),a.decreaseParentZIndex(a.parent));return this};h.prototype.resizeBehaviorFactory=function(a){if("NoResize"===a||"no"===a)return new na;if("Resize"===a||"yes"===a)return new ba;throw Error("resizeBehaviorFactory(): parameter is not valid");};h.prototype.setResizeBehavior=function(a){this.html&&a&&(this.resizeBehavior=this.resizeBehaviorFactory(a),this.resizeBehavior.init(this));
return this};h.prototype.isResizable=function(){return this.resizeBehavior&&"NoResizeBehavior"!==this.resizeBehavior.type};h.prototype.refreshShape=function(){this.setPosition(this.x,this.y).setDimension(this.width,this.height);return this};h.prototype.refreshConnections=function(){return this};h.prototype.refreshChildrenPositions=function(a){var b,c=this.children,d,f=[],l=[];for(b=0;b<c.getSize();b+=1)d=c.get(b),d.setPosition(d.getX(),d.getY()),a&&d.refreshConnections(!1),f.push(d),l.push({x:d.getX(),
y:d.getY()}),d.refreshChildrenPositions(a);this.canvas.triggerPositionChangeEvent(f,l,l);return this};h.prototype.fixConnectionsOnResize=function(a,b){var c,d,f;if(b){if(this.ports)for(c=0;c<this.ports.getSize();c+=1)d=this.ports.get(c),f=d.connection,this.recalculatePortPosition(d),f.disconnect().connect(),this.resizing||(f.setSegmentMoveHandlers(),f.checkAndCreateIntersectionsWithAll())}else if(this.ports)for(c=0;c<this.ports.getSize();c+=1)d=this.ports.get(c),f=d.connection,d.setPosition(d.x,d.y),
f.disconnect().connect(),this.resizing||(f.setSegmentMoveHandlers(),f.checkAndCreateIntersectionsWithAll());for(c=0;c<this.children.getSize();c+=1)d=this.children.get(c),d.setPosition(d.x,d.y),d.fixConnectionsOnResize(d.resizing,!1);return this};h.prototype.stringify=function(){var a=t.prototype.stringify.call(this);e.extend(!0,a,{resizeBehavior:this.savedOptions.resizeBehavior,resizeHandlers:{type:this.savedOptions.resizeHandlers&&this.savedOptions.resizeHandlers.type||"Rectangle",total:this.savedOptions.resizeHandlers&&
this.savedOptions.resizeHandlers.total||4}});return a};h.prototype.setCenter=function(a){if(a instanceof k)this.center=a;else throw Error("setCenter(): argument is not an instance of Point");return this};h.prototype.setParent=function(a,b){a&&(this.canvas&&b&&(this.canvas.updatedElement={id:this.id,type:this.type,fields:[{field:"parent",oldVal:this.parent,newVal:a}]},e(this.canvas.html).trigger("changeelement")),this.parent=a);return this};h.prototype.setOldParent=function(a){this.oldParent=a;return this};
h.prototype.getCenter=function(){return this.center};h.prototype.getParent=function(){return this.parent};h.prototype.getOldParent=function(){return this.oldParent};h.prototype.getHandlesIDs=function(){var a={},b;for(b=0;b<this.midPointIdentifiers.length;b+=1)a[this.midPointIdentifiers[b]]="#"+this.midPointIdentifiers[b]+this.id+"resizehandler";for(b=0;b<this.cornersIdentifiers.length;b+=1)a[this.cornersIdentifiers[b]]="#"+this.cornersIdentifiers[b]+this.id+"resizehandler";return a};v=function(a){h.call(this,
a);this.yPercentage=this.xPercentage=0;this.orientation=this.message="";this.text=null;this.onFocus=this.overflow=this.updateParent=!1;this.location="";this.diffY=this.diffX=0;this.fontSizeOnZoom=[];this.fontSize=0;this.textField=null;v.prototype.initObject.call(this,a)};v.prototype=new h;v.prototype.type="Label";v.prototype.lineHeight=20;v.prototype.initObject=function(a){var b={message:"New Label",orientation:"horizontal",fontFamily:"arial",size:0,position:{location:"none",diffX:0,diffY:0},overflow:!1,
updateParent:!1,parent:null,updateParentOnLoad:!0};this.fontSizeOnZoom=[6,8,10,13,15];e.extend(!0,b,a);this.setMessage(b.message).setOverflow(b.overflow).setUpdateParent(b.updateParent).setOrientation(b.orientation).setFontFamily(b.fontFamily).setFontSize(b.size).setParent(b.parent).updateDimension().setLabelPosition(b.position.location,b.position.diffX,b.position.diffY).setUpdateParentOnLoad(b.updateParentOnLoad)};v.prototype.attachListeners=function(){var a=e(this.html);if(!this.html)return this;
h.prototype.attachListeners.call(this);e(this.textField).on("keydown",function(a){a.stopPropagation()});a.on("dblclick",this.onDblClick(this));return this};v.prototype.createHTML=function(){h.prototype.createHTML.call(this);this.html.style.textAlign="center";this.html.style.align="center";this.html.style.fontFamily=this.fontFamily;this.html.style.fontSize=this.fontSize+"pt";this.textField=document.createElement("input");this.textField.style.width="200px";this.textField.style.position="absolute";this.textField.style.display=
"none";this.text=document.createElement("span");this.text.style.width="auto";this.text.style.height="auto";this.text.style.lineHeight=this.lineHeight*this.canvas.zoomFactor+"px";this.text.innerHTML=this.message;this.html.appendChild(this.text);this.html.appendChild(this.textField);this.html.style.zIndex=2;return this.html};v.prototype.paint=function(){var a=e(this.text);this.text.style.lineHeight=this.lineHeight*this.canvas.zoomFactor+"px";this.textField.value=this.message;this.text.innerHTML=this.message;
this.html.style.verticalAlign="middle";this.html.style.overflow=this.overflow?"hidden":"none";this.displayText(!0);"vertical"===this.orientation?a.addClass("rotateText"):a.removeClass("rotateText");return this};v.prototype.displayText=function(a){a?(this.text.style.display="block",this.textField.style.display="none","vertical"===this.orientation&&(this.textField.style.left="0px")):(this.textField.style.display="block","vertical"===this.orientation&&(this.textField.style.left=this.width/2-100+"px"),
this.text.style.display="none");return this};v.prototype.setMessage=function(a){this.message=a;this.text&&(this.text.innerHTML=this.message);return this};v.prototype.getMessage=function(){return this.message};v.prototype.setOrientation=function(a){var b;this.orientation=a;if(!this.html)return this;b=e(this.text);"vertical"===a?b.addClass("rotateText"):b.removeClass("rotateText");return this};v.prototype.getOrientation=function(){return this.orientation};v.prototype.setFontFamily=function(a){this.fontFamily=
a;this.html&&(this.html.style.fontFamily=this.fontFamily);return this};v.prototype.setFontSize=function(a){this.fontSize=0===a?this.getZoomFontSize():a;this.html&&(this.html.style.fontSize=this.fontSize+"pt");return this};v.prototype.setUpdateParent=function(a){this.updateParent=a;return this};v.prototype.setOverflow=function(a){this.overflow=a;return this};v.prototype.setLabelPosition=function(a,b,c){var d;d=this.zoomWidth;var f=this.zoomHeight,l=this.parent,e,g=this.canvas.zoomFactor,h=4*g,k="top-left top top-right center-left center center-right bottom-left bottom bottom-right".split(" ");
a&&""!==a||(a="top-left");if(void 0===b||null===b)b=0;if(void 0===c||null===c)c=0;if(l&&"Canvas"!==l.family)for(e=l.getZoomWidth(),l=l.getZoomHeight(),f=[{x:-d/2,y:0},{x:e/2-d/2,y:0},{x:e-d/2,y:0},{x:-d/2,y:l/2-f/2},{x:e/2-d/2,y:l/2-f/2},{x:e-d,y:l/2-f/2},{x:-d/2,y:l-h},{x:e/2-d/2,y:l-h},{x:e-d/2,y:l-h}],d=0;9>d;d+=1)if(a===k[d]){this.setPosition(f[d].x/g+b,f[d].y/g+c);break}this.location=a;this.diffX=b;this.diffY=c;return this};v.prototype.setUpdateParentOnLoad=function(a){this.updateParentOnLoad=
a;return this};v.prototype.getFocus=function(){var a=e(this.textField.html);this.displayText(!1);this.canvas.currentLabel=this;e(a).select();this.onFocus=!0;return this};v.prototype.loseFocus=function(){var a;this.canvas.currentLabel=null;this.textField.value!==this.message&&(a=new Z(this,this.textField.value),a.execute(),this.canvas.commandStack.add(a),this.setLabelPosition(this.location,this.diffX,this.diffY));this.paint();this.onFocus=!1;return this};v.prototype.onMouseDown=function(a){return function(b,
c){"Canvas"===a.parent.family&&b.stopPropagation()}};v.prototype.onClick=function(a){return function(b,c){"Canvas"===a.parent.family&&b.stopPropagation();a.onFocus&&b.stopPropagation()}};v.prototype.onDblClick=function(a){return function(b,c){var d=a.getCanvas();e(a.html);d.currentLabel&&d.currentLabel.loseFocus();a.getFocus()}};v.prototype.getZoomFontSize=function(){return this.fontSize=this.fontSizeOnZoom[this.canvas.zoomPropertiesIndex]};v.prototype.parseMessage=function(){var a;a=0;for(var b=
[],c;" "===this.message.charAt(a);)a+=1;for(c=0;a<this.message.length;a+=1)" "===this.message.charAt(a)?(b.push(c),c=0):c+=1;b.push(c);return b};v.prototype.updateDimension=function(a){a=e(this.text).width();var b;a=Math.max(a,this.zoomWidth);b=e(this.text).height();this.setDimension(a/this.canvas.zoomFactor,b/this.canvas.zoomFactor);this.updateParent&&this.updateParentDimension();return this};v.prototype.applyZoom=function(){this.setFontSize(0);this.paint();return this};v.prototype.updateParentDimension=
function(){"vertical"===this.orientation?this.updateVertically():this.updateHorizontally();this.parent.html&&this.parent.paint();return this};v.prototype.updateVertically=function(){var a=this.parent,b=this.zoomWidth;a.setDimension(a.width,(b>a.zoomHeight-10?b+10:a.zoomHeight)/this.canvas.zoomFactor);a.updateChildrenPosition(0,0);a.refreshConnections();this.setLabelPosition(this.location,this.diffX,this.diffY);return this};v.prototype.updateHorizontally=function(){var a=this.parent,b=this.zoomWidth,
c=this.zoomHeight,d=this.canvas.zoomFactor,b=b>a.zoomWidth-10?b+10:a.zoomWidth,c=c>a.zoomHeight-10?c+10:a.zoomHeight;this.updateParentOnLoad?a.setDimension(b/d,c/d):this.updateParentOnLoad=!0;a.fixConnectionsOnResize(a.resizing,!0);a.refreshConnections();this.setLabelPosition(this.location,this.diffX,this.diffY);return this};v.prototype.stringify=function(){var a={},b={id:this.getID(),message:this.getMessage(),orientation:this.getOrientation(),position:{location:this.location,diffX:this.diffX,diffY:this.diffY}};
e.extend(!0,a,b);return a};n=function(a){this.layers=new D;h.call(this,a);this.ports=new D;this.labels=new D;this.zoomProperties=new D;this.limits=[0,0,0,0];this.border=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];this.dragType=this.CANCEL;this.connectAtMiddlePoints=this.startConnectionPoint=null;this.previousYDragPosition=this.previousXDragPosition=0;this.connectionType=null;n.prototype.initObject.call(this,a)};n.prototype=new h;n.prototype.type="CustomShape";n.prototype.family="CustomShape";n.prototype.containerDropBehavior=
null;n.prototype.connectionDropBehavior=null;n.prototype.noDropBehavior=null;n.prototype.CONNECT=1;n.prototype.DRAG=2;n.prototype.CANCEL=0;n.prototype.initObject=function(a){var b={connectAtMiddlePoints:!0,layers:[],labels:[],connectionType:"regular"};this.limits=[5,5,5,5,5];this.setStartConnectionPoint(new k(0,0));e.extend(!0,b,a);for(a=0;a<b.layers.length;a+=1)this.createLayer(b.layers[a]);for(a=0;a<b.labels.length;a+=1)this.createLabel(b.labels[a]);this.setConnectAtMiddlePoints(b.connectAtMiddlePoints).setConnectionType(b.connectionType)};
n.prototype.createLayer=function(a){a.parent=this;a=new C(a);this.addLayer(a);return a};n.prototype.createLabel=function(a){a.canvas=this.canvas;a.parent=this;0===a.width&&(a.width=.9*this.width);a=new v(a);this.addLabel(a);return a};n.prototype.addLabel=function(a){this.html&&(a.parent=this,this.html.appendChild(a.getHTML()));this.labels.contains(a)||this.labels.insert(a)};n.prototype.createHTML=function(){var a,b;h.prototype.createHTML.call(this);this.style.addClasses(["custom_shape"]);this.layers.sort(C.prototype.comparisonFunction);
for(a=0;a<this.layers.getSize();a+=1)this.html.appendChild(this.layers.get(a).getHTML());for(a=0;a<this.labels.getSize();a+=1)b=this.labels.get(a),this.addLabel(b),b.attachListeners();return this.html};n.prototype.attachListeners=function(){if(null===this.html)return this;var a=e(this.html).click(this.onClick(this));a.on("mousedown",this.onMouseDown(this));a.mousemove(this.onMouseMove(this));a.mouseup(this.onMouseUp(this));a.on("contextmenu",function(a){a.preventDefault()});this.updateBehaviors();
return this};n.prototype.paint=function(){var a,b;h.prototype.paint.call(this);for(a=0;a<this.layers.getSize();a+=1)this.layers.get(a).paint();for(a=0;a<this.ports.getSize();a+=1)this.ports.get(a).paint();for(a=0;a<this.labels.getSize();a+=1)b=this.labels.get(a),b.paint();return this};n.prototype.updateHTML=function(){var a,b;this.setDimension(this.width,this.height);for(a=0;a<this.labels.getSize();a+=1)b=this.labels.get(a),b.paint(),b.updateDimension();return this};n.prototype.refreshConnections=
function(a,b,c){var d,f,e=this.ports;for(d=0;d<e.getSize();d+=1)f=e.get(d),f.setPosition(f.getX(),f.getY()),f=f.connection,b||f.disconnect(a).connect(a),f.setSegmentMoveHandlers().checkAndCreateIntersectionsWithAll(),c||this.canvas.triggerConnectionStateChangeEvent(f);return this};n.prototype.updateLayers=function(){var a,b;for(a=0;a<this.getLayers().getSize();a+=1)b=this.getLayers().get(a),b.setProperties();return this};n.prototype.findLayerPosition=function(a){var b=null,c=1E7,d,f,e;for(d=0;d<this.layers.getSize();d+=
1)f=this.layers.get(d),e=f.getPriority(),e>a.getPriority()&&c>e&&(c=e,b=f);return b};n.prototype.addLayer=function(a){var b=this.findLayerPosition(a);this.html&&(b?this.html.insertBefore(a.getHTML(),b.getHTML()):this.html.appendChild(a.getHTML()),a.paint());this.layers.insert(a);return this};n.prototype.findLayer=function(a){return this.layers.find("id",a)};n.prototype.setDimension=function(a,b){h.prototype.setDimension.call(this,a,b);this.updateLabels();this.updateLayers();return this};n.prototype.updateLabels=
function(){};n.prototype.hideLayer=function(a){if(!a||"string"!==typeof a)return this;a=this.findLayer(a);if(!a)return this;a.setVisible(!1);return this};n.prototype.showLayer=function(a){if(!a||"string"!==typeof a)return this;a=this.findLayer(a);if(!a)return this;a.setVisible(!0);return this};n.prototype.addPort=function(a,b,c,d,f){b=new k(b,c);a.setParent(this);a.setCanvas(this.canvas);this.definePortPosition(a,b,f);this.html.appendChild(a.getHTML());a.paint();this.ports.insert(a);return this};
n.prototype.removePort=function(a){this.ports.remove(a);return this};n.prototype.definePortPosition=function(a,b,c){var d=[this.TOP,this.RIGHT,this.BOTTOM,this.LEFT],f=[new k(Math.round(this.zoomWidth/2),0),new k(this.zoomWidth,Math.round(this.zoomHeight/2)),new k(Math.round(this.zoomWidth/2),this.zoomHeight),new k(0,Math.round(this.zoomHeight/2))],e=[new k(b.x,0),new k(this.getZoomWidth(),b.y),new k(b.x,this.getZoomHeight()),new k(0,b.y)],g,h,m,n=[-1,1,1,-1],p=[0,0,-2,0],r=[0,-2,0,0],f=this.connectAtMiddlePoints?
f:e;m="getSquaredDistance";c&&this.connectAtMiddlePoints&&(m="getManhattanDistance");c=void 0;h=Infinity;for(e=0;e<f.length;e+=1)g=b[m](f[e]),h>g&&(h=g,c=d[e]);b=this.getBorderConsideringLayers();for(e=0;4>e;e+=1)this.border[e].x=b*n[e]+b*p[e],this.border[e].y=b*n[e]+b*r[e];a.setDirection(c);a.setPosition(f[c].x-a.getWidth()/2,f[c].y-a.getHeight()/2);a.applyBorderMargin(!0);a.determinePercentage();return this};n.prototype.getBorderConsideringLayers=function(){var a=parseInt(this.style.getProperty("borderTopWidth")||
0,10),b,c;for(c=0;c<this.getLayers().getSize();c+=1)b=this.getLayers().get(c),a=Math.max(a,parseInt(b.style.getProperty("borderTopWidth")||0,10));return a};n.prototype.showPorts=function(){var a;for(a=0;a<this.ports.getSize();a+=1)this.ports.get(a).show();return this};n.prototype.hidePorts=function(){var a;for(a=0;a<this.ports.getSize();a+=1)this.ports.get(a).hide();return this};n.prototype.updatePortsPosition=function(a,b){var c,d,f=this.ports;for(c=0;c<f.getSize();c+=1)d=f.get(c),d.direction===
this.RIGHT||d.direction===this.BOTTOM?(d.oldX=d.x,d.oldY=d.y,d.oldAbsoluteX=d.absoluteX,d.oldAbsoluteY=d.absoluteY,d.setPosition(d.x+a,d.y+b,!0),d.changePosition(d.oldX,d.oldY,d.oldAbsoluteX,d.oldAbsoluteY)):d.setPosition(d.x,d.y,!0),d.connection.disconnect().connect(),d.connection.setSegmentMoveHandlers();return this};n.prototype.recalculatePortPosition=function(a){var b=Math.round(a.percentage*a.parent.getZoomWidth()/100),c=Math.round(a.percentage*a.parent.getZoomHeight()/100),b=[b,a.parent.getZoomWidth(),
b,0],c=[0,c,a.parent.getZoomHeight(),c];this.connectAtMiddlePoints&&(b=[a.parent.getZoomWidth()/2,a.parent.getZoomWidth(),a.parent.getZoomWidth()/2,0],c=[0,a.parent.getZoomHeight()/2,a.parent.getZoomHeight(),a.parent.getZoomHeight()/2]);a.setPosition(this.border[a.direction].x+b[a.direction]-Math.round(a.width/2),this.border[a.direction].y+c[a.direction]-Math.round(a.height/2));return this};n.prototype.initPortsChange=function(){var a,b=this.ports,c;for(a=0;a<b.getSize();a+=1)c=b.get(a),c.oldX=c.x,
c.oldY=c.y,c.oldAbsoluteX=c.absoluteX,c.oldAbsoluteY=c.absoluteY;return this};n.prototype.firePortsChange=function(){var a,b=this.ports,c;for(a=0;a<b.getSize();a+=1)c=b.get(a),h.prototype.changePosition.call(this,c.oldX,c.oldY,c.oldAbsoluteX,c.oldAbsoluteY);return this};n.prototype.refreshShape=function(){h.prototype.refreshShape.call(this);this.updatePortsOnZoom().refreshConnections(!1,!1,!0);this.paint();return this};n.prototype.updatePortsOnZoom=function(){var a,b=this.ports,c,d=this.canvas.zoomFactor,
f=(25*this.canvas.prevZoom+50)/100;a=0<b.getSize()?b.get(0).width/2:0;var e,g=[this.zoomWidth/2-a,this.zoomWidth-a,this.zoomWidth/2-a,-a],h=[-a,this.zoomHeight/2-a,this.zoomHeight-a,this.zoomHeight/2-a];for(a=0;a<b.getSize();a+=1)c=b.get(a),c.applyBorderMargin(!1),this.connectAtMiddlePoints||(g=[c.x/f*d,this.getZoomWidth()-c.getZoomWidth()/2,c.x/f*d,c.x],h=[c.y,c.y/f*d,this.getZoomHeight()-c.getZoomHeight()/2,c.y/f*d]),c.setPosition(Math.round(g[c.direction]),Math.round(h[c.direction])),c.applyBorderMargin(!0),
e=c.connection.srcDecorator,c=c.connection.destDecorator,e&&e.applyZoom(),c&&c.applyZoom();return this};n.prototype.calculateLabelsPercentage=function(){var a,b;for(a=0;a<this.labels.getSize();a+=1)b=this.labels.get(a),b.xPercentage=b.getX()/this.getWidth(),b.yPercentage=b.getY()/this.getHeight()};n.prototype.updateLabelsPosition=function(){var a,b;for(a=0;a<this.labels.getSize();a+=1)b=this.labels.get(a),b.setLabelPosition(b.location,b.diffX,b.diffY);return this};n.prototype.determineDragBehavior=
function(a){var b=this.limits[this.canvas.zoomPropertiesIndex],c=parseInt(this.style.getProperty("border")||0,10);return O.pointInRectangle(a,new k(0,0),new k(this.zoomWidth+2*c,this.zoomHeight+2*c))?O.pointInRectangle(a,new k(c+b,c+b),new k(this.zoomWidth+c-b,this.zoomHeight+c-b))?this.DRAG:this.CONNECT:this.CANCEL};n.prototype.createDragHelper=function(){var a=document.createElement("div");a.style.width="8px";a.style.height="8px";a.style.backgroundColor="black";a.style.zIndex=2*h.prototype.MAX_ZINDEX;
a.id="drag-helper";a.className="drag-helper";return a};n.prototype.onMouseDown=function(a){return function(b,c){var d=a.canvas;3===b.which?e(d.html).trigger("rightclick",[b,a]):(a.dragType===a.DRAG?a.setDragBehavior("customshapedrag"):a.dragType===a.CONNECT?a.setDragBehavior("connection"):a.setDragBehavior("nodrag"),a.dragging=!0);b.stopPropagation()}};n.prototype.onMouseUp=function(a){return function(b,c){a.dragging=!1}};n.prototype.onMouseMove=function(a){return function(b,c){var d,f;a.dragging||
a.entered||(d=e(a.html),f=a.getCanvas(),a.startConnectionPoint.x=b.pageX-f.getX()-a.absoluteX+f.getLeftScroll(),a.startConnectionPoint.y=b.pageY-f.getY()-a.absoluteY+f.getTopScroll(),a.dragType=a.determineDragBehavior(a.startConnectionPoint),a.dragType===a.DRAG?d.css("cursor","move"):a.dragType===a.CONNECT?d.css("cursor","crosshair"):d.css("cursor","default"))}};n.prototype.onClick=function(a){return function(b,c){var d=!1,f=a.canvas,l=f.currentSelection,g=f.currentLabel;b.ctrlKey&&(d=!0);a.canvas.hideCurrentConnection();
3===b.which?(b.preventDefault(),a.canvas.triggerRightClickEvent(a)):(a.wasDragged||(d?l.contains(a)?f.removeFromSelection(a):f.addToSelection(a):(f.emptyCurrentSelection(),f.addToSelection(a))),l.isEmpty()||f.triggerSelectEvent(l.asArray()));this.helper&&e(this.helper.html).remove();g&&(g.loseFocus(),e(g.textField).focusout());a.wasDragged=!1;b.stopPropagation()}};n.prototype.parseHook=function(){};n.prototype.getPorts=function(){return this.ports};n.prototype.getLayers=function(){return this.layers};
n.prototype.getLabels=function(){return this.labels};n.prototype.applyZoom=function(){var a,b;h.prototype.applyZoom.call(this);for(a=0;a<this.layers.getSize();a+=1)this.layers.get(a).applyZoom();for(a=0;a<this.labels.getSize();a+=1)b=this.labels.get(a),b.applyZoom(),b.setLabelPosition(b.location,b.diffX,b.diffY);return this};n.prototype.setStartConnectionPoint=function(a){this.startConnectionPoint=a;return this};n.prototype.setConnectAtMiddlePoints=function(a){this.connectAtMiddlePoints=a;return this};
n.prototype.getConnectAtMiddlePoints=function(){return this.connectAtMiddlePoints};n.prototype.setConnectionType=function(a){this.connectionType=a;return this};n.prototype.getConnectionType=function(){return this.connectionType};n.prototype.stringify=function(){var a=[],b=[],c;for(c=0;c<this.layers.getSize();c+=1)a.push(this.layers.get(c).stringify());for(c=0;c<this.labels.getSize();c+=1)b.push(this.labels.get(c).stringify());c=h.prototype.stringify.call(this);a={canvas:this.canvas.getID(),layers:a,
labels:b,connectAtMiddlePoints:this.getConnectAtMiddlePoints(),connectionType:this.getConnectionType(),parent:this.parent.getID()};e.extend(!0,c,a);return c};n.prototype.parseJSON=function(a){this.initObject(a);return this};w=function(a){m.call(this,a);this.endPoint=this.startPoint=this.parent=null;this.zOrder=h.prototype.MAX_ZINDEX;this.nextNeighbor=this.previousNeighbor=null;this.orientation="";this.width=1;this.moveHandler=this.segmentColor=this.segmentStyle=this.customLine=null;this.intersections=
new D;this.hasMoveHandler=!1;w.prototype.initObject.call(this,a)};w.prototype=new m;w.prototype.type="Segment";w.prototype.initObject=function(a){var b={startPoint:new k(0,0),endPoint:new k(0,0),parent:null,color:new B(0,0,0)};e.extend(!0,b,a);this.setStartPoint(b.startPoint).setEndPoint(b.endPoint).setColor(b.color).setParent(b.parent)};w.prototype.createHTML=function(){this.html=document.createElement("div");this.html.id=this.id;this.html.style.position="absolute";this.html.style.left="0px";this.html.style.top=
"0px";this.html.style.height="0px";this.html.style.width="0px";this.html.style.zIndex=this.zOrder;return this.html};w.prototype.paint=function(){if(null===this.getHTML())return this;null===this.customLine&&(this.customLine=new CustomLine({canvas:this.html}));this.customLine.drawLine(this.startPoint.x,this.startPoint.y,this.endPoint.x,this.endPoint.y);this.parent.html.appendChild(this.html);return this};w.prototype.destroy=function(){e(this.html).remove();return this};w.prototype.paintWithIntersections=
function(){this.destroy();var a,b,c,d,f=!1;if(null===this.getHTML())return this;null===this.customLine&&(this.customLine=new CustomLine({canvas:this.html}));this.hasMoveHandler&&(e(this.moveHandler.html).remove(),this.addSegmentMoveHandler());this.orientation===this.HORIZONTAL?(c=new k(h.prototype.DEFAULT_RADIUS,0),this.startPoint.x>this.endPoint.x&&(f=!0),this.intersections.sort(function(a,b){return a.center.x>=b.center.x})):(c=new k(0,h.prototype.DEFAULT_RADIUS),this.startPoint.y>this.endPoint.y&&
(f=!0),this.intersections.sort(function(a,b){return a.center.y>=b.center.y}));this.customLine.clear();a=this.startPoint.clone();for(d=0;d<this.intersections.getSize();d+=1)b=f?this.intersections.get(this.intersections.getSize()-d-1).center:this.intersections.get(d).center,b=f?b.add(c):b.subtract(c),this.customLine.drawLine(a.x,a.y,b.x,b.y),a=f?b.subtract(c.multiply(2)):b.add(c.multiply(2));b=this.endPoint.clone();this.customLine.drawLine(a.x,a.y,b.x,b.y);this.parent.html.appendChild(this.html);return this};
w.prototype.addSegmentMoveHandler=function(){var a=(this.startPoint.x+this.endPoint.x)/2,b=(this.startPoint.y+this.endPoint.y)/2;this.moveHandler=new M({parent:this,orientation:this.orientation,style:{cssProperties:{border:"1px solid black"}}});a-=this.moveHandler.width/2;b-=this.moveHandler.height/2;this.moveHandler.setPosition(a,b);this.html.appendChild(this.moveHandler.getHTML());this.moveHandler.paint();this.moveHandler.attachListeners(this.moveHandler);return this};w.prototype.getParent=function(){return this.parent};
w.prototype.getStartPoint=function(){return this.startPoint};w.prototype.getEndPoint=function(){return this.endPoint};w.prototype.setParent=function(a){this.parent=a;return this};w.prototype.setStartPoint=function(a){this.startPoint=a;return this};w.prototype.setEndPoint=function(a){this.endPoint=a;return this};w.prototype.setStyle=function(a){this.segmentStyle=a;return this};w.prototype.setColor=function(a){this.segmentColor=a;return this};w.prototype.createIntersectionWith=function(a,b){var c,d,
f=!0;c=b?b:O.segmentIntersectionPoint(this.startPoint,this.endPoint,a.startPoint,a.endPoint);for(d=0;d<this.intersections.getSize();d+=1)b.equals(this.intersections.get(d).center)&&(f=!1);f&&(c=new ma(c,a.parent.getID(),this),this.html.appendChild(c.getHTML()),c.paint(),this.intersections.insert(c));return this};w.prototype.clearIntersections=function(){for(var a,b=this.intersections.getSize();0<b;)a=this.intersections.get(b-1),e(a.html).remove(),this.intersections.popLast(),b-=1;return this};w.prototype.moveSegment=
function(a,b){var c=this.moveHandler,d=this.previousNeighbor,f=this.nextNeighbor,e;c.orientation===c.VERTICAL?(this.startPoint.x=a+c.width/2,this.endPoint.x=a+c.width/2,d.endPoint.x=this.startPoint.x,f.startPoint.x=this.endPoint.x):(this.startPoint.y=b+c.height/2,this.endPoint.y=b+c.height/2,d.endPoint.y=this.startPoint.y,f.startPoint.y=this.endPoint.y);this.moveHandler&&(c=(this.startPoint.x+this.endPoint.x)/2-this.moveHandler.width/2,e=(this.startPoint.y+this.endPoint.y)/2-this.moveHandler.height/
2,this.moveHandler.setPosition(c,e));d.paint();d.moveHandler&&(c=(d.startPoint.x+d.endPoint.x)/2-d.moveHandler.width/2,e=(d.startPoint.y+d.endPoint.y)/2-d.moveHandler.height/2,d.moveHandler.setPosition(c,e));f.paint();f.moveHandler&&(c=(f.startPoint.x+f.endPoint.x)/2-f.moveHandler.width/2,e=(f.startPoint.y+f.endPoint.y)/2-f.moveHandler.height/2,f.moveHandler.setPosition(c,e));this.paint();return this};N=function(a){h.call(this,a);this.color=new B;this.graphics=null};N.prototype=new h;N.prototype.type=
"RegularShape";N.prototype.getColor=function(){return this.color};N.prototype.setColor=function(a){a.type&&"Color"===a.type&&(this.color=a);return this};ca=function(a){N.call(this,a);this.points=null;ca.prototype.initObject.call(this,a)};ca.prototype=new N;ca.prototype.type="Polygon";ca.prototype.initObject=function(a){var b={points:[]};e.extend(!0,b,a);this.setPoints(b.points)};ca.prototype.setPoints=function(a){var b,c;this.points=[];for(b=0;b<a.length;b+=1)c=a[b],this.points.push(new k(c.getX(),
c.getY()))};ca.prototype.getPoints=function(){return this.points};Q=function(a){ca.call(this,a);Q.prototype.initObject.call(this,a)};Q.prototype=new ca;Q.prototype.type="Rectangle";Q.prototype.initObject=function(a){};Q.prototype.paint=function(){this.html&&(this.style.applyStyle(),this.color&&this.style.addProperties({backgroundColor:this.color.getCSS()}));return this};Q.prototype.createHTML=function(){h.prototype.createHTML.call(this);return this.html};da=function(a){N.call(this,a);da.prototype.initObject.call(this,
a)};da.prototype=new N;da.prototype.type="Oval";da.prototype.initObject=function(a){var b={center:new k(0,0),width:4,height:4};e.extend(!0,b,a);this.setCenter(b.center).setWidth(b.width).setHeight(b.height)};da.prototype.paint=function(){this.setVisible(this.visible);this.html&&this.style.applyStyle();return this};da.prototype.createHTML=function(){h.prototype.createHTML.call(this);return this.html};da.prototype.setColor=function(a){this.graphic.setColor(a);this.graphic.fillOval(0,0,this.getWidth(),
this.getHeight());this.graphic.paint();return this};E=function(a){N.call(this);this.step=this.radius=this.endAngle=this.startAngle=null;E.prototype.initObject.call(this,a)};E.prototype=new N;E.prototype.type="Arc";E.prototype.initObject=function(a){var b={center:new k(0,0),radius:h.prototype.DEFAULT_RADIUS,startAngle:270,endAngle:90,step:10};e.extend(!0,b,a);this.setCenter(b.center).setStartAngle(b.startAngle).setEndAngle(b.endAngle).setRadius(b.radius).setStep(b.step);this.id+="-ARC"};E.prototype.paint=
function(){this.setVisible(this.visible);this.html&&this.style.applyStyle();return this};E.prototype.createHTML=function(){h.prototype.createHTML.call(this);return this.html};E.prototype.getStartAngle=function(){return this.startAngle};E.prototype.setStartAngle=function(a){this.startAngle=a;return this};E.prototype.getEndAngle=function(){return this.endAngle};E.prototype.setEndAngle=function(a){this.endAngle=a;return this};E.prototype.getRadius=function(){return this.radius};E.prototype.setRadius=
function(a){this.radius=a;return this};E.prototype.getStep=function(){return this.step};E.prototype.setStep=function(a){this.step=a;return this};K=function(a){N.call(this);this.canvas=this.backgroundColor=null;K.prototype.initObject.call(this,a)};K.prototype=new Q;K.prototype.type="MultipleSelectionContainer";K.prototype.initObject=function(a){this.backgroundColor=new B(0,128,255,.1);this.canvas=a;this.canvas.addElement(this,0,0,!0)};K.prototype.paint=function(){this.style.addProperties({backgroundColor:this.backgroundColor.getCSS()});
return this};K.prototype.changeOpacity=function(a){this.backgroundColor.setOpacity(a);this.paint();return this};K.prototype.wrapElements=function(){var a=this.canvas.currentSelection,b=[];this.intersectElements();a.isEmpty()||(b=a.asArray(),this.canvas.triggerSelectEvent(b));this.reset();this.setVisible(!1);return this};K.prototype.intersectElements=function(){var a,b,c;this.canvas.emptyCurrentSelection();c=this.canvas.customShapes;for(a=0;a<c.getSize();a+=1)b=c.get(a),"Canvas"===b.parent.family&&
this.checkIntersection(b)&&this.canvas.addToSelection(b);return this};K.prototype.reset=function(){this.setPosition(0,0);this.setDimension(0,0);return this};K.prototype.getLeft=h.prototype.getAbsoluteX;K.prototype.getTop=h.prototype.getAbsoluteY;K.prototype.checkIntersection=function(a){var b=new k(this.zoomX,this.zoomY),c=new k(this.zoomX+this.zoomWidth,this.zoomY+this.zoomHeight);return O.pointInRectangle(new k(a.getZoomX(),a.getZoomY()),b,c)||O.pointInRectangle(new k(a.zoomX+a.zoomWidth,a.zoomY),
b,c)||O.pointInRectangle(new k(a.zoomX,a.zoomY+a.zoomHeight),b,c)||O.pointInRectangle(new k(a.zoomX+a.zoomWidth,a.zoomY+a.zoomHeight),b,c)};ma=function(a,b,c){E.call(this);this.center=a?a:null;this.visible=!0;this.parent=c;this.idOtherConnection=b};ma.prototype=new E;ma.prototype.type="Intersection";ma.prototype.paint=function(){this.parent.orientation===this.VERTICAL?(this.startAngle=270,this.endAngle=90):(this.startAngle=180,this.endAngle=0);E.prototype.paint.call(this);this.style.applyStyle();
return this};ma.prototype.destroy=function(){e(this.html).remove();return this};ma.prototype.createHTML=function(){h.prototype.createHTML.call(this);return this.html};H=function(a){m.call(this,a);this.orientation=null;this.data=[];this.visible=!1;H.prototype.initObject.call(this,a)};H.prototype=new m;H.prototype.type="Snapper";H.prototype.initObject=function(a){var b={orientation:"horizontal"};e.extend(!0,b,a);this.setOrientation(b.orientation);this.setDimension(b.width,b.height);this.createHTML();
this.hide()};H.prototype.createHTML=function(){m.prototype.createHTML.call(this);e(this.canvas.getHTML()).append(this.html);this.setZOrder(99);this.html.className="custom-snapper";"horizontal"==this.getOrientation()?(this.html.id="guide-h",this.html.style.borderTop="1px dashed #55f",this.html.style.width="100%"):(this.html.id="guide-v",this.html.style.borderLeft="1px dashed #55f",this.html.style.height="100%");return this.html};H.prototype.hide=function(){this.visible=!1;this.setVisible(this.visible);
return this};H.prototype.show=function(){this.visible=!0;this.setVisible(this.visible);return this};H.prototype.createSnapData=function(){var a,b=0,c,d=0;this.data=[];for(a=0;a<this.canvas.customShapes.getSize();a+=1)c=this.canvas.customShapes.get(a),this.canvas.currentSelection.find("id",c.getID())||(d=parseInt(e(c.getHTML()).css("borderTopWidth"),10),"horizontal"===this.orientation?(this.data[2*b]=c.getAbsoluteY()-d,this.data[2*b+1]=c.getAbsoluteY()+c.getZoomHeight()):(this.data[2*b]=c.getAbsoluteX()-
d,this.data[2*b+1]=c.getAbsoluteX()+c.getZoomWidth()),b+=1);for(a=0;a<this.canvas.regularShapes.getSize();a+=1)c=this.canvas.regularShapes.get(a),d=parseInt(e(c.getHTML()).css("borderTopWidth"),10),"horizontal"===this.orientation?(this.data[2*b]=c.getAbsoluteY()-d,this.data[2*b+1]=c.getAbsoluteY()+c.getZoomHeight()):(this.data[2*b]=c.getAbsoluteX()-d,this.data[2*b+1]=c.getAbsoluteX()+c.getZoomWidth()),b+=1;return this};H.prototype.sortData=function(){this.data.sort(function(a,b){return a>b});return this};
H.prototype.binarySearch=function(a){for(var b=0,c=this.data.length-1,d;b<=c;){d=parseInt((b+c)/2,10);if(this.data[d]===a)return a;this.data[d]>a?c=d-1:b=d+1}return!1};H.prototype.attachListeners=function(a){e(a.html).mousemove(function(){a.hide()});return this};H.prototype.setOrientation=function(a){if("horizontal"===a||"vertical"===a)this.orientation=a;else throw Error("setOrientation(): parameter is not valid");return this};H.prototype.getOrientation=function(){return this.orientation};W=function(a){m.call(this,
a);W.prototype.initObject.call(this,a)};W.prototype=new m;W.prototype.initObject=function(a){this.createHTML();this.attachListeners()};W.prototype.attachListeners=function(){e(this.html).on("mousedown",this.onMouseDown(this)).on("mouseup",this.onMouseUp(this)).on("mousemove",this.onMouseMove(this)).on("click",this.onClick(this)).droppable({accept:"*",greedy:!0,onDrop:function(){return!1}})};W.prototype.onMouseDown=function(a){return function(a,c){a.stopPropagation()}};W.prototype.onMouseUp=function(a){return function(a,
c){a.stopPropagation()}};W.prototype.onClick=function(a){return function(a,c){a.stopPropagation()}};W.prototype.onMouseMove=function(a){return function(a,c){a.stopPropagation()}};g=function(a){t.call(this,a);this.sharedConnections=this.currentSelection=this.connections=this.regularShapes=this.customShapes=this.html=null;this.topScroll=this.leftScroll=0;this.verticalSnapper=this.horizontalSnapper=this.multipleSelectionHelper=this.connectionSegment=this.oldCurrentConnection=this.currentConnection=null;
this.zoomFactor=1;this.zoomPropertiesIndex=2;this.zOrder=0;this.isMouseDown=!1;this.currentShape=null;this.draggingASegmentHandler=this.multipleDrop=this.isMouseDownAndMove=!1;this.updatedElement=null;this.rightClick=!1;this.commandStack=this.currentLabel=this.intersectionTimeout=null;this.shapesToCopy=[];this.connectionsToCopy=[];this.readOnly=!1;this.readOnlyLayer=null;this.copyAndPasteReferences={};this.prevZoom=1;this.dummyLabelInitializer=null;this.MIN_DISTANCE=4;this.guides=[];g.prototype.initObject.call(this,
a)};g.prototype=new t;g.prototype.type="Canvas";g.prototype.family="Canvas";g.prototype.initObject=function(a){var b;b={width:4E3,commandStackOnSuccess:function(){},height:4E3,toolbarFactory:a&&a.toolbarFactory||g.prototype.toolBarShapeFactory||function(a){return null},copyAndPasteReferences:a&&a.copyAndPasteReferences||{},readOnly:!1,snapToGuide:!0};e.extend(!0,b,a);a&&(this.createHTML(),a=e("#"+this.id).offset(),this.children=new D,this.customShapes=new D,this.regularShapes=new D,this.connections=
new D,this.currentSelection=new D,this.sharedConnections=new D,this.commandStack=new va(20,b.commandStackOnSuccess),this.multipleSelectionHelper=new K(this),this.copyAndPaste=!1,this.copyAndPasteReferences=b.copyAndPasteReferences,this.setToolBarShapeFactory(b.toolbarFactory),this.setPosition(a.left,a.top).setDimension(b.width,b.height).setCanvas(this).setSnapToGuide(b.snapToGuide).setCopyAndPaste(b.copyAndPaste),b.readOnly&&this.setToReadOnly())};g.prototype.setReadOnly=function(a){a?this.setToReadOnly():
this.unsetReadOnly();return this};g.prototype.setToReadOnly=function(){var a=this.readOnlyLayer;a&&a.html||(this.readOnlyLayer=new W({width:this.width,height:this.height}));this.html.appendChild(this.readOnlyLayer.html);this.readOnly=!0;return this};g.prototype.unsetReadOnly=function(){this.html.removeChild(this.readOnlyLayer.getHTML());this.readOnly=!1;return this};g.prototype.setPosition=function(a,b){this.setX(a);this.setY(b);return this};g.prototype.setX=function(a){this.x=this.zoomX=a;this.absoluteX=
0;return this};g.prototype.setY=function(a){this.y=this.zoomY=a;this.absoluteY=0;return this};g.prototype.setSnapToGuide=function(a){this.snapToGuide=a;this.horizontalSnapper||(this.horizontalSnapper=new H({orientation:"horizontal",canvas:this,width:4E3,height:1}));this.verticalSnapper||(this.verticalSnapper=new H({orientation:"vertical",canvas:this,width:1,height:4E3}));return this};g.prototype.setCopyAndPaste=function(a){this.copyAndPaste=a;return this};g.prototype.createHTMLDiv=function(){return document.getElementById(this.id)};
g.prototype.toolBarShapeFactory=function(a){var b=null;switch(a){case "tiny_shape":b=new n({width:50,height:50,canvas:this,connectAtMiddlePoints:!1,drop:{type:"connection"},style:{cssClasses:["grey"],cssProperties:{border:"1px solid blue","-webkit-box-shadow":"0px 0px 4px 0px black","box-shadow":"0px 0px 4px 0px black"}},resizeBehavior:"NoResize",resizeHandlers:{type:"Rectangle",total:8,resizableStyle:{cssProperties:{"background-color":"rgb(0, 255, 0)",border:"1px solid black"}},nonResizableStyle:{cssProperties:{"background-color":"white",
border:"1px solid black"}}}});b.attachListeners();break;case "big_shape":b=new n({width:200,height:200,canvas:this,container:"regular",connectAtMiddlePoints:!1,drop:{type:"connectioncontainer",selectors:[".custom_shape"]},style:{cssClasses:["grey"],cssProperties:{border:"1px solid green","-webkit-box-shadow":"0px 0px 4px 0px black","box-shadow":"0px 0px 4px 0px black"}},resizeBehavior:"yes",resizeHandlers:{type:"Rectangle",total:8,resizableStyle:{cssProperties:{"background-color":"rgb(0, 255, 0)",
border:"1px solid black"}},nonResizableStyle:{cssProperties:{"background-color":"white",border:"1px solid black"}}}}),b.attachListeners()}return b};g.prototype.addToList=function(a){switch(a.family){case "CustomShape":this.customShapes.contains(a)||this.customShapes.insert(a);break;case "RegularShape":this.regularShapes.contains(a)||this.regularShapes.insert(a)}return this};g.prototype.hideCurrentConnection=function(){this.currentConnection&&(this.currentConnection.hidePortsAndHandlers(),this.currentConnection=
null);return this};g.prototype.applyZoom=function(a){var b;0<a&&(a-=1,this.prevZoom=this.zoomPropertiesIndex,this.zoomPropertiesIndex=a,this.zoomFactor=(25*a+50)/100);for(a=0;a<this.customShapes.getSize();a+=1)b=this.customShapes.get(a),b.applyZoom(),b.paint();for(a=0;a<this.regularShapes.getSize();a+=1)b=this.regularShapes.get(a),b.applyZoom(),b.paint();return this};g.prototype.addConnection=function(a){this.html.appendChild(a.getHTML());this.connections.insert(a);this.updatedElement=a;return this};
g.prototype.removeElements=function(){var a;a=new U(this);this.commandStack.add(a);a.execute();return this};g.prototype.moveAllChildConnections=function(a){var b,c,d,f;if(null!==a.child)for(b=0;b<a.children.getSize();b+=1){c=a.children.get(b);c.setPosition(c.x,c.y);for(d=0;d<c.getPorts().getSize();d+=1)f=c.getPorts().get(d),f.setPosition(f.x,f.y),f.connection.disconnect(),f.connection.connect();this.moveAllChildConnections(c)}return this};g.prototype.moveElements=function(a,b,c){var d,f,e,g=0,h=0,
k,m=[];switch(b){case "LEFT":g=-1;break;case "RIGHT":g=1;break;case "TOP":h=-1;break;case "BOTTOM":h=1}for(d=0;d<a.getCurrentSelection().getSize();d+=1)if(b=!0,e=a.getCurrentSelection().get(d),m.push(e),c&&"function"===typeof c&&!c(e)&&(b=!1),b){e.oldX=e.x;e.oldY=e.y;e.oldAbsoluteX=e.absoluteX;e.oldAbsoluteY=e.absoluteY;e.setPosition(e.getX()+g,e.getY()+h);e.changePosition(e.oldX,e.oldY,e.oldAbsoluteX,e.oldAbsoluteY);for(f=0;f<e.ports.getSize();f+=1)k=e.ports.get(f),k.setPosition(k.x,k.y),k.connection.disconnect().connect();
this.moveAllChildConnections(e);e.refreshConnections(!1)}clearTimeout(this.intersectionTimeout);this.intersectionTimeout=ta.setTimeout(function(a){var b=[];a=a||[];for(d=0;d<a.length;d+=1)e=a[d],b.push(e);for(;0<b.length;){e=b.pop();for(d=0;d<e.getChildren().getSize();d+=1)b.push(e.getChildren().get(d));for(f=0;f<e.ports.getSize();f+=1)k=e.ports.get(f),k.connection.disconnect().connect(),k.connection.setSegmentMoveHandlers(),k.connection.checkAndCreateIntersectionsWithAll()}},1E3,m);return this};
g.prototype.removeFromList=function(a){this.currentSelection.remove(a);"CustomShape"===a.family?this.customShapes.remove(a):"RegularShape"===a.family&&this.regularShapes.remove(a);return this};g.prototype.startSnappers=function(a){var b;this.guides=[];for(b=0;b<this.customShapes.getSize();b+=1)a=this.customShapes.get(b),this.currentSelection.find("id",a.getID())||this.computeGuidesForElement(a);return this};g.prototype.computeGuidesForElement=function(a){var b=a.getAbsoluteX(),c=a.getAbsoluteY(),
d=a.getZoomWidth()-1;a=a.getZoomHeight()-1;this.guides.push({type:"h",x:b,y:c},{type:"h",x:b,y:c+a},{type:"v",x:b,y:c},{type:"v",x:b+d,y:c});return this};g.prototype.processGuides=function(a,b,c){var d,f,g,h,k=this.MIN_DISTANCE+1,m=this.MIN_DISTANCE+1,n,p,r,s,t=c.getZoomWidth()-1,v=c.getZoomHeight()-1,u;s=a.originalEvent.pageY-b.offset.top;r=a.originalEvent.pageX-b.offset.left;d=a.originalEvent.pageY-c.canvas.getY()-s+c.canvas.getTopScroll();f=a.originalEvent.pageX-c.canvas.getX()-r+c.canvas.getLeftScroll();
e.each(this.guides,function(a,b){"h"===b.type&&(u=Math.abs(d-b.y),u<m&&(m=u,h=b,p=0),u=Math.abs(d-b.y+v),u<m&&(m=u,h=b,p=v));"v"===b.type&&(u=Math.abs(f-b.x),u<k&&(k=u,g=b,n=0),u=Math.abs(f-b.x+t),u<k&&(k=u,g=b,n=t))});m<=this.MIN_DISTANCE?(e("#guide-h").css("top",h.y).show(),"canvas"!==c.parent.family?(b.position.top=h.y-p-c.parent.getAbsoluteY(),c.setPosition(b.helper.position().left/this.zoomFactor,h.y-p-c.parent.getAbsoluteY())):(b.position.top=h.y-p,c.setPosition(b.helper.position().left/this.zoomFactor,
h.y-p))):e("#guide-h").hide();k<=this.MIN_DISTANCE?(e("#guide-v").css("left",g.x).show(),"canvas"!==c.parent.family?(b.position.left=g.x-n-c.parent.getAbsoluteX(),c.setPosition(g.x-n-c.parent.getAbsoluteX(),b.helper.position().top/this.zoomFactor)):(b.position.left=g.x-n,c.setPosition(g.x-n,b.helper.position().top/this.zoomFactor))):e("#guide-v").hide();return this};g.prototype.emptyCurrentSelection=function(){for(var a;0<this.currentSelection.getSize();)a=this.currentSelection.get(0),this.removeFromSelection(a);
this.sharedConnections.clear();return this};g.prototype.isValidSelection=function(a,b){return null===a.parent?null===b.parent:null===b.parent?!1:b.parent.id===a.parent.id};g.prototype.addToSelection=function(a){var b=this.currentSelection,c;b.isEmpty()?c=!0:(c=b.get(0),c=this.isValidSelection(c,a));!b.contains(a)&&c&&(a.increaseZIndex(),b.insert(a),"CustomShape"===a.family&&this.addToSharedConnections(a),a.selected=!0,a.showOrHideResizeHandlers(!0));return this};g.prototype.removeFromSelection=function(a){a.decreaseZIndex();
this.removeFromSharedConnections(a);this.currentSelection.remove(a);a.selected=!1;a.showOrHideResizeHandlers(!1);return this};g.prototype.removeFromSharedConnections=function(a){var b,c,d=this.sharedConnections;for(b=0;b<a.getChildren().getSize();b+=1)c=a.getChildren().get(b),this.removeFromSharedConnections(c);if(a.ports)for(b=0;b<a.ports.getSize();b+=1)c=a.ports.get(b).connection,d.find("id",c.getID())&&this.sharedConnections.remove(c);return this};g.prototype.findAncestorInCurrentSelection=function(a){return this.currentSelection.find("id",
a.getID())?!0:a.parent?this.findAncestorInCurrentSelection(a.parent):!1};g.prototype.addToSharedConnections=function(a){var b,c,d,f,e=this.sharedConnections;for(b=0;b<a.getChildren().getSize();b+=1)c=a.getChildren().get(b),this.addToSharedConnections(c);if(a.ports)for(b=0;b<a.ports.getSize();b+=1)c=a.ports.get(b).connection,d=c.srcPort.parent,f=c.destPort.parent,this.findAncestorInCurrentSelection(d)&&this.findAncestorInCurrentSelection(f)&&!e.find("id",c.getID())&&e.insert(c);return this};g.prototype.removeConnection=
function(a){this.connections.remove(a);return this};g.prototype.attachListeners=function(){var a=e(this.html).click(this.onClick(this)),b=a.parent();a.mousedown(this.onMouseDown(this));b.scroll(this.onScroll(this,b));a.mousemove(this.onMouseMove(this));a.mouseup(this.onMouseUp(this));a.on("createelement",this.onCreateElement(this));a.on("removeelement",this.onRemoveElement(this));a.on("changeelement",this.onChangeElement(this));a.on("selectelement",this.onSelectElement(this));a.on("rightclick",this.onRightClick(this));
a.on("contextmenu",function(a){a.preventDefault()});this.updateBehaviors();return this};g.prototype.onCreateElementHandler=function(a){};g.prototype.onCreateElement=function(a){return function(b,c){a.onCreateElementHandler(a.updatedElement)}};g.prototype.onRemoveElementHandler=function(a){return!0};g.prototype.onRemoveElement=function(a){return function(b,c){a.onRemoveElementHandler(a.updatedElement.relatedElements)}};g.prototype.onChangeElementHandler=function(a){};g.prototype.onChangeElement=function(a){return function(b,
c){a.onChangeElementHandler(a.updatedElement)}};g.prototype.onSelectElementHandler=function(a){};g.prototype.onSelectElement=function(a){return function(b,c){a.onSelectElementHandler(a.updatedElement)}};g.prototype.onRightClickHandler=function(a,b,c){};g.prototype.onRightClick=function(a){return function(b,c,d){b=c.pageX-a.x+a.leftScroll;c=c.pageY-a.y+a.topScroll;a.updatedElement=d;console.log(d);a.onRightClickHandler(a.updatedElement,b,c)}};g.prototype.onClick=function(a){return function(b,c){var d=
a.currentLabel;d&&(d.loseFocus(),e(d.textField).focusout())}};g.prototype.onMouseDown=function(a){return function(b,c){var d=b.pageX-a.getX()+a.getLeftScroll(),f=b.pageY-a.getY()+a.getTopScroll();b.preventDefault();3===b.which&&(a.rightClick=!0,e(a.html).trigger("rightclick",[b,a]));a.isMouseDown=!0;a.isMouseDownAndMove=!1;a.draggingASegmentHandler||(a.emptyCurrentSelection(),a.hideCurrentConnection(),a.multipleSelectionHelper.reset(),a.multipleSelectionHelper.setPosition(d/a.zoomFactor,f/a.zoomFactor),
a.multipleSelectionHelper.oldX=d,a.multipleSelectionHelper.oldY=f,a.multipleSelectionHelper.setVisible(!0),a.multipleSelectionHelper.changeOpacity(.2))}};g.prototype.onMouseMove=function(a){return function(b,c){if(a.isMouseDown&&!a.rightClick){a.isMouseDownAndMove=!0;var d=b.pageX-a.getX()+a.getLeftScroll(),f=b.pageY-a.getY()+a.getTopScroll(),e,g;e=Math.min(d,a.multipleSelectionHelper.oldX);g=Math.min(f,a.multipleSelectionHelper.oldY);d=Math.max(d,a.multipleSelectionHelper.oldX);f=Math.max(f,a.multipleSelectionHelper.oldY);
a.multipleSelectionHelper.setPosition(e/a.zoomFactor,g/a.zoomFactor);a.multipleSelectionHelper.setDimension((d-e)/a.zoomFactor,(f-g)/a.zoomFactor)}}};g.prototype.onClickHandler=function(a,b,c){};g.prototype.onMouseUp=function(a){return function(b,c){if(a.isMouseDownAndMove){var d=b.pageX-a.getX()+a.getLeftScroll(),f=b.pageY-a.getY()+a.getTopScroll();a.multipleSelectionHelper.setPosition(Math.min(d,a.multipleSelectionHelper.zoomX)/a.zoomFactor,Math.min(f,a.multipleSelectionHelper.zoomY)/a.zoomFactor);
a.multipleSelectionHelper&&a.multipleSelectionHelper.wrapElements()}else{if(a.isMouseDown&&!a.rightClick)a.onClickHandler(a,d,f);a.multipleSelectionHelper.wasDragged||a.multipleSelectionHelper.reset().setVisible(!1)}a.isMouseDown=!1;a.isMouseDownAndMove=!1;a.rightClick=!1}};g.prototype.onScroll=function(a,b){return function(c,d){a.setLeftScroll(b.scrollLeft()).setTopScroll(b.scrollTop())}};g.prototype.triggerSelectEvent=function(a){var b,c=[],d;for(b=0;b<a.length;b+=1)d=a[b],c.push({id:d.id,type:d.type,
relatedObject:d});this.updatedElement=c;e(this.html).trigger("selectelement");return this};g.prototype.triggerRightClickEvent=function(a){this.updatedElement={id:a.id,type:a.type,relatedObject:a};e(this.html).trigger("rightclick");return this};g.prototype.triggerCreateEvent=function(a,b){this.updatedElement={id:a&&a.id||null,type:a&&a.type||null,relatedObject:a,relatedElements:b};e(this.html).trigger("createelement");return this};g.prototype.triggerRemoveEvent=function(a,b){this.updatedElement={id:a&&
a.id||null,type:a&&a.type||null,relatedObject:a,relatedElements:b};e(this.html).trigger("removeelement");return this};g.prototype.triggerDimensionChangeEvent=function(a,b,c,d,f){this.updatedElement=[{id:a.id,type:a.type,fields:[{field:"width",oldVal:b,newVal:d},{field:"height",oldVal:c,newVal:f}],relatedObject:a}];e(this.html).trigger("changeelement");return this};g.prototype.triggerPortChangeEvent=function(a){this.updatedElement=[{id:a.getID(),type:a.type,fields:[{field:"x",oldVal:a.getOldX(),newVal:a.getX()},
{field:"y",oldVal:a.getOldY(),newVal:a.getY()},{field:"parent",oldVal:a.getOldParent().getID(),newVal:a.getParent().getID()},{field:"state",oldVal:a.connection.getOldPoints(),newVal:a.connection.savePoints()&&a.connection.getPoints()}],relatedObject:a}];console.log("port change!");e(this.html).trigger("changeelement");return this};g.prototype.triggerConnectionStateChangeEvent=function(a){var b=[],c,d;a.savePoints();for(d=0;d<a.points.length;d+=1)c=a.points[d],b.push(new k(c.x/this.zoomFactor,c.y/
this.zoomFactor));this.updatedElement=[{id:a.getID(),type:a.type,fields:[{field:"state",oldVal:a.getOldPoints(),newVal:b}],relatedObject:a}];e(this.html).trigger("changeelement");return this};g.prototype.triggerPositionChangeEvent=function(a,b,c){var d,f=[];for(d=0;d<a.length;d+=1)f.push({id:a[d].getID(),type:a[d].type,fields:[{field:"x",oldVal:b[d].x,newVal:c[d].x},{field:"y",oldVal:b[d].y,newVal:c[d].y}],relatedObject:a[d]});this.updatedElement=f;e(this.html).trigger("changeelement");return this};
g.prototype.triggerTextChangeEvent=function(a,b,c){this.updatedElement=[{id:a.id,type:a.type,parent:a.parent,fields:[{field:"message",oldVal:b,newVal:c}],relatedObject:a}];e(this.html).trigger("changeelement");return this};g.prototype.triggerParentChangeEvent=function(a,b,c){var d,f=[];for(d=0;d<a.length;d+=1)f.push({id:a[d].getID(),type:a[d].type,fields:[{field:"parent",oldParent:b[d].parent,newVal:c[d].parent},{field:"x",oldVal:b[d].x,newVal:c[d].x},{field:"y",oldVal:b[d].y,newVal:c[d].y}],relatedObject:a[d]});
this.updatedElement=f;e(this.html).trigger("changeelement");return this};g.prototype.setTopScroll=function(a){this.topScroll=a;return this};g.prototype.setLeftScroll=function(a){this.leftScroll=a;return this};g.prototype.setZoomFactor=function(a){"number"===typeof a&&0===a%25&&0<a&&(this.zoomFactor=a);return this};g.prototype.setCurrentConnection=function(a){"Connection"===a.type&&(this.currentConnection=a);return this};g.prototype.setToolBarShapeFactory=function(a){g.prototype.toolBarShapeFactory=
a;return this};g.prototype.getZoomFactor=function(){return this.zoomFactor};g.prototype.getZoomPropertiesIndex=function(){return this.zoomPropertiesIndex};g.prototype.getConnectionSegment=function(){return this.connectionSegment};g.prototype.getLeftScroll=function(){return this.leftScroll};g.prototype.getTopScroll=function(){return this.topScroll};g.prototype.getCurrentConnection=function(){return this.currentConnection};g.prototype.getCurrentSelection=function(){return this.currentSelection};g.prototype.getConnections=
function(){return this.connections};g.prototype.getSharedConnections=function(){return this.sharedConnections};g.prototype.getCustomShapes=function(){return this.customShapes};g.prototype.getRegularShapes=function(){return this.regularShapes};g.prototype.getMultipleSelectionHelper=function(){return this.multipleSelectionHelper};g.prototype.getHorizontalSnapper=function(){return this.horizontalSnapper};g.prototype.getVerticalSnapper=function(){return this.verticalSnapper};g.prototype.getUpdatedElement=
function(){return this.updatedElement};g.prototype.isResizable=function(){return!1};g.prototype.getCanvas=function(){return this};g.prototype.undo=function(){this.commandStack.undo();return this};g.prototype.redo=function(){this.commandStack.redo();return this};g.prototype.stringify=function(){var a,b=[],c=[],d=[];for(a=0;a<this.customShapes.getSize();a+=1)b.push(this.customShapes.get(a).stringify());for(a=0;a<this.regularShapes.getSize();a+=1)c.push(this.regularShapes.get(a).stringify());for(a=0;a<
this.connections.getSize();a+=1)d.push(this.connections.get(a).stringify());a=h.prototype.stringify.call(this);e.extend(!0,a,{customShapes:b,regularShapes:c,connections:d});return a};g.prototype.addToShapesToCopy=function(a){var b,c;this.shapesToCopy.push(a.stringify());for(b=0;b<a.getChildren().getSize();b+=1)c=a.getChildren().get(b),this.addToShapesToCopy(c);return this};g.prototype.copy=function(){var a,b;this.shapesToCopy=[];for(a=0;a<this.getCurrentSelection().getSize();a+=1)b=this.getCurrentSelection().get(a),
this.addToShapesToCopy(b);this.connectionsToCopy=[];for(a=0;a<this.getSharedConnections().getSize();a+=1)b=this.getSharedConnections().get(a),this.connectionsToCopy.push(b.stringify());console.log("shapes: "+this.shapesToCopy.length);console.log("conn: "+this.connectionsToCopy.length);return this};g.prototype.paste=function(){this.parse({shapes:this.shapesToCopy,connections:this.connectionsToCopy,createCommand:!0,uniqueID:!0,selectAfterFinish:!0,prependMessage:"Copy of ",diffX:100,diffY:100});return this};
g.prototype.shapeFactory=function(a,b){return this.copyAndPasteReferences[a]?new this.copyAndPasteReferences[a](b):new n(b)};g.prototype.connectionFactory=function(a,b){return a&&this.copyAndPasteReferences[a]?new this.copyAndPasteReferences[a](b):new p(b)};g.prototype.transformToTree=function(a){var b={},c,d;for(d=0;d<a.length;d+=1)c=a[d],b[c.id]||(b[c.id]=[]),c.parent&&(b[c.parent]||(b[c.parent]=[]),b[c.parent][c.order]=c.id);return b};g.prototype.levelOrderTraversal=function(a,b){var c=[],d=[],
f;f=b||this.getID();var e;for(c.push(f);0<c.length;)for(f=c.shift(),d.push(f),e=0;e<a[f].length;e+=1)c.push(a[f][e]);return d};g.prototype.parse=function(a){var b={shapes:[],connections:[],uniqueID:!1,selectAfterFinish:!1,prependMessage:"",createCommand:!0,diffX:0,diffY:0},c,d,f,g,h,k,m,n,p,s,t,v=[],z=[];f=this.getID();var y={},w={};k={};e.extend(!0,b,a);s=b.diffX;t=b.diffY;w[f]=this;y[f]=f;b.selectAfterFinish&&this.emptyCurrentSelection();for(a=0;a<b.shapes.length;a+=1){g={};e.extend(!0,g,b.shapes[a]);
g.canvas=this;c=g.id;b.uniqueID&&(g.id=ea.generateUniqueId());y[c]=g.id;if(g.labels)for(c=0;c<g.labels.length;c+=1)g.labels[c].message=b.prependMessage+g.labels[c].message;c=this.shapeFactory(g.type,g);w[g.id]=c;y[g.parent]?g.parent!==f?w[y[g.parent]].addElement(c,g.x,g.y,!0):w[y[g.parent]].addElement(c,g.x+s,g.y+t,!0):this.addElement(c,g.x+s,g.y+t,!0);c.parseHook();c.attachListeners();k=new T(c);k.execute();v.push(k)}for(a=0;a<b.connections.length;a+=1)g={},e.extend(!0,g,b.connections[a]),f=g.state||
[],c=g.srcPort,k=w[y[c.parent]],h=k.getBorderConsideringLayers(),m=g.destPort,n=w[y[m.parent]],p=n.getBorderConsideringLayers(),0===f.length&&(f.push({x:c.x+k.getAbsoluteX(),y:c.y+k.getAbsoluteY()}),f.push({x:m.x+n.getAbsoluteX(),y:m.y+n.getAbsoluteY()})),c=new r({width:12,height:12}),m=new r({width:12,height:12}),k.addPort(c,f[0].x+s+h-k.getAbsoluteX(),f[0].y+s+h-k.getAbsoluteY()),n.addPort(m,f[f.length-1].x+s+p-n.getAbsoluteX(),f[f.length-1].y+t+p-n.getAbsoluteY(),!1,c),k=e.extend(!0,{},b.connections[a],
{srcPort:c,destPort:m,canvas:this,segmentStyle:g.segmentStyle}),h=this.connectionFactory(g.type,k),h.id=g.id||ea.generateUniqueId(),b.uniqueID&&(h.id=ea.generateUniqueId()),h.setSrcDecorator(new u({width:11,height:11,canvas:this,decoratorPrefix:g.srcDecoratorPrefix,decoratorType:"source",parent:h})),h.setDestDecorator(new u({width:11,height:11,canvas:this,decoratorPrefix:g.destDecoratorPrefix,decoratorType:"target",parent:h})),k=new P(h),z.push(k),3<=f.length?h.connect({algorithm:"user",points:g.state,
dx:b.diffX,dy:b.diffY}):h.connect(),h.setSegmentMoveHandlers(),this.addConnection(h),h.checkAndCreateIntersectionsWithAll(),c.attachListeners(c),m.attachListeners(m),this.triggerCreateEvent(h,[]);if(b.selectAfterFinish)for(d in w)w.hasOwnProperty(d)&&"Canvas"!==w[d].family&&this.addToSelection(w[d]);b.createCommand&&this.commandStack.add(new Y(this,{stackCommandCreate:v,stackCommandConnect:z}));return this};CustomLine=function(a){this.html=this.y2=this.x2=this.y1=this.x1=null;this.canvas=a.canvas?
a.canvas:null};CustomLine.prototype.type="CustomLine";CustomLine.prototype.family="CustomLine";CustomLine.prototype.setStarPoint=function(a){this.x1=a.x;this.y1=a.y;return this};CustomLine.prototype.setEndPoint=function(a){this.x2=a.x;this.y2=a.y;return this};CustomLine.prototype.setHtml=function(a){this.html=a;return this};CustomLine.prototype.drawLine=function(a,b,c,d){var f,e,g,h;f=c-a;e=d-b;g=Math.sqrt(Math.pow(Math.abs(f),2)+Math.pow(Math.abs(e),2));h=180*Math.atan2(e,f)/Math.PI;0===f?0>e?this.createDiv(c,
d,1,g):this.createDiv(a,b,1,g):0===e?0>f?this.createDiv(c,d,g,1):this.createDiv(a,b,g,1):this.createDiv(a,b,g,1,"rotate("+h+"deg)");this.paint()};CustomLine.prototype.paint=function(){this.canvas&&e(this.html).appendTo(this.canvas);this.html=""};CustomLine.prototype.createDiv=function(a,b,c,d,f){this.html=e("<div>").addClass("line").css({animation:"none",position:"absolute"}).width(c).height(d).offset({left:a,top:b});f&&e(this.html).css({"-webkit-transform":f,"-moz-transform":f,"-ms-transform":f,
transform:f})};CustomLine.prototype.remove=function(){this.html&&e(this.html).remove()};CustomLine.prototype.clear=function(){e(this.html).empty();this.canvas&&(this.canvas.innerHTML="")};e(document).keydown(function(a){if(s)switch(a.which){case 16:ua=!0;break;case 17:pa=!0;break;case 116:a.preventDefault();ta.location.reload(!0);break;case 37:s.currentLabel||(a.preventDefault(),s.moveElements(s,"LEFT"));break;case 38:s.currentLabel||(a.preventDefault(),s.moveElements(s,"TOP"));break;case 39:s.currentLabel||
(a.preventDefault(),s.moveElements(s,"RIGHT"));break;case 40:s.currentLabel||(a.preventDefault(),s.moveElements(s,"BOTTOM"));break;case 67:!s.currentLabel&&pa&&s.copyAndPaste&&(a.preventDefault(),s.copy());break;case 86:!s.currentLabel&&pa&&s.copyAndPaste&&(a.preventDefault(),s.paste());break;case 90:pa&&(ua?s.redo():s.undo(),a.preventDefault());break;case 8:s&&s.currentSelection.getSize()&&a.preventDefault()}}).keypress(function(a){}).keyup(function(a){a.preventDefault();switch(a.which){case 8:(pa||
s&&s.currentSelection.getSize())&&s&&!s.currentLabel&&s.removeElements();break;case 13:s&&s.currentLabel&&s.currentLabel.loseFocus();break;case 46:s&&!s.currentLabel&&s.removeElements();break;case 16:ua=!1;break;case 17:pa=!1;break;case 113:s&&null!==s.getCurrentSelection().getLast()&&(a=s.getCurrentSelection().getLast(),void 0!==a&&null!==a.label.html&&(e(a.label.html).dblclick(),e(a.label.text.html).focus()))}});return{ArrayList:D,Point:k,Geometry:O,Graphics:void 0,Utils:ea,Command:y,CommandStack:va,
CommandResize:ha,CommandConnect:P,CommandReconnect:ia,CommandSegmentMove:R,CommandMove:S,CommandCreate:T,CommandSwitchContainer:X,CommandDelete:U,CommandPaste:Y,CommandEditLabel:Z,ContainerBehavior:$,RegularContainerBehavior:ja,NoContainerBehavior:sa,DragBehavior:G,RegularDragBehavior:aa,NoDragBehavior:qa,ConnectionDragBehavior:fa,CustomShapeDragBehavior:I,ResizeBehavior:J,RegularResizeBehavior:ba,NoResizeBehavior:na,DropBehavior:z,ConnectionDropBehavior:V,NoDropBehavior:ra,ContainerDropBehavior:ka,
ConnectionContainerDropBehavior:la,Color:B,Style:A,JCoreObject:m,Handler:F,ReadOnlyLayer:W,ResizeHandler:L,SegmentMoveHandler:M,Port:r,Router:oa,ManhattanConnectionRouter:ga,ConnectionDecorator:u,Connection:p,BehavioralElement:t,Layer:C,Shape:h,Label:v,CustomShape:n,Segment:w,RegularShape:N,Polygon:ca,Rectangle:Q,Oval:da,Arc:E,MultipleSelectionContainer:K,Intersection:ma,Snapper:H,Canvas:g,setActiveCanvas:function(a){s=a;return this},getActiveCanvas:function(){return s},getVersion:function(){return"///***VERSION***///"}}}(jQuery,
window);
