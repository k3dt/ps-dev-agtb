<script>
      //instantiate D3 chart using NVD3
    var d3Chart = null;

    nv.addGraph({
      generate: function() {
          var chart = nv.models.paretoChart()
                .margin({top: 10, right: 10, bottom: 30, left: 40})
                .showControls(false)
                .showTitle(false)
                .stacked(true)
                .colorData( 'default' )
                .colorFill( 'default' );

          d3.select('#db620e51-8350-c596-06d1-4f866bfcfd5b svg')
            .datum(this.translateDataToD3(mark_gibson_Q1))
            .transition().duration(500).call(chart);

          nv.utils.windowResize(chart.update);

          return chart;
      },
      translateDataToD3 : function( json, params )
      {
          return {
              'properties':{
                  'title': json.properties[0].title
                , 'quota': parseInt(json.values[0].goalmarkervalue[0],10)
                // bar group data (x-axis)
                , 'groupData': json.values.map( function(d,i){
                      return {
                        'group': i
                      , 'l': json.values[i].label
                      , 't': json.values[i].values.reduce( function(p, c, i, a){
                          return parseInt(p,10) + parseInt(c,10);
                        })
                      }
                  })
              }
              // series data
            , 'data': json.label.map( function(d,i){
                  return {
                      'key': d
                    , 'type': 'bar'
                    , 'series': i
                    , 'values': json.values.map( function(e,j){
                          return { 'series': i, 'x': j+1, 'y': parseInt(e.values[i],10),  y0: 0 };
                      })
                    , 'valuesOrig': json.values.map( function(e,j){
                          return { 'series': i, 'x': j+1, 'y': parseInt(e.values[i],10),  y0: 0 };
                      })
                  }
              }).concat(
                  json.properties[0].goal_marker_label.filter( function(d,i){
                      return d !== 'Quota';
                    }).map( function(d,i){
                      return {
                          'key': d
                        , 'type': 'line'
                        , 'series': i
                        , 'values': json.values.map( function(e,j){
                            return { 'series': i, 'x': j+1, 'y': parseInt(e.goalmarkervalue[i+1],10) };
                          })
                        , 'valuesOrig': json.values.map( function(e,j){
                            return { 'series': i, 'x': j+1, 'y': parseInt(e.goalmarkervalue[i+1],10) };
                          })
                      }
                  })
              )
          };
      },
      callback: function(graph) {
        d3Chart = graph;
      }
    });

    $('.thumbnail.viz .btn-expand-full').on('click', toggleExpand);
</script>

<div class="side sidebar-content span4">
    <div class="side-pane active">

        <div class="thumbnail viz">
          <div class="view-forecastsChart">
            <div>
              <div class="btn-toolbar pull-right">
                <form class="dropdown form-horizontal" id="forecastsChartDisplayOptions">
                  <a href="#" class="btn btn-invisible btn-expand-full"><span class="icon-resize-full"></span></a>
                  <a href="#forecastsChartDisplayOptions" data-toggle="dropdown" class="dropdown-toggle btn btn-invisible"><span class="icon-cog"></span></a>
                  <ul class="dropdown-menu left carettop" id="chartDisplayOptions">
                    <div class="datasetOptions">
                      <li><a href="#"><label class="radio checked"><i class="icon-ok"></i>&nbsp;Likely</label></a></li>
                      <li><a href="#"><label class="radio"><i class="icon-ok"></i>&nbsp;Best</label></a></li>
                      <li><a href="#"><label class="radio"><i class="icon-ok"></i>&nbsp;Worst</label></a></li>
                    </div>
                    <div class="groupByOptions">
                      <li class="divider"></li>
                      <li><a href="#"><label class="radio checked"><i class="icon-ok"></i>&nbsp;Included In Forecast</label></a></li>
                      <li><a href="#"><label class="radio"><i class="icon-ok"></i>&nbsp;Sales Stage</label></a></li>
                      <li><a href="#"><label class="radio"><i class="icon-ok"></i>&nbsp;Probability</label></a></li>
                    </div>
                  </ul>
                </form>
              </div>
              <h4>Forecast for Q4 2012</h4>
              <div class="tcenter">
                <div id="chart" class="tcenter">
                  <div class="chart-container">
                    <div id="sbdb620e51-8350-c596-06d1-4f866bfcfd5b" class="scrollBars">
                      <div id="db620e51-8350-c596-06d1-4f866bfcfd5b" class="nv-chart">
                        <svg></svg>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="clearfix"></div>
        <div class="block thumbnail" id="guages">
            <h4>Projected</h4>
            <ul id="projectActions" class="nav nav-pills actions">
                <li class="dropdown">
                    <a id="projectedOptions" class="dropdown-toggle btn btn-invisible" href="#" data-toggle="dropdown"><i class="icon-cog"></i></a>
                    <ul class="dropdown-menu left carettop">
                        <li> <input type="checkbox"> Best</li>
                        <li> <input type="checkbox"> Likely</li>
                        <li> <input type="checkbox"> Worst</li>
                    </ul>
                </li>


            </ul>
            <div class="row-fluid">
                <strong>
                <span class="span6">
                  Quota
                </span>
                <span class="span6 tright">
                  $600,000
                </span>
                </strong>
            </div>

            <div class="row-fluid">
              <span class="span6">
                Pipeline
              </span>
              <span class="span1 tright">
                1,400,000
              </span>
              <span class="span5 tright">
                Pipeline Size x2
              </span>
            </div>
            <div class="row-fluid">
              <span class="span6">
                Committed
              </span>
              <span class="span1 tright">
                500,000
              </span>
              <span class="span5 tright">
                Likely to quota<br>56%
              </span>
            </div>
            <div class="row-fluid">
              <span class="span6">
                Closed
              </span>
              <span class="span1 tright">
                650,000
              </span>
              <span class="span5 tright">
                Likely to close<br>
                  56%
              </span>
            </div>
        </div>

    </div>
    <div class="tab-pane" id="file1">
        <div class="block" id="">
            <a href="#overview" data-toggle="tab" class="actions"><i class="icon-remove"></i></a>
            <h4>Screenshot_766.png</h4>
            <br>
            <img src="http://placehold.it/400x300">
            <div class="card2">
                <div class="row-fluid">
                    <div class="span3">Added:</div>
                    <div class="span9">1 hour ago at 3:00 pm EST</div>
                </div>
                <div class="row-fluid">
                    <div class="span3">Added By:</div>
                    <div class="span9"><a href="profile_skhan.html">Sabra Khan</a></div>
                </div>
                <div class="row-fluid">
                    <div class="span3">File Type:</div>
                    <div class="span9">PNG</div>
                </div>
            </div>
        </div>
    </div>
</div>
