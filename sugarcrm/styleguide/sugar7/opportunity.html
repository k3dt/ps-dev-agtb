<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Opportunities - SugarCRM</title>
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="../css/bootstrap.css" rel="stylesheet">
</head>
<body>
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container-fluid">
        <div class="nav-collapse">
          <ul class="nav">
            <li><a class="cube" href="dashboard.html" rel="tooltip" title="Dashboard"></a></li>
            <li class="active"><a href="opportunity.html">Opportunities</a></li>
            <li><a href="forecast.html">Forecasts</a></li>
          </ul>
          <ul class="nav pull-right">
            <li class="divider-vertical"></li>
            <li class="dropdown">
              <a href="#" class="btn btn-danger dropdown-toggle" data-toggle="dropdown">3</a>
              <ul class="dropdown-menu">
                <li><a href="">System-wide maintenance &hellip;</a></li>
                <li class="divider"></li>
                <li><a href="">Upgrade to 7.0!</a></li>
                <li class="divider"></li>                       
                <li><a href="">Please take our survey.</a></li>
              </ul>
            </li>
            <li class="divider-vertical"></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><img src="../img/avatar_sabra.jpg" alt="skahn" class="avatar"><b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="profile_skhan.html">Profile</a></li>
                <li><a href="#">Password</a></li>
                <li><a href="#">Advanced</a></li>
                <li><a href="#">External Accounts</a></li>
                <li class="divider"></li>
                <li><a href="#">Log Out</a></li>
              </ul>
            </li>
            <li class="divider-vertical"></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-plus icon-md"></i> <b class="caret"></b></a>
              <ul class="dropdown-menu quick">
                <li><a href="create_account.html">Create Account</a></li>
                <li><a data-toggle="modal" href="#contactModal">Create Contact</a></li>
                <li><a href="create.html">Create Opportunity</a></li>
              </ul>
            </li>              
          </ul>
          <div id="searchForm">
            <form class="navbar-search pull-right" action="">
              <input type="text" class="search-query span2" placeholder="Search" data-provide="typeahead" data-items="10" data-source="[&quot;Bad links in Pitch&quot;,&quot;Broken images in pdf&quot;,&quot;Misspellings everywhere&quot;,&quot;404 on faq&quot;,&quot;HTML is broken&quot;,&quot;Page link is not redirecting&quot;,&quot;Improper text in search placeholder&quot;,&quot;Misaligned elements&quot;,&quot;Need new text on log in&quot;,&quot;Image broken on profile&quot;]">&nbsp;&nbsp;&nbsp; 
              <div class="advanced">
                <div class="btn-toolbar pull-right">
                  <div class="btn-group">
                    <a class="btn btn-invisible dropdown-toggle" data-toggle="dropdown" href="#">
                      <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                      <li class="title">Advanced Search:</li>
                      <li class="divider"></li>
                      <li><input type="checkbox"> Accounts</li>
                      <li><input type="checkbox"> Cases</li>
                      <li><input type="checkbox"> Opportunities</li>
                      <li><input type="checkbox"> Reports</li>
                    </ul>
                    <a class="btn" href="#"><i class="icon icon-search"></i></a>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div><!-- /.nav-collapse -->
      </div>
    </div><!-- /navbar-inner -->
  </div>
  <div class="container-fluid" id="dashboard">
    <div class="thumbnav">
      <ul>
        <li><a href="" class=""><i class="icon-plus"></i><br><b>New</b></a></li>
      </ul>
    </div>
    <div class="row-fluid">
      <div class="span8 content">
        <h1>Opportunities</h1>
        <table class="table datatable">
          <thead>
            <tr>
              <th class="nosort">
                <div class="btn-group">
                  <b class="btn" rel="tooltip" data-original-title="Actions for the data table"><input type="checkbox" class="toggle-all"></b>
                  <a class="btn dropdown-toggle" data-toggle="dropdown" href="#"> <span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    <li><a href="#">Email</a></li>
                    <li><a href="#">Mass Update</a></li>
                    <li><a href="#">Merge</a></li>
                    <li><a href="#">Export</a></li>
                  </ul>
                </div>
              </th>
              <th>Name</th>
              <th>Stage</th>
              <th>Amount</th>
              <th>Account</th>
              <th>Probability</th>
              <th>Close Date</th>
              <th class="nosort"></th>
            </tr>
          </thead>
          <tbody id="listed">
            <tr>
              <td><input type="checkbox"> <i class="icon-star"></i></td>
              <td><a href="opportunity_plato.html">Plato's LED Financial Apps</a></td>
              <td><span class="dblclick">Prospecting</span></td>
              <td><span class="dblclick">$300,000 (USD)</span></td>
              <td><span class="dblclick">Plato's LED MFT</span></td>
              <td><span class="dblclick">30%</span></td>
              <td><span class="dblclick">06/06/2012</span></td>
              <td>
                <span class="hide actions dropdown pull-right">
                  <div class="actions">
                    <a data-toggle="tab" href="#file1"><i class="icon-eye-open" rel="tooltip" data-title="Preview"></i></a>
                  </div>
                </span>
              </td>
            </tr>                                                                                                                                                                                                                                                                                                                                                                          
          </tbody>
        </table>
      </div>  
      <div class="span4 tab-content" id="folded">
        <div class="tab-pane active" id="overview">
          <div class="thumbnail viz">
            <h4>Report: Sales Stage</h4>
              <div class="chartContainer">
                <div id="legenddb620e51-8350-c596-06d1-4f866bfcfd5b" class="legend"></div>
                <div id="sbdb620e51-8350-c596-06d1-4f866bfcfd5b" class="scrollBars">
                    <div id="db620e51-8350-c596-06d1-4f866bfcfd5b" class="chartCanvas" style="width: 99%; height: 200px;"></div>
                </div>
              </div>
          </div>
           
        </div>
        <div class="tab-pane" id="file1">
           <div class="block" id="">
              <a href="#overview" data-toggle="tab" class="actions"><i class="icon-remove"></i></a>
              <h4>Screenshot_766.png</h4>
              <br>
              <img src="http://placehold.it/400x300">
              <div class="card2">
                <div class="row-fluid">
                   <div class="span3">Added:</div>
                   <div class="span9">1 hour ago at 3:00 pm EST</div>
                 </div>
                 <div class="row-fluid">
                   <div class="span3">Added By:</div>
                   <div class="span9"><a href="profile_skhan.html">Sabra Khan</a></div>
                 </div>
                 <div class="row-fluid">
                   <div class="span3">File Type:</div>
                   <div class="span9">PNG</div>     
                 </div>
               </div>
            </div>
        </div>
  </div>
  </div>
  </div>
  <footer>
    <div class="row-fluid">
      <div class="span6">
        <a href="" class="logo">SugarCRM</a> 
      </div>        
      <div class="span6">
        <div class="btn-toolbar pull-right">
          <div class="btn-group">
            <a data-toggle="modal" title="Activity View Tour" href="#systemTour" class="btn btn-invisible"><i class="icon-road"></i> Tour</a>
            <a data-toggle="modal" title="Feedback" href="#systemFeedback" class="btn btn-invisible"><i class="icon-comment"></i> Feedback</a> 
            <a data-toggle="modal" title="Support" href="#systemSupport" class="btn btn-invisible"><i class="icon-question-sign"></i> Support</a>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script src="../js/jquery-1.7.2.min.js"></script>
  <script src="../js/bootstrap-transition.js"></script>
  <script src="../js/bootstrap-alert.js"></script>
  <script src="../js/bootstrap-modal.js"></script>
  <script src="../js/bootstrap-collapse.js"></script>
  <script src="../js/bootstrap-dropdown.js"></script>
  <script src="../js/bootstrap-scrollspy.js"></script>
  <script src="../js/bootstrap-tab.js"></script>
  <script src="../js/bootstrap-tooltip.js"></script>
  <script src="../js/bootstrap-popover.js"></script>
  <script src="../js/bootstrap-button.js"></script>
  <script src="../js/bootstrap-typeahead.js"></script>
  <script src="../js/bootstrapx-clickover.js"></script>          
  <script src="../js/jquery.dataTables.js"></script>

  <script src="../js/wicked.js"></script>        
  <script src="../js/jquery.jeditable.js"></script>        
  <script src="../js/editable.js"></script>
  <script src="../js/chosen.jquery.min.js"></script>
  <script src="../js/jquery.jstree.js"></script>
  <script src="../js/jquery.prettynumber.js"></script>
  <script src="../js/jit.js"></script>
  <script src="../js/sugarCharts.js"></script>
  <script src="../js/cookie.js"></script>
  <script src="../js/application.js"></script>   


    <script>
        var chartId = 'db620e51-8350-c596-06d1-4f866bfcfd5b';
        var css = new Array();
        var chartConfig = new Array();
        css["gridLineColor"] = '#cccccc';
        css["font-family"] = 'Arial';
        css["color"] = '#000000';
        chartConfig["orientation"] = 'vertical';
        chartConfig["barType"] = 'stacked';
        chartConfig["tip"] = 'name';
        chartConfig["chartType"] ='barChart';
        chartConfig["imageExportType"] = 'png';
        chartConfig["showNodeLabels"] = false;
        chartConfig["showAggregates"] = false;
        chartConfig["saveImageTo"] = "";
        chartConfig["dataPointSize"] = 5;

        var forecast = null;
        var chartFile = 'forecast-json-q1-month.js';
        forecast = new loadSugarChart(chartId,chartFile,css,chartConfig);
    </script>
    <script type="text/javascript" charset="utf-8">
        /* Data set - can contain whatever information you want */
        function quarter(val) {
            var quarter = "";
            switch (val){
                case "2012-01-01 - 2012-03-30":
                    quarter = "q1";
                    break;
                case "2012-04-01 - 2012-06-30":
                    quarter = "q2";
                    break;
                case "2012-07-01 - 2012-09-30":
                    quarter = "q3";
                    break;
                case "2012-10-01 - 2012-12-30":
                    quarter = "q4";
                    break;
            }

            return quarter;

        }


        $(document).ready(function() {

            //$('#date_filter').ready(function(){
            $.fn.dataTableExt.afnFiltering.push(
                    function( oSettings, aData, iDataIndex ) {
                        var probability = parseFloat(aData[4].replace(/<div style='position:relative;'><span class='dblclick'>/,'').replace(/<\/span><\/div>/,''));
                        var probability_select = 0;
  //                      var probability_select = $('#probability_filter')[0].value;


                       //date filters
                        var dateRange = $('#date_filter')[0].value;

                        // parse the range from a single field into min and max, remove " - "
                        var dateMin = dateRange.substring(0,4) + dateRange.substring(5,7)  + dateRange.substring(8,10);
                        var dateMax = dateRange.substring(13,17) + dateRange.substring(18,20) + dateRange.substring(21,23);

                        // 4 here is the column where my dates are.
                        var date = aData[2];

                        // remove the time stamp out of my date
                        // 2010-04-11 20:48:22 -> 2010-04-11
                        date = date.substring(0,10);
                        // remove the "-" characters
                        // 2010-04-11 -> 20100411
                        date = date.substring(0,4) + date.substring(5,7) + date.substring( 8,10 )

                        // run through cases
                        if ( (dateMin == "" && date <= dateMax) && (probability >= probability_select)){
                            return true;
                        }
                        else if ( (dateMin =="" && date <= dateMax)  && (probability >= probability_select)){
                            return true;
                        }
                        else if ( (dateMin <= date && "" == dateMax)  && (probability >= probability_select)){
                            return true;
                        }
                        else if ( (dateMin <= date && date <= dateMax)  && (probability >= probability_select)){
                            return true;
                        }


                        return false;
                    }
            );


            //});

            function fnFormatDetails ( oTable, nTr )
            {
                var aData = oTable.fnGetData( nTr );
                var sOut = '<div>'+aData[8]+'</div>';

                return sOut;
            }



            $('#dynamic').html( '<table cellpadding="0" cellspacing="0" border="0" class="table table-striped datatableInput data2" id="example"><thead></thead><tbody></tbody><tfoot><tr><th colspan="5" style="text-align: right;">Commited Total</th><th></th><th></th><th></th></tr><tr class="overall"><th colspan="5" style="text-align: right;">Overall Total</th><th></th><th></th><th></th></tr></tfoot></table>' );
            var oTable = $('#example').dataTable( {


  //              "bFilter": true,
                "bInfo":false,
                "bPaginate": false,
                "bProcessing": true,
                "sAjaxSource": 'james_json.txt' ,
                "aoColumns": [



                    {
                        "sTitle": "Commit",
                        "bSortable": false,
                        "sClass": "tcenter",
                        "fnRender": function(obj) {
                            var sReturn = obj.aData[ obj.iDataColumn ];
                            var ret = "<input class='tog' type='checkbox' name='checkbox-"+sReturn+"' id='checkbox-"+sReturn+"' checked />";
                            return ret;
                        }
                    },
                    {
                        "sTitle": "Opportunity",
                        "sWidth": "30%"
                    },
                    { "sTitle": "Close Date" },
                    { "sTitle": "Stage" },
                    { "sTitle": "Probability",
                        "fnRender": function(obj) {
                            var sReturn = obj.aData[ obj.iDataColumn ];
                            var ret = "<div style='position:relative;'><span class='dblclick'>" + sReturn + "</span></div>";
                            return ret;
                        }
                    },
                    { "sTitle": "Amount",
                        "fnRender": function(obj) {
                            var sReturn = obj.aData[ obj.iDataColumn ];
                            var ret = "<span class='format'>" + sReturn + "</span>";
                            return ret;
                        }
                    },
                    { "sTitle": "Best",
                        "fnRender": function(obj) {
                            var sReturn = obj.aData[ obj.iDataColumn ];
                            var ret = "<span class='format'>" + sReturn + "</span>";
                            return ret;
                        }
                    },
                    { "sTitle": "Likely",
                        "fnRender": function(obj) {
                            var sReturn = obj.aData[ obj.iDataColumn ];
                            var ret = "<div style='position:relative;'><span class='dblclick format'>" + sReturn + "</span></div>";
                            return ret;
                        }
                    }

                ],
                "fnRowCallback": function( nRow, aData, iDisplayIndex, iDisplayIndexFull ) {
                    // Bold the grade for all 'A' grade browsers

                        $('td .format', nRow).prettynumber({delimiter : ','});


                },
                "fnInitComplete": function(oSettings, json) {

                    /* for line items
                    var nCloneTh = document.createElement( 'th' );

                    $('#example thead tr').each( function () {
                        $(this).append(nCloneTh);
                    } );


                    $('#example tbody tr').each( function () {
                        var nCloneTd = document.createElement( 'td' );
                        nCloneTd.innerHTML = '<i class="icon-plus-sign"></i>';
                        nCloneTd.className = "center";
                        $(this).append(nCloneTd);
                    } );

                    $('#example tbody td i').live('click', function () {
                        var nTr = $(this).parents('tr')[0];
                        if ( oTable.fnIsOpen(nTr) )
                        {
                            // This row is already open - close it *
                            $(this).attr("class","icon-plus-sign");
                            oTable.fnClose( nTr );
                        }
                        else
                        {
                            //Open this row
                            $(this).attr("class","icon-minus-sign");
                            var colspan = $(nTr).children('td').length;

                            oTable.fnOpen( nTr, fnFormatDetails(oTable, nTr), 'details' );
                            $(nTr).next().children("td").attr("colspan",colspan);
                        }
                    } );
        */

                    $('input.tog').click(function(){

                            var nTr = $(this).parents('tr')[0];

                              if(!$(this).attr('checked')) {
                                  $(nTr).addClass('disabled');
                              } else {
                                  $(nTr).removeClass('disabled');
                              }

                            var iStart = oSettings._iDisplayStart;
                            var iEnd = oSettings._iDisplayEnd;
                            var aiDisplay = oSettings.aiDisplay;
                            var amountTotal = 0;
                            var bestTotal = 0;
                            var likelyTotal = 0;
                            //

                            $('#example tbody').children('tr').each(function(i) {
                                var tdInclude = $(this).children('td')[0];
                                var isChecked = $(tdInclude).find('input').attr('checked');
                                var tdAmount =$(this).children('td')[5];
                                var tdBest =$(this).children('td')[6];
                                var tdLikely =$(this).children('td')[7];



                                if(isChecked) {

                                    amountTotal += parseFloat($(tdAmount).find('span').html().replace(/,/,""));
                                    bestTotal += parseFloat($(tdBest).find('span').html().replace(/,/,""));
                                    likelyTotal += parseFloat($(tdLikely).find('span').html().replace(/,/,""));
                                }

                            }) ;
                            var foot = $(oTable).children('tfoot')[0];
                            var trs = $(foot).children('tr');
                            var included = $(trs)[0];
                            var includedCells =  $(included).children('th');

                            $(includedCells[1]).html(amountTotal).prettynumber({delimiter : ','});
                            $(includedCells[2]).html(bestTotal).prettynumber({delimiter : ','});
                            $(includedCells[3]).html(likelyTotal).prettynumber({delimiter : ','});

                            $('h2#best').html(bestTotal).prettynumber({delimiter : ','});
                            $('h2#likely').html(likelyTotal).prettynumber({delimiter : ','});
                    })


                    $('[rel="clickover"]').clickover() ;
                    $('[rel="clickoverTop"]').clickover({placement: "top"}) ;
                    $('[rel="clickoverBottom"]').clickover({placement: "bottom"}) ;
                },
                "fnFooterCallback": function ( nFoot, aaData, iStart, iEnd, aiDisplay ) {
                    var amountTotal = 0;
                    var bestTotal = 0;
                    var likelyTotal = 0;
                    for ( var i=iStart ; i<iEnd ; i++ )
                    {
                        amountTotal += parseFloat(aaData[ aiDisplay[i] ][5].replace(/<span class='format'>/,'').replace(/<\/span>/,''));
                        bestTotal += parseFloat(aaData[ aiDisplay[i] ][6].replace(/<span class='format'>/,'').replace(/<\/span>/,''));
                        likelyTotal += parseFloat(aaData[ aiDisplay[i] ][7].replace(/<div style='position:relative;'><span class='dblclick format'>/,'').replace(/<\/span><\/div>/,''));
                    }

                    /* Modify the footer row to match what we want */
  //                  var nCells = nFoot.getElementsByTagName('th');
                    var foot = $(oTable).children('tfoot')[0];
                    var trs = $(foot).children('tr');
                    var overall = $(trs)[1];
                    var included = $(trs)[0];
                    var overallCells =  $(overall).children('th');
                    var includedCells =  $(included).children('th');
  //                  console.log($(overall).children('th'))
                    $(overallCells[1]).html(amountTotal).prettynumber({delimiter : ','});
                    $(overallCells[2]).html(bestTotal).prettynumber({delimiter : ','});
                    $(overallCells[3]).html(likelyTotal).prettynumber({delimiter : ','});
                    $(includedCells[1]).html(amountTotal).prettynumber({delimiter : ','});
                    $(includedCells[2]).html(bestTotal).prettynumber({delimiter : ','});
                    $(includedCells[3]).html(likelyTotal).prettynumber({delimiter : ','});

                    $('h2#best').html(bestTotal).prettynumber({delimiter : ','});
                    $('h2#likely').html(likelyTotal).prettynumber({delimiter : ','});



                },
                "fnDrawCallback": function( oSettings ) {
                    $('#example tbody td .dblclick').editable('save.php',{
                        //loadurl: "load.php",
                        indicator : 'Saving ...',
                        cssclass   : "editable",
                        callback : function(value, settings) {
                            var val  = parseInt(value.replace(/,/,''));
                            //updateChart("forecast-json-update.js",forecast.chartObject);

                            var cellIndex = $(this).parent().parent()[0].cellIndex;
                            var rowIndex = $(this).parent().parent().parent()[0]._DT_RowIndex;


  //                                                 console.log(forecast.chartObject.json)

                            oTable.fnUpdate( val, rowIndex, cellIndex);


                            var likely = $('h2#likely').html().replace(/,/,"")
                            var json =  forecast.chartObject.json;
                            $(json.values).each( function(i) {
                                if(rowIndex == i) {
                                    this.goalmarkervalue[1] =  val/1000;
                                    this.goalmarkervaluelabel[1] =  val/1000+"K";
                                }
                            });

                            updateChart(forecast.chartObject);
                            oTable.fnDraw();
                            //return (value);
                        }
                    });

                }
            } );



             // editable example
            $(".dblclick").live({

                mouseenter:function(){
                    $(this).before('<span class="span2" style=" border-right: medium none; position: absolute; left: -15px; top: 0px; width: 15px"><i class="icon-pencil icon-sm"></i></span>');
                } ,
                mouseleave:function(){
                    $('span.span2').remove();
                }
            });





    //$('.datatableInput ').dataTable({ aoColumnDefs: [{ bSortable: false, aTargets: [0,8]}],"bPaginate": false,"bFilter": true,"bInfo": false,"bAutoWidth": false });

    //init chart


    //chart types
    $('.icon-play').parent().click(function(e){
      e.preventDefault();
      chartConfig["chartType"] = 'funnelChart';
        chartConfig["funnelType"] = 'basic';
      forecast = swapChart(chartId,'forecast-json-funnel.js',css,chartConfig);
      var that = this;
      $('#chartType .btn-group').children("a").each(function() {
        $(this).removeClass('active');
        $(that).addClass('active');
      });
    });

    $('.icon-signal').parent().click(function(e){
      e.preventDefault();
      chartConfig["chartType"] = 'barChart';
      chartConfig["barType"] = 'stacked';
      chartConfig["orientation"] = 'vertical';

      forecast = swapChart(chartId,'forecast-json-month.js',css,chartConfig);
      var that = this;
      $('#chartType .btn-group').children("a").each(function() {
        $(this).removeClass('active');
        $(that).addClass('active');
      });
    });



    $("#date_filter").chosen().change(function(formData){
        var q = quarter(formData.target.value);
        oTable.fnDraw();
        chartFile =  'forecast-json-'+q+'-month.js';
        forecast = swapChart(chartId,chartFile,css,chartConfig);
    }).ready(function(){
         var q = quarter($("#date_filter")[0].value);
        chartFile =  'forecast-json-'+q+'-month.js';
        forecast = swapChart(chartId,chartFile,css,chartConfig);
    });

    $("#group_by").chosen().change(function(data){
        forecast = swapChart(chartId,'forecast-json-'+data.target.value+'.js',css,chartConfig);
    });


    $("#probability_filter").chosen().change(function(formData){
  //    forecast = swapChart(chartId,'forecast-json-'+data.target.value+'.js',css,chartConfig);
        //console.log( oTable.fnFilter( data.target.value, 4 ))

        oTable.fnDraw();
        jQuery.ajax({
            url: "forecast-json-month.js?r=" + new Date().getTime(),
            dataType:"text",
            async: false,
            success: function(data) {

                if(data !== undefined && data != "No Data"){
                    var json = eval('('+data+')');


                    var likely = $('h2#likely').html().replace(/,/,"");
                    $(json.values).each( function(i)    {
                        var probability = this.probability;
                        var that = this;
  //          console.log(probability)
                        $.each(probability , function(j,prob) {
                            if(prob < formData.target.value)    {
                                that.values[j] = 0;
                                that.goalmarkervalue[1] =  likely/1000;
                                that.goalmarkervaluelabel[1] =  likely/1000+"K";

                            }
                        });

                    });
                    forecast.chartObject.json = json;
                    updateChart(forecast.chartObject);

                }
            }
        });





    });


    $("#people").jstree({
        "json_data" : {
            "data" : [
                {
                    "data" : "Sabra Khan",
                    "state" : "open",
                    "metadata" : { id : 1 },
                    "children" : [

                        {"data" : "Mark Gibson","metadata" : { id : 2 }},
                        {"data" : "James Joplin","metadata" : { id : 3 }},
                        {"data" : "Terrence Li","metadata" : { id : 4 }},
                        {"data" : "Amy McCray","metadata" : { id : 5 }}
                    ]
                }
            ]
        },
  //                "themes" : { "theme" : "default", "dots" : false },
        "plugins" : [ "json_data", "ui", "types" ]

    })
            .bind("loaded.jstree", function () {
                // do stuff when tree is loaded
                $("#people").addClass("jstree-sugar");
                $("#people > ul").addClass("list");
                $("#people > ul > li > a").addClass("jstree-clicked");


            })
            .bind("select_node.jstree", function (e, data) {
                console.log("load data for id: " + jQuery.data(data.rslt.obj[0], "id"));
                data.inst.toggle_node(data.rslt.obj);
            });


            $("#sales_stage_filter").chosen().change(function(formData){
          oTable.fnFilter( formData.target.value, 3 );
        jQuery.ajax({
            url: "forecast-json-month.js?r=" + new Date().getTime(),
            dataType:"text",
            async: false,
            success: function(data) {

                if(data !== undefined && data != "No Data"){
                    var json = eval('('+data+')');


                    var likely = $('h2#likely').html().replace(/,/,"");
                    $(json.values).each( function(i)    {
                        var sales_stage = this.sales_stage;
                        var that = this;
  //          console.log(probability)
                        $.each(sales_stage , function(j,stage) {
                            if(stage != formData.target.value && formData.target.value != "")    {
                                that.values[j] = 0;
                                that.goalmarkervalue[1] =  likely/1000;
                                that.goalmarkervaluelabel[1] =  likely/1000+"K";
                            }
                        });

                    });
                    forecast.chartObject.json = json;
                    updateChart(forecast.chartObject);

                }
            }
        });

    });

    $("#x-axis").chosen().change(function(data){
      forecast = swapChart(chartId,'forecast-json-'+data.target.value+'.js',css,chartConfig);
    });
    $("#groupby").chosen().change(function(data){
      forecast = swapChart(chartId,'forecast-json-q1-'+data.target.value+'.js',css,chartConfig);
    });
    $("#dataset").chosen().change(function(data){
        forecast = swapChart(chartId,'forecast-json-q1-month'+data.target.value+'.js',css,chartConfig);
    });

  });


  </script>  
  </body>
  </html>
