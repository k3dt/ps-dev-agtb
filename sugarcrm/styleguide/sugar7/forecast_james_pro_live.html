<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Forecast: James Joplin for Q1 2012 - SugarCRM</title>
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- styles -->
  <link href="../css/bootstrap.css" rel="stylesheet">
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600' rel='stylesheet' type='text/css'>
    <style type="text/css">

        .icon-play:before {
            -webkit-transform: rotate(90deg);
            -moz-transform: rotate(90deg);
            filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
        }



    </style>
</head>
<body id="forecast">
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container-fluid">
        <div class="nav-collapse">
          <ul class="nav">
            <li>
              <a class="cube" href="dashboard.html" rel="tooltip" title="Dashboard"></a>
            </li>
            <li>
              <a href="accounts.html">Accounts</a>
            </li>
            <li class="">
              <a href="contacts.html">Contacts</a>
            </li>              
            <li>
              <a href="opportunity.html">Opportunities</a>
            </li>              
            <li class="active">
              <a href="#">Forecasts</a>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">More <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li id="gen17"><a href="index.php?module=Campaigns&amp;action=index" id="moduleTab_Campaigns">Campaigns</a></li>
                <li id="gen18"><a href="index.php?module=Quotes&amp;action=index" id="moduleTab_Quotes">Quotes</a></li>
                <li id="gen19"><a href="#ajaxUILoc=index.php%3Fmodule%3DSubscriptions%26action%3Dindex" id="moduleTab_Subscriptions">Subscriptions</a></li>
                <li id="gen23"><a href="index.php?module=Documents&amp;action=index" id="moduleTab_Documents">Documents</a></li>
                <li id="gen24"><a href="index.php?module=P1_Partners&amp;action=index" id="moduleTab_P1_Partners">oppQ</a></li>
                <li id="gen25"><a href="index.php?module=Emails&amp;action=index" id="moduleTab_Emails">Emails</a></li>
                <li id="gen26"><a href="index.php?module=Products&amp;action=index" id="moduleTab_Products">Products</a></li>
                <li id="gen27"><a href="#ajaxUILoc=index.php%3Fmodule%3DCases%26action%3Dindex" id="moduleTab_Cases">Cases</a></li>
                <li class="divider"></li>
                <li><a href="#">Filter Menu By</a></li>
              </ul>
            </li>
          </ul>
          <ul class="nav pull-right">
            <li class="divider-vertical"></li>
            <li class="dropdown">
              <a href="#" class="btn btn-danger dropdown-toggle" data-toggle="dropdown">3</a>
              <ul class="dropdown-menu">
                <li><a href="">System-wide maintenance &hellip;</a></li>
                <li class="divider"></li>
                <li><a href="">Upgrade to 7.0!</a></li>
                <li class="divider"></li>                       
                <li><a href="">Please take our survey.</a></li>
              </ul>
            </li>
            <li class="divider-vertical"></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><img src="../img/avatar_sabra.jpg" alt="skahn avatar" class="avatar">skhan <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="profile_skhan.html">Profile</a></li>
                <li><a href="#">Password</a></li>
                <li><a href="#">Advanced</a></li>
                <li><a href="#">External Accounts</a></li>
                <li class="divider"></li>
                <li><a href="#">Log Out</a></li>
              </ul>
            </li>
            <li class="divider-vertical"></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-plus icon-white icon-md"></i> <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#">Create Account</a></li>
                <li><a data-toggle="modal" href="#contactModal">Create Contact</a></li>
                <li><a href="#">Create Opportunity</a></li>
              </ul>
            </li>              
          </ul>
          <form class="navbar-search pull-right" action="">
            <input type="text" class="search-query span3" placeholder="Search" data-provide="typeahead" data-items="10" data-source="[&quot;Alabama&quot;,&quot;Alaska&quot;,&quot;Arizona&quot;,&quot;Arkansas&quot;,&quot;California&quot;,&quot;Colorado&quot;,&quot;Connecticut&quot;,&quot;Delaware&quot;,&quot;Florida&quot;,&quot;Georgia&quot;,&quot;Hawaii&quot;,&quot;Idaho&quot;,&quot;Illinois&quot;,&quot;Indiana&quot;,&quot;Iowa&quot;,&quot;Kansas&quot;,&quot;Kentucky&quot;,&quot;Louisiana&quot;,&quot;Maine&quot;,&quot;Maryland&quot;,&quot;Massachusetts&quot;,&quot;Michigan&quot;,&quot;Minnesota&quot;,&quot;Mississippi&quot;,&quot;Missouri&quot;,&quot;Montana&quot;,&quot;Nebraska&quot;,&quot;Nevada&quot;,&quot;New Hampshire&quot;,&quot;New Jersey&quot;,&quot;New Mexico&quot;,&quot;New York&quot;,&quot;North Dakota&quot;,&quot;North Carolina&quot;,&quot;Ohio&quot;,&quot;Oklahoma&quot;,&quot;Oregon&quot;,&quot;Pennsylvania&quot;,&quot;Rhode Island&quot;,&quot;South Carolina&quot;,&quot;South Dakota&quot;,&quot;Tennessee&quot;,&quot;Texas&quot;,&quot;Utah&quot;,&quot;Vermont&quot;,&quot;Virginia&quot;,&quot;Washington&quot;,&quot;West Virginia&quot;,&quot;Wisconsin&quot;,&quot;Wyoming&quot;]">
          </form>
        </div><!-- /.nav-collapse -->
      </div>
    </div><!-- /navbar-inner -->
  </div>
  <div class="subnav">
    <div class="btn-toolbar pull-left">
      <h1>Forecast: James Joplin for Q1 2012</h1>
    </div>
    <div class="btn-toolbar pull-right">
      <!-- <div class="btn-group">
        <a href="forecast_james.html" class="btn active">Opportunity</a>
        <a href="forecast_james_line.html" class="btn">Line Item</a>
      </div> -->
      <div class="btn-group">
        <a class="btn btn-success" href="#">Save</a>
        <a class="btn btn-success dropdown-toggle" data-toggle="dropdown" href="#">
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">
          <li><a href="#">Duplicate</a></li>
          <li class="divider"></li>
          <li><a href="#">Email</a></li>
          <li><a href="#">PDF</a></li>
          <li><a href="#">CSV</a></li>
        </ul>
      </div>
    </div>
  </div>         
  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span2" id="drawer">
        <a class="drawerTrig btn btn-mini pull-right"><i class="icon-chevron-left icon-sm"></i></a>
        <div class="bordered">
          <div class="block">
            <h4>Filters</h4>
            <div class="control-group">
              <label for="date_filter" class="control-label">Forecast Period:</label>
              <div class="controls ">
                <select id="date_filter" data-placeholder="Choose a account..." class="chzn-select span12" tabindex="0">
                  <option value="2012-01-01 - 2012-03-30" selected="selected">Q1 2012</option>
                  <option value="2012-04-01 - 2012-06-30">Q2 2012</option>
                  <option value="2012-07-01 - 2012-09-30">Q3 2012</option>
                  <option value="2012-10-01 - 2012-12-30">Q4 2012</option>
                </select>
              </div>
            </div>  
            <div class="control-group">
              <label for="sales_stage_filter" class="control-label">Sales Stage:</label>
              <div class="controls">
                <select id="sales_stage_filter" data-placeholder="Choose a account..." class="chzn-select span12" multiple tabindex="1">
                  <option value=""></option>
                  <option value="Closed" selected="selected">Closed</option>
                  <option value="Proposal" selected="selected">Proposal</option>
                  <option value="Negotiation" selected="selected">Negotiation</option>
                  <option value="Qualified" selected="selected">Qualified</option>
                </select>
              </div>
            </div>  
            <div class="control-group">
              <label for="probability_filter" class="control-label">Probability:</label>
              <div class="controls">
                <select id="probability_filter" data-placeholder="Choose a account..." class="chzn-select span12" tabindex="2">
                  <option value="10">10%</option>
                  <option value="20">20%</option>
                  <option value="30">30%</option>
                  <option value="40">40%</option>
                  <option value="50">50%</option>
                  <option value="60">60%</option>
                  <option value="70" selected="selected">70%</option>
                  <option value="80">80%</option>
                  <option value="90">90%</option>
                  <option value="100">100%</option>
                </select>
              </div>
            </div>  
          </ul>
        </div>
        <div class="block">
          <h4>Chart Options</h4>
          <div class="control-group">
            <label for="select01" class="control-label">Group By:</label>
            <div class="controls">
              <select data-placeholder="Choose a grouping..." class="chzn-select span12" tabindex="2">
                <option value="pk" selected="selected">Sales Stage</option> 
                <option value="pk">Probability</option> 
                <option value="pk">Forecast to Pipeline</option> 
              </select>
            </div>
          </div>
          <div class="control-group">
            <label for="select01" class="control-label">Data Set:</label>
            <div class="controls">
              <select data-placeholder="Choose a y-axis..." class="chzn-select span12" tabindex="2">
                <option value="pk" selected="selected">All</option> 
                <option value="pk">Best</option> 
                <option value="pk">Likely</option> 
                <option value="pk">Worst</option> 
              </select>
            </div>
          </div>
        </div>  
      </div>
    </div>
    <div id="charts" class="span10">
      <div class="row-fluid">
        <div class="span8">            
          <div id="chart" class="tcenter">
            <div class="chartContainer">
              <div id="legenddb620e51-8350-c596-06d1-4f866bfcfd5b" class="legend"></div>
                <div id="sbdb620e51-8350-c596-06d1-4f866bfcfd5b" class="scrollBars">
                    <div id="db620e51-8350-c596-06d1-4f866bfcfd5b" class="chartCanvas" style="width: 99%; height: 300px;"></div>
                </div>
            </div>
          </div>
        </div>
        <div class="span4">
          <div class="block" id="guages">
            <h4>Projected</h4>
            <div class="row-fluid">
              <strong>
                <div class="span6">
                  Quota
                </div>
                <div class="span6 tright">
                  $200,000
                </div>
              </strong>
            </div>
            <div class="row-fluid">
              <div class="span6">
                Likely to Quota
              </div>
              <div class="span1 tright">
                100%
              </div>
              <div class="span5 tright">
                $222,200,000
              </div>
            </div>
            <div class="row-fluid">
              <div class="span6">
                Likely to Closed
              </div>
              <div class="span1 tright">
                100%
              </div>
              <div class="span5 tright">
                $20,000
              </div>
            </div>
            <div class="row-fluid">
              <strong>
                <div class="span6">
                  Closed
                </div>
                <div class="span6 tright">
                  $200,000
                </div>
              </strong>
            </div>
            <div class="row-fluid">
              <div class="span6">
                Closed to Likely
              </div>
              <div class="span1 tright">
                5%
              </div>
              <div class="span5 tright">
                $2,200,000
              </div>
            </div>
            <div class="row-fluid">
              <div class="span6">
                Closed to Best
              </div>
              <div class="span1 tright">
                45%
              </div>
              <div class="span5 tright">
                $200,000
              </div>
            </div>
          </div>
          <div class="row-fluid">
            <div class="span4 tcenter">
              Opportunities<br>
              <strong>12</strong>
            </div>
            <div class="span4 tcenter">
              Revenue<br>
              <strong>120,000</strong>
            </div>
            <div class="span4 tcenter">
              Pipeline Size<br>
              <strong>x2</strong>
            </div>
          </div>
        </div>
      </div>
      <div class="topline thumbnail">
          <div class="title">
              James Joplin's<br>
              <h2>Forecast</h2>
          </div>
            <div class="datapoint1">
                Best<br>
                <h2 id="best"></h2>
            </div>
            <div class="divider"></div>
            <div class="datapoint2">
                Likely<br>
                <h2 id="likely"></h2>
            </div>
            <a href="forecast.html" class="btn btn-primary btn-large"><i class="icon-upload icon-md"></i> Commit</a>
        <hr>
        <div class="log drawer">
          <div class="title">
              <strong>Previous</strong>:  3 days ago on May 29, 2012 at 4:30 pm EST
          </div>
            <div class="datapoint1">
              123,300
            </div>
            <div class="divider"></div>
            <div class="datapoint2">
              123,300
            </div>
          <div class="toggle">
            <i class="icon-chevron-down"></i>
          </div>
        </div>
        <div class="hide extend">
            test
        </div>
        <div id="dynamic"></div>
      </div>
    </div>
  </div>
</div>                         
</div>

<footer>
  <div class="row-fluid">
    <div class="span6">
      <a href="" class="logo">SugarCRM</a> 
    </div>        
    <div class="span6">
      <div class="btn-toolbar pull-right">
        <div class="btn-group">
          <a data-toggle="modal" title="Activity View Tour" href="#systemTour" class="btn btn-invisible"><i class="icon-road"></i> Tour</a>
          <a data-toggle="modal" title="Feedback" href="#systemFeedback" class="btn btn-invisible"><i class="icon-comment"></i> Feedback</a> 
          <a data-toggle="modal" title="Support" href="#systemSupport" class="btn btn-invisible"><i class="icon-question-sign"></i> Support</a>
        </div>
      </div>
    </div>
  </div>
</footer>
<script src="../js/jquery-1.7.2.min.js"></script>
<script src="../js/bootstrap-transition.js"></script>
<script src="../js/bootstrap-alert.js"></script>
<script src="../js/bootstrap-modal.js"></script>
<script src="../js/bootstrap-collapse.js"></script>
<script src="../js/bootstrap-dropdown.js"></script>
<script src="../js/bootstrap-scrollspy.js"></script>
<script src="../js/bootstrap-tab.js"></script>
<script src="../js/bootstrap-tooltip.js"></script>
<script src="../js/bootstrap-popover.js"></script>
<script src="../js/bootstrap-button.js"></script>
<script src="../js/bootstrap-typeahead.js"></script>
<script src="../js/bootstrapx-clickover.js"></script>          
<script src="../js/jquery.dataTables.js"></script>

<script src="../js/wicked.js"></script>        
<script src="../js/jquery.jeditable.js"></script>        
<script src="../js/editable.js"></script>
<script src="../js/chosen.jquery.min.js"></script>
<script src="../js/jquery.jstree.js"></script>
<script src="../js/jquery.prettynumber.js"></script>
<script src="../js/jit.js"></script>
<script src="../js/sugarCharts.js"></script>
<script src="../js/cookie.js"></script>
<script src="../js/application.js"></script>   


  <script>
      var chartId = 'db620e51-8350-c596-06d1-4f866bfcfd5b';
      var css = new Array();
      var chartConfig = new Array();
      css["gridLineColor"] = '#cccccc';
      css["font-family"] = 'Arial';
      css["color"] = '#000000';
      chartConfig["orientation"] = 'vertical';
      chartConfig["barType"] = 'stacked';
      chartConfig["tip"] = 'name';
      chartConfig["chartType"] ='barChart';
      chartConfig["imageExportType"] = 'png';
      chartConfig["showNodeLabels"] = false;
      chartConfig["showAggregates"] = false;
      chartConfig["saveImageTo"] = "";

      var forecast = null;
      forecast = new loadSugarChart(chartId,'forecast-json-month.js',css,chartConfig);
  </script>
  <script type="text/javascript" charset="utf-8">
      /* Data set - can contain whatever information you want */



      $(document).ready(function() {

          //$('#date_filter').ready(function(){
          $.fn.dataTableExt.afnFiltering.push(
                  function( oSettings, aData, iDataIndex ) {
                      var probability = parseFloat(aData[4].replace(/<div style='position:relative;'><span class='dblclick'>/,'').replace(/<\/span><\/div>/,''));
                      var probability_select = $('#probability_filter')[0].value;


                     //date filters
                      var dateRange = $('#date_filter')[0].value;

                      // parse the range from a single field into min and max, remove " - "
                      var dateMin = dateRange.substring(0,4) + dateRange.substring(5,7)  + dateRange.substring(8,10);
                      var dateMax = dateRange.substring(13,17) + dateRange.substring(18,20) + dateRange.substring(21,23);

                      // 4 here is the column where my dates are.
                      var date = aData[2];

                      // remove the time stamp out of my date
                      // 2010-04-11 20:48:22 -> 2010-04-11
                      date = date.substring(0,10);
                      // remove the "-" characters
                      // 2010-04-11 -> 20100411
                      date = date.substring(0,4) + date.substring(5,7) + date.substring( 8,10 )

                      // run through cases
                      if ( (dateMin == "" && date <= dateMax) && (probability >= probability_select)){
                          return true;
                      }
                      else if ( (dateMin =="" && date <= dateMax)  && (probability >= probability_select)){
                          return true;
                      }
                      else if ( (dateMin <= date && "" == dateMax)  && (probability >= probability_select)){
                          return true;
                      }
                      else if ( (dateMin <= date && date <= dateMax)  && (probability >= probability_select)){
                          return true;
                      }


                      return false;
                  }
          );


          //});

          function fnFormatDetails ( oTable, nTr )
          {
              var aData = oTable.fnGetData( nTr );
              var sOut = '<div>'+aData[8]+'</div>';

              return sOut;
          }



          $('#dynamic').html( '<table cellpadding="0" cellspacing="0" border="0" class="table table-striped datatableInput" id="example"><thead></thead><tbody></tbody><tfoot><tr><th colspan="5"></th><th></th><th></th><th></th><th></th></tr></tfoot></table>' );
          var oTable = $('#example').dataTable( {

              "fnFooterCallback": function ( nFoot, aaData, iStart, iEnd, aiDisplay ) {

                  var amountTotal = 0;
                  var bestTotal = 0;
                  var likelyTotal = 0;
                  for ( var i=iStart ; i<iEnd ; i++ )
                  {
                      amountTotal += parseFloat(aaData[ aiDisplay[i] ][5].replace(/<div style='position:relative;'><span class='dblclick format'>/,'').replace(/<\/span><\/div>/,''));
                      bestTotal += parseFloat(aaData[ aiDisplay[i] ][6].replace(/<div style='position:relative;'><span class='dblclick format'>/,'').replace(/<\/span><\/div>/,''));
                      likelyTotal += parseFloat(aaData[ aiDisplay[i] ][7].replace(/<div style='position:relative;'><span class='dblclick format'>/,'').replace(/<\/span><\/div>/,''));
                  }

                  /* Modify the footer row to match what we want */
                  var nCells = nFoot.getElementsByTagName('th');
                  $(nCells[1]).html(amountTotal).prettynumber({delimiter : ','});
                  $(nCells[2]).html(bestTotal).prettynumber({delimiter : ','});
                  $(nCells[3]).html(likelyTotal).prettynumber({delimiter : ','});

                  $('h2#best').html(bestTotal).prettynumber({delimiter : ','});
                  $('h2#likely').html(likelyTotal).prettynumber({delimiter : ','});




              },
//              "bFilter": true,
              "bInfo":false,
              "bPaginate": false,
              "bProcessing": true,
              "sAjaxSource": 'james_json.txt' ,
              "aoColumns": [



                  {
                      "sTitle": "Included",
                      "bSortable": false,
                      "sClass": "tcenter",
                      "fnRender": function(obj) {
                          var sReturn = obj.aData[ obj.iDataColumn ];
                          var ret = "  <div class='iphone-toggle-buttons'><label for='checkbox-"+sReturn+"'><input type='checkbox' name='checkbox-"+sReturn+"' id='checkbox-"+sReturn+"' /><span>checkbox 0</span></label></div>";
                          return ret;
                      }
                  },
                  {
                      "sTitle": "Opportunity",
                      "sWidth": "30%"
                  },
                  { "sTitle": "Expected close" },
                  { "sTitle": "Stage" },
                  { "sTitle": "Probability",
                      "fnRender": function(obj) {
                          var sReturn = obj.aData[ obj.iDataColumn ];
                          var ret = "<div style='position:relative;'><span class='dblclick'>" + sReturn + "</span></div>";
                          return ret;
                      }
                  },
                  { "sTitle": "Amount",
                      "fnRender": function(obj) {
                          var sReturn = obj.aData[ obj.iDataColumn ];
                          var ret = "<div style='position:relative;'><span class='dblclick format'>" + sReturn + "</span></div>";
                          return ret;
                      }},
                  { "sTitle": "Best",
                      "fnRender": function(obj) {
                          var sReturn = obj.aData[ obj.iDataColumn ];
                          var ret = "<div style='position:relative;'><span class='dblclick format'>" + sReturn + "</span></div>";
                          return ret;
                      }
                  },
                  { "sTitle": "Likely",
                      "fnRender": function(obj) {
                          var sReturn = obj.aData[ obj.iDataColumn ];
                          var ret = "<div style='position:relative;'><span class='dblclick format'>" + sReturn + "</span></div>";
                          return ret;
                      }
                  }

              ],
              "fnRowCallback": function( nRow, aData, iDisplayIndex, iDisplayIndexFull ) {
                  // Bold the grade for all 'A' grade browsers

                      $('td .format', nRow).prettynumber({delimiter : ','});


              },
              "fnInitComplete": function(oSettings, json) {


                  var nCloneTh = document.createElement( 'th' );

                  $('#example thead tr').each( function () {
                      $(this).append(nCloneTh);
                  } );


                  $('#example tbody tr').each( function () {
                      var nCloneTd = document.createElement( 'td' );
                      nCloneTd.innerHTML = '<i class="icon-plus-sign"></i>';
                      nCloneTd.className = "center";
                      $(this).append(nCloneTd);
                  } );
                  
                  $('#example tbody td i').live('click', function () {
                      var nTr = $(this).parents('tr')[0];
                      if ( oTable.fnIsOpen(nTr) )
                      {
                          /* This row is already open - close it */
                          $(this).attr("class","icon-plus-sign");
                          oTable.fnClose( nTr );
                      }
                      else
                      {
                          /* Open this row */
                          $(this).attr("class","icon-minus-sign");
                          var colspan = $(nTr).children('td').length;

                          oTable.fnOpen( nTr, fnFormatDetails(oTable, nTr), 'details' );
                          $(nTr).next().children("td").attr("colspan",colspan);
                      }
                  } );
              },

              "fnDrawCallback": function( oSettings ) {
                  $('#example tbody td .dblclick').editable('save.php',{
                      //loadurl: "load.php",
                      indicator : 'Saving ...',
                      cssclass   : "editable",
                      callback : function(value, settings) {
                          var val  = parseInt(value.replace(/,/,''));
                          //updateChart("forecast-json-update.js",forecast.chartObject);


                          var json =  forecast.chartObject.json;

                          var cellIndex = $(this).parent().parent()[0].cellIndex;
                          var rowIndex = $(this).parent().parent().parent()[0]._DT_RowIndex;


//                                                 console.log(forecast.chartObject.json)

                          oTable.fnUpdate( val, rowIndex, cellIndex);


                          var likely = $('h2#likely').html().replace(/,/,"")
                          var json =  forecast.chartObject.json;
                          $(json.values).each( function(i) {
                              this.goalmarkervalue[1] =  likely/1000;
                              this.goalmarkervaluelabel[1] =  likely/1000+"K";
                          });

                          updateChart(forecast.chartObject);
                          oTable.fnDraw();
                          //return (value);
                      }
                  });

              }
          } );



           // editable example
          $(".dblclick").live({

              mouseenter:function(){
                  $(this).before('<span class="span2" style=" border-right: medium none; position: absolute; left: -25px; top: -8px; width: 15px"><i class="icon-pencil icon-sm"></i></span>');
              } ,
              mouseleave:function(){
                  $('span.span2').remove();
              }
          });




  //$('.datatableInput ').dataTable({ aoColumnDefs: [{ bSortable: false, aTargets: [0,8]}],"bPaginate": false,"bFilter": true,"bInfo": false,"bAutoWidth": false });

  //init chart


  //chart types
  $('.icon-play').parent().click(function(e){
    e.preventDefault();
    chartConfig["chartType"] = 'funnelChart';
      chartConfig["funnelType"] = 'basic';
    forecast = swapChart(chartId,'forecast-json-funnel.js',css,chartConfig);
    var that = this;
    $('#chartType .btn-group').children("a").each(function() {
      $(this).removeClass('active');
      $(that).addClass('active');
    });
  });

  $('.icon-signal').parent().click(function(e){
    e.preventDefault();
    chartConfig["chartType"] = 'barChart';
    chartConfig["barType"] = 'stacked';
    chartConfig["orientation"] = 'vertical';

    forecast = swapChart(chartId,'forecast-json-month.js',css,chartConfig);
    var that = this;
    $('#chartType .btn-group').children("a").each(function() {
      $(this).removeClass('active');
      $(that).addClass('active');
    });
  });


  $("#date_filter").chosen().change(function(formData){
      oTable.fnDraw();
      jQuery.ajax({
          url: "forecast-json-month.js?r=" + new Date().getTime(),
          dataType:"text",
          async: false,
          success: function(data) {

              if(data !== undefined && data != "No Data"){
                  var json = eval('('+data+')');
                  var dateRange = formData.target.value;
                  var dateMin = dateRange.substring(0,4) + dateRange.substring(5,7)  + dateRange.substring(8,10);
                  var dateMax = dateRange.substring(13,17) + dateRange.substring(18,20) + dateRange.substring(21,23);

                  var likely = $('h2#likely').html().replace(/,/,"");
                  $(json.values).each( function(i)    {
                      var close_date = this.close_date;
                      var that = this;
//          console.log(probability)
                      $.each(close_date , function(j,date) {
                          var newDate = date.substring(0,4) + date.substring(5,7) + date.substring( 8,10 );

                          if ( !(dateMin <= newDate && newDate <= dateMax)){
                              that.values[j] = 0;
                              that.goalmarkervalue[1] =  likely/1000;
                              that.goalmarkervaluelabel[1] =  likely/1000+"K";
                          }


                      });

                  });
                  forecast.chartObject.json = json;
                  updateChart(forecast.chartObject);

              }
          }
      });
  });

  $("#group_by").chosen().change(function(data){
      forecast = swapChart(chartId,'forecast-json-'+data.target.value+'.js',css,chartConfig);
  });


  $("#probability_filter").chosen().change(function(formData){
//    forecast = swapChart(chartId,'forecast-json-'+data.target.value+'.js',css,chartConfig);
      //console.log( oTable.fnFilter( data.target.value, 4 ))

      oTable.fnDraw();
      jQuery.ajax({
          url: "forecast-json-month.js?r=" + new Date().getTime(),
          dataType:"text",
          async: false,
          success: function(data) {

              if(data !== undefined && data != "No Data"){
                  var json = eval('('+data+')');


                  var likely = $('h2#likely').html().replace(/,/,"");
                  $(json.values).each( function(i)    {
                      var probability = this.probability;
                      var that = this;
//          console.log(probability)
                      $.each(probability , function(j,prob) {
                          if(prob < formData.target.value)    {
                              that.values[j] = 0;
                              that.goalmarkervalue[1] =  likely/1000;
                              that.goalmarkervaluelabel[1] =  likely/1000+"K";

                          }
                      });

                  });
                  forecast.chartObject.json = json;
                  updateChart(forecast.chartObject);

              }
          }
      });





  });


  $("#people").jstree({
      "json_data" : {
          "data" : [
              {
                  "data" : "Sabra Khan",
                  "state" : "open",
                  "metadata" : { id : 1 },
                  "children" : [

                      {"data" : "Mark Gibson","metadata" : { id : 2 }},
                      {"data" : "James Joplin","metadata" : { id : 3 }},
                      {"data" : "Terrence Li","metadata" : { id : 4 }},
                      {"data" : "Amy McCray","metadata" : { id : 5 }}
                  ]
              }
          ]
      },
//                "themes" : { "theme" : "default", "dots" : false },
      "plugins" : [ "json_data", "ui", "types" ]

  })
          .bind("loaded.jstree", function () {
              // do stuff when tree is loaded
              $("#people").addClass("jstree-sugar");
              $("#people > ul").addClass("list");
              $("#people > ul > li > a").addClass("jstree-clicked");


          })
          .bind("select_node.jstree", function (e, data) {
              console.log("load data for id: " + jQuery.data(data.rslt.obj[0], "id"));
              data.inst.toggle_node(data.rslt.obj);
          });


          $("#sales_stage_filter").chosen().change(function(formData){
        oTable.fnFilter( formData.target.value, 3 );
      jQuery.ajax({
          url: "forecast-json-month.js?r=" + new Date().getTime(),
          dataType:"text",
          async: false,
          success: function(data) {

              if(data !== undefined && data != "No Data"){
                  var json = eval('('+data+')');


                  var likely = $('h2#likely').html().replace(/,/,"");
                  $(json.values).each( function(i)    {
                      var sales_stage = this.sales_stage;
                      var that = this;
//          console.log(probability)
                      $.each(sales_stage , function(j,stage) {
                          if(stage != formData.target.value && formData.target.value != "")    {
                              that.values[j] = 0;
                              that.goalmarkervalue[1] =  likely/1000;
                              that.goalmarkervaluelabel[1] =  likely/1000+"K";
                          }
                      });

                  });
                  forecast.chartObject.json = json;
                  updateChart(forecast.chartObject);

              }
          }
      });

  });

  $("#x-axis").chosen().change(function(data){
    forecast = swapChart(chartId,'forecast-json-'+data.target.value+'.js',css,chartConfig);
  });
    $('[rel="clickover"]').clickover()
    $('[rel="clickoverTop"]').clickover({placement: "top"})
});
</script>  
</body>
</html>
